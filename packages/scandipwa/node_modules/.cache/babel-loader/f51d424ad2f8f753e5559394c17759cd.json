{"ast":null,"code":"import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{showNotification as _showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import{ProductType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/ProductList\";import{isSignedIn}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";import{BUNDLE,CONFIGURABLE,GROUPED}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";import AddToCart from\"./AddToCart.component\";export var CartDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Cart/Cart.dispatcher\");export var WishlistDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Wishlist/Wishlist.dispatcher\");/** @namespace Component/AddToCart/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{wishlistItems:state.WishlistReducer.productsInWishlist};},\"Component/AddToCart/Container/mapStateToProps\");/** @namespace Component/AddToCart/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{addProduct:function addProduct(options){return CartDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.addProductToCart(dispatch,options);});},removeFromWishlist:function removeFromWishlist(options){return WishlistDispatcher.then(function(_ref2){var dispatcher=_ref2.default;return dispatcher.removeItemFromWishlist(dispatch,options);});},showNotification:function showNotification(type,message){return dispatch(_showNotification(type,message));}};},\"Component/AddToCart/Container/mapDispatchToProps\");/* @namespace Component/AddToCart/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _AddToCartContainer=/*#__PURE__*/function(_Extensible){_inherits(_AddToCartContainer,_Extensible);var _super=_createSuper(_AddToCartContainer);function _AddToCartContainer(){var _this$validationMap,_this$addToCartHandle;var _this;_classCallCheck(this,_AddToCartContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isLoading:false};_this.containerFunctions={buttonClick:_this.buttonClick.bind(_assertThisInitialized(_this))};_this.validationMap=(_this$validationMap={},_defineProperty(_this$validationMap,CONFIGURABLE,_this.validateConfigurableProduct.bind(_assertThisInitialized(_this))),_defineProperty(_this$validationMap,GROUPED,_this.validateGroupedProduct.bind(_assertThisInitialized(_this))),_defineProperty(_this$validationMap,BUNDLE,_this.validateBundleProduct.bind(_assertThisInitialized(_this))),_this$validationMap);_this.addToCartHandlerMap=(_this$addToCartHandle={},_defineProperty(_this$addToCartHandle,CONFIGURABLE,_this.addConfigurableProductToCart.bind(_assertThisInitialized(_this))),_defineProperty(_this$addToCartHandle,GROUPED,_this.addGroupedProductToCart.bind(_assertThisInitialized(_this))),_this$addToCartHandle);return _this;}_createClass(_AddToCartContainer,[{key:\"validateConfigurableProduct\",value:function validateConfigurableProduct(){var _this$props=this.props,configurableVariantIndex=_this$props.configurableVariantIndex,showNotification=_this$props.showNotification,_this$props$product$v=_this$props.product.variants,variants=_this$props$product$v===void 0?[]:_this$props$product$v;if(configurableVariantIndex<0||!variants[configurableVariantIndex]){showNotification('info',__('Please select product options!'));return false;}var configurableStock=variants[configurableVariantIndex].stock_status;if(configurableStock!=='IN_STOCK'){showNotification('info',__('Sorry! The selected product option is out of stock!'));return false;}return true;}},{key:\"validateGroupedProduct\",value:function validateGroupedProduct(){var _this$props2=this.props,groupedProductQuantity=_this$props2.groupedProductQuantity,showNotification=_this$props2.showNotification,items=_this$props2.product.items;var isAllItemsAvailable=items.some(function(_ref3){var id=_ref3.product.id;return groupedProductQuantity[id];});if(!isAllItemsAvailable){showNotification('info',__('Please specify the quantity of product(s)!'));return false;}return true;}},{key:\"validateBundleProduct\",value:function validateBundleProduct(){var _this$props3=this.props,productOptionsData=_this$props3.productOptionsData,showNotification=_this$props3.showNotification;var validateBundleOptions=this.validateCustomizableOptions(productOptionsData,true);if(!validateBundleOptions){showNotification('info',__('Please select required option!'));return false;}return true;}},{key:\"validateSimpleProduct\",value:function validateSimpleProduct(){var _this$props4=this.props,productOptionsData=_this$props4.productOptionsData,showNotification=_this$props4.showNotification;var validateCustomizableOptions=this.validateCustomizableOptions(productOptionsData);if(!validateCustomizableOptions){showNotification('info',__('Please select required option!'));return false;}return true;}},{key:\"validateCustomizableOptions\",value:function validateCustomizableOptions(productOptionsData){var isBundle=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var _ref4=productOptionsData||{},_ref4$requiredOptions=_ref4.requiredOptions,requiredOptions=_ref4$requiredOptions===void 0?{}:_ref4$requiredOptions;if(requiredOptions.length){var productOptions=productOptionsData.productOptions,productOptionsMulti=productOptionsData.productOptionsMulti,_requiredOptions=productOptionsData.requiredOptions;return this.validateProductOptions([].concat(_toConsumableArray(productOptions||[]),_toConsumableArray(productOptionsMulti||[])),_requiredOptions,isBundle);}return true;}},{key:\"validateProductOptions\",value:function validateProductOptions(items,requiredOptions){var isBundle=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;// Make sure EVERY required option is FOUND in selected items\nreturn requiredOptions.every(function(requiredOption){return items.find(function(item){var id=item.id,option_id=item.option_id;var matchWith=isBundle?id:option_id;return requiredOption===matchWith;});});}},{key:\"validateAddToCart\",value:function validateAddToCart(){var type_id=this.props.product.type_id;var validationRule=this.validationMap[type_id];if(validationRule){return validationRule();}return this.validateSimpleProduct();}},{key:\"addGroupedProductToCart\",value:function addGroupedProductToCart(){var _this2=this;var _this$props5=this.props,product=_this$props5.product,items=_this$props5.product.items,groupedProductQuantity=_this$props5.groupedProductQuantity,addProduct=_this$props5.addProduct;Promise.all(items.map(function(item){var groupedProductItem=item.product;var newProduct=_objectSpread(_objectSpread({},groupedProductItem),{},{parent:product});var quantity=groupedProductQuantity[groupedProductItem.id];if(!quantity){return Promise.resolve();}return addProduct({product:newProduct,quantity:quantity});})).then(/** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllThen */middleware(function(){return _this2.afterAddToCart();},\"Component/AddToCart/Container/addGroupedProductToCartPromiseAllThen\"),/** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllCatch */middleware(function(){return _this2.resetLoading();},\"Component/AddToCart/Container/addGroupedProductToCartPromiseAllCatch\"));}},{key:\"addConfigurableProductToCart\",value:function addConfigurableProductToCart(){var _this3=this;var _this$props6=this.props,product=_this$props6.product,quantity=_this$props6.quantity,addProduct=_this$props6.addProduct,configurableVariantIndex=_this$props6.configurableVariantIndex,productOptionsData=_this$props6.productOptionsData;addProduct({product:_objectSpread(_objectSpread({},product),{},{configurableVariantIndex:configurableVariantIndex}),quantity:quantity,productOptionsData:productOptionsData}).then(/** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductThen */middleware(function(){return _this3.afterAddToCart();},\"Component/AddToCart/Container/addConfigurableProductToCartAddProductThen\"),/** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductCatch */middleware(function(){return _this3.resetLoading();},\"Component/AddToCart/Container/addConfigurableProductToCartAddProductCatch\"));}},{key:\"addSimpleProductToCart\",value:function addSimpleProductToCart(){var _this4=this;var _this$props7=this.props,product=_this$props7.product,quantity=_this$props7.quantity,addProduct=_this$props7.addProduct,productOptionsData=_this$props7.productOptionsData;addProduct({product:product,quantity:quantity,productOptionsData:productOptionsData}).then(/** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductThen */middleware(function(){return _this4.afterAddToCart();},\"Component/AddToCart/Container/addSimpleProductToCartAddProductThen\"),/** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductCatch */middleware(function(){return _this4.resetLoading();},\"Component/AddToCart/Container/addSimpleProductToCartAddProductCatch\"));}},{key:\"addProductToCart\",value:function addProductToCart(){var type_id=this.props.product.type_id;var addToCartHandler=this.addToCartHandlerMap[type_id];if(addToCartHandler){addToCartHandler();return;}this.addSimpleProductToCart();}},{key:\"buttonClick\",value:function buttonClick(){var _this5=this;var _this$props8=this.props,_this$props8$product=_this$props8.product;_this$props8$product=_this$props8$product===void 0?{}:_this$props8$product;var type_id=_this$props8$product.type_id,onProductValidationError=_this$props8.onProductValidationError,disableHandler=_this$props8.disableHandler;if(disableHandler){return;}if(!this.validateAddToCart()){onProductValidationError(type_id);return;}this.setState({isLoading:true},function(){return _this5.addProductToCart();});}},{key:\"resetLoading\",value:function resetLoading(){this.setState({isLoading:false});}},{key:\"removeProductFromWishlist\",value:function removeProductFromWishlist(){var _this$props9=this.props,wishlistItems=_this$props9.wishlistItems,removeFromWishlist=_this$props9.removeFromWishlist,configurableVariantIndex=_this$props9.configurableVariantIndex,_this$props9$product=_this$props9.product;_this$props9$product=_this$props9$product===void 0?{}:_this$props9$product;var type_id=_this$props9$product.type_id,_this$props9$product$=_this$props9$product.variants,variants=_this$props9$product$===void 0?{}:_this$props9$product$;if(type_id!=='configurable'){return;}var sku=variants[configurableVariantIndex].sku;var wishlistItemKey=Object.keys(wishlistItems).find(function(key){var wSku=wishlistItems[key].wishlist.sku;return wSku===sku;});if(!isSignedIn()||wishlistItemKey===undefined){return;}var item_id=wishlistItems[wishlistItemKey].wishlist.id;removeFromWishlist({item_id:item_id,sku:sku,noMessage:true});}},{key:\"afterAddToCart\",value:function afterAddToCart(){var _this$props10=this.props,showNotification=_this$props10.showNotification,setQuantityToDefault=_this$props10.setQuantityToDefault;showNotification('success',__('Product added to cart!'));setQuantityToDefault();this.removeProductFromWishlist();this.setState({isLoading:false});}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,AddToCart,Object.assign({},this.props,this.state,this.containerFunctions));}}]);return _AddToCartContainer;}(Extensible(PureComponent));_AddToCartContainer.defaultProps={quantity:1,configurableVariantIndex:0,setQuantityToDefault:function setQuantityToDefault(){},onProductValidationError:function onProductValidationError(){},isLoading:false,disableHandler:false};Object.defineProperty(_AddToCartContainer,'name',{value:'AddToCartContainer'});export var AddToCartContainer=middleware(_AddToCartContainer,\"Component/AddToCart/Container\");export default connect(mapStateToProps,mapDispatchToProps)(AddToCartContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/AddToCart/AddToCart.container.js"],"names":["PureComponent","connect","showNotification","ProductType","isSignedIn","BUNDLE","CONFIGURABLE","GROUPED","AddToCart","CartDispatcher","WishlistDispatcher","mapStateToProps","state","wishlistItems","WishlistReducer","productsInWishlist","mapDispatchToProps","dispatch","addProduct","options","then","dispatcher","default","addProductToCart","removeFromWishlist","removeItemFromWishlist","type","message","AddToCartContainer","isLoading","containerFunctions","buttonClick","bind","validationMap","validateConfigurableProduct","validateGroupedProduct","validateBundleProduct","addToCartHandlerMap","addConfigurableProductToCart","addGroupedProductToCart","props","configurableVariantIndex","product","variants","__","configurableStock","stock_status","groupedProductQuantity","items","isAllItemsAvailable","some","id","productOptionsData","validateBundleOptions","validateCustomizableOptions","isBundle","requiredOptions","length","productOptions","productOptionsMulti","validateProductOptions","every","requiredOption","find","item","option_id","matchWith","type_id","validationRule","validateSimpleProduct","Promise","all","map","groupedProductItem","newProduct","parent","quantity","resolve","afterAddToCart","resetLoading","addToCartHandler","addSimpleProductToCart","onProductValidationError","disableHandler","validateAddToCart","setState","sku","wishlistItemKey","Object","keys","key","wSku","wishlist","undefined","item_id","noMessage","setQuantityToDefault","removeProductFromWishlist","defaultProps","defineProperty","_AddToCartContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { ProductType } from 'Type/ProductList';\nimport { isSignedIn } from 'Util/Auth';\nimport {\n    BUNDLE,\n    CONFIGURABLE,\n    GROUPED\n} from 'Util/Product';\n\nimport AddToCart from './AddToCart.component';\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\n\nexport const WishlistDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Wishlist/Wishlist.dispatcher'\n);\n\n/** @namespace Component/AddToCart/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    wishlistItems: state.WishlistReducer.productsInWishlist\n});\n\n/** @namespace Component/AddToCart/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    addProduct: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.addProductToCart(dispatch, options)\n    ),\n    removeFromWishlist: (options) => WishlistDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.removeItemFromWishlist(dispatch, options)\n    ),\n    showNotification: (type, message) => dispatch(showNotification(type, message))\n});\n\n/* @namespace Component/AddToCart/Container */\nexport class AddToCartContainer extends PureComponent {\n    static propTypes = {\n        isLoading: PropTypes.bool,\n        product: ProductType.isRequired,\n        quantity: PropTypes.number,\n        configurableVariantIndex: PropTypes.number,\n        groupedProductQuantity: PropTypes.objectOf(PropTypes.number).isRequired,\n        showNotification: PropTypes.func.isRequired,\n        setQuantityToDefault: PropTypes.func,\n        addProduct: PropTypes.func.isRequired,\n        removeFromWishlist: PropTypes.func.isRequired,\n        wishlistItems: PropTypes.objectOf(ProductType).isRequired,\n        onProductValidationError: PropTypes.func,\n        productOptionsData: PropTypes.object.isRequired,\n        disableHandler: PropTypes.bool\n    };\n\n    static defaultProps = {\n        quantity: 1,\n        configurableVariantIndex: 0,\n        setQuantityToDefault: () => {},\n        onProductValidationError: () => {},\n        isLoading: false,\n        disableHandler: false\n    };\n\n    state = { isLoading: false };\n\n    containerFunctions = {\n        buttonClick: this.buttonClick.bind(this)\n    };\n\n    validationMap = {\n        [CONFIGURABLE]: this.validateConfigurableProduct.bind(this),\n        [GROUPED]: this.validateGroupedProduct.bind(this),\n        [BUNDLE]: this.validateBundleProduct.bind(this)\n    };\n\n    addToCartHandlerMap = {\n        [CONFIGURABLE]: this.addConfigurableProductToCart.bind(this),\n        [GROUPED]: this.addGroupedProductToCart.bind(this)\n    };\n\n    validateConfigurableProduct() {\n        const {\n            configurableVariantIndex,\n            showNotification,\n            product: {\n                variants = []\n            }\n        } = this.props;\n\n        if (configurableVariantIndex < 0 || !variants[configurableVariantIndex]) {\n            showNotification('info', __('Please select product options!'));\n            return false;\n        }\n\n        const { stock_status: configurableStock } = variants[configurableVariantIndex];\n\n        if (configurableStock !== 'IN_STOCK') {\n            showNotification('info', __('Sorry! The selected product option is out of stock!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateGroupedProduct() {\n        const {\n            groupedProductQuantity,\n            showNotification,\n            product: {\n                items\n            }\n        } = this.props;\n\n        const isAllItemsAvailable = items.some(({ product: { id } }) => groupedProductQuantity[id]);\n\n        if (!isAllItemsAvailable) {\n            showNotification('info', __('Please specify the quantity of product(s)!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateBundleProduct() {\n        const {\n            productOptionsData,\n            showNotification\n        } = this.props;\n\n        const validateBundleOptions = this.validateCustomizableOptions(productOptionsData, true);\n\n        if (!validateBundleOptions) {\n            showNotification('info', __('Please select required option!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateSimpleProduct() {\n        const {\n            productOptionsData,\n            showNotification\n        } = this.props;\n\n        const validateCustomizableOptions = this.validateCustomizableOptions(productOptionsData);\n\n        if (!validateCustomizableOptions) {\n            showNotification('info', __('Please select required option!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateCustomizableOptions(productOptionsData, isBundle = false) {\n        const {\n            requiredOptions = {}\n        } = productOptionsData || {};\n\n        if (requiredOptions.length) {\n            const {\n                productOptions,\n                productOptionsMulti,\n                requiredOptions\n            } = productOptionsData;\n\n            return this.validateProductOptions(\n                [...productOptions || [], ...productOptionsMulti || []],\n                requiredOptions,\n                isBundle\n            );\n        }\n\n        return true;\n    }\n\n    validateProductOptions(items, requiredOptions, isBundle = false) {\n        // Make sure EVERY required option is FOUND in selected items\n        return requiredOptions.every((requiredOption) => (\n            items.find((item) => {\n                const { id, option_id } = item;\n                const matchWith = isBundle ? id : option_id;\n                return requiredOption === matchWith;\n            })\n        ));\n    }\n\n    validateAddToCart() {\n        const {\n            product: { type_id }\n        } = this.props;\n\n        const validationRule = this.validationMap[type_id];\n\n        if (validationRule) {\n            return validationRule();\n        }\n\n        return this.validateSimpleProduct();\n    }\n\n    addGroupedProductToCart() {\n        const {\n            product,\n            product: { items },\n            groupedProductQuantity,\n            addProduct\n        } = this.props;\n\n        Promise.all(items.map((item) => {\n            const { product: groupedProductItem } = item;\n\n            const newProduct = {\n                ...groupedProductItem,\n                parent: product\n            };\n\n            const quantity = groupedProductQuantity[groupedProductItem.id];\n\n            if (!quantity) {\n                return Promise.resolve();\n            }\n\n            return addProduct({\n                product: newProduct,\n                quantity\n            });\n        })).then(\n            /** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllThen */\n            () => this.afterAddToCart(),\n            /** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllCatch */\n            () => this.resetLoading()\n        );\n    }\n\n    addConfigurableProductToCart() {\n        const {\n            product,\n            quantity,\n            addProduct,\n            configurableVariantIndex,\n            productOptionsData\n        } = this.props;\n\n        addProduct({\n            product: {\n                ...product,\n                configurableVariantIndex\n            },\n            quantity,\n            productOptionsData\n        }).then(\n            /** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductThen */\n            () => this.afterAddToCart(),\n            /** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductCatch */\n            () => this.resetLoading()\n        );\n    }\n\n    addSimpleProductToCart() {\n        const {\n            product,\n            quantity,\n            addProduct,\n            productOptionsData\n        } = this.props;\n\n        addProduct({\n            product,\n            quantity,\n            productOptionsData\n        }).then(\n            /** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductThen */\n            () => this.afterAddToCart(),\n            /** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductCatch */\n            () => this.resetLoading()\n        );\n    }\n\n    addProductToCart() {\n        const {\n            product: { type_id }\n        } = this.props;\n\n        const addToCartHandler = this.addToCartHandlerMap[type_id];\n\n        if (addToCartHandler) {\n            addToCartHandler();\n            return;\n        }\n\n        this.addSimpleProductToCart();\n    }\n\n    buttonClick() {\n        const {\n            product: { type_id } = {},\n            onProductValidationError,\n            disableHandler\n        } = this.props;\n\n        if (disableHandler) {\n            return;\n        }\n\n        if (!this.validateAddToCart()) {\n            onProductValidationError(type_id);\n            return;\n        }\n\n        this.setState({ isLoading: true }, () => this.addProductToCart());\n    }\n\n    resetLoading() {\n        this.setState({ isLoading: false });\n    }\n\n    removeProductFromWishlist() {\n        const {\n            wishlistItems,\n            removeFromWishlist,\n            configurableVariantIndex,\n            product: { type_id, variants = {} } = {}\n        } = this.props;\n\n        if (type_id !== 'configurable') {\n            return;\n        }\n\n        const { sku } = variants[configurableVariantIndex];\n\n        const wishlistItemKey = Object.keys(wishlistItems)\n            .find((key) => {\n                const { wishlist: { sku: wSku } } = wishlistItems[key];\n                return wSku === sku;\n            });\n\n        if (!isSignedIn() || wishlistItemKey === undefined) {\n            return;\n        }\n\n        const { wishlist: { id: item_id } } = wishlistItems[wishlistItemKey];\n        removeFromWishlist({ item_id, sku, noMessage: true });\n    }\n\n    afterAddToCart() {\n        const {\n            showNotification,\n            setQuantityToDefault\n        } = this.props;\n\n        showNotification('success', __('Product added to cart!'));\n        setQuantityToDefault();\n\n        this.removeProductFromWishlist();\n        this.setState({ isLoading: false });\n    }\n\n    render() {\n        return (\n            <AddToCart\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerFunctions }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AddToCartContainer);\n"]},"metadata":{},"sourceType":"module"}