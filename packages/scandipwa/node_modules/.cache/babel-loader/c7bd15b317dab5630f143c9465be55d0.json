{"ast":null,"code":"import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{STORE_IN_PICK_UP_ATTRIBUTE_CODE,STORE_IN_PICK_UP_METHOD_CODE}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/StoreInPickUp/StoreInPickUp.config\";import{updateShippingFields as _updateShippingFields}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Checkout/Checkout.action\";import{customerType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Account\";import{shippingMethodsType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Checkout\";import{getFormFields,trimAddressFields,trimCustomerAddress}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Address\";import{getCartTotalSubPrice}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Cart\";import CheckoutShipping from\"./CheckoutShipping.component\";/** @namespace Component/CheckoutShipping/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{customer:state.MyAccountReducer.customer,addressLinesQty:state.ConfigReducer.address_lines_quantity,totals:state.CartReducer.cartTotals,cartTotalSubPrice:getCartTotalSubPrice(state)};},\"Component/CheckoutShipping/Container/mapStateToProps\");/** @namespace Component/CheckoutShipping/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{updateShippingFields:function updateShippingFields(fields){return dispatch(_updateShippingFields(fields));}};},\"Component/CheckoutShipping/Container/mapDispatchToProps\");/** @namespace Component/CheckoutShipping/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _CheckoutShippingContainer=/*#__PURE__*/function(_Extensible){_inherits(_CheckoutShippingContainer,_Extensible);var _super=_createSuper(_CheckoutShippingContainer);function _CheckoutShippingContainer(){var _this;_classCallCheck(this,_CheckoutShippingContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={onShippingSuccess:_this.onShippingSuccess.bind(_assertThisInitialized(_this)),onShippingError:_this.onShippingError.bind(_assertThisInitialized(_this)),onAddressSelect:_this.onAddressSelect.bind(_assertThisInitialized(_this)),onShippingMethodSelect:_this.onShippingMethodSelect.bind(_assertThisInitialized(_this)),onStoreSelect:_this.onStoreSelect.bind(_assertThisInitialized(_this))};return _this;}_createClass(_CheckoutShippingContainer,[{key:\"__construct\",value:function __construct(props){_get(_getPrototypeOf(_CheckoutShippingContainer.prototype),\"__construct\",this).call(this,props);var shippingMethods=props.shippingMethods;var _shippingMethods=_slicedToArray(shippingMethods,1),selectedShippingMethod=_shippingMethods[0];var _ref=selectedShippingMethod||{},_ref$method_code=_ref.method_code,method_code=_ref$method_code===void 0?'':_ref$method_code;this.state={selectedCustomerAddressId:0,isSubmitted:false,selectedShippingMethod:method_code&&method_code!==STORE_IN_PICK_UP_METHOD_CODE?selectedShippingMethod:{}};}},{key:\"getStoreAddress\",value:function getStoreAddress(shippingAddress){var _this$state$selectedS=this.state.selectedStoreAddress,region=_this$state$selectedS.region,city=_this$state$selectedS.city,postcode=_this$state$selectedS.postcode,phone=_this$state$selectedS.phone,street=_this$state$selectedS.street,name=_this$state$selectedS.name,pickup_location_code=_this$state$selectedS.pickup_location_code;return _objectSpread(_objectSpread({},shippingAddress),{},{region:region,city:city,postcode:postcode,telephone:phone,street:[street],firstname:name,lastname:'Store',extension_attributes:[{attribute_code:STORE_IN_PICK_UP_ATTRIBUTE_CODE,value:pickup_location_code}]});}},{key:\"onAddressSelect\",value:function onAddressSelect(id){this.setState({selectedCustomerAddressId:id});}},{key:\"onShippingMethodSelect\",value:function onShippingMethodSelect(method){this.setState({selectedShippingMethod:method});}},{key:\"onShippingError\",value:function onShippingError(){// TODO: implement notification if some data in Form can not display error\nvar isSubmitted=this.state.isSubmitted;this.setState({isSubmitted:!isSubmitted});}},{key:\"onStoreSelect\",value:function onStoreSelect(address){this.setState({selectedStoreAddress:address});}},{key:\"onShippingSuccess\",value:function onShippingSuccess(fields){var _this$props=this.props,saveAddressInformation=_this$props.saveAddressInformation,updateShippingFields=_this$props.updateShippingFields,addressLinesQty=_this$props.addressLinesQty;var _this$state=this.state,selectedCustomerAddressId=_this$state.selectedCustomerAddressId,selectedShippingMethod=_this$state.selectedShippingMethod,selectedStoreAddress=_this$state.selectedStoreAddress;var formFields=getFormFields(fields,addressLinesQty);var shippingAddress=selectedCustomerAddressId?this._getAddressById(selectedCustomerAddressId):trimAddressFields(formFields);var shipping_carrier_code=selectedShippingMethod.carrier_code,shipping_method_code=selectedShippingMethod.method_code;var data={billing_address:shippingAddress,shipping_address:selectedStoreAddress?this.getStoreAddress(shippingAddress):shippingAddress,shipping_carrier_code:shipping_carrier_code,shipping_method_code:shipping_method_code};saveAddressInformation(data);updateShippingFields(fields);}},{key:\"_getAddressById\",value:function _getAddressById(addressId){var addresses=this.props.customer.addresses;var address=addresses.find(function(_ref2){var id=_ref2.id;return id===addressId;});return _objectSpread(_objectSpread({},trimCustomerAddress(address)),{},{save_in_address_book:false,id:addressId});}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,CheckoutShipping,Object.assign({},this.props,this.state,this.containerFunctions));}}]);return _CheckoutShippingContainer;}(Extensible(PureComponent));Object.defineProperty(_CheckoutShippingContainer,'name',{value:'CheckoutShippingContainer'});export var CheckoutShippingContainer=middleware(_CheckoutShippingContainer,\"Component/CheckoutShipping/Container\");export default connect(mapStateToProps,mapDispatchToProps)(CheckoutShippingContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/CheckoutShipping/CheckoutShipping.container.js"],"names":["PureComponent","connect","STORE_IN_PICK_UP_ATTRIBUTE_CODE","STORE_IN_PICK_UP_METHOD_CODE","updateShippingFields","customerType","shippingMethodsType","getFormFields","trimAddressFields","trimCustomerAddress","getCartTotalSubPrice","CheckoutShipping","mapStateToProps","state","customer","MyAccountReducer","addressLinesQty","ConfigReducer","address_lines_quantity","totals","CartReducer","cartTotals","cartTotalSubPrice","mapDispatchToProps","dispatch","fields","CheckoutShippingContainer","containerFunctions","onShippingSuccess","bind","onShippingError","onAddressSelect","onShippingMethodSelect","onStoreSelect","props","shippingMethods","selectedShippingMethod","method_code","selectedCustomerAddressId","isSubmitted","shippingAddress","selectedStoreAddress","region","city","postcode","phone","street","name","pickup_location_code","telephone","firstname","lastname","extension_attributes","attribute_code","value","id","setState","method","address","saveAddressInformation","formFields","_getAddressById","shipping_carrier_code","carrier_code","shipping_method_code","data","billing_address","shipping_address","getStoreAddress","addressId","addresses","find","save_in_address_book","Object","defineProperty","_CheckoutShippingContainer"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport {\n    STORE_IN_PICK_UP_ATTRIBUTE_CODE,\n    STORE_IN_PICK_UP_METHOD_CODE\n} from 'Component/StoreInPickUp/StoreInPickUp.config';\nimport { updateShippingFields } from 'Store/Checkout/Checkout.action';\nimport { customerType } from 'Type/Account';\nimport { shippingMethodsType } from 'Type/Checkout';\nimport { getFormFields, trimAddressFields, trimCustomerAddress } from 'Util/Address';\nimport { getCartTotalSubPrice } from 'Util/Cart';\n\nimport CheckoutShipping from './CheckoutShipping.component';\n\n/** @namespace Component/CheckoutShipping/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    customer: state.MyAccountReducer.customer,\n    addressLinesQty: state.ConfigReducer.address_lines_quantity,\n    totals: state.CartReducer.cartTotals,\n    cartTotalSubPrice: getCartTotalSubPrice(state)\n});\n\n/** @namespace Component/CheckoutShipping/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    updateShippingFields: (fields) => dispatch(updateShippingFields(fields))\n});\n\n/** @namespace Component/CheckoutShipping/Container */\nexport class CheckoutShippingContainer extends PureComponent {\n    static propTypes = {\n        saveAddressInformation: PropTypes.func.isRequired,\n        shippingMethods: shippingMethodsType.isRequired,\n        customer: customerType.isRequired,\n        addressLinesQty: PropTypes.number.isRequired,\n        updateShippingFields: PropTypes.func.isRequired\n    };\n\n    containerFunctions = {\n        onShippingSuccess: this.onShippingSuccess.bind(this),\n        onShippingError: this.onShippingError.bind(this),\n        onAddressSelect: this.onAddressSelect.bind(this),\n        onShippingMethodSelect: this.onShippingMethodSelect.bind(this),\n        onStoreSelect: this.onStoreSelect.bind(this)\n    };\n\n    __construct(props) {\n        super.__construct(props);\n\n        const { shippingMethods } = props;\n        const [selectedShippingMethod] = shippingMethods;\n        const { method_code = '' } = selectedShippingMethod || {};\n\n        this.state = {\n            selectedCustomerAddressId: 0,\n            isSubmitted: false,\n            selectedShippingMethod: method_code && method_code !== STORE_IN_PICK_UP_METHOD_CODE\n                ? selectedShippingMethod\n                : {}\n        };\n    }\n\n    getStoreAddress(shippingAddress) {\n        const {\n            selectedStoreAddress: {\n                region,\n                city,\n                postcode,\n                phone,\n                street,\n                name,\n                pickup_location_code\n            }\n        } = this.state;\n\n        return {\n            ...shippingAddress,\n            region,\n            city,\n            postcode,\n            telephone: phone,\n            street: [street],\n            firstname: name,\n            lastname: 'Store',\n            extension_attributes: [\n                {\n                    attribute_code: STORE_IN_PICK_UP_ATTRIBUTE_CODE,\n                    value: pickup_location_code\n                }\n            ]\n        };\n    }\n\n    onAddressSelect(id) {\n        this.setState({ selectedCustomerAddressId: id });\n    }\n\n    onShippingMethodSelect(method) {\n        this.setState({ selectedShippingMethod: method });\n    }\n\n    onShippingError() {\n        // TODO: implement notification if some data in Form can not display error\n        const { isSubmitted } = this.state;\n        this.setState({ isSubmitted: !isSubmitted });\n    }\n\n    onStoreSelect(address) {\n        this.setState({ selectedStoreAddress: address });\n    }\n\n    onShippingSuccess(fields) {\n        const {\n            saveAddressInformation,\n            updateShippingFields,\n            addressLinesQty\n        } = this.props;\n\n        const {\n            selectedCustomerAddressId,\n            selectedShippingMethod,\n            selectedStoreAddress\n        } = this.state;\n\n        const formFields = getFormFields(fields, addressLinesQty);\n\n        const shippingAddress = selectedCustomerAddressId\n            ? this._getAddressById(selectedCustomerAddressId)\n            : trimAddressFields(formFields);\n\n        const {\n            carrier_code: shipping_carrier_code,\n            method_code: shipping_method_code\n        } = selectedShippingMethod;\n\n        const data = {\n            billing_address: shippingAddress,\n            shipping_address: selectedStoreAddress ? this.getStoreAddress(shippingAddress) : shippingAddress,\n            shipping_carrier_code,\n            shipping_method_code\n        };\n\n        saveAddressInformation(data);\n        updateShippingFields(fields);\n    }\n\n    _getAddressById(addressId) {\n        const { customer: { addresses } } = this.props;\n        const address = addresses.find(({ id }) => id === addressId);\n        return {\n            ...trimCustomerAddress(address),\n            save_in_address_book: false,\n            id: addressId\n        };\n    }\n\n    render() {\n        return (\n            <CheckoutShipping\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerFunctions }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CheckoutShippingContainer);\n"]},"metadata":{},"sourceType":"module"}