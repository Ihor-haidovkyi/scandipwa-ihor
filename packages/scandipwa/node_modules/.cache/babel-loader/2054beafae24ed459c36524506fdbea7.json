{"ast":null,"code":"import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{createRef,PureComponent}from'react';import{withRouter}from'react-router';import{TransformWrapper}from'react-zoom-pan-pinch';import CarouselScroll from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/CarouselScroll\";import Image from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/Image\";import ProductGalleryBaseImage from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductGalleryBaseImage\";import ProductGalleryThumbnailImage from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductGalleryThumbnailImage\";import Slider from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/Slider\";import VideoPopup from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/VideoPopup\";import VideoThumbnail from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/VideoThumbnail\";import{LocationType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Common\";import CSS from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/CSS\";import{IMAGE_TYPE,MAX_ZOOM_SCALE,PLACEHOLDER_TYPE,VIDEO_TYPE}from\"./ProductGallery.config\";import\"./ProductGallery.style\";/**\n * Product gallery\n * @class ProductGallery\n * @namespace Component/ProductGallery/Component\n */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _ProductGallery=/*#__PURE__*/function(_Extensible){_inherits(_ProductGallery,_Extensible);var _super=_createSuper(_ProductGallery);function _ProductGallery(){var _this;_classCallCheck(this,_ProductGallery);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.maxScale=MAX_ZOOM_SCALE;_this.imageRef=/*#__PURE__*/createRef();_this.state={scrollEnabled:true};_this.handleSliderClick=function(){var _this$props=_this.props,handleImageZoomPopupActiveChange=_this$props.handleImageZoomPopupActiveChange,gallery=_this$props.gallery,activeImage=_this$props.activeImage;var media_type=gallery[activeImage].media_type;if(media_type===VIDEO_TYPE){return;}handleImageZoomPopupActiveChange(true);};_this.renderAdditionalPicture=function(media){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return/*#__PURE__*/_checkBEM(React,ProductGalleryThumbnailImage,{key:index,media:media});};_this.onWheel=function(zoomState){var scale=zoomState.scale;if(_this.timeout){return;}if(scale===1||scale===MAX_ZOOM_SCALE){_this.stopScrolling();}};return _this;}_createClass(_ProductGallery,[{key:\"__construct\",value:function __construct(props,context){_get(_getPrototypeOf(_ProductGallery.prototype),\"__construct\",this).call(this,props,context);this.renderSlide=this.renderSlide.bind(this);}},{key:\"componentDidMount\",value:function componentDidMount(){this.updateSharedDestinationElement();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var _sliderRef$current;var _this$props2=this.props,productId=_this$props2.productId,pathname=_this$props2.location.pathname,sliderRef=_this$props2.sliderRef;var prevProductId=prevProps.productId,prevPathname=prevProps.location.pathname;if(productId!==prevProductId){this.updateSharedDestinationElement();}if((sliderRef===null||sliderRef===void 0?void 0:(_sliderRef$current=sliderRef.current)===null||_sliderRef$current===void 0?void 0:_sliderRef$current.draggableRef)&&pathname!==prevPathname){CSS.setVariable(sliderRef.current.draggableRef,'animation-speed',0);}}},{key:\"updateSharedDestinationElement\",value:function updateSharedDestinationElement(){var registerSharedElementDestination=this.props.registerSharedElementDestination;registerSharedElementDestination(this.imageRef);}},{key:\"renderVideo\",value:/**\n     * Renders a video thumbnail which opens popup player on click/tap\n     * @param media\n     * @param index\n     * @returns {*}\n     * @private\n     */function renderVideo(media,index){var isImageZoomPopupActive=this.props.isImageZoomPopupActive;return/*#__PURE__*/_checkBEM(React,VideoThumbnail,{key:index,media:media,isVideoZoomed:isImageZoomPopupActive});}},{key:\"renderPlaceholder\",value:function renderPlaceholder(index){return/*#__PURE__*/_checkBEM(React,Image,{key:index,ratio:\"custom\",mix:{block:'ProductGallery',elem:'SliderImage',mods:{isPlaceholder:true}},isPlaceholder:true});}},{key:\"stopScrolling\",value:function stopScrolling(){var _this2=this;this.setState({scrollEnabled:false});this.timeout=setTimeout(function(){_this2.setState({scrollEnabled:true});_this2.timeout=null;// 20 ms is time give to scroll down, usually that is enough\n// eslint-disable-next-line no-magic-numbers\n},20);}},{key:\"renderImage\",value:/**\n     * Renders a product image to be displayed in the gallery\n     * @param mediaData\n     * @param index\n     * @returns {*}\n     * @private\n     */function renderImage(mediaData,index){var _this$props3=this.props,isZoomEnabled=_this$props3.isZoomEnabled,handleZoomChange=_this$props3.handleZoomChange,disableZoom=_this$props3.disableZoom,isMobile=_this$props3.isMobile,isImageZoomPopupActive=_this$props3.isImageZoomPopupActive;var scrollEnabled=this.state.scrollEnabled;if(!isMobile){var _mediaData$base=mediaData.base;_mediaData$base=_mediaData$base===void 0?{}:_mediaData$base;var baseSrc=_mediaData$base.url,_mediaData$large=mediaData.large;_mediaData$large=_mediaData$large===void 0?{}:_mediaData$large;var largeSrc=_mediaData$large.url;var style=isImageZoomPopupActive?{height:'auto'}:{};var src=isImageZoomPopupActive?largeSrc:baseSrc;return/*#__PURE__*/_checkBEM(React,Image,{key:index,src:src,ratio:\"custom\",mix:{block:'ProductGallery',elem:'SliderImage',mods:{isPlaceholder:!src}},isPlaceholder:!src,style:style});}return/*#__PURE__*/_checkBEM(React,TransformWrapper,{key:index,onZoomChange:handleZoomChange,onWheelStart:this.onWheelStart,onWheel:this.onWheel,wheel:{limitsOnWheel:true,disabled:!scrollEnabled}//   doubleClick={ { mode: 'reset' } }\n,pan:{disabled:!isZoomEnabled,limitToWrapperBounds:true,velocity:false},options:{limitToBounds:true,minScale:1}},function(_ref){var scale=_ref.scale,previousScale=_ref.previousScale,resetTransform=_ref.resetTransform,setTransform=_ref.setTransform;if(scale===1&&previousScale!==1){resetTransform();}return/*#__PURE__*/_checkBEM(React,ProductGalleryBaseImage,{setTransform:setTransform,index:index,mediaData:mediaData,scale:scale,previousScale:previousScale,disableZoom:disableZoom,isZoomEnabled:isZoomEnabled});});}/**\n     * Checks for the type of the slide and renders it accordingly\n     * @param media\n     * @param index\n     * @returns {null|*}\n     */},{key:\"renderSlide\",value:function renderSlide(media,index){var media_type=media.media_type;switch(media_type){case IMAGE_TYPE:return this.renderImage(media,index);case VIDEO_TYPE:return this.renderVideo(media,index);case PLACEHOLDER_TYPE:return this.renderPlaceholder(index);default:return null;}}},{key:\"renderAdditionalPictures\",value:function renderAdditionalPictures(){var _this$props4=this.props,gallery=_this$props4.gallery,isImageZoomPopupActive=_this$props4.isImageZoomPopupActive,activeImage=_this$props4.activeImage,onActiveImageChange=_this$props4.onActiveImageChange;if(gallery.length===1){return/*#__PURE__*/_checkBEM(React,\"div\",{block:\"ProductGallery\",elem:\"Additional\"});}return/*#__PURE__*/_checkBEM(React,\"div\",{block:\"ProductGallery\",elem:\"Additional\",mods:{isImageZoomPopupActive:isImageZoomPopupActive}},/*#__PURE__*/_checkBEM(React,CarouselScroll,{activeItemId:activeImage,onChange:onActiveImageChange,showedItemCount:4},gallery.map(this.renderAdditionalPicture)));}},{key:\"getImageUrl\",value:function getImageUrl(){var _this$props$gallery=this.props.gallery;_this$props$gallery=_this$props$gallery===void 0?[]:_this$props$gallery;var _this$props$gallery2=_slicedToArray(_this$props$gallery,1),_this$props$gallery2$=_this$props$gallery2[0].thumbnail;_this$props$gallery2$=_this$props$gallery2$===void 0?{}:_this$props$gallery2$;var _this$props$gallery2$2=_this$props$gallery2$.url,url=_this$props$gallery2$2===void 0?'':_this$props$gallery2$2;return url;}},{key:\"renderSlider\",value:function renderSlider(){var _this$props5=this.props,gallery=_this$props5.gallery,activeImage=_this$props5.activeImage,isZoomEnabled=_this$props5.isZoomEnabled,onActiveImageChange=_this$props5.onActiveImageChange,isImageZoomPopupActive=_this$props5.isImageZoomPopupActive,sliderRef=_this$props5.sliderRef;var mods={isImageZoomPopupActive:isImageZoomPopupActive,isZoomInCursor:!isImageZoomPopupActive};return/*#__PURE__*/_checkBEM(React,\"div\",{ref:this.imageRef,block:\"ProductGallery\",elem:\"SliderWrapper\"},/*#__PURE__*/_checkBEM(React,\"meta\",{itemProp:\"image\",content:this.getImageUrl()}),/*#__PURE__*/_checkBEM(React,Slider,{sliderRef:sliderRef,mix:{block:'ProductGallery',elem:'Slider',mods:mods},showCrumbs:true,activeImage:activeImage,onActiveImageChange:onActiveImageChange,isInteractionDisabled:isZoomEnabled,onClick:this.handleSliderClick,sliderHeight:isImageZoomPopupActive?'100%':0,isHeightTransitionDisabledOnMount:true},gallery.map(this.renderSlide)));}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,\"div\",{block:\"ProductGallery\"},this.renderAdditionalPictures(),this.renderSlider(),/*#__PURE__*/_checkBEM(React,VideoPopup,null));}}]);return _ProductGallery;}(Extensible(PureComponent));_ProductGallery.defaultProps={productId:0};Object.defineProperty(_ProductGallery,'name',{value:'ProductGallery'});export var ProductGallery=middleware(_ProductGallery,\"Component/ProductGallery/Component\");export default withRouter(ProductGallery);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductGallery/ProductGallery.component.js"],"names":["createRef","PureComponent","withRouter","TransformWrapper","CarouselScroll","Image","ProductGalleryBaseImage","ProductGalleryThumbnailImage","Slider","VideoPopup","VideoThumbnail","LocationType","CSS","IMAGE_TYPE","MAX_ZOOM_SCALE","PLACEHOLDER_TYPE","VIDEO_TYPE","ProductGallery","maxScale","imageRef","state","scrollEnabled","handleSliderClick","props","handleImageZoomPopupActiveChange","gallery","activeImage","media_type","renderAdditionalPicture","media","index","onWheel","zoomState","scale","timeout","stopScrolling","context","renderSlide","bind","updateSharedDestinationElement","prevProps","productId","pathname","location","sliderRef","prevProductId","prevPathname","current","draggableRef","setVariable","registerSharedElementDestination","isImageZoomPopupActive","block","elem","mods","isPlaceholder","setState","setTimeout","mediaData","isZoomEnabled","handleZoomChange","disableZoom","isMobile","base","baseSrc","url","large","largeSrc","style","height","src","onWheelStart","limitsOnWheel","disabled","limitToWrapperBounds","velocity","limitToBounds","minScale","previousScale","resetTransform","setTransform","renderImage","renderVideo","renderPlaceholder","onActiveImageChange","length","map","thumbnail","isZoomInCursor","getImageUrl","renderAdditionalPictures","renderSlider","defaultProps","Object","defineProperty","_ProductGallery","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { createRef, PureComponent } from 'react';\nimport { withRouter } from 'react-router';\nimport { TransformWrapper } from 'react-zoom-pan-pinch';\n\nimport CarouselScroll from 'Component/CarouselScroll';\nimport Image from 'Component/Image';\nimport ProductGalleryBaseImage from 'Component/ProductGalleryBaseImage';\nimport ProductGalleryThumbnailImage from 'Component/ProductGalleryThumbnailImage';\nimport Slider from 'Component/Slider';\nimport VideoPopup from 'Component/VideoPopup';\nimport VideoThumbnail from 'Component/VideoThumbnail';\nimport { LocationType } from 'Type/Common';\nimport CSS from 'Util/CSS';\n\nimport {\n    IMAGE_TYPE,\n    MAX_ZOOM_SCALE,\n    PLACEHOLDER_TYPE,\n    VIDEO_TYPE\n} from './ProductGallery.config';\n\nimport './ProductGallery.style';\n\n/**\n * Product gallery\n * @class ProductGallery\n * @namespace Component/ProductGallery/Component\n */\nexport class ProductGallery extends PureComponent {\n    static propTypes = {\n        gallery: PropTypes.arrayOf(\n            PropTypes.shape({\n                id: PropTypes.oneOfType([\n                    PropTypes.number,\n                    PropTypes.string\n                ]),\n                image: PropTypes.string,\n                isPlaceholder: PropTypes.bool,\n                alt: PropTypes.string,\n                type: PropTypes.string,\n                media_type: PropTypes.string\n            })\n        ).isRequired,\n        productId: PropTypes.number,\n        isZoomEnabled: PropTypes.bool.isRequired,\n        activeImage: PropTypes.number.isRequired,\n        onActiveImageChange: PropTypes.func.isRequired,\n        handleZoomChange: PropTypes.func.isRequired,\n        registerSharedElementDestination: PropTypes.func.isRequired,\n        disableZoom: PropTypes.func.isRequired,\n        location: LocationType.isRequired,\n        sliderRef: PropTypes.object.isRequired,\n        handleImageZoomPopupActiveChange: PropTypes.func.isRequired,\n        isMobile: PropTypes.bool.isRequired,\n        isImageZoomPopupActive: PropTypes.bool.isRequired\n    };\n\n    static defaultProps = {\n        productId: 0\n    };\n\n    maxScale = MAX_ZOOM_SCALE;\n\n    imageRef = createRef();\n\n    state = {\n        scrollEnabled: true\n    };\n\n    __construct(props, context) {\n        super.__construct(props, context);\n        this.renderSlide = this.renderSlide.bind(this);\n    }\n\n    componentDidMount() {\n        this.updateSharedDestinationElement();\n    }\n\n    componentDidUpdate(prevProps) {\n        const { productId, location: { pathname }, sliderRef } = this.props;\n        const { productId: prevProductId, location: { pathname: prevPathname } } = prevProps;\n\n        if (productId !== prevProductId) {\n            this.updateSharedDestinationElement();\n        }\n\n        if (sliderRef?.current?.draggableRef && pathname !== prevPathname) {\n            CSS.setVariable(\n                sliderRef.current.draggableRef,\n                'animation-speed',\n                0\n            );\n        }\n    }\n\n    handleSliderClick = () => {\n        const {\n            handleImageZoomPopupActiveChange,\n            gallery,\n            activeImage\n        } = this.props;\n\n        const { media_type } = gallery[activeImage];\n        if (media_type === VIDEO_TYPE) {\n            return;\n        }\n\n        handleImageZoomPopupActiveChange(true);\n    };\n\n    updateSharedDestinationElement() {\n        const { registerSharedElementDestination } = this.props;\n        registerSharedElementDestination(this.imageRef);\n    }\n\n    renderAdditionalPicture = (media, index = 0) => (\n        <ProductGalleryThumbnailImage\n          key={ index }\n          media={ media }\n        />\n    );\n\n    /**\n     * Renders a video thumbnail which opens popup player on click/tap\n     * @param media\n     * @param index\n     * @returns {*}\n     * @private\n     */\n    renderVideo(media, index) {\n        const { isImageZoomPopupActive } = this.props;\n        return (\n            <VideoThumbnail\n              key={ index }\n              media={ media }\n              isVideoZoomed={ isImageZoomPopupActive }\n            />\n        );\n    }\n\n    renderPlaceholder(index) {\n        return (\n            <Image\n              key={ index }\n              ratio=\"custom\"\n              mix={ {\n                  block: 'ProductGallery',\n                  elem: 'SliderImage',\n                  mods: { isPlaceholder: true }\n              } }\n              isPlaceholder\n            />\n        );\n    }\n\n    stopScrolling() {\n        this.setState({ scrollEnabled: false });\n        this.timeout = setTimeout(() => {\n            this.setState({ scrollEnabled: true });\n            this.timeout = null;\n\n            // 20 ms is time give to scroll down, usually that is enough\n            // eslint-disable-next-line no-magic-numbers\n        }, 20);\n    }\n\n    onWheel = (zoomState) => {\n        const { scale } = zoomState;\n\n        if (this.timeout) {\n            return;\n        }\n\n        if (scale === 1 || scale === MAX_ZOOM_SCALE) {\n            this.stopScrolling();\n        }\n    };\n\n    /**\n     * Renders a product image to be displayed in the gallery\n     * @param mediaData\n     * @param index\n     * @returns {*}\n     * @private\n     */\n    renderImage(mediaData, index) {\n        const {\n            isZoomEnabled,\n            handleZoomChange,\n            disableZoom,\n            isMobile,\n            isImageZoomPopupActive\n        } = this.props;\n        const { scrollEnabled } = this.state;\n\n        if (!isMobile) {\n            const {\n                base: { url: baseSrc } = {},\n                large: { url: largeSrc } = {}\n            } = mediaData;\n\n            const style = isImageZoomPopupActive ? { height: 'auto' } : {};\n            const src = isImageZoomPopupActive ? largeSrc : baseSrc;\n\n            return (\n                <Image\n                  key={ index }\n                  src={ src }\n                  ratio=\"custom\"\n                  mix={ {\n                      block: 'ProductGallery',\n                      elem: 'SliderImage',\n                      mods: { isPlaceholder: !src }\n                  } }\n                  isPlaceholder={ !src }\n                  style={ style }\n                />\n            );\n        }\n\n        return (\n            <TransformWrapper\n              key={ index }\n              onZoomChange={ handleZoomChange }\n              onWheelStart={ this.onWheelStart }\n              onWheel={ this.onWheel }\n              wheel={ { limitsOnWheel: true, disabled: !scrollEnabled } }\n            //   doubleClick={ { mode: 'reset' } }\n              pan={ {\n                  disabled: !isZoomEnabled,\n                  limitToWrapperBounds: true,\n                  velocity: false\n              } }\n              options={ {\n                  limitToBounds: true,\n                  minScale: 1\n              } }\n            >\n                { ({\n                    scale,\n                    previousScale,\n                    resetTransform,\n                    setTransform\n                }) => {\n                    if (scale === 1 && previousScale !== 1) {\n                        resetTransform();\n                    }\n\n                    return (\n                        <ProductGalleryBaseImage\n                          setTransform={ setTransform }\n                          index={ index }\n                          mediaData={ mediaData }\n                          scale={ scale }\n                          previousScale={ previousScale }\n                          disableZoom={ disableZoom }\n                          isZoomEnabled={ isZoomEnabled }\n                        />\n                    );\n                } }\n            </TransformWrapper>\n        );\n    }\n\n    /**\n     * Checks for the type of the slide and renders it accordingly\n     * @param media\n     * @param index\n     * @returns {null|*}\n     */\n    renderSlide(media, index) {\n        const { media_type } = media;\n\n        switch (media_type) {\n        case IMAGE_TYPE:\n            return this.renderImage(media, index);\n        case VIDEO_TYPE:\n            return this.renderVideo(media, index);\n        case PLACEHOLDER_TYPE:\n            return this.renderPlaceholder(index);\n        default:\n            return null;\n        }\n    }\n\n    renderAdditionalPictures() {\n        const {\n            gallery,\n            isImageZoomPopupActive,\n            activeImage,\n            onActiveImageChange\n        } = this.props;\n\n        if (gallery.length === 1) {\n            return <div block=\"ProductGallery\" elem=\"Additional\" />;\n        }\n\n        return (\n            <div block=\"ProductGallery\" elem=\"Additional\" mods={ { isImageZoomPopupActive } }>\n                <CarouselScroll activeItemId={ activeImage } onChange={ onActiveImageChange } showedItemCount={ 4 }>\n                    { gallery.map(this.renderAdditionalPicture) }\n                </CarouselScroll>\n            </div>\n        );\n    }\n\n    getImageUrl() {\n        const {\n            gallery: [\n                {\n                    thumbnail: {\n                        url = ''\n                    } = {}\n                }\n            ] = []\n        } = this.props;\n\n        return url;\n    }\n\n    renderSlider() {\n        const {\n            gallery,\n            activeImage,\n            isZoomEnabled,\n            onActiveImageChange,\n            isImageZoomPopupActive,\n            sliderRef\n        } = this.props;\n\n        const mods = {\n            isImageZoomPopupActive,\n            isZoomInCursor: !isImageZoomPopupActive\n        };\n\n        return (\n            <div\n              ref={ this.imageRef }\n              block=\"ProductGallery\"\n              elem=\"SliderWrapper\"\n            >\n                <meta itemProp=\"image\" content={ this.getImageUrl() } />\n                <Slider\n                  sliderRef={ sliderRef }\n                  mix={ { block: 'ProductGallery', elem: 'Slider', mods } }\n                  showCrumbs\n                  activeImage={ activeImage }\n                  onActiveImageChange={ onActiveImageChange }\n                  isInteractionDisabled={ isZoomEnabled }\n                  onClick={ this.handleSliderClick }\n                  sliderHeight={ isImageZoomPopupActive ? '100%' : 0 }\n                  isHeightTransitionDisabledOnMount\n                >\n                    { gallery.map(this.renderSlide) }\n                </Slider>\n            </div>\n        );\n    }\n\n    render() {\n        return (\n            <div block=\"ProductGallery\">\n                { this.renderAdditionalPictures() }\n                { this.renderSlider() }\n                <VideoPopup />\n            </div>\n        );\n    }\n}\n\nexport default withRouter(ProductGallery);\n"]},"metadata":{},"sourceType":"module"}