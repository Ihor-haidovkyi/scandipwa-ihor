{"ast":null,"code":"/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport { BUNDLE, CONFIGURABLE, DOWNLOADABLE, SIMPLE } from \"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";\n/**\n * Checks whether every option is in attributes\n * @param {Object} attributes\n * @param {{ attribute_code: string }[]} options\n * @returns {boolean}\n * @namespace Util/Product/checkEveryOption\n */\n\nexport const checkEveryOption = middleware(function (attributes, options) {\n  return Object.keys(options).every(function (option) {\n    if (!attributes[option]) {\n      return false;\n    }\n\n    const {\n      attribute_value\n    } = attributes[option];\n\n    if (typeof options[option] === 'string') {\n      return options[option] === attribute_value;\n    }\n\n    return options[option].includes(attribute_value);\n  });\n}, \"Util/Product/checkEveryOption\\n\");\n/** @namespace Util/Product/getIndexedAttributeOption */\n\nexport const getIndexedAttributeOption = middleware(function (option) {\n  const {\n    swatch_data: defaultSwatchData\n  } = option;\n\n  if (!defaultSwatchData) {\n    return option;\n  }\n\n  const {\n    type\n  } = defaultSwatchData;\n  const swatch_data = type ? defaultSwatchData : null;\n  return { ...option,\n    swatch_data\n  };\n}, \"Util/Product/getIndexedAttributeOption\");\n/** @namespace Util/Product/getIndexedAttributes */\n\nexport const getIndexedAttributes = middleware(function (attributes) {\n  return attributes.reduce(function (indexedAttributes, attribute) {\n    const {\n      attribute_code,\n      attribute_options = []\n    } = attribute;\n    return { ...indexedAttributes,\n      [attribute_code]: { ...attribute,\n        attribute_options: attribute_options.reduce(function (acc, option) {\n          const {\n            value\n          } = option;\n          return { ...acc,\n            [value]: getIndexedAttributeOption(option)\n          };\n        }, {})\n      }\n    };\n  }, {});\n}, \"Util/Product/getIndexedAttributes\");\n/** @namespace Util/Product/getIndexedConfigurableOptions */\n\nexport const getIndexedConfigurableOptions = middleware(function (configurableOptions, indexedAttributes) {\n  return configurableOptions.reduce(function (indexedConfigurableOptions, configurableOption) {\n    const {\n      values,\n      attribute_code\n    } = configurableOption;\n    return { ...indexedConfigurableOptions,\n      [attribute_code]: { ...configurableOption,\n        ...indexedAttributes[attribute_code],\n        attribute_values: values.map(function ({\n          value_index\n        }) {\n          return `${value_index}`;\n        })\n      }\n    };\n  }, {});\n}, \"Util/Product/getIndexedConfigurableOptions\");\n/** @namespace Util/Product/getIndexedVariants */\n\nexport const getIndexedVariants = middleware(function (variants) {\n  return variants.map(function ({\n    product\n  }) {\n    const {\n      attributes\n    } = product;\n    return { ...product,\n      attributes: getIndexedAttributes(attributes || [])\n    };\n  });\n}, \"Util/Product/getIndexedVariants\");\n/** @namespace Util/Product/getIndexedSingleVariant */\n\nexport const getIndexedSingleVariant = middleware(function (variants, itemSku) {\n  const index = variants.findIndex(function ({\n    product: {\n      sku\n    }\n  }) {\n    return sku === itemSku || itemSku.includes(sku);\n  });\n\n  if (index < 0) {\n    return getIndexedVariants(variants);\n  }\n\n  const indexedProduct = variants[index].product;\n  const {\n    attributes\n  } = indexedProduct;\n  return [{ ...indexedProduct,\n    attributes: getIndexedAttributes(attributes || [])\n  }];\n}, \"Util/Product/getIndexedSingleVariant\");\n/**\n * Get product variant index by options\n * @param {Object[]} variants\n * @param {{ attribute_code: string }[]} options\n * @returns {number}\n * @namespace Util/Product/getVariantIndex\n */\n\nexport const getVariantIndex = middleware(function (variants, options) {\n  return variants.findIndex(function (variant) {\n    return checkEveryOption(variant.attributes, options);\n  });\n}, \"Util/Product/getVariantIndex\\n\");\n/** @namespace Util/Product/getVariantsIndexes */\n\nexport const getVariantsIndexes = middleware(function (variants, options) {\n  return Object.entries(variants).reduce(function (indexes, [index, variant]) {\n    if (checkEveryOption(variant.attributes, options)) {\n      indexes.push(+index);\n    }\n\n    return indexes;\n  }, []);\n}, \"Util/Product/getVariantsIndexes\");\n/** @namespace Util/Product/getIndexedCustomOption */\n\nexport const getIndexedCustomOption = middleware(function (option) {\n  const {\n    checkboxValues,\n    dropdownValues,\n    fieldValues,\n    areaValues,\n    fileValues,\n    ...otherFields\n  } = option;\n\n  if (checkboxValues) {\n    const data = Array.isArray(checkboxValues) ? checkboxValues : [checkboxValues];\n    return {\n      type: 'checkbox',\n      data,\n      ...otherFields\n    };\n  }\n\n  if (dropdownValues) {\n    const data = Array.isArray(dropdownValues) ? dropdownValues : [dropdownValues];\n    return {\n      type: 'dropdown',\n      data,\n      ...otherFields\n    };\n  }\n\n  if (fieldValues) {\n    const data = Array.isArray(fieldValues) ? fieldValues : [fieldValues];\n    return {\n      type: 'field',\n      data,\n      ...otherFields\n    };\n  }\n\n  if (areaValues) {\n    const data = Array.isArray(areaValues) ? areaValues : [areaValues];\n    return {\n      type: 'area',\n      data,\n      ...otherFields\n    };\n  }\n\n  if (fileValues) {\n    const data = Array.isArray(fileValues) ? fileValues : [fileValues];\n    return {\n      type: 'file',\n      data,\n      ...otherFields\n    };\n  } // skip unsupported types\n\n\n  return null;\n}, \"Util/Product/getIndexedCustomOption\");\n/** @namespace Util/Product/getIndexedCustomOptions */\n\nexport const getIndexedCustomOptions = middleware(function (options) {\n  return options.reduce(function (acc, option) {\n    const indexedOption = getIndexedCustomOption(option);\n\n    if (indexedOption) {\n      acc.push(indexedOption);\n    }\n\n    return acc;\n  }, []);\n}, \"Util/Product/getIndexedCustomOptions\");\n/** @namespace Util/Product/getIndexedReviews */\n\nexport const getIndexedReviews = middleware(function (reviews) {\n  if (!reviews) {\n    return null;\n  }\n\n  const {\n    items\n  } = reviews;\n  const ONE_FIFTH_OF_A_HUNDRED = 20;\n  return items.reduce(function (acc, review) {\n    const {\n      rating_votes = [],\n      ...restOfReview\n    } = review;\n    const newRatingVotes = rating_votes.reduce(function (acc, vote) {\n      const {\n        rating_code,\n        value\n      } = vote;\n      return [...acc, {\n        rating_code,\n        value,\n        // stars / 5 * 100 to get percent\n        percent: value * ONE_FIFTH_OF_A_HUNDRED\n      }];\n    }, []);\n    return [...acc, { ...restOfReview,\n      rating_votes: newRatingVotes\n    }];\n  }, []);\n}, \"Util/Product/getIndexedReviews\");\n/** @namespace Util/Product/getBundleOptions */\n\nexport const getBundleOptions = middleware(function (options, items) {\n  const bundleOptions = options.reduce(function (prev, next) {\n    return [...prev, ...next.selection_details];\n  }, []);\n  return items.map(function (item) {\n    var _item$options;\n\n    return { ...item,\n      options: item === null || item === void 0 ? void 0 : (_item$options = item.options) === null || _item$options === void 0 ? void 0 : _item$options.map(function (option) {\n        const selection = bundleOptions.find(function (o) {\n          return o.selection_id === option.id;\n        }) || {};\n        const {\n          regular_option_price: regularOptionPrice = 0,\n          regular_option_price_excl_tax: regularOptionPriceExclTax = 0,\n          final_option_price: finalOptionPrice = 0,\n          final_option_price_excl_tax: finalOptionPriceExclTax = 0\n        } = selection;\n        return { ...option,\n          regularOptionPrice,\n          regularOptionPriceExclTax,\n          finalOptionPrice,\n          finalOptionPriceExclTax\n        };\n      })\n    };\n  });\n}, \"Util/Product/getBundleOptions\");\n/** @namespace Util/Product/getIndexedProduct */\n\nexport const getIndexedProduct = middleware(function (product, itemSku) {\n  const {\n    variants: initialVariants = [],\n    configurable_options: initialConfigurableOptions = [],\n    attributes: initialAttributes = [],\n    options: initialOptions = [],\n    rating_summary,\n    review_count,\n    reviews: initialReviews,\n    items = [],\n    bundle_options = []\n  } = product;\n  const attributes = getIndexedAttributes(initialAttributes || []);\n  const reviews = getIndexedReviews(initialReviews);\n  const updatedProduct = { ...product,\n    configurable_options: getIndexedConfigurableOptions(initialConfigurableOptions, attributes),\n    variants: itemSku ? getIndexedSingleVariant(initialVariants, itemSku) : getIndexedVariants(initialVariants),\n    options: getIndexedCustomOptions(initialOptions || []),\n    attributes,\n    // Magento 2.4.1 review endpoint compatibility\n    reviews,\n    review_summary: {\n      rating_summary,\n      review_count\n    }\n  };\n\n  if (bundle_options) {\n    updatedProduct.items = getBundleOptions(bundle_options, items);\n  }\n\n  return updatedProduct;\n}, \"Util/Product/getIndexedProduct\");\n/** @namespace Util/Product/getIndexedProducts */\n\nexport const getIndexedProducts = middleware(function (products) {\n  return products.map(function (product) {\n    return getIndexedProduct(product);\n  });\n}, \"Util/Product/getIndexedProducts\");\n/** @namespace Util/Product/getIndexedParameteredProducts */\n\nexport const getIndexedParameteredProducts = middleware(function (products) {\n  return Object.entries(products).reduce(function (products, [id, product]) {\n    return { ...products,\n      [id]: getIndexedProduct(product)\n    };\n  }, {});\n}, \"Util/Product/getIndexedParameteredProducts\");\n/** @namespace Util/Product/getExtensionAttributes */\n\nexport const getExtensionAttributes = middleware(function (product) {\n  const {\n    configurable_options,\n    configurableVariantIndex,\n    productOptions,\n    productOptionsMulti,\n    downloadableLinks,\n    variants,\n    type_id\n  } = product;\n\n  if (type_id === CONFIGURABLE) {\n    const {\n      attributes = {}\n    } = variants[configurableVariantIndex] || {};\n    const properties = {\n      configurable_item_options: Object.values(configurable_options).reduce(function (prev, {\n        attribute_id,\n        attribute_code\n      }) {\n        const {\n          attribute_value,\n          attribute_id: attrId\n        } = attributes[attribute_code] || {};\n\n        if (attribute_value) {\n          return [...prev, {\n            option_id: attribute_id || attrId,\n            option_value: attribute_value\n          }];\n        }\n\n        return prev;\n      }, [])\n    };\n\n    if (productOptions) {\n      properties.customizable_options = productOptions;\n    }\n\n    if (productOptionsMulti) {\n      properties.customizable_options_multi = productOptionsMulti;\n    }\n\n    return properties;\n  }\n\n  if (type_id === BUNDLE && (productOptions || productOptionsMulti)) {\n    return {\n      bundle_options: Array.from(productOptions || [])\n    };\n  }\n\n  if (type_id === SIMPLE && (productOptions || productOptionsMulti)) {\n    return {\n      customizable_options: productOptions || [],\n      customizable_options_multi: productOptionsMulti || []\n    };\n  }\n\n  if (type_id === DOWNLOADABLE && downloadableLinks) {\n    return {\n      downloadable_product_links: downloadableLinks\n    };\n  }\n\n  return {};\n}, \"Util/Product/getExtensionAttributes\");\n/** @namespace Util/Product/sortBySortOrder */\n\nexport const sortBySortOrder = middleware(function (options, sortKey = 'sort_order') {\n  return options.sort(function (a, b) {\n    if (a[sortKey] < b[sortKey]) {\n      return -1;\n    }\n\n    if (a[sortKey] > b[sortKey]) {\n      return 1;\n    }\n\n    return 0;\n  });\n}, \"Util/Product/sortBySortOrder\");","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/util/Product/Product.js"],"names":["BUNDLE","CONFIGURABLE","DOWNLOADABLE","SIMPLE","checkEveryOption","attributes","options","Object","keys","every","option","attribute_value","includes","getIndexedAttributeOption","swatch_data","defaultSwatchData","type","getIndexedAttributes","reduce","indexedAttributes","attribute","attribute_code","attribute_options","acc","value","getIndexedConfigurableOptions","configurableOptions","indexedConfigurableOptions","configurableOption","values","attribute_values","map","value_index","getIndexedVariants","variants","product","getIndexedSingleVariant","itemSku","index","findIndex","sku","indexedProduct","getVariantIndex","variant","getVariantsIndexes","entries","indexes","push","getIndexedCustomOption","checkboxValues","dropdownValues","fieldValues","areaValues","fileValues","otherFields","data","Array","isArray","getIndexedCustomOptions","indexedOption","getIndexedReviews","reviews","items","ONE_FIFTH_OF_A_HUNDRED","review","rating_votes","restOfReview","newRatingVotes","vote","rating_code","percent","getBundleOptions","bundleOptions","prev","next","selection_details","item","selection","find","o","selection_id","id","regular_option_price","regularOptionPrice","regular_option_price_excl_tax","regularOptionPriceExclTax","final_option_price","finalOptionPrice","final_option_price_excl_tax","finalOptionPriceExclTax","getIndexedProduct","initialVariants","configurable_options","initialConfigurableOptions","initialAttributes","initialOptions","rating_summary","review_count","initialReviews","bundle_options","updatedProduct","review_summary","getIndexedProducts","products","getIndexedParameteredProducts","getExtensionAttributes","configurableVariantIndex","productOptions","productOptionsMulti","downloadableLinks","type_id","properties","configurable_item_options","attribute_id","attrId","option_id","option_value","customizable_options","customizable_options_multi","from","downloadable_product_links","sortBySortOrder","sortKey","sort","a","b"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport {\n    BUNDLE,\n    CONFIGURABLE,\n    DOWNLOADABLE,\n    SIMPLE\n} from 'Util/Product';\n\n/**\n * Checks whether every option is in attributes\n * @param {Object} attributes\n * @param {{ attribute_code: string }[]} options\n * @returns {boolean}\n * @namespace Util/Product/checkEveryOption\n */\nexport const checkEveryOption = (attributes, options) => Object.keys(options)\n    .every((option) => {\n        if (!attributes[option]) {\n            return false;\n        }\n\n        const { attribute_value } = attributes[option];\n        if (typeof options[option] === 'string') {\n            return options[option] === attribute_value;\n        }\n\n        return options[option].includes(attribute_value);\n    });\n\n/** @namespace Util/Product/getIndexedAttributeOption */\nexport const getIndexedAttributeOption = (option) => {\n    const { swatch_data: defaultSwatchData } = option;\n    if (!defaultSwatchData) {\n        return option;\n    }\n\n    const { type } = defaultSwatchData;\n    const swatch_data = type ? defaultSwatchData : null;\n\n    return {\n        ...option,\n        swatch_data\n    };\n};\n\n/** @namespace Util/Product/getIndexedAttributes */\nexport const getIndexedAttributes = (attributes) => attributes.reduce((indexedAttributes, attribute) => {\n    const { attribute_code, attribute_options = [] } = attribute;\n\n    return {\n        ...indexedAttributes,\n        [attribute_code]: {\n            ...attribute,\n            attribute_options: attribute_options.reduce((acc, option) => {\n                const { value } = option;\n\n                return {\n                    ...acc,\n                    [value]: getIndexedAttributeOption(option)\n                };\n            }, {})\n        }\n    };\n}, {});\n\n/** @namespace Util/Product/getIndexedConfigurableOptions */\nexport const getIndexedConfigurableOptions = (configurableOptions, indexedAttributes) => (\n    configurableOptions.reduce((indexedConfigurableOptions, configurableOption) => {\n        const { values, attribute_code } = configurableOption;\n\n        return {\n            ...indexedConfigurableOptions,\n            [attribute_code]: {\n                ...configurableOption,\n                ...indexedAttributes[attribute_code],\n                attribute_values: values.map(({ value_index }) => `${ value_index }`)\n            }\n        };\n    }, {})\n);\n\n/** @namespace Util/Product/getIndexedVariants */\nexport const getIndexedVariants = (variants) => variants.map(({ product }) => {\n    const { attributes } = product;\n    return {\n        ...product,\n        attributes: getIndexedAttributes(attributes || [])\n    };\n});\n\n/** @namespace Util/Product/getIndexedSingleVariant */\nexport const getIndexedSingleVariant = (variants, itemSku) => {\n    const index = variants.findIndex(({ product: { sku } }) => sku === itemSku || itemSku.includes(sku));\n\n    if (index < 0) {\n        return getIndexedVariants(variants);\n    }\n\n    const indexedProduct = variants[index].product;\n    const { attributes } = indexedProduct;\n\n    return [\n        { ...indexedProduct, attributes: getIndexedAttributes(attributes || []) }\n    ];\n};\n\n/**\n * Get product variant index by options\n * @param {Object[]} variants\n * @param {{ attribute_code: string }[]} options\n * @returns {number}\n * @namespace Util/Product/getVariantIndex\n */\nexport const getVariantIndex = (variants, options) => variants\n    .findIndex((variant) => checkEveryOption(variant.attributes, options));\n\n/** @namespace Util/Product/getVariantsIndexes */\nexport const getVariantsIndexes = (variants, options) => Object.entries(variants)\n    .reduce((indexes, [index, variant]) => {\n        if (checkEveryOption(variant.attributes, options)) {\n            indexes.push(+index);\n        }\n\n        return indexes;\n    }, []);\n\n/** @namespace Util/Product/getIndexedCustomOption */\nexport const getIndexedCustomOption = (option) => {\n    const {\n        checkboxValues,\n        dropdownValues,\n        fieldValues,\n        areaValues,\n        fileValues,\n        ...otherFields\n    } = option;\n\n    if (checkboxValues) {\n        const data = Array.isArray(checkboxValues) ? checkboxValues : [checkboxValues];\n        return { type: 'checkbox', data, ...otherFields };\n    }\n\n    if (dropdownValues) {\n        const data = Array.isArray(dropdownValues) ? dropdownValues : [dropdownValues];\n        return { type: 'dropdown', data, ...otherFields };\n    }\n\n    if (fieldValues) {\n        const data = Array.isArray(fieldValues) ? fieldValues : [fieldValues];\n        return { type: 'field', data, ...otherFields };\n    }\n\n    if (areaValues) {\n        const data = Array.isArray(areaValues) ? areaValues : [areaValues];\n        return { type: 'area', data, ...otherFields };\n    }\n\n    if (fileValues) {\n        const data = Array.isArray(fileValues) ? fileValues : [fileValues];\n        return { type: 'file', data, ...otherFields };\n    }\n\n    // skip unsupported types\n    return null;\n};\n\n/** @namespace Util/Product/getIndexedCustomOptions */\nexport const getIndexedCustomOptions = (options) => options.reduce(\n    (acc, option) => {\n        const indexedOption = getIndexedCustomOption(option);\n\n        if (indexedOption) {\n            acc.push(indexedOption);\n        }\n\n        return acc;\n    },\n    []\n);\n\n/** @namespace Util/Product/getIndexedReviews */\nexport const getIndexedReviews = (reviews) => {\n    if (!reviews) {\n        return null;\n    }\n\n    const { items } = reviews;\n    const ONE_FIFTH_OF_A_HUNDRED = 20;\n\n    return items.reduce((acc, review) => {\n        const { rating_votes = [], ...restOfReview } = review;\n\n        const newRatingVotes = rating_votes.reduce((acc, vote) => {\n            const { rating_code, value } = vote;\n\n            return [\n                ...acc,\n                {\n                    rating_code,\n                    value,\n                    // stars / 5 * 100 to get percent\n                    percent: value * ONE_FIFTH_OF_A_HUNDRED\n                }\n            ];\n        }, []);\n\n        return [\n            ...acc,\n            {\n                ...restOfReview,\n                rating_votes: newRatingVotes\n            }\n        ];\n    }, []);\n};\n\n/** @namespace Util/Product/getBundleOptions */\nexport const getBundleOptions = (options, items) => {\n    const bundleOptions = options.reduce((prev, next) => [...prev, ...next.selection_details], []);\n\n    return items.map((item) => ({\n        ...item,\n        options: item?.options?.map((option) => {\n            const selection = bundleOptions.find((o) => o.selection_id === option.id) || {};\n            const {\n                regular_option_price: regularOptionPrice = 0,\n                regular_option_price_excl_tax: regularOptionPriceExclTax = 0,\n                final_option_price: finalOptionPrice = 0,\n                final_option_price_excl_tax: finalOptionPriceExclTax = 0\n            } = selection;\n\n            return {\n                ...option,\n                regularOptionPrice,\n                regularOptionPriceExclTax,\n                finalOptionPrice,\n                finalOptionPriceExclTax\n            };\n        })\n    }));\n};\n\n/** @namespace Util/Product/getIndexedProduct */\nexport const getIndexedProduct = (product, itemSku) => {\n    const {\n        variants: initialVariants = [],\n        configurable_options: initialConfigurableOptions = [],\n        attributes: initialAttributes = [],\n        options: initialOptions = [],\n        rating_summary,\n        review_count,\n        reviews: initialReviews,\n        items = [],\n        bundle_options = []\n    } = product;\n\n    const attributes = getIndexedAttributes(initialAttributes || []);\n    const reviews = getIndexedReviews(initialReviews);\n\n    const updatedProduct = {\n        ...product,\n        configurable_options: getIndexedConfigurableOptions(initialConfigurableOptions, attributes),\n        variants: itemSku ? getIndexedSingleVariant(initialVariants, itemSku) : getIndexedVariants(initialVariants),\n        options: getIndexedCustomOptions(initialOptions || []),\n        attributes,\n        // Magento 2.4.1 review endpoint compatibility\n        reviews,\n        review_summary: {\n            rating_summary,\n            review_count\n        }\n    };\n\n    if (bundle_options) {\n        updatedProduct.items = getBundleOptions(bundle_options, items);\n    }\n\n    return updatedProduct;\n};\n\n/** @namespace Util/Product/getIndexedProducts */\nexport const getIndexedProducts = (products) => products.map((product) => getIndexedProduct(product));\n\n/** @namespace Util/Product/getIndexedParameteredProducts */\nexport const getIndexedParameteredProducts = (products) => Object.entries(products)\n    .reduce((products, [id, product]) => ({\n        ...products,\n        [id]: getIndexedProduct(product)\n    }), {});\n\n/** @namespace Util/Product/getExtensionAttributes */\nexport const getExtensionAttributes = (product) => {\n    const {\n        configurable_options,\n        configurableVariantIndex,\n        productOptions,\n        productOptionsMulti,\n        downloadableLinks,\n        variants,\n        type_id\n    } = product;\n\n    if (type_id === CONFIGURABLE) {\n        const { attributes = {} } = variants[configurableVariantIndex] || {};\n        const properties = {\n            configurable_item_options: Object.values(configurable_options)\n                .reduce((prev, { attribute_id, attribute_code }) => {\n                    const {\n                        attribute_value,\n                        attribute_id: attrId\n                    } = attributes[attribute_code] || {};\n\n                    if (attribute_value) {\n                        return [\n                            ...prev,\n                            {\n                                option_id: attribute_id || attrId,\n                                option_value: attribute_value\n                            }\n                        ];\n                    }\n\n                    return prev;\n                }, [])\n        };\n\n        if (productOptions) {\n            properties.customizable_options = productOptions;\n        }\n        if (productOptionsMulti) {\n            properties.customizable_options_multi = productOptionsMulti;\n        }\n\n        return properties;\n    }\n\n    if (type_id === BUNDLE && (productOptions || productOptionsMulti)) {\n        return { bundle_options: Array.from(productOptions || []) };\n    }\n\n    if (type_id === SIMPLE && (productOptions || productOptionsMulti)) {\n        return {\n            customizable_options: productOptions || [],\n            customizable_options_multi: productOptionsMulti || []\n        };\n    }\n\n    if (type_id === DOWNLOADABLE && downloadableLinks) {\n        return {\n            downloadable_product_links: downloadableLinks\n        };\n    }\n\n    return {};\n};\n\n/** @namespace Util/Product/sortBySortOrder */\nexport const sortBySortOrder = (options, sortKey = 'sort_order') => options.sort(\n    (a, b) => {\n        if (a[sortKey] < b[sortKey]) {\n            return -1;\n        }\n\n        if (a[sortKey] > b[sortKey]) {\n            return 1;\n        }\n\n        return 0;\n    }\n);\n"]},"metadata":{},"sourceType":"module"}