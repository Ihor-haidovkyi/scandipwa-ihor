{"ast":null,"code":"import _defineProperty from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";var _MyAccountContainer$t2;/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{CUSTOMER_ACCOUNT,CUSTOMER_ACCOUNT_PAGE,CUSTOMER_WISHLIST}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/Header/Header.config\";import{updateMeta as _updateMeta}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Meta/Meta.action\";import{changeNavigationState}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.action\";import{TOP_NAVIGATION_TYPE}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.reducer\";import{toggleOverlayByKey as _toggleOverlayByKey}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Overlay/Overlay.action\";import{ADDRESS_BOOK,DASHBOARD,MY_DOWNLOADABLE,MY_ORDERS,MY_WISHLIST,NEWSLETTER_SUBSCRIPTION}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Account\";import{HistoryType,LocationType,MatchType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Common\";import{DeviceType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Device\";import{isSignedIn}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";import history from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/History\";import{appendWithStoreCode}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Url\";import MyAccount from\"./MyAccount.component\";import{MY_ACCOUNT_URL}from\"./MyAccount.config\";export var BreadcrumbsDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Breadcrumbs/Breadcrumbs.dispatcher\");export var MyAccountDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/MyAccount/MyAccount.dispatcher\");/** @namespace Route/MyAccount/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{device:state.ConfigReducer.device,isWishlistEnabled:state.ConfigReducer.wishlist_general_active,wishlistItems:state.WishlistReducer.productsInWishlist,isSignedIn:state.MyAccountReducer.isSignedIn,newsletterActive:state.ConfigReducer.newsletter_general_active};},\"Route/MyAccount/Container/mapStateToProps\");/** @namespace Route/MyAccount/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{updateBreadcrumbs:function updateBreadcrumbs(breadcrumbs){return BreadcrumbsDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.update(breadcrumbs,dispatch);});},changeHeaderState:function changeHeaderState(state){return dispatch(changeNavigationState(TOP_NAVIGATION_TYPE,state));},requestCustomerData:function requestCustomerData(){return MyAccountDispatcher.then(function(_ref2){var dispatcher=_ref2.default;return dispatcher.requestCustomerData(dispatch);});},toggleOverlayByKey:function toggleOverlayByKey(key){return dispatch(_toggleOverlayByKey(key));},updateMeta:function updateMeta(meta){return dispatch(_updateMeta(meta));}};},\"Route/MyAccount/Container/mapDispatchToProps\");/** @namespace Route/MyAccount/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _MyAccountContainer=/*#__PURE__*/function(_Extensible){_inherits(_MyAccountContainer,_Extensible);var _super=_createSuper(_MyAccountContainer);function _MyAccountContainer(){var _this;_classCallCheck(this,_MyAccountContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={changeActiveTab:_this.changeActiveTab.bind(_assertThisInitialized(_this)),onSignIn:_this.onSignIn.bind(_assertThisInitialized(_this)),onSignOut:_this.onSignOut.bind(_assertThisInitialized(_this))};_this.getMyWishlistHeaderTitle=function(){var wishlistItems=_this.props.wishlistItems;var _Object$keys=Object.keys(wishlistItems),length=_Object$keys.length;return\"\".concat(length,\" \").concat(length===1?__('item'):__('items'));};return _this;}_createClass(_MyAccountContainer,[{key:\"__construct\",value:function __construct(props){_get(_getPrototypeOf(_MyAccountContainer.prototype),\"__construct\",this).call(this,props);var _this$props=this.props,updateMeta=_this$props.updateMeta,toggleOverlayByKey=_this$props.toggleOverlayByKey;this.state=_objectSpread(_objectSpread({},MyAccountContainer.navigateToSelectedTab(this.props)),{},{isEditingActive:false});if(!isSignedIn()){toggleOverlayByKey(CUSTOMER_ACCOUNT);}updateMeta({title:__('My account')});this.redirectIfNotSignedIn();this.onSignIn();this.updateBreadcrumbs();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){var prevWishlistItems=prevProps.wishlistItems,prevIsSignedIn=prevProps.isSignedIn;var _this$props2=this.props,wishlistItems=_this$props2.wishlistItems,currIsSignedIn=_this$props2.isSignedIn;var prevActiveTab=prevState.activeTab;var activeTab=this.state.activeTab;this.redirectIfNotSignedIn();if(prevIsSignedIn!==currIsSignedIn){this.changeHeaderState();}if(prevActiveTab!==activeTab){this.updateBreadcrumbs();this.changeHeaderState();}if(Object.keys(wishlistItems).length!==Object.keys(prevWishlistItems).length){this.changeHeaderState();}if(!isSignedIn()){this.changeHeaderState('default');}}},{key:\"tabsFilterEnabled\",value:function tabsFilterEnabled(){var _this2=this;return Object.fromEntries(Object.entries(MyAccountContainer.tabMap).filter(function(_ref3){var _ref4=_slicedToArray(_ref3,1),k=_ref4[0];return MyAccountContainer.isTabEnabled(_this2.props,k);}));}},{key:\"onSignOut\",value:function onSignOut(){var toggleOverlayByKey=this.props.toggleOverlayByKey;this.setState({activeTab:DASHBOARD});toggleOverlayByKey(CUSTOMER_ACCOUNT);history.push(appendWithStoreCode('/'));}},{key:\"onSignIn\",value:function onSignIn(){var requestCustomerData=this.props.requestCustomerData;if(isSignedIn()){requestCustomerData();}this.changeHeaderState();}},{key:\"changeWishlistHeaderState\",value:function changeWishlistHeaderState(hiddenElements){var _this3=this;var changeHeaderState=this.props.changeHeaderState;var isEditingActive=this.state.isEditingActive;var currentHiddenElements=hiddenElements||[isEditingActive?'edit':'ok'];var handleClick=function handleClick(){var isEdit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_this3.setState({isEditingActive:isEdit});var hiddenElements=[isEdit?'edit':'ok'];_this3.changeWishlistHeaderState(hiddenElements);};changeHeaderState({title:this.getMyWishlistHeaderTitle(),name:CUSTOMER_WISHLIST,onEditClick:function onEditClick(){return handleClick(true);},onOkClick:function onOkClick(){return handleClick();},hiddenElements:currentHiddenElements,shouldNotGoToPrevState:true});}},{key:\"changeDefaultHeaderState\",value:function changeDefaultHeaderState(){var changeHeaderState=this.props.changeHeaderState;changeHeaderState({title:'My account',name:CUSTOMER_ACCOUNT_PAGE,onBackClick:function onBackClick(){return history.push(appendWithStoreCode('/'));}});}},{key:\"changeHeaderState\",value:function changeHeaderState(activeTabParam){var activeTabState=this.state.activeTab;var activeTab=activeTabParam||activeTabState;if(activeTab!==MY_WISHLIST){this.changeDefaultHeaderState();return;}this.changeWishlistHeaderState();}},{key:\"changeActiveTab\",value:function changeActiveTab(activeTab){var history=this.props.history;var _this$tabsFilterEnabl=this.tabsFilterEnabled(MyAccountContainer.tabMap),url=_this$tabsFilterEnabl[activeTab].url;history.push(appendWithStoreCode(\"\".concat(MY_ACCOUNT_URL).concat(url)));this.changeHeaderState(activeTab);}},{key:\"updateBreadcrumbs\",value:function updateBreadcrumbs(){var updateBreadcrumbs=this.props.updateBreadcrumbs;var activeTab=this.state.activeTab;var _MyAccountContainer$t=MyAccountContainer.tabMap[activeTab],url=_MyAccountContainer$t.url,name=_MyAccountContainer$t.name;updateBreadcrumbs([{url:\"\".concat(MY_ACCOUNT_URL).concat(url),name:name},{name:__('My Account'),url:\"\".concat(MY_ACCOUNT_URL,\"/\").concat(DASHBOARD)}]);}},{key:\"redirectIfNotSignedIn\",value:function redirectIfNotSignedIn(){var _this$props3=this.props,history=_this$props3.history,pathname=_this$props3.location.pathname,device=_this$props3.device;if(isSignedIn()){// do nothing for signed-in users\nreturn;}if(device.isMobile){// do not redirect on mobile\nreturn;}if(pathname==='/forgot-password'){// forward the forgot password state\nhistory.push({pathname:appendWithStoreCode('/'),state:{isForgotPassword:true}});return;}history.push({pathname:appendWithStoreCode('/')});}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,MyAccount,Object.assign({},this.props,this.state,this.containerFunctions,{tabMap:this.tabsFilterEnabled(MyAccountContainer.tabMap)}));}}],[{key:\"isTabEnabled\",value:function isTabEnabled(props,tabName){var isWishlistEnabled=props.isWishlistEnabled,newsletterActive=props.newsletterActive;switch(tabName){case MY_WISHLIST:return isWishlistEnabled;case NEWSLETTER_SUBSCRIPTION:return newsletterActive;default:return true;}}},{key:\"navigateToSelectedTab\",value:function navigateToSelectedTab(props){var state=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var history=props.history,_props$match=props.match;_props$match=_props$match===void 0?{}:_props$match;var _props$match$params=_props$match.params;_props$match$params=_props$match$params===void 0?{}:_props$match$params;var historyActiveTab=_props$match$params.tab;var activeTab=state.activeTab;// redirect to Dashboard, if user visited non-existent or disabled page\nvar newActiveTab=this.tabMap[historyActiveTab]&&this.isTabEnabled(props,historyActiveTab)?historyActiveTab:DASHBOARD;if(historyActiveTab!==newActiveTab){history.push(appendWithStoreCode(\"\".concat(MY_ACCOUNT_URL,\"/\").concat(newActiveTab)));}if(activeTab!==newActiveTab){return{activeTab:newActiveTab};}return null;}},{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){return MyAccountContainer.navigateToSelectedTab(props,state);}}]);return _MyAccountContainer;}(Extensible(PureComponent));_MyAccountContainer.defaultProps={wishlistItems:{}};_MyAccountContainer.tabMap=(_MyAccountContainer$t2={},_defineProperty(_MyAccountContainer$t2,DASHBOARD,{url:'/dashboard',name:__('Dashboard')}),_defineProperty(_MyAccountContainer$t2,ADDRESS_BOOK,{url:'/address-book',name:__('Address book')}),_defineProperty(_MyAccountContainer$t2,MY_ORDERS,{url:'/my-orders',name:__('My orders')}),_defineProperty(_MyAccountContainer$t2,MY_DOWNLOADABLE,{url:'/my-downloadable',name:__('My downloadable')}),_defineProperty(_MyAccountContainer$t2,MY_WISHLIST,{url:'/my-wishlist',name:__('My wishlist')}),_defineProperty(_MyAccountContainer$t2,NEWSLETTER_SUBSCRIPTION,{url:'/newsletter-subscription',name:__('Newsletter Subscription')}),_MyAccountContainer$t2);Object.defineProperty(_MyAccountContainer,'name',{value:'MyAccountContainer'});export var MyAccountContainer=middleware(_MyAccountContainer,\"Route/MyAccount/Container\");export default connect(mapStateToProps,mapDispatchToProps)(MyAccountContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/route/MyAccount/MyAccount.container.js"],"names":["PureComponent","connect","CUSTOMER_ACCOUNT","CUSTOMER_ACCOUNT_PAGE","CUSTOMER_WISHLIST","updateMeta","changeNavigationState","TOP_NAVIGATION_TYPE","toggleOverlayByKey","ADDRESS_BOOK","DASHBOARD","MY_DOWNLOADABLE","MY_ORDERS","MY_WISHLIST","NEWSLETTER_SUBSCRIPTION","HistoryType","LocationType","MatchType","DeviceType","isSignedIn","history","appendWithStoreCode","MyAccount","MY_ACCOUNT_URL","BreadcrumbsDispatcher","MyAccountDispatcher","mapStateToProps","state","device","ConfigReducer","isWishlistEnabled","wishlist_general_active","wishlistItems","WishlistReducer","productsInWishlist","MyAccountReducer","newsletterActive","newsletter_general_active","mapDispatchToProps","dispatch","updateBreadcrumbs","breadcrumbs","then","dispatcher","default","update","changeHeaderState","requestCustomerData","key","meta","MyAccountContainer","containerFunctions","changeActiveTab","bind","onSignIn","onSignOut","getMyWishlistHeaderTitle","props","Object","keys","length","__","navigateToSelectedTab","isEditingActive","title","redirectIfNotSignedIn","prevProps","prevState","prevWishlistItems","prevIsSignedIn","currIsSignedIn","prevActiveTab","activeTab","fromEntries","entries","tabMap","filter","k","isTabEnabled","setState","push","hiddenElements","currentHiddenElements","handleClick","isEdit","changeWishlistHeaderState","name","onEditClick","onOkClick","shouldNotGoToPrevState","onBackClick","activeTabParam","activeTabState","changeDefaultHeaderState","tabsFilterEnabled","url","pathname","location","isMobile","isForgotPassword","tabName","match","params","historyActiveTab","tab","newActiveTab","defaultProps","defineProperty","_MyAccountContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { CUSTOMER_ACCOUNT, CUSTOMER_ACCOUNT_PAGE, CUSTOMER_WISHLIST } from 'Component/Header/Header.config';\nimport { updateMeta } from 'Store/Meta/Meta.action';\nimport { changeNavigationState } from 'Store/Navigation/Navigation.action';\nimport { TOP_NAVIGATION_TYPE } from 'Store/Navigation/Navigation.reducer';\nimport { toggleOverlayByKey } from 'Store/Overlay/Overlay.action';\nimport {\n    ADDRESS_BOOK,\n    DASHBOARD, MY_DOWNLOADABLE, MY_ORDERS,\n    MY_WISHLIST, NEWSLETTER_SUBSCRIPTION\n} from 'Type/Account';\nimport { HistoryType, LocationType, MatchType } from 'Type/Common';\nimport { DeviceType } from 'Type/Device';\nimport { isSignedIn } from 'Util/Auth';\nimport history from 'Util/History';\nimport { appendWithStoreCode } from 'Util/Url';\n\nimport MyAccount from './MyAccount.component';\nimport { MY_ACCOUNT_URL } from './MyAccount.config';\n\nexport const BreadcrumbsDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Breadcrumbs/Breadcrumbs.dispatcher'\n);\nexport const MyAccountDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/MyAccount/MyAccount.dispatcher'\n);\n\n/** @namespace Route/MyAccount/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    device: state.ConfigReducer.device,\n    isWishlistEnabled: state.ConfigReducer.wishlist_general_active,\n    wishlistItems: state.WishlistReducer.productsInWishlist,\n    isSignedIn: state.MyAccountReducer.isSignedIn,\n    newsletterActive: state.ConfigReducer.newsletter_general_active\n});\n\n/** @namespace Route/MyAccount/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    updateBreadcrumbs: (breadcrumbs) => BreadcrumbsDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.update(breadcrumbs, dispatch)\n    ),\n    changeHeaderState: (state) => dispatch(changeNavigationState(TOP_NAVIGATION_TYPE, state)),\n    requestCustomerData: () => MyAccountDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.requestCustomerData(dispatch)\n    ),\n    toggleOverlayByKey: (key) => dispatch(toggleOverlayByKey(key)),\n    updateMeta: (meta) => dispatch(updateMeta(meta))\n});\n\n/** @namespace Route/MyAccount/Container */\nexport class MyAccountContainer extends PureComponent {\n    static propTypes = {\n        changeHeaderState: PropTypes.func.isRequired,\n        requestCustomerData: PropTypes.func.isRequired,\n        updateBreadcrumbs: PropTypes.func.isRequired,\n        toggleOverlayByKey: PropTypes.func.isRequired,\n        updateMeta: PropTypes.func.isRequired,\n        match: MatchType.isRequired,\n        location: LocationType.isRequired,\n        history: HistoryType.isRequired,\n        device: DeviceType.isRequired,\n        wishlistItems: PropTypes.object,\n        newsletterActive: PropTypes.bool.isRequired,\n        isWishlistEnabled: PropTypes.bool.isRequired,\n        isSignedIn: PropTypes.bool.isRequired\n    };\n\n    static defaultProps = {\n        wishlistItems: {}\n    };\n\n    static tabMap = {\n        [DASHBOARD]: {\n            url: '/dashboard',\n            name: __('Dashboard')\n        },\n        [ADDRESS_BOOK]: {\n            url: '/address-book',\n            name: __('Address book')\n        },\n        [MY_ORDERS]: {\n            url: '/my-orders',\n            name: __('My orders')\n        },\n        [MY_DOWNLOADABLE]: {\n            url: '/my-downloadable',\n            name: __('My downloadable')\n        },\n        [MY_WISHLIST]: {\n            url: '/my-wishlist',\n            name: __('My wishlist')\n        },\n        [NEWSLETTER_SUBSCRIPTION]: {\n            url: '/newsletter-subscription',\n            name: __('Newsletter Subscription')\n        }\n    };\n\n    static isTabEnabled(props, tabName) {\n        const { isWishlistEnabled, newsletterActive } = props;\n\n        switch (tabName) {\n        case MY_WISHLIST:\n            return isWishlistEnabled;\n        case NEWSLETTER_SUBSCRIPTION:\n            return newsletterActive;\n        default:\n            return true;\n        }\n    }\n\n    static navigateToSelectedTab(props, state = {}) {\n        const {\n            history,\n            match: {\n                params: {\n                    tab: historyActiveTab\n                } = {}\n            } = {}\n        } = props;\n\n        const { activeTab } = state;\n\n        // redirect to Dashboard, if user visited non-existent or disabled page\n        const newActiveTab = this.tabMap[historyActiveTab] && this.isTabEnabled(props, historyActiveTab)\n            ? historyActiveTab\n            : DASHBOARD;\n\n        if (historyActiveTab !== newActiveTab) {\n            history.push(appendWithStoreCode(`${ MY_ACCOUNT_URL }/${ newActiveTab }`));\n        }\n\n        if (activeTab !== newActiveTab) {\n            return { activeTab: newActiveTab };\n        }\n\n        return null;\n    }\n\n    containerFunctions = {\n        changeActiveTab: this.changeActiveTab.bind(this),\n        onSignIn: this.onSignIn.bind(this),\n        onSignOut: this.onSignOut.bind(this)\n    };\n\n    __construct(props) {\n        super.__construct(props);\n\n        const {\n            updateMeta,\n            toggleOverlayByKey\n        } = this.props;\n\n        this.state = {\n            ...MyAccountContainer.navigateToSelectedTab(this.props),\n            isEditingActive: false\n        };\n\n        if (!isSignedIn()) {\n            toggleOverlayByKey(CUSTOMER_ACCOUNT);\n        }\n\n        updateMeta({ title: __('My account') });\n\n        this.redirectIfNotSignedIn();\n        this.onSignIn();\n        this.updateBreadcrumbs();\n    }\n\n    static getDerivedStateFromProps(props, state) {\n        return MyAccountContainer.navigateToSelectedTab(props, state);\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        const {\n            wishlistItems: prevWishlistItems,\n            isSignedIn: prevIsSignedIn\n        } = prevProps;\n        const {\n            wishlistItems,\n            isSignedIn: currIsSignedIn\n        } = this.props;\n        const { activeTab: prevActiveTab } = prevState;\n        const { activeTab } = this.state;\n\n        this.redirectIfNotSignedIn();\n\n        if (prevIsSignedIn !== currIsSignedIn) {\n            this.changeHeaderState();\n        }\n\n        if (prevActiveTab !== activeTab) {\n            this.updateBreadcrumbs();\n            this.changeHeaderState();\n        }\n\n        if (Object.keys(wishlistItems).length !== Object.keys(prevWishlistItems).length) {\n            this.changeHeaderState();\n        }\n\n        if (!isSignedIn()) {\n            this.changeHeaderState('default');\n        }\n    }\n\n    getMyWishlistHeaderTitle = () => {\n        const { wishlistItems } = this.props;\n\n        const { length } = Object.keys(wishlistItems);\n\n        return `${ length } ${ length === 1 ? __('item') : __('items') }`;\n    };\n\n    tabsFilterEnabled() {\n        return Object.fromEntries(Object.entries(MyAccountContainer.tabMap)\n            .filter(([k]) => MyAccountContainer.isTabEnabled(this.props, k)));\n    }\n\n    onSignOut() {\n        const { toggleOverlayByKey } = this.props;\n        this.setState({ activeTab: DASHBOARD });\n        toggleOverlayByKey(CUSTOMER_ACCOUNT);\n        history.push(appendWithStoreCode('/'));\n    }\n\n    onSignIn() {\n        const { requestCustomerData } = this.props;\n\n        if (isSignedIn()) {\n            requestCustomerData();\n        }\n\n        this.changeHeaderState();\n    }\n\n    changeWishlistHeaderState(hiddenElements) {\n        const { changeHeaderState } = this.props;\n        const { isEditingActive } = this.state;\n\n        const currentHiddenElements = hiddenElements || [isEditingActive ? 'edit' : 'ok'];\n\n        const handleClick = (isEdit = false) => {\n            this.setState({ isEditingActive: isEdit });\n\n            const hiddenElements = [isEdit ? 'edit' : 'ok'];\n\n            this.changeWishlistHeaderState(hiddenElements);\n        };\n\n        changeHeaderState({\n            title: this.getMyWishlistHeaderTitle(),\n            name: CUSTOMER_WISHLIST,\n            onEditClick: () => handleClick(true),\n            onOkClick: () => handleClick(),\n            hiddenElements: currentHiddenElements,\n            shouldNotGoToPrevState: true\n        });\n    }\n\n    changeDefaultHeaderState() {\n        const { changeHeaderState } = this.props;\n\n        changeHeaderState({\n            title: 'My account',\n            name: CUSTOMER_ACCOUNT_PAGE,\n            onBackClick: () => history.push(appendWithStoreCode('/'))\n        });\n    }\n\n    changeHeaderState(activeTabParam) {\n        const { activeTab: activeTabState } = this.state;\n        const activeTab = activeTabParam || activeTabState;\n\n        if (activeTab !== MY_WISHLIST) {\n            this.changeDefaultHeaderState();\n\n            return;\n        }\n\n        this.changeWishlistHeaderState();\n    }\n\n    changeActiveTab(activeTab) {\n        const { history } = this.props;\n        const { [activeTab]: { url } } = this.tabsFilterEnabled(MyAccountContainer.tabMap);\n\n        history.push(appendWithStoreCode(`${ MY_ACCOUNT_URL }${ url }`));\n        this.changeHeaderState(activeTab);\n    }\n\n    updateBreadcrumbs() {\n        const { updateBreadcrumbs } = this.props;\n        const { activeTab } = this.state;\n        const { url, name } = MyAccountContainer.tabMap[activeTab];\n\n        updateBreadcrumbs([\n            { url: `${ MY_ACCOUNT_URL }${ url }`, name },\n            { name: __('My Account'), url: `${ MY_ACCOUNT_URL }/${ DASHBOARD }` }\n        ]);\n    }\n\n    redirectIfNotSignedIn() {\n        const {\n            history,\n            location: { pathname },\n            device\n        } = this.props;\n\n        if (isSignedIn()) { // do nothing for signed-in users\n            return;\n        }\n\n        if (device.isMobile) { // do not redirect on mobile\n            return;\n        }\n\n        if (pathname === '/forgot-password') { // forward the forgot password state\n            history.push({ pathname: appendWithStoreCode('/'), state: { isForgotPassword: true } });\n            return;\n        }\n\n        history.push({ pathname: appendWithStoreCode('/') });\n    }\n\n    render() {\n        return (\n            <MyAccount\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerFunctions }\n              tabMap={ this.tabsFilterEnabled(MyAccountContainer.tabMap) }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MyAccountContainer);\n"]},"metadata":{},"sourceType":"module"}