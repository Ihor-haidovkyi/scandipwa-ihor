{"ast":null,"code":"import _defineProperty from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _asyncToGenerator from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{CART_TAB}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/NavigationTabs/NavigationTabs.config\";import CheckoutQuery from\"/home/marketihor/scandipwa/packages/scandipwa/src/query/Checkout.query\";import MyAccountQuery from\"/home/marketihor/scandipwa/packages/scandipwa/src/query/MyAccount.query\";import{toggleBreadcrumbs as _toggleBreadcrumbs}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Breadcrumbs/Breadcrumbs.action\";import{updateShippingPrice as _updateShippingPrice}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Cart/Cart.action\";import{updateEmail as _updateEmail,updateShippingFields as _updateShippingFields}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Checkout/Checkout.action\";import{updateMeta as _updateMeta}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Meta/Meta.action\";import{changeNavigationState}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.action\";import{BOTTOM_NAVIGATION_TYPE,TOP_NAVIGATION_TYPE}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.reducer\";import{showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import{customerType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Account\";import{HistoryType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Common\";import{TotalsType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/MiniCart\";import{isSignedIn}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";import BrowserDatabase from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/BrowserDatabase\";import{deleteGuestQuoteId,getGuestQuoteId}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Cart\";import history from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/History\";import{debounce,fetchMutation,fetchQuery,getErrorMessage}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request\";import{ONE_MONTH_IN_SECONDS}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request/QueryDispatcher\";import{appendWithStoreCode}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Url\";import Checkout from\"./Checkout.component\";import{BILLING_STEP,DETAILS_STEP,PAYMENT_TOTALS,SHIPPING_STEP,UPDATE_EMAIL_CHECK_FREQUENCY}from\"./Checkout.config\";export var CartDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Cart/Cart.dispatcher\");export var MyAccountDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/MyAccount/MyAccount.dispatcher\");export var CheckoutDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Checkout/Checkout.dispatcher\");/** @namespace Route/Checkout/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{totals:state.CartReducer.cartTotals,customer:state.MyAccountReducer.customer,guest_checkout:state.ConfigReducer.guest_checkout,countries:state.ConfigReducer.countries,isEmailAvailable:state.CheckoutReducer.isEmailAvailable,isMobile:state.ConfigReducer.device.isMobile};},\"Route/Checkout/Container/mapStateToProps\");/** @namespace Route/Checkout/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{updateMeta:function updateMeta(meta){return dispatch(_updateMeta(meta));},resetCart:function resetCart(){return CartDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.updateInitialCartData(dispatch);});},resetGuestCart:function resetGuestCart(){return CartDispatcher.then(function(_ref2){var dispatcher=_ref2.default;dispatcher.resetGuestCart(dispatch);dispatcher.createGuestEmptyCart(dispatch);});},toggleBreadcrumbs:function toggleBreadcrumbs(state){return dispatch(_toggleBreadcrumbs(state));},showErrorNotification:function showErrorNotification(message){return dispatch(showNotification('error',message));},showInfoNotification:function showInfoNotification(message){return dispatch(showNotification('info',message));},showSuccessNotification:function showSuccessNotification(message){return dispatch(showNotification('success',message));},setHeaderState:function setHeaderState(stateName){return dispatch(changeNavigationState(TOP_NAVIGATION_TYPE,stateName));},setNavigationState:function setNavigationState(stateName){return dispatch(changeNavigationState(BOTTOM_NAVIGATION_TYPE,stateName));},createAccount:function createAccount(options){return MyAccountDispatcher.then(function(_ref3){var dispatcher=_ref3.default;return dispatcher.createAccount(options,dispatch);});},updateShippingFields:function updateShippingFields(fields){return dispatch(_updateShippingFields(fields));},updateEmail:function updateEmail(email){return dispatch(_updateEmail(email));},checkEmailAvailability:function checkEmailAvailability(email){return CheckoutDispatcher.then(function(_ref4){var dispatcher=_ref4.default;return dispatcher.handleData(dispatch,email);});},updateShippingPrice:function updateShippingPrice(data){return dispatch(_updateShippingPrice(data));}};},\"Route/Checkout/Container/mapDispatchToProps\");/** @namespace Route/Checkout/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _CheckoutContainer=/*#__PURE__*/function(_Extensible){_inherits(_CheckoutContainer,_Extensible);var _super=_createSuper(_CheckoutContainer);function _CheckoutContainer(){var _this;_classCallCheck(this,_CheckoutContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={setLoading:_this.setLoading.bind(_assertThisInitialized(_this)),setDetailsStep:_this.setDetailsStep.bind(_assertThisInitialized(_this)),savePaymentInformation:_this.savePaymentInformation.bind(_assertThisInitialized(_this)),saveAddressInformation:_this.saveAddressInformation.bind(_assertThisInitialized(_this)),onShippingEstimationFieldsChange:_this.onShippingEstimationFieldsChange.bind(_assertThisInitialized(_this)),onEmailChange:_this.onEmailChange.bind(_assertThisInitialized(_this)),onCreateUserChange:_this.onCreateUserChange.bind(_assertThisInitialized(_this)),onPasswordChange:_this.onPasswordChange.bind(_assertThisInitialized(_this)),onCouponCodeUpdate:_this.onCouponCodeUpdate.bind(_assertThisInitialized(_this)),goBack:_this.goBack.bind(_assertThisInitialized(_this))};_this.checkEmailAvailability=debounce(function(email){var checkEmailAvailability=_this.props.checkEmailAvailability;checkEmailAvailability(email);},UPDATE_EMAIL_CHECK_FREQUENCY);_this.setShippingAddress=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var isDefaultShipping,shippingAddress,region,region_id,address,mutation,data,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isDefaultShipping=_args.length>0&&_args[0]!==undefined?_args[0]:false;shippingAddress=_this.state.shippingAddress;region=shippingAddress.region,region_id=shippingAddress.region_id,address=_objectWithoutProperties(shippingAddress,[\"region\",\"region_id\"]);mutation=MyAccountQuery.getCreateAddressMutation(_objectSpread(_objectSpread({},address),{},{region:{region:region,region_id:region_id},default_shipping:isDefaultShipping}));_context.next=6;return fetchMutation(mutation);case 6:data=_context.sent;if(data===null||data===void 0?void 0:data.createCustomerAddress){_this.setState({shippingAddress:_objectSpread(_objectSpread({},shippingAddress),{},{id:data.createCustomerAddress.id})});}return _context.abrupt(\"return\",true);case 9:case\"end\":return _context.stop();}}},_callee);}));return function(){return _ref5.apply(this,arguments);};}();_this.containerProps=function(){var paymentTotals=_this.state.paymentTotals;return{checkoutTotals:_this._getCheckoutTotals(),paymentTotals:paymentTotals};};_this._handleError=function(error){var showErrorNotification=_this.props.showErrorNotification;_this.setState({isDeliveryOptionsLoading:false,isLoading:false},function(){showErrorNotification(getErrorMessage(error));});return false;};return _this;}_createClass(_CheckoutContainer,[{key:\"__construct\",value:function __construct(props){_get(_getPrototypeOf(_CheckoutContainer.prototype),\"__construct\",this).call(this,props);var toggleBreadcrumbs=props.toggleBreadcrumbs,is_virtual=props.totals.is_virtual;toggleBreadcrumbs(false);this.state={isLoading:is_virtual,isDeliveryOptionsLoading:false,requestsSent:0,paymentMethods:[],shippingMethods:[],shippingAddress:{},billingAddress:{},selectedShippingMethod:'',checkoutStep:is_virtual?BILLING_STEP:SHIPPING_STEP,orderID:'',paymentTotals:BrowserDatabase.getItem(PAYMENT_TOTALS)||{},email:'',isGuestEmailSaved:false,isCreateUser:false,estimateAddress:{}};if(is_virtual){this._getPaymentMethods();}}},{key:\"componentDidMount\",value:function componentDidMount(){var _this$props=this.props,history=_this$props.history,showInfoNotification=_this$props.showInfoNotification,guest_checkout=_this$props.guest_checkout,updateMeta=_this$props.updateMeta,_this$props$totals$it=_this$props.totals.items,items=_this$props$totals$it===void 0?[]:_this$props$totals$it;if(!items.length){showInfoNotification(__('Please add at least one product to cart!'));history.push(appendWithStoreCode('/cart'));}// if guest checkout is disabled and user is not logged in => throw him to homepage\nif(!guest_checkout&&!isSignedIn()){history.push(appendWithStoreCode('/'));}updateMeta({title:__('Checkout')});}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){var _this$props2=this.props,urlStep=_this$props2.match.params.step,isEmailAvailable=_this$props2.isEmailAvailable,updateEmail=_this$props2.updateEmail;var prevUrlStep=prevProps.match.params.step;var email=this.state.email;var prevEmail=prevState.email;// Handle going back from billing to shipping\nif(/shipping/.test(urlStep)&&/billing/.test(prevUrlStep)){BrowserDatabase.deleteItem(PAYMENT_TOTALS);// eslint-disable-next-line react/no-did-update-set-state\nthis.setState({checkoutStep:SHIPPING_STEP,isGuestEmailSaved:false});}if(email!==prevEmail){this.checkEmailAvailability(email);}if(!isEmailAvailable){updateEmail(email);}return null;}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){var toggleBreadcrumbs=this.props.toggleBreadcrumbs;toggleBreadcrumbs(true);}},{key:\"onEmailChange\",value:function onEmailChange(email){this.setState({email:email});}},{key:\"onCreateUserChange\",value:function onCreateUserChange(){var isCreateUser=this.state.isCreateUser;this.setState({isCreateUser:!isCreateUser});}},{key:\"onPasswordChange\",value:function onPasswordChange(password){this.setState({password:password});}},{key:\"onShippingEstimationFieldsChange\",value:function onShippingEstimationFieldsChange(address){var _this2=this;var requestsSent=this.state.requestsSent;var guestQuoteId=getGuestQuoteId();if(!guestQuoteId){return;}this.setState({isDeliveryOptionsLoading:true,requestsSent:requestsSent+1,estimateAddress:address});fetchMutation(CheckoutQuery.getEstimateShippingCosts(address,guestQuoteId)).then(/** @namespace Route/Checkout/Container/onShippingEstimationFieldsChangeFetchMutationThen */middleware(function(_ref6){var shippingMethods=_ref6.estimateShippingCosts;var requestsSent=_this2.state.requestsSent;_this2.setState({shippingMethods:shippingMethods,isDeliveryOptionsLoading:requestsSent>1,requestsSent:requestsSent-1});},\"Route/Checkout/Container/onShippingEstimationFieldsChangeFetchMutationThen\"),this._handleError);}},{key:\"onCouponCodeUpdate\",value:function onCouponCodeUpdate(){var _this$state=this.state,estimateAddress=_this$state.estimateAddress,checkoutStep=_this$state.checkoutStep;// update delivery methods on coupon change\n// in order ot fetch new available delivery methods\n// if any could be applied by coupon\nif(checkoutStep===SHIPPING_STEP){this.onShippingEstimationFieldsChange(estimateAddress);}}},{key:\"goBack\",value:function goBack(){var checkoutStep=this.state.checkoutStep;if(checkoutStep===BILLING_STEP){this.setState({isLoading:false});BrowserDatabase.deleteItem(PAYMENT_TOTALS);}history.goBack();}},{key:\"setDetailsStep\",value:function setDetailsStep(orderID){var _this$props3=this.props,resetCart=_this$props3.resetCart,resetGuestCart=_this$props3.resetGuestCart,setNavigationState=_this$props3.setNavigationState;deleteGuestQuoteId();BrowserDatabase.deleteItem(PAYMENT_TOTALS);if(isSignedIn()){resetCart();}else{resetGuestCart();}this.setState({isLoading:false,paymentTotals:{},checkoutStep:DETAILS_STEP,orderID:orderID});setNavigationState({name:CART_TAB});}},{key:\"setLoading\",value:function setLoading(){var isLoading=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.setState({isLoading:isLoading});}},{key:\"_getPaymentMethods\",value:function _getPaymentMethods(){var _this3=this;fetchQuery(CheckoutQuery.getPaymentMethodsQuery(getGuestQuoteId())).then(/** @namespace Route/Checkout/Container/fetchQueryThen */middleware(function(_ref7){var paymentMethods=_ref7.getPaymentMethods;_this3.setState({isLoading:false,paymentMethods:paymentMethods});},\"Route/Checkout/Container/fetchQueryThen\"),this._handleError);}},{key:\"_getCheckoutTotals\",value:function _getCheckoutTotals(){var cartTotals=this.props.totals;var shipping_amount=this.state.paymentTotals.shipping_amount;return shipping_amount?_objectSpread(_objectSpread({},cartTotals),{},{shipping_amount:shipping_amount}):cartTotals;}},{key:\"saveGuestEmail\",value:function saveGuestEmail(){var _this4=this;var email=this.state.email;var updateEmail=this.props.updateEmail;var guestCartId=getGuestQuoteId();if(!guestCartId){return null;}var mutation=CheckoutQuery.getSaveGuestEmailMutation(email,guestCartId);updateEmail(email);return fetchMutation(mutation).then(/** @namespace Route/Checkout/Container/saveGuestEmailFetchMutationThen */middleware(function(_ref8){var data=_ref8.setGuestEmailOnCart;if(data){_this4.setState({isGuestEmailSaved:true});}return data;},\"Route/Checkout/Container/saveGuestEmailFetchMutationThen\"),this._handleError);}},{key:\"createUserOrSaveGuest\",value:function(){var _createUserOrSaveGuest=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this$props4,createAccount,is_virtual,showSuccessNotification,isEmailAvailable,_this$state2,email,password,isCreateUser,_this$state2$shipping,firstname,lastname,options,creation;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props4=this.props,createAccount=_this$props4.createAccount,is_virtual=_this$props4.totals.is_virtual,showSuccessNotification=_this$props4.showSuccessNotification,isEmailAvailable=_this$props4.isEmailAvailable;_this$state2=this.state,email=_this$state2.email,password=_this$state2.password,isCreateUser=_this$state2.isCreateUser,_this$state2$shipping=_this$state2.shippingAddress,firstname=_this$state2$shipping.firstname,lastname=_this$state2$shipping.lastname;if(!(!isCreateUser||!isEmailAvailable)){_context2.next=4;break;}return _context2.abrupt(\"return\",this.saveGuestEmail());case 4:options={customer:{email:email,firstname:firstname,lastname:lastname},password:password};_context2.next=7;return createAccount(options);case 7:creation=_context2.sent;if(creation){_context2.next=10;break;}return _context2.abrupt(\"return\",creation);case 10:showSuccessNotification(__('Your account has been created successfully!'));if(is_virtual){_context2.next=13;break;}return _context2.abrupt(\"return\",this.setShippingAddress(true));case 13:return _context2.abrupt(\"return\",true);case 14:case\"end\":return _context2.stop();}}},_callee2,this);}));function createUserOrSaveGuest(){return _createUserOrSaveGuest.apply(this,arguments);}return createUserOrSaveGuest;}()},{key:\"prepareAddressInformation\",value:function prepareAddressInformation(addressInformation){var _addressInformation$s=addressInformation.shipping_address;_addressInformation$s=_addressInformation$s===void 0?{}:_addressInformation$s;var id=_addressInformation$s.id,save_in_address_book=_addressInformation$s.save_in_address_book,shippingAddress=_objectWithoutProperties(_addressInformation$s,[\"id\",\"save_in_address_book\"]),_addressInformation$b=addressInformation.billing_address;_addressInformation$b=_addressInformation$b===void 0?{}:_addressInformation$b;var dropId=_addressInformation$b.id,dropSaveInAddressBook=_addressInformation$b.save_in_address_book,billingAddress=_objectWithoutProperties(_addressInformation$b,[\"id\",\"save_in_address_book\"]),data=_objectWithoutProperties(addressInformation,[\"shipping_address\",\"billing_address\"]);return _objectSpread(_objectSpread({},data),{},{shipping_address:shippingAddress,billing_address:billingAddress});}},{key:\"saveAddressInformation\",value:function(){var _saveAddressInformation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(addressInformation){var _this5=this;var updateShippingPrice,shipping_address,shipping_method_code;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:updateShippingPrice=this.props.updateShippingPrice;shipping_address=addressInformation.shipping_address,shipping_method_code=addressInformation.shipping_method_code;this.setState({isLoading:true,shippingAddress:shipping_address,selectedShippingMethod:shipping_method_code});if(isSignedIn()){_context3.next=9;break;}_context3.next=6;return this.createUserOrSaveGuest();case 6:if(_context3.sent){_context3.next=9;break;}this.setState({isLoading:false});return _context3.abrupt(\"return\");case 9:fetchMutation(CheckoutQuery.getSaveAddressInformation(this.prepareAddressInformation(addressInformation),getGuestQuoteId())).then(/** @namespace Route/Checkout/Container/saveAddressInformationFetchMutationThen */middleware(function(_ref9){var data=_ref9.saveAddressInformation;var payment_methods=data.payment_methods,totals=data.totals;updateShippingPrice(totals);BrowserDatabase.setItem(totals,PAYMENT_TOTALS,ONE_MONTH_IN_SECONDS);_this5.setState({isLoading:false,paymentMethods:payment_methods,checkoutStep:BILLING_STEP,paymentTotals:totals});},\"Route/Checkout/Container/saveAddressInformationFetchMutationThen\"),this._handleError);case 10:case\"end\":return _context3.stop();}}},_callee3,this);}));function saveAddressInformation(_x){return _saveAddressInformation.apply(this,arguments);}return saveAddressInformation;}()},{key:\"savePaymentInformation\",value:function(){var _savePaymentInformation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(paymentInformation){var _this6=this;var is_virtual,_paymentInformation$b,billingFirstName,billingLastName,billingAddress;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:is_virtual=this.props.totals.is_virtual;_paymentInformation$b=paymentInformation.billing_address,billingFirstName=_paymentInformation$b.firstname,billingLastName=_paymentInformation$b.lastname,billingAddress=paymentInformation.billing_address;/**\n         * If cart contains only virtual products then set firstname & lastname\n         * from billing step into shippingAddress for user creating.\n         */if(is_virtual){this.setState({shippingAddress:{firstname:billingFirstName,lastname:billingLastName}});}this.setState({isLoading:true,billingAddress:billingAddress});if(isSignedIn()){_context4.next=10;break;}_context4.next=7;return this.createUserOrSaveGuest();case 7:if(_context4.sent){_context4.next=10;break;}this.setState({isLoading:false});return _context4.abrupt(\"return\");case 10:_context4.next=12;return this.saveBillingAddress(paymentInformation).then(/** @namespace Route/Checkout/Container/saveBillingAddressThen */middleware(function(){return _this6.savePaymentMethodAndPlaceOrder(paymentInformation);},\"Route/Checkout/Container/saveBillingAddressThen\"),this._handleError);case 12:case\"end\":return _context4.stop();}}},_callee4,this);}));function savePaymentInformation(_x2){return _savePaymentInformation.apply(this,arguments);}return savePaymentInformation;}()},{key:\"trimAddressMagentoStyle\",value:function trimAddressMagentoStyle(address){var countries=this.props.countries;var id=address.id,country_id=address.country_id,region_code=address.region_code,purchaseOrderNumber=address.purchaseOrderNumber,region_id=address.region_id,region=address.region,restOfBillingAddress=_objectWithoutProperties(address,[\"id\",\"country_id\",\"region_code\",\"purchaseOrderNumber\",\"region_id\",\"region\"]);var newAddress=_objectSpread(_objectSpread({},restOfBillingAddress),{},{country_code:country_id,region:region,region_id:region_id});/**\n         * If there is no region specified, but there is region ID\n         * get the region code by the country ID\n         */if(region_id){// find a country by country ID\nvar _ref10=countries.find(function(_ref11){var id=_ref11.id;return id===country_id;})||{},available_regions=_ref10.available_regions;if(!available_regions){return newAddress;}// find region by region ID\nvar _ref12=available_regions.find(function(_ref13){var id=_ref13.id;return+id===+region_id;})||{},code=_ref12.code;if(!code){return newAddress;}newAddress.region=code;}return newAddress;}},{key:\"saveBillingAddress\",value:function(){var _saveBillingAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(paymentInformation){var isCustomerSignedIn,guest_cart_id,billing_address,same_as_shipping,_this$state$shippingA,_this$state$shippingA2,shippingAddressId,billingAddress;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:isCustomerSignedIn=isSignedIn();guest_cart_id=!isCustomerSignedIn?getGuestQuoteId():'';if(!(!isCustomerSignedIn&&!getGuestQuoteId)){_context5.next=4;break;}return _context5.abrupt(\"return\");case 4:billing_address=paymentInformation.billing_address,same_as_shipping=paymentInformation.same_as_shipping;_this$state$shippingA=this.state.shippingAddress;_this$state$shippingA=_this$state$shippingA===void 0?{}:_this$state$shippingA;_this$state$shippingA2=_this$state$shippingA.id,shippingAddressId=_this$state$shippingA2===void 0?null:_this$state$shippingA2;billingAddress={address:this.trimAddressMagentoStyle(billing_address)};if(same_as_shipping&&shippingAddressId){billingAddress.customer_address_id=shippingAddressId;}_context5.next=12;return fetchMutation(CheckoutQuery.getSetBillingAddressOnCart({guest_cart_id:guest_cart_id,same_as_shipping:same_as_shipping,billing_address:billingAddress}));case 12:case\"end\":return _context5.stop();}}},_callee5,this);}));function saveBillingAddress(_x3){return _saveBillingAddress.apply(this,arguments);}return saveBillingAddress;}()},{key:\"savePaymentMethodAndPlaceOrder\",value:function(){var _savePaymentMethodAndPlaceOrder=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(paymentInformation){var _paymentInformation$p,code,additional_data,purchase_order_number,isCustomerSignedIn,guest_cart_id,_payment_method,orderData,order_id;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_paymentInformation$p=paymentInformation.paymentMethod,code=_paymentInformation$p.code,additional_data=_paymentInformation$p.additional_data,purchase_order_number=_paymentInformation$p.purchase_order_number;isCustomerSignedIn=isSignedIn();guest_cart_id=!isCustomerSignedIn?getGuestQuoteId():'';if(!(!isCustomerSignedIn&&!guest_cart_id)){_context6.next=5;break;}return _context6.abrupt(\"return\");case 5:_context6.prev=5;_context6.next=8;return fetchMutation(CheckoutQuery.getSetPaymentMethodOnCartMutation({guest_cart_id:guest_cart_id,payment_method:(_payment_method={code:code},_defineProperty(_payment_method,code,additional_data),_defineProperty(_payment_method,\"purchase_order_number\",purchase_order_number),_payment_method)}));case 8:_context6.next=10;return fetchMutation(CheckoutQuery.getPlaceOrderMutation(guest_cart_id));case 10:orderData=_context6.sent;order_id=orderData.placeOrder.order.order_id;this.setDetailsStep(order_id);_context6.next=18;break;case 15:_context6.prev=15;_context6.t0=_context6[\"catch\"](5);this._handleError(_context6.t0);case 18:case\"end\":return _context6.stop();}}},_callee6,this,[[5,15]]);}));function savePaymentMethodAndPlaceOrder(_x4){return _savePaymentMethodAndPlaceOrder.apply(this,arguments);}return savePaymentMethodAndPlaceOrder;}()},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,Checkout,Object.assign({},this.props,this.state,this.containerFunctions,this.containerProps()));}}]);return _CheckoutContainer;}(Extensible(PureComponent));Object.defineProperty(_CheckoutContainer,'name',{value:'CheckoutContainer'});export var CheckoutContainer=middleware(_CheckoutContainer,\"Route/Checkout/Container\");export default connect(mapStateToProps,mapDispatchToProps)(CheckoutContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/route/Checkout/Checkout.container.js"],"names":["PureComponent","connect","CART_TAB","CheckoutQuery","MyAccountQuery","toggleBreadcrumbs","updateShippingPrice","updateEmail","updateShippingFields","updateMeta","changeNavigationState","BOTTOM_NAVIGATION_TYPE","TOP_NAVIGATION_TYPE","showNotification","customerType","HistoryType","TotalsType","isSignedIn","BrowserDatabase","deleteGuestQuoteId","getGuestQuoteId","history","debounce","fetchMutation","fetchQuery","getErrorMessage","ONE_MONTH_IN_SECONDS","appendWithStoreCode","Checkout","BILLING_STEP","DETAILS_STEP","PAYMENT_TOTALS","SHIPPING_STEP","UPDATE_EMAIL_CHECK_FREQUENCY","CartDispatcher","MyAccountDispatcher","CheckoutDispatcher","mapStateToProps","state","totals","CartReducer","cartTotals","customer","MyAccountReducer","guest_checkout","ConfigReducer","countries","isEmailAvailable","CheckoutReducer","isMobile","device","mapDispatchToProps","dispatch","meta","resetCart","then","dispatcher","default","updateInitialCartData","resetGuestCart","createGuestEmptyCart","showErrorNotification","message","showInfoNotification","showSuccessNotification","setHeaderState","stateName","setNavigationState","createAccount","options","fields","email","checkEmailAvailability","handleData","data","CheckoutContainer","containerFunctions","setLoading","bind","setDetailsStep","savePaymentInformation","saveAddressInformation","onShippingEstimationFieldsChange","onEmailChange","onCreateUserChange","onPasswordChange","onCouponCodeUpdate","goBack","props","setShippingAddress","isDefaultShipping","shippingAddress","region","region_id","address","mutation","getCreateAddressMutation","default_shipping","createCustomerAddress","setState","id","containerProps","paymentTotals","checkoutTotals","_getCheckoutTotals","_handleError","error","isDeliveryOptionsLoading","isLoading","is_virtual","requestsSent","paymentMethods","shippingMethods","billingAddress","selectedShippingMethod","checkoutStep","orderID","getItem","isGuestEmailSaved","isCreateUser","estimateAddress","_getPaymentMethods","items","length","__","push","title","prevProps","prevState","urlStep","match","params","step","prevUrlStep","prevEmail","test","deleteItem","password","guestQuoteId","getEstimateShippingCosts","estimateShippingCosts","name","getPaymentMethodsQuery","getPaymentMethods","shipping_amount","guestCartId","getSaveGuestEmailMutation","setGuestEmailOnCart","firstname","lastname","saveGuestEmail","creation","addressInformation","shipping_address","save_in_address_book","billing_address","dropId","dropSaveInAddressBook","shipping_method_code","createUserOrSaveGuest","getSaveAddressInformation","prepareAddressInformation","payment_methods","setItem","paymentInformation","billingFirstName","billingLastName","saveBillingAddress","savePaymentMethodAndPlaceOrder","country_id","region_code","purchaseOrderNumber","restOfBillingAddress","newAddress","country_code","find","available_regions","code","isCustomerSignedIn","guest_cart_id","same_as_shipping","shippingAddressId","trimAddressMagentoStyle","customer_address_id","getSetBillingAddressOnCart","paymentMethod","additional_data","purchase_order_number","getSetPaymentMethodOnCartMutation","payment_method","getPlaceOrderMutation","orderData","order_id","placeOrder","order","Object","defineProperty","_CheckoutContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { CART_TAB } from 'Component/NavigationTabs/NavigationTabs.config';\nimport CheckoutQuery from 'Query/Checkout.query';\nimport MyAccountQuery from 'Query/MyAccount.query';\nimport { toggleBreadcrumbs } from 'Store/Breadcrumbs/Breadcrumbs.action';\nimport { updateShippingPrice } from 'Store/Cart/Cart.action';\nimport { updateEmail, updateShippingFields } from 'Store/Checkout/Checkout.action';\nimport { updateMeta } from 'Store/Meta/Meta.action';\nimport { changeNavigationState } from 'Store/Navigation/Navigation.action';\nimport { BOTTOM_NAVIGATION_TYPE, TOP_NAVIGATION_TYPE } from 'Store/Navigation/Navigation.reducer';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { customerType } from 'Type/Account';\nimport { HistoryType } from 'Type/Common';\nimport { TotalsType } from 'Type/MiniCart';\nimport { isSignedIn } from 'Util/Auth';\nimport BrowserDatabase from 'Util/BrowserDatabase';\nimport { deleteGuestQuoteId, getGuestQuoteId } from 'Util/Cart';\nimport history from 'Util/History';\nimport {\n    debounce,\n    fetchMutation,\n    fetchQuery,\n    getErrorMessage\n} from 'Util/Request';\nimport { ONE_MONTH_IN_SECONDS } from 'Util/Request/QueryDispatcher';\nimport { appendWithStoreCode } from 'Util/Url';\n\nimport Checkout from './Checkout.component';\nimport {\n    BILLING_STEP, DETAILS_STEP, PAYMENT_TOTALS, SHIPPING_STEP, UPDATE_EMAIL_CHECK_FREQUENCY\n} from './Checkout.config';\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\nexport const MyAccountDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/MyAccount/MyAccount.dispatcher'\n);\nexport const CheckoutDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Checkout/Checkout.dispatcher'\n);\n\n/** @namespace Route/Checkout/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    totals: state.CartReducer.cartTotals,\n    customer: state.MyAccountReducer.customer,\n    guest_checkout: state.ConfigReducer.guest_checkout,\n    countries: state.ConfigReducer.countries,\n    isEmailAvailable: state.CheckoutReducer.isEmailAvailable,\n    isMobile: state.ConfigReducer.device.isMobile\n});\n\n/** @namespace Route/Checkout/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    updateMeta: (meta) => dispatch(updateMeta(meta)),\n    resetCart: () => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.updateInitialCartData(dispatch)\n    ),\n    resetGuestCart: () => CartDispatcher.then(\n        ({ default: dispatcher }) => {\n            dispatcher.resetGuestCart(dispatch);\n            dispatcher.createGuestEmptyCart(dispatch);\n        }\n    ),\n    toggleBreadcrumbs: (state) => dispatch(toggleBreadcrumbs(state)),\n    showErrorNotification: (message) => dispatch(showNotification('error', message)),\n    showInfoNotification: (message) => dispatch(showNotification('info', message)),\n    showSuccessNotification: (message) => dispatch(showNotification('success', message)),\n    setHeaderState: (stateName) => dispatch(changeNavigationState(TOP_NAVIGATION_TYPE, stateName)),\n    setNavigationState: (stateName) => dispatch(changeNavigationState(BOTTOM_NAVIGATION_TYPE, stateName)),\n    createAccount: (options) => MyAccountDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.createAccount(options, dispatch)\n    ),\n    updateShippingFields: (fields) => dispatch(updateShippingFields(fields)),\n    updateEmail: (email) => dispatch(updateEmail(email)),\n    checkEmailAvailability: (email) => CheckoutDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.handleData(dispatch, email)\n    ),\n    updateShippingPrice: (data) => dispatch(updateShippingPrice(data))\n});\n\n/** @namespace Route/Checkout/Container */\nexport class CheckoutContainer extends PureComponent {\n    static propTypes = {\n        showErrorNotification: PropTypes.func.isRequired,\n        showInfoNotification: PropTypes.func.isRequired,\n        showSuccessNotification: PropTypes.func.isRequired,\n        toggleBreadcrumbs: PropTypes.func.isRequired,\n        setNavigationState: PropTypes.func.isRequired,\n        createAccount: PropTypes.func.isRequired,\n        updateMeta: PropTypes.func.isRequired,\n        resetCart: PropTypes.func.isRequired,\n        resetGuestCart: PropTypes.func.isRequired,\n        guest_checkout: PropTypes.bool.isRequired,\n        totals: TotalsType.isRequired,\n        history: HistoryType.isRequired,\n        customer: customerType.isRequired,\n        countries: PropTypes.arrayOf(\n            PropTypes.shape({\n                label: PropTypes.string,\n                id: PropTypes.string,\n                available_regions: PropTypes.arrayOf(\n                    PropTypes.shape({\n                        code: PropTypes.string,\n                        name: PropTypes.string,\n                        id: PropTypes.number\n                    })\n                )\n            })\n        ).isRequired,\n        match: PropTypes.shape({\n            params: PropTypes.shape({\n                step: PropTypes.string\n            })\n        }).isRequired,\n        updateShippingFields: PropTypes.func.isRequired,\n        updateEmail: PropTypes.func.isRequired,\n        checkEmailAvailability: PropTypes.func.isRequired,\n        isEmailAvailable: PropTypes.bool.isRequired,\n        updateShippingPrice: PropTypes.func.isRequired\n    };\n\n    containerFunctions = {\n        setLoading: this.setLoading.bind(this),\n        setDetailsStep: this.setDetailsStep.bind(this),\n        savePaymentInformation: this.savePaymentInformation.bind(this),\n        saveAddressInformation: this.saveAddressInformation.bind(this),\n        onShippingEstimationFieldsChange: this.onShippingEstimationFieldsChange.bind(this),\n        onEmailChange: this.onEmailChange.bind(this),\n        onCreateUserChange: this.onCreateUserChange.bind(this),\n        onPasswordChange: this.onPasswordChange.bind(this),\n        onCouponCodeUpdate: this.onCouponCodeUpdate.bind(this),\n        goBack: this.goBack.bind(this)\n    };\n\n    checkEmailAvailability = debounce((email) => {\n        const { checkEmailAvailability } = this.props;\n        checkEmailAvailability(email);\n    }, UPDATE_EMAIL_CHECK_FREQUENCY);\n\n    __construct(props) {\n        super.__construct(props);\n\n        const {\n            toggleBreadcrumbs,\n            totals: {\n                is_virtual\n            }\n        } = props;\n\n        toggleBreadcrumbs(false);\n\n        this.state = {\n            isLoading: is_virtual,\n            isDeliveryOptionsLoading: false,\n            requestsSent: 0,\n            paymentMethods: [],\n            shippingMethods: [],\n            shippingAddress: {},\n            billingAddress: {},\n            selectedShippingMethod: '',\n            checkoutStep: is_virtual ? BILLING_STEP : SHIPPING_STEP,\n            orderID: '',\n            paymentTotals: BrowserDatabase.getItem(PAYMENT_TOTALS) || {},\n            email: '',\n            isGuestEmailSaved: false,\n            isCreateUser: false,\n            estimateAddress: {}\n        };\n\n        if (is_virtual) {\n            this._getPaymentMethods();\n        }\n    }\n\n    componentDidMount() {\n        const {\n            history,\n            showInfoNotification,\n            guest_checkout,\n            updateMeta,\n            totals: {\n                items = []\n            }\n        } = this.props;\n\n        if (!items.length) {\n            showInfoNotification(__('Please add at least one product to cart!'));\n            history.push(appendWithStoreCode('/cart'));\n        }\n\n        // if guest checkout is disabled and user is not logged in => throw him to homepage\n        if (!guest_checkout && !isSignedIn()) {\n            history.push(appendWithStoreCode('/'));\n        }\n\n        updateMeta({ title: __('Checkout') });\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        const { match: { params: { step: urlStep } }, isEmailAvailable, updateEmail } = this.props;\n        const { match: { params: { step: prevUrlStep } } } = prevProps;\n        const { email } = this.state;\n        const { email: prevEmail } = prevState;\n\n        // Handle going back from billing to shipping\n        if (/shipping/.test(urlStep) && /billing/.test(prevUrlStep)) {\n            BrowserDatabase.deleteItem(PAYMENT_TOTALS);\n\n            // eslint-disable-next-line react/no-did-update-set-state\n            this.setState({\n                checkoutStep: SHIPPING_STEP,\n                isGuestEmailSaved: false\n            });\n        }\n\n        if (email !== prevEmail) {\n            this.checkEmailAvailability(email);\n        }\n\n        if (!isEmailAvailable) {\n            updateEmail(email);\n        }\n\n        return null;\n    }\n\n    componentWillUnmount() {\n        const { toggleBreadcrumbs } = this.props;\n        toggleBreadcrumbs(true);\n    }\n\n    onEmailChange(email) {\n        this.setState({ email });\n    }\n\n    onCreateUserChange() {\n        const { isCreateUser } = this.state;\n        this.setState({ isCreateUser: !isCreateUser });\n    }\n\n    onPasswordChange(password) {\n        this.setState({ password });\n    }\n\n    onShippingEstimationFieldsChange(address) {\n        const { requestsSent } = this.state;\n        const guestQuoteId = getGuestQuoteId();\n\n        if (!guestQuoteId) {\n            return;\n        }\n\n        this.setState({\n            isDeliveryOptionsLoading: true,\n            requestsSent: requestsSent + 1,\n            estimateAddress: address\n        });\n\n        fetchMutation(CheckoutQuery.getEstimateShippingCosts(\n            address,\n            guestQuoteId\n        )).then(\n            /** @namespace Route/Checkout/Container/onShippingEstimationFieldsChangeFetchMutationThen */\n            ({ estimateShippingCosts: shippingMethods }) => {\n                const { requestsSent } = this.state;\n\n                this.setState({\n                    shippingMethods,\n                    isDeliveryOptionsLoading: requestsSent > 1,\n                    requestsSent: requestsSent - 1\n                });\n            },\n            this._handleError\n        );\n    }\n\n    onCouponCodeUpdate() {\n        const { estimateAddress, checkoutStep } = this.state;\n\n        // update delivery methods on coupon change\n        // in order ot fetch new available delivery methods\n        // if any could be applied by coupon\n        if (checkoutStep === SHIPPING_STEP) {\n            this.onShippingEstimationFieldsChange(estimateAddress);\n        }\n    }\n\n    goBack() {\n        const { checkoutStep } = this.state;\n\n        if (checkoutStep === BILLING_STEP) {\n            this.setState({\n                isLoading: false\n            });\n            BrowserDatabase.deleteItem(PAYMENT_TOTALS);\n        }\n\n        history.goBack();\n    }\n\n    setDetailsStep(orderID) {\n        const { resetCart, resetGuestCart, setNavigationState } = this.props;\n\n        deleteGuestQuoteId();\n        BrowserDatabase.deleteItem(PAYMENT_TOTALS);\n\n        if (isSignedIn()) {\n            resetCart();\n        } else {\n            resetGuestCart();\n        }\n\n        this.setState({\n            isLoading: false,\n            paymentTotals: {},\n            checkoutStep: DETAILS_STEP,\n            orderID\n        });\n\n        setNavigationState({\n            name: CART_TAB\n        });\n    }\n\n    setLoading(isLoading = true) {\n        this.setState({ isLoading });\n    }\n\n    setShippingAddress = async (isDefaultShipping = false) => {\n        const { shippingAddress } = this.state;\n        const { region, region_id, ...address } = shippingAddress;\n\n        const mutation = MyAccountQuery.getCreateAddressMutation({\n            ...address,\n            region: { region, region_id },\n            default_shipping: isDefaultShipping\n        });\n\n        const data = await fetchMutation(mutation);\n\n        if (data?.createCustomerAddress) {\n            this.setState({\n                shippingAddress: {\n                    ...shippingAddress,\n                    id: data.createCustomerAddress.id\n                }\n            });\n        }\n\n        return true;\n    };\n\n    containerProps = () => {\n        const { paymentTotals } = this.state;\n\n        return {\n            checkoutTotals: this._getCheckoutTotals(),\n            paymentTotals\n        };\n    };\n\n    _handleError = (error) => {\n        const { showErrorNotification } = this.props;\n\n        this.setState({\n            isDeliveryOptionsLoading: false,\n            isLoading: false\n        }, () => {\n            showErrorNotification(getErrorMessage(error));\n        });\n\n        return false;\n    };\n\n    _getPaymentMethods() {\n        fetchQuery(CheckoutQuery.getPaymentMethodsQuery(\n            getGuestQuoteId()\n        )).then(\n            /** @namespace Route/Checkout/Container/fetchQueryThen */\n            ({ getPaymentMethods: paymentMethods }) => {\n                this.setState({ isLoading: false, paymentMethods });\n            },\n            this._handleError\n        );\n    }\n\n    _getCheckoutTotals() {\n        const { totals: cartTotals } = this.props;\n        const { paymentTotals: { shipping_amount } } = this.state;\n\n        return shipping_amount\n            ? { ...cartTotals, shipping_amount }\n            : cartTotals;\n    }\n\n    saveGuestEmail() {\n        const { email } = this.state;\n        const { updateEmail } = this.props;\n        const guestCartId = getGuestQuoteId();\n\n        if (!guestCartId) {\n            return null;\n        }\n\n        const mutation = CheckoutQuery.getSaveGuestEmailMutation(email, guestCartId);\n\n        updateEmail(email);\n        return fetchMutation(mutation).then(\n            /** @namespace Route/Checkout/Container/saveGuestEmailFetchMutationThen */\n            ({ setGuestEmailOnCart: data }) => {\n                if (data) {\n                    this.setState({ isGuestEmailSaved: true });\n                }\n\n                return data;\n            },\n            this._handleError\n        );\n    }\n\n    async createUserOrSaveGuest() {\n        const {\n            createAccount,\n            totals: { is_virtual },\n            showSuccessNotification,\n            isEmailAvailable\n        } = this.props;\n\n        const {\n            email,\n            password,\n            isCreateUser,\n            shippingAddress: {\n                firstname,\n                lastname\n            }\n        } = this.state;\n\n        if (!isCreateUser || !isEmailAvailable) {\n            return this.saveGuestEmail();\n        }\n\n        const options = {\n            customer: {\n                email,\n                firstname,\n                lastname\n            },\n            password\n        };\n\n        const creation = await createAccount(options);\n\n        if (!creation) {\n            return creation;\n        }\n\n        showSuccessNotification(__('Your account has been created successfully!'));\n\n        if (!is_virtual) {\n            return this.setShippingAddress(true);\n        }\n\n        return true;\n    }\n\n    prepareAddressInformation(addressInformation) {\n        const {\n            shipping_address: {\n                id,\n                save_in_address_book,\n                ...shippingAddress\n            } = {},\n            billing_address: {\n                id: dropId,\n                save_in_address_book: dropSaveInAddressBook,\n                ...billingAddress\n            } = {},\n            ...data\n        } = addressInformation;\n\n        return {\n            ...data,\n            shipping_address: shippingAddress,\n            billing_address: billingAddress\n        };\n    }\n\n    async saveAddressInformation(addressInformation) {\n        const { updateShippingPrice } = this.props;\n        const { shipping_address, shipping_method_code } = addressInformation;\n\n        this.setState({\n            isLoading: true,\n            shippingAddress: shipping_address,\n            selectedShippingMethod: shipping_method_code\n        });\n\n        if (!isSignedIn()) {\n            if (!await this.createUserOrSaveGuest()) {\n                this.setState({ isLoading: false });\n                return;\n            }\n        }\n\n        fetchMutation(CheckoutQuery.getSaveAddressInformation(\n            this.prepareAddressInformation(addressInformation),\n            getGuestQuoteId()\n        )).then(\n            /** @namespace Route/Checkout/Container/saveAddressInformationFetchMutationThen */\n            ({ saveAddressInformation: data }) => {\n                const { payment_methods, totals } = data;\n\n                updateShippingPrice(totals);\n\n                BrowserDatabase.setItem(\n                    totals,\n                    PAYMENT_TOTALS,\n                    ONE_MONTH_IN_SECONDS\n                );\n\n                this.setState({\n                    isLoading: false,\n                    paymentMethods: payment_methods,\n                    checkoutStep: BILLING_STEP,\n                    paymentTotals: totals\n                });\n            },\n            this._handleError\n        );\n    }\n\n    async savePaymentInformation(paymentInformation) {\n        const { totals: { is_virtual } } = this.props;\n        const {\n            billing_address: {\n                firstname: billingFirstName,\n                lastname: billingLastName\n            },\n            billing_address: billingAddress\n        } = paymentInformation;\n\n        /**\n         * If cart contains only virtual products then set firstname & lastname\n         * from billing step into shippingAddress for user creating.\n         */\n        if (is_virtual) {\n            this.setState({\n                shippingAddress: {\n                    firstname: billingFirstName,\n                    lastname: billingLastName\n                }\n            });\n        }\n\n        this.setState({ isLoading: true, billingAddress });\n\n        if (!isSignedIn()) {\n            if (!await this.createUserOrSaveGuest()) {\n                this.setState({ isLoading: false });\n                return;\n            }\n        }\n\n        await this.saveBillingAddress(paymentInformation).then(\n            /** @namespace Route/Checkout/Container/saveBillingAddressThen */\n            () => this.savePaymentMethodAndPlaceOrder(paymentInformation),\n            this._handleError\n        );\n    }\n\n    trimAddressMagentoStyle(address) {\n        const { countries } = this.props;\n\n        const {\n            id, // drop this\n            country_id,\n            region_code, // drop this\n            purchaseOrderNumber, // drop this\n            region_id,\n            region,\n            ...restOfBillingAddress\n        } = address;\n\n        const newAddress = {\n            ...restOfBillingAddress,\n            country_code: country_id,\n            region,\n            region_id\n        };\n\n        /**\n         * If there is no region specified, but there is region ID\n         * get the region code by the country ID\n         */\n        if (region_id) {\n            // find a country by country ID\n            const { available_regions } = countries.find(\n                ({ id }) => id === country_id\n            ) || {};\n\n            if (!available_regions) {\n                return newAddress;\n            }\n\n            // find region by region ID\n            const { code } = available_regions.find(\n                ({ id }) => +id === +region_id\n            ) || {};\n\n            if (!code) {\n                return newAddress;\n            }\n\n            newAddress.region = code;\n        }\n\n        return newAddress;\n    }\n\n    async saveBillingAddress(paymentInformation) {\n        const isCustomerSignedIn = isSignedIn();\n        const guest_cart_id = !isCustomerSignedIn ? getGuestQuoteId() : '';\n\n        if (!isCustomerSignedIn && !getGuestQuoteId) {\n            return;\n        }\n\n        const { billing_address, same_as_shipping } = paymentInformation;\n        const {\n            shippingAddress: {\n                id: shippingAddressId = null\n            } = {}\n        } = this.state;\n        const billingAddress = {\n            address: this.trimAddressMagentoStyle(billing_address)\n        };\n\n        if (same_as_shipping && shippingAddressId) {\n            billingAddress.customer_address_id = shippingAddressId;\n        }\n\n        await fetchMutation(CheckoutQuery.getSetBillingAddressOnCart({\n            guest_cart_id,\n            same_as_shipping,\n            billing_address: billingAddress\n        }));\n    }\n\n    async savePaymentMethodAndPlaceOrder(paymentInformation) {\n        const { paymentMethod: { code, additional_data, purchase_order_number } } = paymentInformation;\n        const isCustomerSignedIn = isSignedIn();\n        const guest_cart_id = !isCustomerSignedIn ? getGuestQuoteId() : '';\n\n        if (!isCustomerSignedIn && !guest_cart_id) {\n            return;\n        }\n\n        try {\n            await fetchMutation(CheckoutQuery.getSetPaymentMethodOnCartMutation({\n                guest_cart_id,\n                payment_method: {\n                    code,\n                    [code]: additional_data,\n                    purchase_order_number\n                }\n            }));\n\n            const orderData = await fetchMutation(CheckoutQuery.getPlaceOrderMutation(guest_cart_id));\n            const { placeOrder: { order: { order_id } } } = orderData;\n\n            this.setDetailsStep(order_id);\n        } catch (e) {\n            this._handleError(e);\n        }\n    }\n\n    render() {\n        return (\n            <Checkout\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerFunctions }\n              { ...this.containerProps() }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CheckoutContainer);\n"]},"metadata":{},"sourceType":"module"}