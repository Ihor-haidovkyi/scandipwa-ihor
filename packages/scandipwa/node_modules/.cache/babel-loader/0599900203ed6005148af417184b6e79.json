{"ast":null,"code":"import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{makeCancelable}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Promise\";import{prepareQuery}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Query\";import{executeGet}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request\";import{hash}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request/Hash\";import{ONE_MONTH_IN_SECONDS}from\"./QueryDispatcher\";/** @namespace Util/Request/DataContainer */export var _DataContainer=/*#__PURE__*/function(_Extensible){_inherits(_DataContainer,_Extensible);var _super=_createSuper(_DataContainer);function _DataContainer(){var _this;_classCallCheck(this,_DataContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.dataModelName='DataContainer';return _this;}_createClass(_DataContainer,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.promise){this.promise.cancel();}}},{key:\"fetchData\",value:function fetchData(rawQueries){var onSucces=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};var onError=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){};var preparedQuery=prepareQuery(rawQueries);var query=preparedQuery.query,variables=preparedQuery.variables;var queryHash=hash(query+JSON.stringify(variables));if(!window.dataCache){window.dataCache={};}if(window.dataCache[queryHash]){onSucces(window.dataCache[queryHash]);return;}this.promise=makeCancelable(executeGet(preparedQuery,this.dataModelName,ONE_MONTH_IN_SECONDS));this.promise.promise.then(/** @namespace Util/Request/DataContainer/fetchData/thisPromisePromiseThen */middleware(function(response){window.dataCache[queryHash]=response;onSucces(response);},\"Util/Request/DataContainer/fetchData/thisPromisePromiseThen\"),/** @namespace Util/Request/DataContainer/fetchData/thisPromisePromiseCatch */middleware(function(err){return onError(err);},\"Util/Request/DataContainer/fetchData/thisPromisePromiseCatch\"));}}]);return _DataContainer;}(Extensible(PureComponent));Object.defineProperty(_DataContainer,'name',{value:'DataContainer'});export var DataContainer=middleware(_DataContainer,\"Util/Request/DataContainer\");export default DataContainer;","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/util/Request/DataContainer.js"],"names":["PureComponent","makeCancelable","prepareQuery","executeGet","hash","ONE_MONTH_IN_SECONDS","DataContainer","dataModelName","promise","cancel","rawQueries","onSucces","onError","preparedQuery","query","variables","queryHash","JSON","stringify","window","dataCache","then","response","err","Object","defineProperty","_DataContainer","value"],"mappings":"ojBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAEA,OAASA,aAAT,KAA8B,OAA9B,CAEA,OAASC,cAAT,sEACA,OAASC,YAAT,oEACA,OAASC,UAAT,sEACA,OAASC,IAAT,2EAEA,OAASC,oBAAT,yBAEA,4CACA,UAAaC,CAAAA,cAAb,6VACIC,aADJ,CACoB,eADpB,8EAGI,+BAAuB,CACnB,GAAI,KAAKC,OAAT,CAAkB,CACd,KAAKA,OAAL,CAAaC,MAAb,GACH,CACJ,CAPL,yBASI,mBAAUC,UAAV,CAA+D,IAAzCC,CAAAA,QAAyC,2DAA9B,UAAM,CAAE,CAAsB,IAApBC,CAAAA,OAAoB,2DAAV,UAAM,CAAE,CAAE,CAC3D,GAAMC,CAAAA,aAAa,CAAGX,YAAY,CAACQ,UAAD,CAAlC,CAD2D,GAEnDI,CAAAA,KAFmD,CAE9BD,aAF8B,CAEnDC,KAFmD,CAE5CC,SAF4C,CAE9BF,aAF8B,CAE5CE,SAF4C,CAG3D,GAAMC,CAAAA,SAAS,CAAGZ,IAAI,CAACU,KAAK,CAAGG,IAAI,CAACC,SAAL,CAAeH,SAAf,CAAT,CAAtB,CAEA,GAAI,CAACI,MAAM,CAACC,SAAZ,CAAuB,CACnBD,MAAM,CAACC,SAAP,CAAmB,EAAnB,CACH,CAED,GAAID,MAAM,CAACC,SAAP,CAAiBJ,SAAjB,CAAJ,CAAiC,CAC7BL,QAAQ,CAACQ,MAAM,CAACC,SAAP,CAAiBJ,SAAjB,CAAD,CAAR,CACA,OACH,CAED,KAAKR,OAAL,CAAeP,cAAc,CACzBE,UAAU,CAACU,aAAD,CAAgB,KAAKN,aAArB,CAAoCF,oBAApC,CADe,CAA7B,CAIA,KAAKG,OAAL,CAAaA,OAAb,CAAqBa,IAArB,CACI,6EADJ,WAEI,SAACC,QAAD,CAAc,CACVH,MAAM,CAACC,SAAP,CAAiBJ,SAAjB,EAA8BM,QAA9B,CACAX,QAAQ,CAACW,QAAD,CAAR,CACH,CALL,gEAMI,8EANJ,WAOI,SAACC,GAAD,QAASX,CAAAA,OAAO,CAACW,GAAD,CAAhB,EAPJ,kEASH,CApCL,uDArBAC,MAAM,CAACC,cAAP,CAAsBC,cAAtB,CAAsC,MAAtC,CAA8C,CAAEC,KAAK,CAAE,eAAT,CAA9C,E,iFA4DA,cAAerB,CAAAA,aAAf","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport { PureComponent } from 'react';\n\nimport { makeCancelable } from 'Util/Promise';\nimport { prepareQuery } from 'Util/Query';\nimport { executeGet } from 'Util/Request';\nimport { hash } from 'Util/Request/Hash';\n\nimport { ONE_MONTH_IN_SECONDS } from './QueryDispatcher';\n\n/** @namespace Util/Request/DataContainer */\nexport class DataContainer extends PureComponent {\n    dataModelName = 'DataContainer';\n\n    componentWillUnmount() {\n        if (this.promise) {\n            this.promise.cancel();\n        }\n    }\n\n    fetchData(rawQueries, onSucces = () => {}, onError = () => {}) {\n        const preparedQuery = prepareQuery(rawQueries);\n        const { query, variables } = preparedQuery;\n        const queryHash = hash(query + JSON.stringify(variables));\n\n        if (!window.dataCache) {\n            window.dataCache = {};\n        }\n\n        if (window.dataCache[queryHash]) {\n            onSucces(window.dataCache[queryHash]);\n            return;\n        }\n\n        this.promise = makeCancelable(\n            executeGet(preparedQuery, this.dataModelName, ONE_MONTH_IN_SECONDS)\n        );\n\n        this.promise.promise.then(\n            /** @namespace Util/Request/DataContainer/fetchData/thisPromisePromiseThen */\n            (response) => {\n                window.dataCache[queryHash] = response;\n                onSucces(response);\n            },\n            /** @namespace Util/Request/DataContainer/fetchData/thisPromisePromiseCatch */\n            (err) => onError(err)\n        );\n    }\n}\n\nexport default DataContainer;\n"]},"metadata":{},"sourceType":"module"}