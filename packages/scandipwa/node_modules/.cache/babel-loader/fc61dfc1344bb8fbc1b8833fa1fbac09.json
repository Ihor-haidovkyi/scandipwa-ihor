{"ast":null,"code":"import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{KLARNA,PURCHASE_ORDER}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/CheckoutPayments/CheckoutPayments.config\";import{TERMS_AND_CONDITIONS_POPUP_ID}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/CheckoutTermsAndConditionsPopup/CheckoutTermsAndConditionsPopup.config\";import{STORE_IN_PICK_UP_METHOD_CODE}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/StoreInPickUp/StoreInPickUp.config\";import{showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import{showPopup as _showPopup}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Popup/Popup.action\";import{addressType,customerType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Account\";import{paymentMethodsType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Checkout\";import{TotalsType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/MiniCart\";import{getFormFields,trimAddressFields,trimCustomerAddress}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Address\";import{getCartTotalSubPrice}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Cart\";import CheckoutBilling from\"./CheckoutBilling.component\";/** @namespace Component/CheckoutBilling/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{customer:state.MyAccountReducer.customer,totals:state.CartReducer.cartTotals,termsAreEnabled:state.ConfigReducer.terms_are_enabled,termsAndConditions:state.ConfigReducer.checkoutAgreements,addressLinesQty:state.ConfigReducer.address_lines_quantity,cartTotalSubPrice:getCartTotalSubPrice(state)};},\"Component/CheckoutBilling/Container/mapStateToProps\");/** @namespace Component/CheckoutBilling/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{showErrorNotification:function showErrorNotification(message){return dispatch(showNotification('error',message));},showPopup:function showPopup(payload){return dispatch(_showPopup(TERMS_AND_CONDITIONS_POPUP_ID,payload));}};},\"Component/CheckoutBilling/Container/mapDispatchToProps\");/** @namespace Component/CheckoutBilling/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _CheckoutBillingContainer=/*#__PURE__*/function(_Extensible){_inherits(_CheckoutBillingContainer,_Extensible);var _super=_createSuper(_CheckoutBillingContainer);function _CheckoutBillingContainer(){var _this;_classCallCheck(this,_CheckoutBillingContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={onBillingSuccess:_this.onBillingSuccess.bind(_assertThisInitialized(_this)),onBillingError:_this.onBillingError.bind(_assertThisInitialized(_this)),onAddressSelect:_this.onAddressSelect.bind(_assertThisInitialized(_this)),onSameAsShippingChange:_this.onSameAsShippingChange.bind(_assertThisInitialized(_this)),onPaymentMethodSelect:_this.onPaymentMethodSelect.bind(_assertThisInitialized(_this)),showPopup:_this.showPopup.bind(_assertThisInitialized(_this))};return _this;}_createClass(_CheckoutBillingContainer,[{key:\"__construct\",value:function __construct(props){_get(_getPrototypeOf(_CheckoutBillingContainer.prototype),\"__construct\",this).call(this,props);var paymentMethods=props.paymentMethods,customer=props.customer;var _paymentMethods=_slicedToArray(paymentMethods,1),method=_paymentMethods[0];var _ref=method||{},paymentMethod=_ref.code;this.state={isSameAsShipping:this.isSameShippingAddress(customer),selectedCustomerAddressId:0,prevPaymentMethods:paymentMethods,paymentMethod:paymentMethod};}},{key:\"isSameShippingAddress\",value:function isSameShippingAddress(_ref2){var default_billing=_ref2.default_billing,default_shipping=_ref2.default_shipping;var _this$props=this.props,is_virtual=_this$props.totals.is_virtual,selectedShippingMethod=_this$props.selectedShippingMethod;if(is_virtual){return false;}return default_billing===default_shipping&&selectedShippingMethod!==STORE_IN_PICK_UP_METHOD_CODE;}},{key:\"onAddressSelect\",value:function onAddressSelect(id){this.setState({selectedCustomerAddressId:id});}},{key:\"onSameAsShippingChange\",value:function onSameAsShippingChange(){this.setState(function(_ref3){var isSameAsShipping=_ref3.isSameAsShipping;return{isSameAsShipping:!isSameAsShipping};});}},{key:\"onPaymentMethodSelect\",value:function onPaymentMethodSelect(code){this.setState({paymentMethod:code});}},{key:\"onBillingSuccess\",value:function onBillingSuccess(fields,asyncData){var savePaymentInformation=this.props.savePaymentInformation;var isSameAsShipping=this.state.isSameAsShipping;var address=this._getAddress(fields);var paymentMethod=this._getPaymentData(fields,asyncData);savePaymentInformation({billing_address:address,paymentMethod:paymentMethod,same_as_shipping:isSameAsShipping});}},{key:\"onBillingError\",value:function onBillingError(fields,invalidFields,error){var showErrorNotification=this.props.showErrorNotification;if(error){var _error$message=error.message,message=_error$message===void 0?__('Something went wrong!'):_error$message;showErrorNotification(message);}}},{key:\"showPopup\",value:function showPopup(){var _this$props2=this.props,showPopup=_this$props2.showPopup,termsAndConditions=_this$props2.termsAndConditions;var _ref4=termsAndConditions[0]||{},_ref4$name=_ref4.name,title=_ref4$name===void 0?__('Terms and Conditions'):_ref4$name,_ref4$content=_ref4.content,text=_ref4$content===void 0?__('There are no Terms and Conditions configured.'):_ref4$content;return showPopup({title:title,text:text});}},{key:\"_getPaymentData\",value:function _getPaymentData(fields,asyncData){var code=this.state.paymentMethod;switch(code){case KLARNA:var _asyncData=_slicedToArray(asyncData,1),authorization_token=_asyncData[0].authorization_token;return{code:code,additional_data:{authorization_token:authorization_token}};case PURCHASE_ORDER:var purchaseOrderNumber=fields.purchaseOrderNumber;return{code:code,purchase_order_number:purchaseOrderNumber};default:return{code:code};}}},{key:\"_getAddress\",value:function _getAddress(fields){var _this$props3=this.props,addressLinesQty=_this$props3.addressLinesQty,shippingAddress=_this$props3.shippingAddress;var _this$state=this.state,isSameAsShipping=_this$state.isSameAsShipping,selectedCustomerAddressId=_this$state.selectedCustomerAddressId;var formFields=getFormFields(fields,addressLinesQty);if(isSameAsShipping){return shippingAddress;}if(!selectedCustomerAddressId){return trimAddressFields(formFields);}var addresses=this.props.customer.addresses;var address=addresses.find(function(_ref5){var id=_ref5.id;return id===selectedCustomerAddressId;});return _objectSpread(_objectSpread({},trimCustomerAddress(address)),{},{save_in_address_book:false});}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,CheckoutBilling,Object.assign({},this.props,this.state,this.containerFunctions));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){var paymentMethod=state.paymentMethod,prevPaymentMethods=state.prevPaymentMethods;var paymentMethods=props.paymentMethods;if(!prevPaymentMethods.length&&!paymentMethod){var _paymentMethods2=_slicedToArray(paymentMethods,1),method=_paymentMethods2[0];var _ref6=method||{},_paymentMethod=_ref6.code;return{prevPaymentMethods:paymentMethods,paymentMethod:_paymentMethod};}return null;}}]);return _CheckoutBillingContainer;}(Extensible(PureComponent));Object.defineProperty(_CheckoutBillingContainer,'name',{value:'CheckoutBillingContainer'});export var CheckoutBillingContainer=middleware(_CheckoutBillingContainer,\"Component/CheckoutBilling/Container\");export default connect(mapStateToProps,mapDispatchToProps)(CheckoutBillingContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/CheckoutBilling/CheckoutBilling.container.js"],"names":["PureComponent","connect","KLARNA","PURCHASE_ORDER","TERMS_AND_CONDITIONS_POPUP_ID","STORE_IN_PICK_UP_METHOD_CODE","showNotification","showPopup","addressType","customerType","paymentMethodsType","TotalsType","getFormFields","trimAddressFields","trimCustomerAddress","getCartTotalSubPrice","CheckoutBilling","mapStateToProps","state","customer","MyAccountReducer","totals","CartReducer","cartTotals","termsAreEnabled","ConfigReducer","terms_are_enabled","termsAndConditions","checkoutAgreements","addressLinesQty","address_lines_quantity","cartTotalSubPrice","mapDispatchToProps","dispatch","showErrorNotification","message","payload","CheckoutBillingContainer","containerFunctions","onBillingSuccess","bind","onBillingError","onAddressSelect","onSameAsShippingChange","onPaymentMethodSelect","props","paymentMethods","method","paymentMethod","code","isSameAsShipping","isSameShippingAddress","selectedCustomerAddressId","prevPaymentMethods","default_billing","default_shipping","is_virtual","selectedShippingMethod","id","setState","fields","asyncData","savePaymentInformation","address","_getAddress","_getPaymentData","billing_address","same_as_shipping","invalidFields","error","__","name","title","content","text","authorization_token","additional_data","purchaseOrderNumber","purchase_order_number","shippingAddress","formFields","addresses","find","save_in_address_book","length","Object","defineProperty","_CheckoutBillingContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { KLARNA, PURCHASE_ORDER } from 'Component/CheckoutPayments/CheckoutPayments.config';\nimport {\n    TERMS_AND_CONDITIONS_POPUP_ID\n} from 'Component/CheckoutTermsAndConditionsPopup/CheckoutTermsAndConditionsPopup.config';\nimport { STORE_IN_PICK_UP_METHOD_CODE } from 'Component/StoreInPickUp/StoreInPickUp.config';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { showPopup } from 'Store/Popup/Popup.action';\nimport { addressType, customerType } from 'Type/Account';\nimport { paymentMethodsType } from 'Type/Checkout';\nimport { TotalsType } from 'Type/MiniCart';\nimport { getFormFields, trimAddressFields, trimCustomerAddress } from 'Util/Address';\nimport { getCartTotalSubPrice } from 'Util/Cart';\n\nimport CheckoutBilling from './CheckoutBilling.component';\n\n/** @namespace Component/CheckoutBilling/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    customer: state.MyAccountReducer.customer,\n    totals: state.CartReducer.cartTotals,\n    termsAreEnabled: state.ConfigReducer.terms_are_enabled,\n    termsAndConditions: state.ConfigReducer.checkoutAgreements,\n    addressLinesQty: state.ConfigReducer.address_lines_quantity,\n    cartTotalSubPrice: getCartTotalSubPrice(state)\n});\n\n/** @namespace Component/CheckoutBilling/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    showErrorNotification: (message) => dispatch(showNotification('error', message)),\n    showPopup: (payload) => dispatch(showPopup(TERMS_AND_CONDITIONS_POPUP_ID, payload))\n});\n\n/** @namespace Component/CheckoutBilling/Container */\nexport class CheckoutBillingContainer extends PureComponent {\n    static propTypes = {\n        showErrorNotification: PropTypes.func.isRequired,\n        paymentMethods: paymentMethodsType.isRequired,\n        savePaymentInformation: PropTypes.func.isRequired,\n        showPopup: PropTypes.func.isRequired,\n        shippingAddress: addressType.isRequired,\n        customer: customerType.isRequired,\n        totals: TotalsType.isRequired,\n        addressLinesQty: PropTypes.number.isRequired,\n        termsAndConditions: PropTypes.arrayOf(PropTypes.shape({\n            checkbox_text: PropTypes.string,\n            content: PropTypes.string,\n            name: PropTypes.string\n        })).isRequired,\n        selectedShippingMethod: PropTypes.string.isRequired\n    };\n\n    static getDerivedStateFromProps(props, state) {\n        const { paymentMethod, prevPaymentMethods } = state;\n        const { paymentMethods } = props;\n\n        if (!prevPaymentMethods.length && !paymentMethod) {\n            const [method] = paymentMethods;\n            const { code: paymentMethod } = method || {};\n\n            return {\n                prevPaymentMethods: paymentMethods,\n                paymentMethod\n            };\n        }\n\n        return null;\n    }\n\n    containerFunctions = {\n        onBillingSuccess: this.onBillingSuccess.bind(this),\n        onBillingError: this.onBillingError.bind(this),\n        onAddressSelect: this.onAddressSelect.bind(this),\n        onSameAsShippingChange: this.onSameAsShippingChange.bind(this),\n        onPaymentMethodSelect: this.onPaymentMethodSelect.bind(this),\n        showPopup: this.showPopup.bind(this)\n    };\n\n    __construct(props) {\n        super.__construct(props);\n\n        const { paymentMethods, customer } = props;\n        const [method] = paymentMethods;\n        const { code: paymentMethod } = method || {};\n\n        this.state = {\n            isSameAsShipping: this.isSameShippingAddress(customer),\n            selectedCustomerAddressId: 0,\n            prevPaymentMethods: paymentMethods,\n            paymentMethod\n        };\n    }\n\n    isSameShippingAddress({ default_billing, default_shipping }) {\n        const { totals: { is_virtual }, selectedShippingMethod } = this.props;\n\n        if (is_virtual) {\n            return false;\n        }\n\n        return default_billing === default_shipping && selectedShippingMethod !== STORE_IN_PICK_UP_METHOD_CODE;\n    }\n\n    onAddressSelect(id) {\n        this.setState({ selectedCustomerAddressId: id });\n    }\n\n    onSameAsShippingChange() {\n        this.setState(({ isSameAsShipping }) => ({ isSameAsShipping: !isSameAsShipping }));\n    }\n\n    onPaymentMethodSelect(code) {\n        this.setState({ paymentMethod: code });\n    }\n\n    onBillingSuccess(fields, asyncData) {\n        const { savePaymentInformation } = this.props;\n        const { isSameAsShipping } = this.state;\n\n        const address = this._getAddress(fields);\n        const paymentMethod = this._getPaymentData(fields, asyncData);\n\n        savePaymentInformation({\n            billing_address: address,\n            paymentMethod,\n            same_as_shipping: isSameAsShipping\n        });\n    }\n\n    onBillingError(fields, invalidFields, error) {\n        const { showErrorNotification } = this.props;\n\n        if (error) {\n            const { message = __('Something went wrong!') } = error;\n            showErrorNotification(message);\n        }\n    }\n\n    showPopup() {\n        const { showPopup, termsAndConditions } = this.props;\n        const {\n            name: title = __('Terms and Conditions'),\n            content: text = __('There are no Terms and Conditions configured.')\n        } = termsAndConditions[0] || {};\n\n        return showPopup({\n            title, text\n        });\n    }\n\n    _getPaymentData(fields, asyncData) {\n        const { paymentMethod: code } = this.state;\n\n        switch (code) {\n        case KLARNA:\n            const [{ authorization_token }] = asyncData;\n\n            return {\n                code,\n                additional_data: {\n                    authorization_token\n                }\n            };\n\n        case PURCHASE_ORDER:\n            const { purchaseOrderNumber } = fields;\n\n            return {\n                code,\n                purchase_order_number: purchaseOrderNumber\n            };\n\n        default:\n            return { code };\n        }\n    }\n\n    _getAddress(fields) {\n        const { addressLinesQty, shippingAddress } = this.props;\n\n        const {\n            isSameAsShipping,\n            selectedCustomerAddressId\n        } = this.state;\n\n        const formFields = getFormFields(fields, addressLinesQty);\n\n        if (isSameAsShipping) {\n            return shippingAddress;\n        }\n\n        if (!selectedCustomerAddressId) {\n            return trimAddressFields(formFields);\n        }\n\n        const { customer: { addresses } } = this.props;\n        const address = addresses.find(({ id }) => id === selectedCustomerAddressId);\n\n        return {\n            ...trimCustomerAddress(address),\n            save_in_address_book: false\n        };\n    }\n\n    render() {\n        return (\n            <CheckoutBilling\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerFunctions }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CheckoutBillingContainer);\n"]},"metadata":{},"sourceType":"module"}