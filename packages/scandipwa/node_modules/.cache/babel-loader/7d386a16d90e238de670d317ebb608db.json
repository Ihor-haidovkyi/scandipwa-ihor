{"ast":null,"code":"/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{updateCustomerSignInStatus}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/MyAccount/MyAccount.action\";import BrowserDatabase from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/BrowserDatabase\";import{deleteGuestQuoteId}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Cart\";import getStore from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Store\";export var AUTH_TOKEN='auth_token';export var ONE_HOUR=3600;/** @namespace Util/Auth/setAuthorizationToken */export var setAuthorizationToken=middleware(function(token){var state=getStore().getState();var _state$ConfigReducer$=state.ConfigReducer.cookie_lifetime,cookie_lifetime=_state$ConfigReducer$===void 0?ONE_HOUR:_state$ConfigReducer$;BrowserDatabase.setItem(token,AUTH_TOKEN,cookie_lifetime);},\"Util/Auth/setAuthorizationToken\");/** @namespace Util/Auth/deleteAuthorizationToken */export var deleteAuthorizationToken=middleware(function(){return BrowserDatabase.deleteItem(AUTH_TOKEN);},\"Util/Auth/deleteAuthorizationToken\");/** @namespace Util/Auth/getAuthorizationToken */export var getAuthorizationToken=middleware(function(){return BrowserDatabase.getItem(AUTH_TOKEN);},\"Util/Auth/getAuthorizationToken\");/** @namespace Util/Auth/refreshAuthorizationToken */export var refreshAuthorizationToken=middleware(function(){return setAuthorizationToken(getAuthorizationToken());},\"Util/Auth/refreshAuthorizationToken\");/** @namespace Util/Auth/isInitiallySignedIn */export var isInitiallySignedIn=middleware(function(){return!!getAuthorizationToken();},\"Util/Auth/isInitiallySignedIn\");/** @namespace Util/Auth/isSignedIn */export var isSignedIn=middleware(function(){var _isSignedIn=!!getAuthorizationToken();var store=getStore();var _store$getState=store.getState(),_store$getState$MyAcc=_store$getState.MyAccountReducer;_store$getState$MyAcc=_store$getState$MyAcc===void 0?{}:_store$getState$MyAcc;var isCustomerSignedIn=_store$getState$MyAcc.isSignedIn;var dispatch=store.dispatch;if(!_isSignedIn&&isCustomerSignedIn){// since logout is async and slow, remove cart id\n// and set customer sign in status here on auth token expiration\ndeleteGuestQuoteId();dispatch(updateCustomerSignInStatus(false));var MyAccountDispatcher=import(\"../../store/MyAccount/MyAccount.dispatcher\");MyAccountDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.logout(true,dispatch);});}else if(_isSignedIn&&isCustomerSignedIn){refreshAuthorizationToken();}return _isSignedIn;},\"Util/Auth/isSignedIn\");","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth/Token.js"],"names":["updateCustomerSignInStatus","BrowserDatabase","deleteGuestQuoteId","getStore","AUTH_TOKEN","ONE_HOUR","setAuthorizationToken","token","state","getState","ConfigReducer","cookie_lifetime","setItem","deleteAuthorizationToken","deleteItem","getAuthorizationToken","getItem","refreshAuthorizationToken","isInitiallySignedIn","isSignedIn","_isSignedIn","store","MyAccountReducer","isCustomerSignedIn","dispatch","MyAccountDispatcher","then","dispatcher","default","logout"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAEA,OAASA,0BAAT,0FACA,MAAOC,CAAAA,eAAP,8EACA,OAASC,kBAAT,mEACA,MAAOC,CAAAA,QAAP,oEAEA,MAAO,IAAMC,CAAAA,UAAU,CAAG,YAAnB,CAEP,MAAO,IAAMC,CAAAA,QAAQ,CAAG,IAAjB,CAEP,iDACA,MAAO,IAAMC,CAAAA,qBAAqB,YAAG,SAACC,KAAD,CAAW,CAC5C,GAAMC,CAAAA,KAAK,CAAGL,QAAQ,GAAGM,QAAX,EAAd,CAD4C,0BAIxCD,KAAK,CAACE,aAJkC,CAGxCC,eAHwC,CAGxCA,eAHwC,gCAGtBN,QAHsB,uBAM5CJ,eAAe,CAACW,OAAhB,CAAwBL,KAAxB,CAA+BH,UAA/B,CAA2CO,eAA3C,EACH,CAPiC,mCAA3B,CASP,oDACA,MAAO,IAAME,CAAAA,wBAAwB,YAAG,iBAAMZ,CAAAA,eAAe,CAACa,UAAhB,CAA2BV,UAA3B,CAAN,EAAH,sCAA9B,CAEP,iDACA,MAAO,IAAMW,CAAAA,qBAAqB,YAAG,iBAAMd,CAAAA,eAAe,CAACe,OAAhB,CAAwBZ,UAAxB,CAAN,EAAH,mCAA3B,CAEP,qDACA,MAAO,IAAMa,CAAAA,yBAAyB,YAAG,iBAAMX,CAAAA,qBAAqB,CAACS,qBAAqB,EAAtB,CAA3B,EAAH,uCAA/B,CAEP,+CACA,MAAO,IAAMG,CAAAA,mBAAmB,YAAG,iBAAM,CAAC,CAACH,qBAAqB,EAA7B,EAAH,iCAAzB,CAEP,sCACA,MAAO,IAAMI,CAAAA,UAAU,YAAG,UAAM,CAC5B,GAAMC,CAAAA,WAAW,CAAG,CAAC,CAACL,qBAAqB,EAA3C,CACA,GAAMM,CAAAA,KAAK,CAAGlB,QAAQ,EAAtB,CAF4B,oBAOxBkB,KAAK,CAACZ,QAAN,EAPwB,uCAIxBa,gBAJwB,sDAMpB,EANoB,0BAKRC,CAAAA,kBALQ,uBAKpBJ,UALoB,IAQpBK,CAAAA,QARoB,CAQPH,KARO,CAQpBG,QARoB,CAU5B,GAAI,CAACJ,WAAD,EAAgBG,kBAApB,CAAwC,CACpC;AACA;AACArB,kBAAkB,GAClBsB,QAAQ,CAACxB,0BAA0B,CAAC,KAAD,CAA3B,CAAR,CAEA,GAAMyB,CAAAA,mBAAmB,CAAG,oDAA5B,CACAA,mBAAmB,CAACC,IAApB,CACI,kBAAYC,CAAAA,UAAZ,MAAGC,OAAH,OAA6BD,CAAAA,UAAU,CAACE,MAAX,CAAkB,IAAlB,CAAwBL,QAAxB,CAA7B,EADJ,EAGH,CAVD,IAUO,IAAIJ,WAAW,EAAIG,kBAAnB,CAAuC,CAC1CN,yBAAyB,GAC5B,CAED,MAAOG,CAAAA,WAAP,CACH,CAzBsB,wBAAhB","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport { updateCustomerSignInStatus } from 'Store/MyAccount/MyAccount.action';\nimport BrowserDatabase from 'Util/BrowserDatabase';\nimport { deleteGuestQuoteId } from 'Util/Cart';\nimport getStore from 'Util/Store';\n\nexport const AUTH_TOKEN = 'auth_token';\n\nexport const ONE_HOUR = 3600;\n\n/** @namespace Util/Auth/setAuthorizationToken */\nexport const setAuthorizationToken = (token) => {\n    const state = getStore().getState();\n    const {\n        cookie_lifetime = ONE_HOUR\n    } = state.ConfigReducer;\n\n    BrowserDatabase.setItem(token, AUTH_TOKEN, cookie_lifetime);\n};\n\n/** @namespace Util/Auth/deleteAuthorizationToken */\nexport const deleteAuthorizationToken = () => BrowserDatabase.deleteItem(AUTH_TOKEN);\n\n/** @namespace Util/Auth/getAuthorizationToken */\nexport const getAuthorizationToken = () => BrowserDatabase.getItem(AUTH_TOKEN);\n\n/** @namespace Util/Auth/refreshAuthorizationToken */\nexport const refreshAuthorizationToken = () => setAuthorizationToken(getAuthorizationToken());\n\n/** @namespace Util/Auth/isInitiallySignedIn */\nexport const isInitiallySignedIn = () => !!getAuthorizationToken();\n\n/** @namespace Util/Auth/isSignedIn */\nexport const isSignedIn = () => {\n    const _isSignedIn = !!getAuthorizationToken();\n    const store = getStore();\n    const {\n        MyAccountReducer: {\n            isSignedIn: isCustomerSignedIn\n        } = {}\n    } = store.getState();\n    const { dispatch } = store;\n\n    if (!_isSignedIn && isCustomerSignedIn) {\n        // since logout is async and slow, remove cart id\n        // and set customer sign in status here on auth token expiration\n        deleteGuestQuoteId();\n        dispatch(updateCustomerSignInStatus(false));\n\n        const MyAccountDispatcher = import('../../store/MyAccount/MyAccount.dispatcher');\n        MyAccountDispatcher.then(\n            ({ default: dispatcher }) => dispatcher.logout(true, dispatch)\n        );\n    } else if (_isSignedIn && isCustomerSignedIn) {\n        refreshAuthorizationToken();\n    }\n\n    return _isSignedIn;\n};\n"]},"metadata":{},"sourceType":"module"}