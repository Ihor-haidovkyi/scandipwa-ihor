{"ast":null,"code":"import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import ProductListQuery from\"/home/marketihor/scandipwa/packages/scandipwa/src/query/ProductList.query\";import{showNotification as _showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import{getIndexedProducts}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";import{prepareQuery}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Query\";import{executeGet}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request\";import NewProducts from\"./NewProducts.component\";/** @namespace Component/NewProducts/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{timezone:state.ConfigReducer.timezone};},\"Component/NewProducts/Container/mapStateToProps\");/** @namespace Component/NewProducts/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{showNotification:function showNotification(type,title,error){return dispatch(_showNotification(type,title,error));}};},\"Component/NewProducts/Container/mapDispatchToProps\");/** @namespace Component/NewProducts/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _NewProductsContainer=/*#__PURE__*/function(_Extensible){_inherits(_NewProductsContainer,_Extensible);var _super=_createSuper(_NewProductsContainer);function _NewProductsContainer(){var _this;_classCallCheck(this,_NewProductsContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={products:undefined,siblingsHaveBrands:false,siblingsHavePriceBadge:false,siblingsHaveTierPrice:false,siblingsHaveConfigurableOptions:false};return _this;}_createClass(_NewProductsContainer,[{key:\"componentDidMount\",value:function componentDidMount(){this.requestProducts();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var _this$props=this.props,category=_this$props.category,productsCount=_this$props.productsCount,cacheLifetime=_this$props.cacheLifetime,timezone=_this$props.timezone;var pCategory=prevProps.category,pProductsCount=prevProps.productsCount,pCacheLifetime=prevProps.cacheLifetime,pTimezone=prevProps.timezone;if(category!==pCategory||timezone!==pTimezone||productsCount!==pProductsCount||cacheLifetime!==pCacheLifetime){this.requestProducts();}}},{key:\"containerProps\",value:function containerProps(){var _this2=this;var _this$state=this.state,siblingsHaveBrands=_this$state.siblingsHaveBrands,siblingsHavePriceBadge=_this$state.siblingsHavePriceBadge,siblingsHaveTierPrice=_this$state.siblingsHaveTierPrice,siblingsHaveConfigurableOptions=_this$state.siblingsHaveConfigurableOptions;return{productCardFunctions:{setSiblingsHaveBrands:function setSiblingsHaveBrands(){return _this2.setState({siblingsHaveBrands:true});},setSiblingsHavePriceBadge:function setSiblingsHavePriceBadge(){return _this2.setState({siblingsHavePriceBadge:true});},setSiblingsHaveTierPrice:function setSiblingsHaveTierPrice(){return _this2.setState({siblingsHaveTierPrice:true});},setSiblingsHaveConfigurableOptions:function setSiblingsHaveConfigurableOptions(){return _this2.setState({siblingsHaveConfigurableOptions:true});}},productCardProps:{siblingsHaveBrands:siblingsHaveBrands,siblingsHavePriceBadge:siblingsHavePriceBadge,siblingsHaveTierPrice:siblingsHaveTierPrice,siblingsHaveConfigurableOptions:siblingsHaveConfigurableOptions}};}/**\n     * Calculates date for request in server locale and with ttl error\n     *\n     * @returns {Date}\n     * @memberof NewProducts\n     */},{key:\"getRequestDate\",value:function getRequestDate(){var _this$props2=this.props,cacheLifetime=_this$props2.cacheLifetime,timeZone=_this$props2.timezone;var milliInSeccond=1000;var now=new Date();var serverNow=new Date(now.toLocaleString('en',{timeZone:timeZone}));var serverNowTime=serverNow.getTime();var ttl=cacheLifetime*milliInSeccond;var requestTime=serverNowTime-serverNowTime%ttl;var requestDate=new Date(requestTime);var timeOffset=10;return requestDate.toISOString().slice(0,timeOffset);}},{key:\"requestProducts\",value:function requestProducts(){var _this3=this;var _this$props3=this.props,timezone=_this$props3.timezone,categoryUrlPath=_this$props3.category,pageSize=_this$props3.productsCount,cacheLifetime=_this$props3.cacheLifetime,showNotification=_this$props3.showNotification;if(!timezone){return;}var newToDate=this.getRequestDate();var options={args:{filter:{categoryUrlPath:categoryUrlPath,newToDate:newToDate},currentPage:1,pageSize:pageSize}};var query=[ProductListQuery.getQuery(options)];executeGet(prepareQuery(query),'NewProducts',cacheLifetime).then(/** @namespace Component/NewProducts/Container/executeGetThen */middleware(function(_ref){var items=_ref.products.items;return _this3.setState({products:getIndexedProducts(items)});},\"Component/NewProducts/Container/executeGetThen\")).catch(/** @namespace Component/NewProducts/Container/executeGetThenCatch */middleware(function(e){return showNotification('error',__('Error fetching NewProducts!'),e);},\"Component/NewProducts/Container/executeGetThenCatch\"));}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,NewProducts,Object.assign({},this.props,this.state,this.containerProps()));}}]);return _NewProductsContainer;}(Extensible(PureComponent));_NewProductsContainer.defaultProps={category:'',productsCount:10,cacheLifetime:86400};Object.defineProperty(_NewProductsContainer,'name',{value:'NewProductsContainer'});export var NewProductsContainer=middleware(_NewProductsContainer,\"Component/NewProducts/Container\");export default connect(mapStateToProps,mapDispatchToProps)(NewProductsContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/NewProducts/NewProducts.container.js"],"names":["PureComponent","connect","ProductListQuery","showNotification","getIndexedProducts","prepareQuery","executeGet","NewProducts","mapStateToProps","state","timezone","ConfigReducer","mapDispatchToProps","dispatch","type","title","error","NewProductsContainer","products","undefined","siblingsHaveBrands","siblingsHavePriceBadge","siblingsHaveTierPrice","siblingsHaveConfigurableOptions","requestProducts","prevProps","props","category","productsCount","cacheLifetime","pCategory","pProductsCount","pCacheLifetime","pTimezone","productCardFunctions","setSiblingsHaveBrands","setState","setSiblingsHavePriceBadge","setSiblingsHaveTierPrice","setSiblingsHaveConfigurableOptions","productCardProps","timeZone","milliInSeccond","now","Date","serverNow","toLocaleString","serverNowTime","getTime","ttl","requestTime","requestDate","timeOffset","toISOString","slice","categoryUrlPath","pageSize","newToDate","getRequestDate","options","args","filter","currentPage","query","getQuery","then","items","catch","e","__","containerProps","defaultProps","Object","defineProperty","_NewProductsContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport ProductListQuery from 'Query/ProductList.query';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { getIndexedProducts } from 'Util/Product';\nimport { prepareQuery } from 'Util/Query';\nimport { executeGet } from 'Util/Request';\n\nimport NewProducts from './NewProducts.component';\n\n/** @namespace Component/NewProducts/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    timezone: state.ConfigReducer.timezone\n});\n\n/** @namespace Component/NewProducts/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    showNotification: (type, title, error) => dispatch(showNotification(type, title, error))\n});\n\n/** @namespace Component/NewProducts/Container */\nexport class NewProductsContainer extends PureComponent {\n    static propTypes = {\n        category: PropTypes.string,\n        cacheLifetime: PropTypes.number,\n        productsCount: PropTypes.number,\n        timezone: PropTypes.string.isRequired,\n        showNotification: PropTypes.func.isRequired\n    };\n\n    static defaultProps = {\n        category: '',\n        productsCount: 10,\n        cacheLifetime: 86400\n    };\n\n    state = {\n        products: undefined,\n        siblingsHaveBrands: false,\n        siblingsHavePriceBadge: false,\n        siblingsHaveTierPrice: false,\n        siblingsHaveConfigurableOptions: false\n    };\n\n    componentDidMount() {\n        this.requestProducts();\n    }\n\n    componentDidUpdate(prevProps) {\n        const {\n            category,\n            productsCount,\n            cacheLifetime,\n            timezone\n        } = this.props;\n        const {\n            category: pCategory,\n            productsCount: pProductsCount,\n            cacheLifetime: pCacheLifetime,\n            timezone: pTimezone\n        } = prevProps;\n\n        if (category !== pCategory\n            || timezone !== pTimezone\n            || productsCount !== pProductsCount\n            || cacheLifetime !== pCacheLifetime) {\n            this.requestProducts();\n        }\n    }\n\n    containerProps() {\n        const {\n            siblingsHaveBrands,\n            siblingsHavePriceBadge,\n            siblingsHaveTierPrice,\n            siblingsHaveConfigurableOptions\n        } = this.state;\n\n        return {\n            productCardFunctions: {\n                setSiblingsHaveBrands: () => this.setState({ siblingsHaveBrands: true }),\n                setSiblingsHavePriceBadge: () => this.setState({ siblingsHavePriceBadge: true }),\n                setSiblingsHaveTierPrice: () => this.setState({ siblingsHaveTierPrice: true }),\n                setSiblingsHaveConfigurableOptions: () => this.setState({ siblingsHaveConfigurableOptions: true })\n            },\n            productCardProps: {\n                siblingsHaveBrands,\n                siblingsHavePriceBadge,\n                siblingsHaveTierPrice,\n                siblingsHaveConfigurableOptions\n            }\n        };\n    }\n\n    /**\n     * Calculates date for request in server locale and with ttl error\n     *\n     * @returns {Date}\n     * @memberof NewProducts\n     */\n    getRequestDate() {\n        const { cacheLifetime, timezone: timeZone } = this.props;\n        const milliInSeccond = 1000;\n\n        const now = new Date();\n        const serverNow = new Date(now.toLocaleString('en', { timeZone }));\n\n        const serverNowTime = serverNow.getTime();\n        const ttl = cacheLifetime * milliInSeccond;\n\n        const requestTime = serverNowTime - (serverNowTime % ttl);\n        const requestDate = new Date(requestTime);\n\n        const timeOffset = 10;\n        return requestDate.toISOString().slice(0, timeOffset);\n    }\n\n    requestProducts() {\n        const {\n            timezone,\n            category: categoryUrlPath,\n            productsCount: pageSize,\n            cacheLifetime,\n            showNotification\n        } = this.props;\n\n        if (!timezone) {\n            return;\n        }\n\n        const newToDate = this.getRequestDate();\n\n        const options = {\n            args: {\n                filter: {\n                    categoryUrlPath,\n                    newToDate\n                },\n                currentPage: 1,\n                pageSize\n            }\n        };\n\n        const query = [ProductListQuery.getQuery(options)];\n        executeGet(prepareQuery(query), 'NewProducts', cacheLifetime)\n            .then(\n                /** @namespace Component/NewProducts/Container/executeGetThen */\n                ({ products: { items } }) => this.setState({ products: getIndexedProducts(items) })\n            )\n            .catch(\n                /** @namespace Component/NewProducts/Container/executeGetThenCatch */\n                (e) => showNotification('error', __('Error fetching NewProducts!'), e)\n            );\n    }\n\n    render() {\n        return (\n            <NewProducts\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerProps() }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(NewProductsContainer);\n"]},"metadata":{},"sourceType":"module"}