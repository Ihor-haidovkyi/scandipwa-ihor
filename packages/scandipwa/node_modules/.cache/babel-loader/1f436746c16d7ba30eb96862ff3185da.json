{"ast":null,"code":"import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import OrderQuery from\"/home/marketihor/scandipwa/packages/scandipwa/src/query/Order.query\";import{showNotification as _showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import{orderType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Account\";import{isSignedIn}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";import{getIndexedProducts}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";import{fetchQuery}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request\";import MyAccountOrderPopup from\"./MyAccountOrderPopup.component\";import{ORDER_POPUP_ID}from\"./MyAccountOrderPopup.config\";export var OrderDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Order/Order.dispatcher\");/** @namespace Component/MyAccountOrderPopup/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{order:state.OrderReducer.order,payload:state.PopupReducer.popupPayload[ORDER_POPUP_ID]||{},display_tax_in_shipping_amount:state.ConfigReducer.cartDisplayConfig.display_tax_in_shipping_amount};},\"Component/MyAccountOrderPopup/Container/mapStateToProps\");/** @namespace Component/MyAccountOrderPopup/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{showNotification:function showNotification(type,message){return dispatch(_showNotification(type,message));},getOrder:function getOrder(orderId){return OrderDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.getOrderById(dispatch,orderId);});}};},\"Component/MyAccountOrderPopup/Container/mapDispatchToProps\");/** @namespace Component/MyAccountOrderPopup/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _MyAccountOrderPopupContainer=/*#__PURE__*/function(_Extensible){_inherits(_MyAccountOrderPopupContainer,_Extensible);var _super=_createSuper(_MyAccountOrderPopupContainer);function _MyAccountOrderPopupContainer(){var _this;_classCallCheck(this,_MyAccountOrderPopupContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={order:{},currency_code:'',prevOrderId:0,isLoading:true};_this.containerProps=function(){var _this$state=_this.state,stateOrder=_this$state.order,isLoading=_this$state.isLoading,currency_code=_this$state.currency_code;var _this$props=_this.props,payloadOrder=_this$props.payload.order,display_tax_in_shipping_amount=_this$props.display_tax_in_shipping_amount;return{display_tax_in_shipping_amount:display_tax_in_shipping_amount,isLoading:isLoading,currency_code:currency_code,order:_objectSpread(_objectSpread({},payloadOrder),stateOrder)};};return _this;}_createClass(_MyAccountOrderPopupContainer,[{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var prevId=prevProps.payload.increment_id;var id=this.props.payload.increment_id;if(id!==prevId){this.requestOrderDetails();}}},{key:\"requestOrderDetails\",value:function requestOrderDetails(){var _this2=this;var _this$props$payload=this.props.payload;_this$props$payload=_this$props$payload===void 0?{}:_this$props$payload;var _this$props$payload$o=_this$props$payload.order;_this$props$payload$o=_this$props$payload$o===void 0?{}:_this$props$payload$o;var _this$props$payload$o2=_this$props$payload$o.base_order_info;_this$props$payload$o2=_this$props$payload$o2===void 0?{}:_this$props$payload$o2;var id=_this$props$payload$o2.id;if(!isSignedIn()){return;}fetchQuery(OrderQuery.getOrderByIdQuery(id)).then(/** @namespace Component/MyAccountOrderPopup/Container/requestOrderDetailsFetchQueryThen */middleware(function(_ref2){var rawOrder=_ref2.getOrderById;var _rawOrder$order_produ=rawOrder.order_products,order_products=_rawOrder$order_produ===void 0?[]:_rawOrder$order_produ;var indexedProducts=getIndexedProducts(order_products);var order=_objectSpread(_objectSpread({},rawOrder),{},{order_products:indexedProducts});var currency_code=order.base_order_info.currency_code;_this2.setState({currency_code:currency_code,order:order,isLoading:false});},\"Component/MyAccountOrderPopup/Container/requestOrderDetailsFetchQueryThen\"),/** @namespace Component/MyAccountOrderPopup/Container/requestOrderDetailsFetchQueryCatch */middleware(function(){_showNotification('error',__('Error getting Order by ID!'));_this2.setState({isLoading:false});},\"Component/MyAccountOrderPopup/Container/requestOrderDetailsFetchQueryCatch\"));}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,MyAccountOrderPopup,this.containerProps());}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){var id=props.payload.increment_id;var prevOrderId=state.prevOrderId;if(prevOrderId===id){return null;}return{order:{},isLoading:true,prevOrderId:id};}}]);return _MyAccountOrderPopupContainer;}(Extensible(PureComponent));Object.defineProperty(_MyAccountOrderPopupContainer,'name',{value:'MyAccountOrderPopupContainer'});export var MyAccountOrderPopupContainer=middleware(_MyAccountOrderPopupContainer,\"Component/MyAccountOrderPopup/Container\");export default connect(mapStateToProps,mapDispatchToProps)(MyAccountOrderPopupContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/MyAccountOrderPopup/MyAccountOrderPopup.container.js"],"names":["PureComponent","connect","OrderQuery","showNotification","orderType","isSignedIn","getIndexedProducts","fetchQuery","MyAccountOrderPopup","ORDER_POPUP_ID","OrderDispatcher","mapStateToProps","state","order","OrderReducer","payload","PopupReducer","popupPayload","display_tax_in_shipping_amount","ConfigReducer","cartDisplayConfig","mapDispatchToProps","dispatch","type","message","getOrder","orderId","then","dispatcher","default","getOrderById","MyAccountOrderPopupContainer","currency_code","prevOrderId","isLoading","containerProps","stateOrder","props","payloadOrder","prevProps","prevId","increment_id","id","requestOrderDetails","base_order_info","getOrderByIdQuery","rawOrder","order_products","indexedProducts","setState","__","Object","defineProperty","_MyAccountOrderPopupContainer","value"],"mappings":"osBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAGA,OAASA,aAAT,KAA8B,OAA9B,CACA,OAASC,OAAT,KAAwB,aAAxB,CAEA,MAAOC,CAAAA,UAAP,2EACA,OAASC,gBAAgB,GAAhBA,CAAAA,iBAAT,gGACA,OAASC,SAAT,sEACA,OAASC,UAAT,mEACA,OAASC,kBAAT,sEACA,OAASC,UAAT,sEAEA,MAAOC,CAAAA,mBAAP,uCACA,OAASC,cAAT,oCAEA,MAAO,IAAMC,CAAAA,eAAe,CAAG,OAC3B,0DAD2B,iFAAxB,CAKP,yEACA,MAAO,IAAMC,CAAAA,eAAe,YAAG,SAACC,KAAD,QAAY,CACvCC,KAAK,CAAED,KAAK,CAACE,YAAN,CAAmBD,KADa,CAEvCE,OAAO,CAAEH,KAAK,CAACI,YAAN,CAAmBC,YAAnB,CAAgCR,cAAhC,GAAmD,EAFrB,CAGvCS,8BAA8B,CAAEN,KAAK,CAACO,aAAN,CAAoBC,iBAApB,CAAsCF,8BAH/B,CAAZ,EAAH,2DAArB,CAMP,4EACA,MAAO,IAAMG,CAAAA,kBAAkB,YAAG,SAACC,QAAD,QAAe,CAC7CnB,gBAAgB,CAAE,0BAACoB,IAAD,CAAOC,OAAP,QAAmBF,CAAAA,QAAQ,CAACnB,iBAAgB,CAACoB,IAAD,CAAOC,OAAP,CAAjB,CAA3B,EAD2B,CAE7CC,QAAQ,CAAE,kBAACC,OAAD,QAAahB,CAAAA,eAAe,CAACiB,IAAhB,CACnB,kBAAYC,CAAAA,UAAZ,MAAGC,OAAH,OAA6BD,CAAAA,UAAU,CAACE,YAAX,CAAwBR,QAAxB,CAAkCI,OAAlC,CAA7B,EADmB,CAAb,EAFmC,CAAf,EAAH,8DAAxB,CAOP,yD,wEACA,UAAaK,CAAAA,6BAAb,yZAWInB,KAXJ,CAWY,CACJC,KAAK,CAAE,EADH,CAEJmB,aAAa,CAAE,EAFX,CAGJC,WAAW,CAAE,CAHT,CAIJC,SAAS,CAAE,IAJP,CAXZ,OAsCIC,cAtCJ,CAsCqB,UAAM,iBACqC,MAAKvB,KAD1C,CACJwB,UADI,aACXvB,KADW,CACQqB,SADR,aACQA,SADR,CACmBF,aADnB,aACmBA,aADnB,iBAKf,MAAKK,KALU,CAGGC,YAHH,aAGfvB,OAHe,CAGJF,KAHI,CAIfK,8BAJe,aAIfA,8BAJe,CAOnB,MAAO,CACHA,8BAA8B,CAA9BA,8BADG,CAEHgB,SAAS,CAATA,SAFG,CAGHF,aAAa,CAAbA,aAHG,CAIHnB,KAAK,gCACEyB,YADF,EAEEF,UAFF,CAJF,CAAP,CASH,CAtDL,2FA6BI,4BAAmBG,SAAnB,CAA8B,IACOC,CAAAA,MADP,CACoBD,SADpB,CAClBxB,OADkB,CACP0B,YADO,IAEOC,CAAAA,EAFP,CAEgB,KAAKL,KAFrB,CAElBtB,OAFkB,CAEP0B,YAFO,CAI1B,GAAIC,EAAE,GAAKF,MAAX,CAAmB,CACf,KAAKG,mBAAL,GACH,CACJ,CApCL,mCAwDI,8BAAsB,yCAOd,KAAKN,KAPS,CAEdtB,OAFc,kDAMV,EANU,mEAGVF,KAHU,sDAKN,EALM,wEAIN+B,eAJM,wDAIoB,EAJpB,2BAIaF,CAAAA,EAJb,wBAIaA,EAJb,CASlB,GAAI,CAACrC,UAAU,EAAf,CAAmB,CACf,OACH,CAEDE,UAAU,CAACL,UAAU,CAAC2C,iBAAX,CAA6BH,EAA7B,CAAD,CAAV,CAA6Cf,IAA7C,CACI,2FADJ,WAEI,eAAgC,IAAfmB,CAAAA,QAAe,OAA7BhB,YAA6B,2BACIgB,QADJ,CACpBC,cADoB,CACpBA,cADoB,gCACH,EADG,uBAE5B,GAAMC,CAAAA,eAAe,CAAG1C,kBAAkB,CAACyC,cAAD,CAA1C,CACA,GAAMlC,CAAAA,KAAK,gCAAQiC,QAAR,MAAkBC,cAAc,CAAEC,eAAlC,EAAX,CAH4B,GAIDhB,CAAAA,aAJC,CAImBnB,KAJnB,CAIpB+B,eAJoB,CAIDZ,aAJC,CAK5B,MAAI,CAACiB,QAAL,CAAc,CAAEjB,aAAa,CAAbA,aAAF,CAAiBnB,KAAK,CAALA,KAAjB,CAAwBqB,SAAS,CAAE,KAAnC,CAAd,EACH,CARL,8EASI,4FATJ,WAUI,UAAM,CACF/B,iBAAgB,CAAC,OAAD,CAAU+C,EAAE,CAAC,4BAAD,CAAZ,CAAhB,CACA,MAAI,CAACD,QAAL,CAAc,CAAEf,SAAS,CAAE,KAAb,CAAd,EACH,CAbL,gFAeH,CApFL,sBAsFI,iBAAS,CACL,mCACK,mBADL,CAEW,KAAKC,cAAL,EAFX,EAKH,CA5FL,0CAkBI,kCAAgCE,KAAhC,CAAuCzB,KAAvC,CAA8C,IACT8B,CAAAA,EADS,CACAL,KADA,CAClCtB,OADkC,CACvB0B,YADuB,IAElCR,CAAAA,WAFkC,CAElBrB,KAFkB,CAElCqB,WAFkC,CAI1C,GAAIA,WAAW,GAAKS,EAApB,CAAwB,CACpB,MAAO,KAAP,CACH,CAED,MAAO,CAAE7B,KAAK,CAAE,EAAT,CAAaqB,SAAS,CAAE,IAAxB,CAA8BD,WAAW,CAAES,EAA3C,CAAP,CACH,CA3BL,sEA9CAS,MAAM,CAACC,cAAP,CAAsBC,6BAAtB,CAAqD,MAArD,CAA6D,CAAEC,KAAK,CAAE,8BAAT,CAA7D,E,4HA6IA,cAAerD,CAAAA,OAAO,CAACU,eAAD,CAAkBU,kBAAlB,CAAP,CAA6CU,4BAA7C,CAAf","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport OrderQuery from 'Query/Order.query';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { orderType } from 'Type/Account';\nimport { isSignedIn } from 'Util/Auth';\nimport { getIndexedProducts } from 'Util/Product';\nimport { fetchQuery } from 'Util/Request';\n\nimport MyAccountOrderPopup from './MyAccountOrderPopup.component';\nimport { ORDER_POPUP_ID } from './MyAccountOrderPopup.config';\n\nexport const OrderDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Order/Order.dispatcher'\n);\n\n/** @namespace Component/MyAccountOrderPopup/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    order: state.OrderReducer.order,\n    payload: state.PopupReducer.popupPayload[ORDER_POPUP_ID] || {},\n    display_tax_in_shipping_amount: state.ConfigReducer.cartDisplayConfig.display_tax_in_shipping_amount\n});\n\n/** @namespace Component/MyAccountOrderPopup/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    showNotification: (type, message) => dispatch(showNotification(type, message)),\n    getOrder: (orderId) => OrderDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.getOrderById(dispatch, orderId)\n    )\n});\n\n/** @namespace Component/MyAccountOrderPopup/Container */\nexport class MyAccountOrderPopupContainer extends PureComponent {\n    static propTypes = {\n        payload: PropTypes.shape({\n            order: orderType,\n            increment_id: PropTypes.string\n        }).isRequired,\n        showNotification: PropTypes.func.isRequired,\n        getOrder: PropTypes.func.isRequired,\n        display_tax_in_shipping_amount: PropTypes.string.isRequired\n    };\n\n    state = {\n        order: {},\n        currency_code: '',\n        prevOrderId: 0,\n        isLoading: true\n    };\n\n    static getDerivedStateFromProps(props, state) {\n        const { payload: { increment_id: id } } = props;\n        const { prevOrderId } = state;\n\n        if (prevOrderId === id) {\n            return null;\n        }\n\n        return { order: {}, isLoading: true, prevOrderId: id };\n    }\n\n    componentDidUpdate(prevProps) {\n        const { payload: { increment_id: prevId } } = prevProps;\n        const { payload: { increment_id: id } } = this.props;\n\n        if (id !== prevId) {\n            this.requestOrderDetails();\n        }\n    }\n\n    containerProps = () => {\n        const { order: stateOrder, isLoading, currency_code } = this.state;\n        const {\n            payload: { order: payloadOrder },\n            display_tax_in_shipping_amount\n        } = this.props;\n\n        return {\n            display_tax_in_shipping_amount,\n            isLoading,\n            currency_code,\n            order: {\n                ...payloadOrder,\n                ...stateOrder\n            }\n        };\n    };\n\n    requestOrderDetails() {\n        const {\n            payload: {\n                order: {\n                    base_order_info: { id } = {}\n                } = {}\n            } = {}\n        } = this.props;\n\n        if (!isSignedIn()) {\n            return;\n        }\n\n        fetchQuery(OrderQuery.getOrderByIdQuery(id)).then(\n            /** @namespace Component/MyAccountOrderPopup/Container/requestOrderDetailsFetchQueryThen */\n            ({ getOrderById: rawOrder }) => {\n                const { order_products = [] } = rawOrder;\n                const indexedProducts = getIndexedProducts(order_products);\n                const order = { ...rawOrder, order_products: indexedProducts };\n                const { base_order_info: { currency_code } } = order;\n                this.setState({ currency_code, order, isLoading: false });\n            },\n            /** @namespace Component/MyAccountOrderPopup/Container/requestOrderDetailsFetchQueryCatch */\n            () => {\n                showNotification('error', __('Error getting Order by ID!'));\n                this.setState({ isLoading: false });\n            }\n        );\n    }\n\n    render() {\n        return (\n            <MyAccountOrderPopup\n              { ...this.containerProps() }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MyAccountOrderPopupContainer);\n"]},"metadata":{},"sourceType":"module"}