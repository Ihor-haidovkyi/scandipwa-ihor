{"ast":null,"code":"import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{CUSTOMER_ACCOUNT,CUSTOMER_SUB_ACCOUNT}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/Header/Header.config\";import{CHECKOUT_URL}from\"/home/marketihor/scandipwa/packages/scandipwa/src/route/Checkout/Checkout.config\";import{ACCOUNT_LOGIN_URL,ACCOUNT_URL,MY_ACCOUNT_URL}from\"/home/marketihor/scandipwa/packages/scandipwa/src/route/MyAccount/MyAccount.config\";import{changeNavigationState,goToPreviousNavigationState}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.action\";import{TOP_NAVIGATION_TYPE}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.reducer\";import{showNotification as _showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import{hideActiveOverlay as _hideActiveOverlay,toggleOverlayByKey}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Overlay/Overlay.action\";import{DeviceType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Device\";import{isSignedIn}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";import history from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/History\";import{appendWithStoreCode}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Url\";import MyAccountOverlay from\"./MyAccountOverlay.component\";import{CUSTOMER_ACCOUNT_OVERLAY_KEY,STATE_CREATE_ACCOUNT,STATE_FORGOT_PASSWORD,STATE_LOGGED_IN,STATE_SIGN_IN}from\"./MyAccountOverlay.config\";/** @namespace Component/MyAccountOverlay/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{isSignedIn:state.MyAccountReducer.isSignedIn,customer:state.MyAccountReducer.customer,device:state.ConfigReducer.device,isPasswordForgotSend:state.MyAccountReducer.isPasswordForgotSend,isOverlayVisible:state.OverlayReducer.activeOverlay===CUSTOMER_ACCOUNT,redirectToDashboard:state.ConfigReducer.redirect_dashboard,isLoading:state.MyAccountReducer.isLoading};},\"Component/MyAccountOverlay/Container/mapStateToProps\");/** @namespace Component/MyAccountOverlay/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{hideActiveOverlay:function hideActiveOverlay(){return dispatch(_hideActiveOverlay());},showNotification:function showNotification(type,message){return dispatch(_showNotification(type,message));},showOverlay:function showOverlay(overlayKey){return dispatch(toggleOverlayByKey(overlayKey));},setHeaderState:function setHeaderState(headerState){return dispatch(changeNavigationState(TOP_NAVIGATION_TYPE,headerState));},goToPreviousHeaderState:function goToPreviousHeaderState(){return dispatch(goToPreviousNavigationState(TOP_NAVIGATION_TYPE));}};},\"Component/MyAccountOverlay/Container/mapDispatchToProps\");/** @namespace Component/MyAccountOverlay/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _MyAccountOverlayContainer=/*#__PURE__*/function(_Extensible){_inherits(_MyAccountOverlayContainer,_Extensible);var _super=_createSuper(_MyAccountOverlayContainer);function _MyAccountOverlayContainer(){var _this;_classCallCheck(this,_MyAccountOverlayContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={onFormError:_this.onFormError.bind(_assertThisInitialized(_this)),handleForgotPassword:_this.handleForgotPassword.bind(_assertThisInitialized(_this)),handleSignIn:_this.handleSignIn.bind(_assertThisInitialized(_this)),handleCreateAccount:_this.handleCreateAccount.bind(_assertThisInitialized(_this)),onVisible:_this.onVisible.bind(_assertThisInitialized(_this)),setSignInState:_this.setSignInState.bind(_assertThisInitialized(_this)),setLoadingState:_this.setLoadingState.bind(_assertThisInitialized(_this))};_this.redirectOrGetState=function(props){var showOverlay=props.showOverlay,setHeaderState=props.setHeaderState,isPasswordForgotSend=props.isPasswordForgotSend,device=props.device;var _history$location=history.location,pathname=_history$location.pathname,_history$location$sta=_history$location.state;_history$location$sta=_history$location$sta===void 0?{}:_history$location$sta;var isForgotPassword=_history$location$sta.isForgotPassword;var state={state:isSignedIn()?STATE_LOGGED_IN:STATE_SIGN_IN,// eslint-disable-next-line react/no-unused-state\nisPasswordForgotSend:isPasswordForgotSend,isLoading:false};// if customer got here from forgot-password\nif(pathname!=='/forgot-password'&&!isForgotPassword){return state;}state.state=STATE_FORGOT_PASSWORD;setHeaderState({name:CUSTOMER_SUB_ACCOUNT,title:'Forgot password',onBackClick:function onBackClick(e){history.push({pathname:appendWithStoreCode('/my-account')});_this.handleSignIn(e);}});if(device.isMobile){history.push({pathname:appendWithStoreCode('/my-account'),state:{isForgotPassword:true}});return state;}showOverlay(CUSTOMER_ACCOUNT_OVERLAY_KEY);return state;};_this.stopLoading=function(){return _this.setState({isLoading:false});};_this.stopLoadingAndHideOverlay=function(){var hideActiveOverlay=_this.props.hideActiveOverlay;_this.stopLoading();hideActiveOverlay();};return _this;}_createClass(_MyAccountOverlayContainer,[{key:\"__construct\",value:function __construct(props){_get(_getPrototypeOf(_MyAccountOverlayContainer.prototype),\"__construct\",this).call(this,props);this.state=this.redirectOrGetState(props);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){var prevIsSignedIn=prevProps.isSignedIn;var oldMyAccountState=prevState.state;var newMyAccountState=this.state.state;var pathname=history.location.pathname;var _this$props=this.props,isSignedIn=_this$props.isSignedIn,hideActiveOverlay=_this$props.hideActiveOverlay,isCheckout=_this$props.isCheckout,goToPreviousHeaderState=_this$props.goToPreviousHeaderState,redirectToDashboard=_this$props.redirectToDashboard;if(oldMyAccountState===newMyAccountState){return;}if(isSignedIn!==prevIsSignedIn){hideActiveOverlay();if(isCheckout){goToPreviousHeaderState();}}if(newMyAccountState!==STATE_LOGGED_IN&&pathname.includes(MY_ACCOUNT_URL)){history.push({pathname:appendWithStoreCode(ACCOUNT_LOGIN_URL)});}if(newMyAccountState===STATE_LOGGED_IN){if(pathname.includes(ACCOUNT_URL)){history.push({pathname:appendWithStoreCode('/')});}else if(!pathname.includes(CHECKOUT_URL)&&redirectToDashboard){history.push({pathname:appendWithStoreCode('/my-account/dashboard')});}}}},{key:\"containerProps\",value:function containerProps(){var props=this.props,state=this.state;return{isLoading:props.isLoading||state.isLoading};}},{key:\"setSignInState\",value:function setSignInState(state){this.setState({state:state});}},{key:\"setLoadingState\",value:function setLoadingState(isLoading){this.setState({isLoading:isLoading});}},{key:\"onVisible\",value:function onVisible(){var _this$props2=this.props,setHeaderState=_this$props2.setHeaderState,isCheckout=_this$props2.isCheckout,device=_this$props2.device;if(device.isMobile&&!isCheckout){setHeaderState({name:CUSTOMER_ACCOUNT,title:__('Sign in')});}}},{key:\"onFormError\",value:function onFormError(){this.setState({isLoading:false});}},{key:\"handleForgotPassword\",value:function handleForgotPassword(e){var _this2=this;var setHeaderState=this.props.setHeaderState;e.preventDefault();e.nativeEvent.stopImmediatePropagation();this.setState({state:STATE_FORGOT_PASSWORD});setHeaderState({name:CUSTOMER_SUB_ACCOUNT,title:__('Forgot password'),onBackClick:function onBackClick(){return _this2.handleSignIn(e);}});}},{key:\"handleSignIn\",value:function handleSignIn(e){var setHeaderState=this.props.setHeaderState;e.preventDefault();e.nativeEvent.stopImmediatePropagation();this.setState({state:STATE_SIGN_IN});setHeaderState({name:CUSTOMER_ACCOUNT,title:__('Sign in')});}},{key:\"handleCreateAccount\",value:function handleCreateAccount(e){var _this3=this;var setHeaderState=this.props.setHeaderState;e.preventDefault();e.nativeEvent.stopImmediatePropagation();this.setState({state:STATE_CREATE_ACCOUNT});setHeaderState({name:CUSTOMER_SUB_ACCOUNT,title:__('Create account'),onBackClick:function onBackClick(){return _this3.handleSignIn(e);}});}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,MyAccountOverlay,Object.assign({},this.props,this.state,this.containerProps(),this.containerFunctions));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){var isPasswordForgotSend=props.isPasswordForgotSend,showNotification=props.showNotification,isOverlayVisible=props.isOverlayVisible,device=props.device;var currentIsPasswordForgotSend=state.isPasswordForgotSend,myAccountState=state.state;var _history$location2=history.location,pathname=_history$location2.pathname,_history$location2$st=_history$location2.state;_history$location2$st=_history$location2$st===void 0?{}:_history$location2$st;var isForgotPassword=_history$location2$st.isForgotPassword;var stateToBeUpdated={};var customerIsSignedIn=isSignedIn();if(!device.isMobile){if(!isOverlayVisible&&!customerIsSignedIn){if(pathname!=='/forgot-password'&&!isForgotPassword){stateToBeUpdated.state=STATE_SIGN_IN;}}else if(!isOverlayVisible&&customerIsSignedIn){stateToBeUpdated.state=STATE_LOGGED_IN;}}if(myAccountState!==STATE_LOGGED_IN&&customerIsSignedIn){stateToBeUpdated.isLoading=false;stateToBeUpdated.state=STATE_LOGGED_IN;}if(myAccountState===STATE_LOGGED_IN&&!customerIsSignedIn){stateToBeUpdated.state=STATE_SIGN_IN;}if(isPasswordForgotSend!==currentIsPasswordForgotSend){stateToBeUpdated.isLoading=false;stateToBeUpdated.isPasswordForgotSend=isPasswordForgotSend;// eslint-disable-next-line max-len\nshowNotification('success',__('If there is an account associated with the provided address you will receive an email with a link to reset your password.'));stateToBeUpdated.state=STATE_SIGN_IN;}return Object.keys(stateToBeUpdated).length?stateToBeUpdated:null;}}]);return _MyAccountOverlayContainer;}(Extensible(PureComponent));_MyAccountOverlayContainer.defaultProps={isCheckout:false,isLoading:false,onSignIn:function onSignIn(){},goToPreviousHeaderState:function goToPreviousHeaderState(){}};Object.defineProperty(_MyAccountOverlayContainer,'name',{value:'MyAccountOverlayContainer'});export var MyAccountOverlayContainer=middleware(_MyAccountOverlayContainer,\"Component/MyAccountOverlay/Container\");export default connect(mapStateToProps,mapDispatchToProps)(MyAccountOverlayContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/MyAccountOverlay/MyAccountOverlay.container.js"],"names":["PureComponent","connect","CUSTOMER_ACCOUNT","CUSTOMER_SUB_ACCOUNT","CHECKOUT_URL","ACCOUNT_LOGIN_URL","ACCOUNT_URL","MY_ACCOUNT_URL","changeNavigationState","goToPreviousNavigationState","TOP_NAVIGATION_TYPE","showNotification","hideActiveOverlay","toggleOverlayByKey","DeviceType","isSignedIn","history","appendWithStoreCode","MyAccountOverlay","CUSTOMER_ACCOUNT_OVERLAY_KEY","STATE_CREATE_ACCOUNT","STATE_FORGOT_PASSWORD","STATE_LOGGED_IN","STATE_SIGN_IN","mapStateToProps","state","MyAccountReducer","customer","device","ConfigReducer","isPasswordForgotSend","isOverlayVisible","OverlayReducer","activeOverlay","redirectToDashboard","redirect_dashboard","isLoading","mapDispatchToProps","dispatch","type","message","showOverlay","overlayKey","setHeaderState","headerState","goToPreviousHeaderState","MyAccountOverlayContainer","containerFunctions","onFormError","bind","handleForgotPassword","handleSignIn","handleCreateAccount","onVisible","setSignInState","setLoadingState","redirectOrGetState","props","location","pathname","isForgotPassword","name","title","onBackClick","e","push","isMobile","stopLoading","setState","stopLoadingAndHideOverlay","prevProps","prevState","prevIsSignedIn","oldMyAccountState","newMyAccountState","isCheckout","includes","__","preventDefault","nativeEvent","stopImmediatePropagation","containerProps","currentIsPasswordForgotSend","myAccountState","stateToBeUpdated","customerIsSignedIn","Object","keys","length","defaultProps","onSignIn","defineProperty","_MyAccountOverlayContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { CUSTOMER_ACCOUNT, CUSTOMER_SUB_ACCOUNT } from 'Component/Header/Header.config';\nimport { CHECKOUT_URL } from 'Route/Checkout/Checkout.config';\nimport {\n    ACCOUNT_LOGIN_URL,\n    ACCOUNT_URL,\n    MY_ACCOUNT_URL\n} from 'Route/MyAccount/MyAccount.config';\nimport { changeNavigationState, goToPreviousNavigationState } from 'Store/Navigation/Navigation.action';\nimport { TOP_NAVIGATION_TYPE } from 'Store/Navigation/Navigation.reducer';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { hideActiveOverlay, toggleOverlayByKey } from 'Store/Overlay/Overlay.action';\nimport { DeviceType } from 'Type/Device';\nimport { isSignedIn } from 'Util/Auth';\nimport history from 'Util/History';\nimport { appendWithStoreCode } from 'Util/Url';\n\nimport MyAccountOverlay from './MyAccountOverlay.component';\nimport {\n    CUSTOMER_ACCOUNT_OVERLAY_KEY,\n    STATE_CREATE_ACCOUNT,\n    STATE_FORGOT_PASSWORD,\n    STATE_LOGGED_IN,\n    STATE_SIGN_IN\n} from './MyAccountOverlay.config';\n\n/** @namespace Component/MyAccountOverlay/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    isSignedIn: state.MyAccountReducer.isSignedIn,\n    customer: state.MyAccountReducer.customer,\n    device: state.ConfigReducer.device,\n    isPasswordForgotSend: state.MyAccountReducer.isPasswordForgotSend,\n    isOverlayVisible: state.OverlayReducer.activeOverlay === CUSTOMER_ACCOUNT,\n    redirectToDashboard: state.ConfigReducer.redirect_dashboard,\n    isLoading: state.MyAccountReducer.isLoading\n});\n\n/** @namespace Component/MyAccountOverlay/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    hideActiveOverlay: () => dispatch(hideActiveOverlay()),\n    showNotification: (type, message) => dispatch(showNotification(type, message)),\n    showOverlay: (overlayKey) => dispatch(toggleOverlayByKey(overlayKey)),\n    setHeaderState: (headerState) => dispatch(changeNavigationState(TOP_NAVIGATION_TYPE, headerState)),\n    goToPreviousHeaderState: () => dispatch(goToPreviousNavigationState(TOP_NAVIGATION_TYPE))\n});\n\n/** @namespace Component/MyAccountOverlay/Container */\nexport class MyAccountOverlayContainer extends PureComponent {\n    static propTypes = {\n        isPasswordForgotSend: PropTypes.bool.isRequired,\n        isSignedIn: PropTypes.bool.isRequired,\n        showNotification: PropTypes.func.isRequired,\n        isOverlayVisible: PropTypes.bool.isRequired,\n        showOverlay: PropTypes.func.isRequired,\n        setHeaderState: PropTypes.func.isRequired,\n        onSignIn: PropTypes.func,\n        goToPreviousHeaderState: PropTypes.func,\n        isCheckout: PropTypes.bool,\n        hideActiveOverlay: PropTypes.func.isRequired,\n        device: DeviceType.isRequired,\n        redirectToDashboard: PropTypes.bool.isRequired,\n        isLoading: PropTypes.bool\n    };\n\n    static defaultProps = {\n        isCheckout: false,\n        isLoading: false,\n        onSignIn: () => {},\n        goToPreviousHeaderState: () => {}\n    };\n\n    containerFunctions = {\n        onFormError: this.onFormError.bind(this),\n        handleForgotPassword: this.handleForgotPassword.bind(this),\n        handleSignIn: this.handleSignIn.bind(this),\n        handleCreateAccount: this.handleCreateAccount.bind(this),\n        onVisible: this.onVisible.bind(this),\n        setSignInState: this.setSignInState.bind(this),\n        setLoadingState: this.setLoadingState.bind(this)\n    };\n\n    __construct(props) {\n        super.__construct(props);\n\n        this.state = this.redirectOrGetState(props);\n    }\n\n    static getDerivedStateFromProps(props, state) {\n        const {\n            isPasswordForgotSend,\n            showNotification,\n            isOverlayVisible,\n            device\n        } = props;\n\n        const {\n            isPasswordForgotSend: currentIsPasswordForgotSend,\n            state: myAccountState\n        } = state;\n\n        const { location: { pathname, state: { isForgotPassword } = {} } } = history;\n\n        const stateToBeUpdated = {};\n        const customerIsSignedIn = isSignedIn();\n\n        if (!device.isMobile) {\n            if (!isOverlayVisible && !customerIsSignedIn) {\n                if (pathname !== '/forgot-password' && !isForgotPassword) {\n                    stateToBeUpdated.state = STATE_SIGN_IN;\n                }\n            } else if (!isOverlayVisible && customerIsSignedIn) {\n                stateToBeUpdated.state = STATE_LOGGED_IN;\n            }\n        }\n\n        if (myAccountState !== STATE_LOGGED_IN && customerIsSignedIn) {\n            stateToBeUpdated.isLoading = false;\n            stateToBeUpdated.state = STATE_LOGGED_IN;\n        }\n\n        if (myAccountState === STATE_LOGGED_IN && !customerIsSignedIn) {\n            stateToBeUpdated.state = STATE_SIGN_IN;\n        }\n\n        if (isPasswordForgotSend !== currentIsPasswordForgotSend) {\n            stateToBeUpdated.isLoading = false;\n            stateToBeUpdated.isPasswordForgotSend = isPasswordForgotSend;\n            // eslint-disable-next-line max-len\n            showNotification('success', __('If there is an account associated with the provided address you will receive an email with a link to reset your password.'));\n            stateToBeUpdated.state = STATE_SIGN_IN;\n        }\n\n        return Object.keys(stateToBeUpdated).length ? stateToBeUpdated : null;\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        const { isSignedIn: prevIsSignedIn } = prevProps;\n        const { state: oldMyAccountState } = prevState;\n        const { state: newMyAccountState } = this.state;\n        const { location: { pathname } } = history;\n\n        const {\n            isSignedIn,\n            hideActiveOverlay,\n            isCheckout,\n            goToPreviousHeaderState,\n            redirectToDashboard\n        } = this.props;\n\n        if (oldMyAccountState === newMyAccountState) {\n            return;\n        }\n\n        if (isSignedIn !== prevIsSignedIn) {\n            hideActiveOverlay();\n\n            if (isCheckout) {\n                goToPreviousHeaderState();\n            }\n        }\n\n        if (newMyAccountState !== STATE_LOGGED_IN && pathname.includes(MY_ACCOUNT_URL)) {\n            history.push({ pathname: appendWithStoreCode(ACCOUNT_LOGIN_URL) });\n        }\n\n        if (newMyAccountState === STATE_LOGGED_IN) {\n            if (pathname.includes(ACCOUNT_URL)) {\n                history.push({ pathname: appendWithStoreCode('/') });\n            } else if (!pathname.includes(CHECKOUT_URL) && redirectToDashboard) {\n                history.push({ pathname: appendWithStoreCode('/my-account/dashboard') });\n            }\n        }\n    }\n\n    containerProps() {\n        const { props, state } = this;\n\n        return {\n            isLoading: props.isLoading || state.isLoading\n        };\n    }\n\n    setSignInState(state) {\n        this.setState({ state });\n    }\n\n    setLoadingState(isLoading) {\n        this.setState({ isLoading });\n    }\n\n    redirectOrGetState = (props) => {\n        const {\n            showOverlay,\n            setHeaderState,\n            isPasswordForgotSend,\n            device\n        } = props;\n\n        const { location: { pathname, state: { isForgotPassword } = {} } } = history;\n\n        const state = {\n            state: isSignedIn() ? STATE_LOGGED_IN : STATE_SIGN_IN,\n            // eslint-disable-next-line react/no-unused-state\n            isPasswordForgotSend,\n            isLoading: false\n        };\n\n        // if customer got here from forgot-password\n        if (pathname !== '/forgot-password' && !isForgotPassword) {\n            return state;\n        }\n\n        state.state = STATE_FORGOT_PASSWORD;\n\n        setHeaderState({\n            name: CUSTOMER_SUB_ACCOUNT,\n            title: 'Forgot password',\n            onBackClick: (e) => {\n                history.push({ pathname: appendWithStoreCode('/my-account') });\n                this.handleSignIn(e);\n            }\n        });\n\n        if (device.isMobile) {\n            history.push({ pathname: appendWithStoreCode('/my-account'), state: { isForgotPassword: true } });\n            return state;\n        }\n\n        showOverlay(CUSTOMER_ACCOUNT_OVERLAY_KEY);\n\n        return state;\n    };\n\n    onVisible() {\n        const { setHeaderState, isCheckout, device } = this.props;\n\n        if (device.isMobile && !isCheckout) {\n            setHeaderState({ name: CUSTOMER_ACCOUNT, title: __('Sign in') });\n        }\n    }\n\n    onFormError() {\n        this.setState({ isLoading: false });\n    }\n\n    stopLoading = () => this.setState({ isLoading: false });\n\n    stopLoadingAndHideOverlay = () => {\n        const { hideActiveOverlay } = this.props;\n        this.stopLoading();\n        hideActiveOverlay();\n    };\n\n    handleForgotPassword(e) {\n        const { setHeaderState } = this.props;\n        e.preventDefault();\n        e.nativeEvent.stopImmediatePropagation();\n        this.setState({ state: STATE_FORGOT_PASSWORD });\n\n        setHeaderState({\n            name: CUSTOMER_SUB_ACCOUNT,\n            title: __('Forgot password'),\n            onBackClick: () => this.handleSignIn(e)\n        });\n    }\n\n    handleSignIn(e) {\n        const { setHeaderState } = this.props;\n        e.preventDefault();\n        e.nativeEvent.stopImmediatePropagation();\n        this.setState({ state: STATE_SIGN_IN });\n\n        setHeaderState({\n            name: CUSTOMER_ACCOUNT,\n            title: __('Sign in')\n        });\n    }\n\n    handleCreateAccount(e) {\n        const { setHeaderState } = this.props;\n        e.preventDefault();\n        e.nativeEvent.stopImmediatePropagation();\n        this.setState({ state: STATE_CREATE_ACCOUNT });\n\n        setHeaderState({\n            name: CUSTOMER_SUB_ACCOUNT,\n            title: __('Create account'),\n            onBackClick: () => this.handleSignIn(e)\n        });\n    }\n\n    render() {\n        return (\n            <MyAccountOverlay\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerProps() }\n              { ...this.containerFunctions }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MyAccountOverlayContainer);\n"]},"metadata":{},"sourceType":"module"}