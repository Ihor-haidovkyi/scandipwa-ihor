{"ast":null,"code":"import _objectWithoutProperties from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _defineProperty from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/* eslint-disable react/jsx-no-useless-fragment */ /**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */ /* eslint-disable consistent-return */ // Disabled due `domToReact` internal logic\nimport parser from'html-react-parser';import _attributesToProps from'html-react-parser/lib/attributes-to-props';import domToReact from'html-react-parser/lib/dom-to-react';import{PureComponent}from'react';import Image from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/Image\";import Link from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/Link\";import WidgetFactory from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/WidgetFactory\";import{hash}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request/Hash\";/**\n * Html content parser\n * Component converts HTML strings to React components\n * @class Html\n * @namespace Component/Html/Component\n */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _Html=/*#__PURE__*/function(_Extensible){_inherits(_Html,_Extensible);var _super=_createSuper(_Html);function _Html(){var _this;_classCallCheck(this,_Html);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.createdOutsideElements={};_this.rules=[{query:{name:['widget']},replace:_this.replaceWidget},{query:{name:['a']},replace:_this.replaceLinks},{query:{name:['img']},replace:_this.replaceImages},{query:{name:['input']},replace:_this.replaceInput},{query:{name:['script']},replace:_this.replaceScript},{query:{name:['style']},replace:_this.replaceStyle},{query:{name:['table']},replace:_this.wrapTable}];_this.parserOptions={replace:function replace(domNode){var data=domNode.data,domName=domNode.name,domAttrs=domNode.attribs;// Let's remove empty text nodes\nif(data&&!data.replace(/\\u21b5/g,'').replace(/\\s/g,'').length){return/*#__PURE__*/_checkBEM(React,React.Fragment,null);}var rule=_this.rules.find(function(rule){var _rule$query=rule.query,name=_rule$query.name,attribs=_rule$query.attribs;if(name&&domName&&name.indexOf(domName)!==-1){return true;}if(attribs&&domAttrs){// eslint-disable-next-line fp/no-loops, fp/no-let\nfor(var i=0;i<attribs.length;i++){var attrib=attribs[i];if(typeof attrib==='object'){var queryAttrib=Object.keys(attrib)[0];if(Object.prototype.hasOwnProperty.call(domAttrs,queryAttrib)){return domAttrs[queryAttrib].match(Object.values(attrib)[0]);}}else if(Object.prototype.hasOwnProperty.call(domAttrs,attrib)){return true;}}}return false;});if(rule){var replace=rule.replace;return replace.call(_assertThisInitialized(_this),domNode);}}};return _this;}_createClass(_Html,[{key:\"attributesToProps\",value:function attributesToProps(attribs){var toCamelCase=function toCamelCase(string){return string.replace(/_[a-z]/g,function(match){return match.substr(1).toUpperCase();});};var convertPropertiesToValidFormat=function convertPropertiesToValidFormat(properties){return Object.entries(properties).reduce(function(validProps,_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];// eslint-disable-next-line no-restricted-globals\nif(!isNaN(value)){return _objectSpread(_objectSpread({},validProps),{},_defineProperty({},toCamelCase(key),+value));}return _objectSpread(_objectSpread({},validProps),{},_defineProperty({},toCamelCase(key),value));},{});};var properties=convertPropertiesToValidFormat(attribs);return _attributesToProps(properties);}/**\n     * Replace links to native React Router links\n     * @param  {{ attribs: Object, children: Array }}\n     * @return {void|JSX} Return JSX if link is allowed to be replaced\n     * @memberof Html\n     */},{key:\"replaceLinks\",value:function replaceLinks(_ref3){var attribs=_ref3.attribs,children=_ref3.children;var href=attribs.href,attrs=_objectWithoutProperties(attribs,[\"href\"]);if(href){var isAbsoluteUrl=function isAbsoluteUrl(value){return new RegExp('^(?:[a-z]+:)?//','i').test(value);};var isSpecialLink=function isSpecialLink(value){return new RegExp('^(sms|tel|mailto):','i').test(value);};if(!isAbsoluteUrl(href)&&!isSpecialLink(href)){return/*#__PURE__*/_checkBEM(React,Link,_attributesToProps(_objectSpread(_objectSpread({},attrs),{},{to:href})),domToReact(children,this.parserOptions));}}}/**\n     * Replace img to React Images\n     * @param  {{ attribs: Object }}\n     * @return {void|JSX} Return JSX with image\n     * @memberof Html\n     */},{key:\"replaceImages\",value:function replaceImages(_ref4){var attribs=_ref4.attribs;var attributes=_attributesToProps(attribs);if(attribs.src){return/*#__PURE__*/_checkBEM(React,Image,attributes);}}/**\n     * Replace input.\n     * @param  {{ attribs: Object }}\n     * @return {void|JSX} Return JSX with image\n     * @memberof Html\n     */},{key:\"replaceInput\",value:function replaceInput(_ref5){var attribs=_ref5.attribs;return/*#__PURE__*/_checkBEM(React,\"input\",_attributesToProps(attribs));}/**\n     * Wrap table in container\n     *\n     * @param attribs\n     * @param children\n     * @returns {*}\n     */},{key:\"wrapTable\",value:function wrapTable(_ref6){var attribs=_ref6.attribs,children=_ref6.children;return/*#__PURE__*/_checkBEM(React,\"div\",{block:\"Table\",elem:\"Wrapper\"},/*#__PURE__*/_checkBEM(React,\"table\",_attributesToProps(attribs),domToReact(children,this.parserOptions)));}/**\n     * Insert corresponding widget\n     *\n     * @param {{ attribs: Object }} { attribs }\n     * @returns {null|JSX} Return Widget\n     * @memberof Html\n     */},{key:\"replaceWidget\",value:function replaceWidget(_ref7){var attribs=_ref7.attribs;return/*#__PURE__*/_checkBEM(React,WidgetFactory,this.attributesToProps(attribs));}},{key:\"replaceStyle\",value:function replaceStyle(elem){var children=elem.children;var elemHash=hash(elem);if(this.createdOutsideElements[elemHash]){return/*#__PURE__*/_checkBEM(React,React.Fragment,null);}var style=document.createElement('style');if(children&&children[0]){style.appendChild(document.createTextNode(children[0].data));}document.head.appendChild(style);this.createdOutsideElements[elemHash]=true;return/*#__PURE__*/_checkBEM(React,React.Fragment,null);}},{key:\"replaceScript\",value:function replaceScript(elem){var attribs=elem.attribs,children=elem.children;var elemHash=hash(elem);if(this.createdOutsideElements[elemHash]){return/*#__PURE__*/_checkBEM(React,React.Fragment,null);}var script=document.createElement('script');Object.entries(attribs).forEach(function(_ref8){var _ref9=_slicedToArray(_ref8,2),attr=_ref9[0],value=_ref9[1];return script.setAttribute(attr,value);});if(children&&children[0]){script.appendChild(document.createTextNode(children[0].data));}document.head.appendChild(script);this.createdOutsideElements[elemHash]=true;return/*#__PURE__*/_checkBEM(React,React.Fragment,null);}},{key:\"render\",value:function render(){var content=this.props.content;return parser(content,this.parserOptions);}}]);return _Html;}(Extensible(PureComponent));Object.defineProperty(_Html,'name',{value:'Html'});export var Html=middleware(_Html,\"Component/Html/Component\");export default Html;","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/Html/Html.component.js"],"names":["parser","attributesToProps","domToReact","PureComponent","Image","Link","WidgetFactory","hash","Html","createdOutsideElements","rules","query","name","replace","replaceWidget","replaceLinks","replaceImages","replaceInput","replaceScript","replaceStyle","wrapTable","parserOptions","domNode","data","domName","domAttrs","attribs","length","rule","find","indexOf","i","attrib","queryAttrib","Object","keys","prototype","hasOwnProperty","call","match","values","toCamelCase","string","substr","toUpperCase","convertPropertiesToValidFormat","properties","entries","reduce","validProps","key","value","isNaN","children","href","attrs","isAbsoluteUrl","RegExp","test","isSpecialLink","to","attributes","src","elem","elemHash","style","document","createElement","appendChild","createTextNode","head","script","forEach","attr","setAttribute","content","props","defineProperty","_Html"],"mappings":"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","sourcesContent":["/* eslint-disable react/jsx-no-useless-fragment */\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\n/* eslint-disable consistent-return */\n// Disabled due `domToReact` internal logic\nimport parser from 'html-react-parser';\nimport attributesToProps from 'html-react-parser/lib/attributes-to-props';\nimport domToReact from 'html-react-parser/lib/dom-to-react';\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\n\nimport Image from 'Component/Image';\nimport Link from 'Component/Link';\nimport WidgetFactory from 'Component/WidgetFactory';\nimport { hash } from 'Util/Request/Hash';\n\n/**\n * Html content parser\n * Component converts HTML strings to React components\n * @class Html\n * @namespace Component/Html/Component\n */\nexport class Html extends PureComponent {\n    static propTypes = {\n        content: PropTypes.string.isRequired\n    };\n\n    createdOutsideElements = {};\n\n    rules = [\n        {\n            query: { name: ['widget'] },\n            replace: this.replaceWidget\n        },\n        {\n            query: { name: ['a'] },\n            replace: this.replaceLinks\n        },\n        {\n            query: { name: ['img'] },\n            replace: this.replaceImages\n        },\n        {\n            query: { name: ['input'] },\n            replace: this.replaceInput\n        },\n        {\n            query: { name: ['script'] },\n            replace: this.replaceScript\n        },\n        {\n            query: { name: ['style'] },\n            replace: this.replaceStyle\n        },\n        {\n            query: { name: ['table'] },\n            replace: this.wrapTable\n        }\n    ];\n\n    parserOptions = {\n        replace: (domNode) => {\n            const { data, name: domName, attribs: domAttrs } = domNode;\n\n            // Let's remove empty text nodes\n            if (data && !data.replace(/\\u21b5/g, '').replace(/\\s/g, '').length) {\n                return <></>;\n            }\n\n            const rule = this.rules.find((rule) => {\n                const { query: { name, attribs } } = rule;\n\n                if (name && domName && name.indexOf(domName) !== -1) {\n                    return true;\n                } if (attribs && domAttrs) {\n                    // eslint-disable-next-line fp/no-loops, fp/no-let\n                    for (let i = 0; i < attribs.length; i++) {\n                        const attrib = attribs[i];\n\n                        if (typeof attrib === 'object') {\n                            const queryAttrib = Object.keys(attrib)[0];\n\n                            if (Object.prototype.hasOwnProperty.call(domAttrs, queryAttrib)) {\n                                return domAttrs[queryAttrib].match(Object.values(attrib)[0]);\n                            }\n                        } else if (Object.prototype.hasOwnProperty.call(domAttrs, attrib)) {\n                            return true;\n                        }\n                    }\n                }\n\n                return false;\n            });\n\n            if (rule) {\n                const { replace } = rule;\n                return replace.call(this, domNode);\n            }\n        }\n    };\n\n    attributesToProps(attribs) {\n        const toCamelCase = (string) => string.replace(/_[a-z]/g, (match) => match.substr(1).toUpperCase());\n\n        const convertPropertiesToValidFormat = (properties) => Object.entries(properties)\n            .reduce((validProps, [key, value]) => {\n                // eslint-disable-next-line no-restricted-globals\n                if (!isNaN(value)) {\n                    return { ...validProps, [toCamelCase(key)]: +value };\n                }\n\n                return { ...validProps, [toCamelCase(key)]: value };\n            }, {});\n\n        const properties = convertPropertiesToValidFormat(attribs);\n        return attributesToProps(properties);\n    }\n\n    /**\n     * Replace links to native React Router links\n     * @param  {{ attribs: Object, children: Array }}\n     * @return {void|JSX} Return JSX if link is allowed to be replaced\n     * @memberof Html\n     */\n    replaceLinks({ attribs, children }) {\n        const { href, ...attrs } = attribs;\n\n        if (href) {\n            const isAbsoluteUrl = (value) => new RegExp('^(?:[a-z]+:)?//', 'i').test(value);\n            const isSpecialLink = (value) => new RegExp('^(sms|tel|mailto):', 'i').test(value);\n\n            if (!isAbsoluteUrl(href) && !isSpecialLink(href)) {\n                return (\n                    <Link { ...attributesToProps({ ...attrs, to: href }) }>\n                        { domToReact(children, this.parserOptions) }\n                    </Link>\n                );\n            }\n        }\n    }\n\n    /**\n     * Replace img to React Images\n     * @param  {{ attribs: Object }}\n     * @return {void|JSX} Return JSX with image\n     * @memberof Html\n     */\n    replaceImages({ attribs }) {\n        const attributes = attributesToProps(attribs);\n\n        if (attribs.src) {\n            return <Image { ...attributes } />;\n        }\n    }\n\n    /**\n     * Replace input.\n     * @param  {{ attribs: Object }}\n     * @return {void|JSX} Return JSX with image\n     * @memberof Html\n     */\n    replaceInput({ attribs }) {\n        return <input { ...attributesToProps(attribs) } />;\n    }\n\n    /**\n     * Wrap table in container\n     *\n     * @param attribs\n     * @param children\n     * @returns {*}\n     */\n    wrapTable({ attribs, children }) {\n        return (\n            <div block=\"Table\" elem=\"Wrapper\">\n                <table { ...attributesToProps(attribs) }>\n                    { domToReact(children, this.parserOptions) }\n                </table>\n            </div>\n        );\n    }\n\n    /**\n     * Insert corresponding widget\n     *\n     * @param {{ attribs: Object }} { attribs }\n     * @returns {null|JSX} Return Widget\n     * @memberof Html\n     */\n    replaceWidget({ attribs }) {\n        return <WidgetFactory { ...this.attributesToProps(attribs) } />;\n    }\n\n    replaceStyle(elem) {\n        const { children } = elem;\n        const elemHash = hash(elem);\n\n        if (this.createdOutsideElements[elemHash]) {\n            return <></>;\n        }\n\n        const style = document.createElement('style');\n\n        if (children && children[0]) {\n            style.appendChild(document.createTextNode(children[0].data));\n        }\n\n        document.head.appendChild(style);\n        this.createdOutsideElements[elemHash] = true;\n\n        return <></>;\n    }\n\n    replaceScript(elem) {\n        const { attribs, children } = elem;\n        const elemHash = hash(elem);\n\n        if (this.createdOutsideElements[elemHash]) {\n            return <></>;\n        }\n\n        const script = document.createElement('script');\n\n        Object.entries(attribs).forEach(([attr, value]) => script.setAttribute(attr, value));\n\n        if (children && children[0]) {\n            script.appendChild(document.createTextNode(children[0].data));\n        }\n\n        document.head.appendChild(script);\n        this.createdOutsideElements[elemHash] = true;\n\n        return <></>;\n    }\n\n    render() {\n        const { content } = this.props;\n        return parser(content, this.parserOptions);\n    }\n}\n\nexport default Html;\n"]},"metadata":{},"sourceType":"module"}