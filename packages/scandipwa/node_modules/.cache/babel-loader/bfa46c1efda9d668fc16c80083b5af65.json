{"ast":null,"code":"import _asyncToGenerator from \"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport ProductCompareQuery from \"/home/marketihor/scandipwa/packages/scandipwa/src/query/ProductCompare.query\";\nimport { showNotification } from \"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";\nimport { clearComparedProducts, setCompareList, toggleLoader } from \"/home/marketihor/scandipwa/packages/scandipwa/src/store/ProductCompare/ProductCompare.action\";\nimport { getUid, removeUid, setUid } from \"/home/marketihor/scandipwa/packages/scandipwa/src/util/Compare\";\nimport { fetchMutation, fetchQuery } from \"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request\";\nexport const CartDispatcher = import(\n/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Cart/Cart.dispatcher\");\n/** @namespace Store/ProductCompare/Dispatcher */\n\nexport class _ProductCompareDispatcher extends Extensible() {\n  getCompareList(dispatch) {\n    return _asyncToGenerator(function* () {\n      const uid = getUid();\n\n      if (!uid) {\n        return false;\n      }\n\n      dispatch(toggleLoader(true));\n\n      try {\n        const {\n          compareList\n        } = yield fetchQuery(ProductCompareQuery.getCompareList(uid));\n        dispatch(toggleLoader(false));\n        dispatch(setCompareList(compareList));\n      } catch (error) {\n        dispatch(toggleLoader(false));\n        dispatch(showNotification('error', __('Unable to fetch compare list'), error));\n        return false;\n      }\n\n      return true;\n    })();\n  }\n\n  createCompareList(productId) {\n    return _asyncToGenerator(function* () {\n      const {\n        createCompareList,\n        createCompareList: {\n          uid\n        }\n      } = yield fetchMutation(ProductCompareQuery.getCreateCompareList([productId]));\n\n      if (uid) {\n        setUid(uid);\n      }\n\n      return createCompareList;\n    })();\n  }\n\n  addToCompareList(uid, productId) {\n    return _asyncToGenerator(function* () {\n      const {\n        addProductsToCompareList\n      } = yield fetchMutation(ProductCompareQuery.getAddProductsToCompareList(uid, [productId]));\n      return addProductsToCompareList;\n    })();\n  }\n\n  addProductToCompare(productId, dispatch) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const uid = getUid();\n\n      try {\n        const result = uid ? yield _this.addToCompareList(uid, productId) : yield _this.createCompareList(productId);\n        dispatch(setCompareList(result));\n        dispatch(showNotification('success', __('Product is added to the compare list')));\n        return result;\n      } catch (error) {\n        dispatch(showNotification('error', __('Unable to add product to the compare list'), error));\n        return false;\n      }\n    })();\n  }\n\n  removeComparedProduct(productId, dispatch) {\n    return _asyncToGenerator(function* () {\n      const uid = getUid();\n\n      if (!uid) {\n        return false;\n      }\n\n      try {\n        const {\n          removeProductsFromCompareList\n        } = yield fetchMutation(ProductCompareQuery.getRemoveProductsFromCompareList(uid, [productId]));\n        dispatch(setCompareList(removeProductsFromCompareList));\n        dispatch(showNotification('success', __('Product is removed from the compare list')));\n        return removeProductsFromCompareList;\n      } catch (error) {\n        dispatch(showNotification('error', __('Unable to remove product from the compare list'), error));\n        return false;\n      }\n    })();\n  }\n\n  fetchCustomersList(dispatch) {\n    return _asyncToGenerator(function* () {\n      const {\n        createCompareList,\n        createCompareList: {\n          uid\n        }\n      } = yield fetchMutation(ProductCompareQuery.getCreateEmptyCompareList());\n\n      if (uid) {\n        setUid(uid);\n      }\n\n      dispatch(setCompareList(createCompareList));\n    })();\n  }\n\n  assignCompareList(dispatch) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const uid = getUid();\n\n      if (!uid) {\n        yield _this2.fetchCustomersList(dispatch);\n        return false;\n      }\n\n      removeUid();\n\n      try {\n        const {\n          assignCompareListToCustomer: {\n            result,\n            compare_list,\n            compare_list: {\n              uid: newUid\n            }\n          }\n        } = yield fetchMutation(ProductCompareQuery.getAssignCompareList(uid));\n\n        if (result) {\n          setUid(newUid);\n          dispatch(setCompareList(compare_list));\n        }\n\n        return result;\n      } catch (error) {\n        dispatch(toggleLoader(false));\n        return false;\n      }\n    })();\n  }\n\n  clearComparedProducts(dispatch) {\n    return _asyncToGenerator(function* () {\n      const uid = getUid();\n\n      if (!uid) {\n        return false;\n      }\n\n      dispatch(toggleLoader(true));\n\n      try {\n        const result = yield fetchMutation(ProductCompareQuery.getDeleteCompareList(uid));\n        removeUid();\n        dispatch(clearComparedProducts());\n        dispatch(showNotification('success', __('Compare list is cleared')));\n        dispatch(toggleLoader(false));\n        return result;\n      } catch (error) {\n        dispatch(toggleLoader(false));\n        dispatch(showNotification('error', __('Unable to clear product compare list'), error));\n        return false;\n      }\n    })();\n  }\n\n  resetComparedProducts(dispatch) {\n    dispatch(clearComparedProducts());\n  }\n\n}\nObject.defineProperty(_ProductCompareDispatcher, 'name', {\n  value: 'ProductCompareDispatcher'\n});\n\nexport const ProductCompareDispatcher = middleware(_ProductCompareDispatcher, \"Store/ProductCompare/Dispatcher\");\nexport default new ProductCompareDispatcher();","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/store/ProductCompare/ProductCompare.dispatcher.js"],"names":["ProductCompareQuery","showNotification","clearComparedProducts","setCompareList","toggleLoader","getUid","removeUid","setUid","fetchMutation","fetchQuery","CartDispatcher","ProductCompareDispatcher","getCompareList","dispatch","uid","compareList","error","__","createCompareList","productId","getCreateCompareList","addToCompareList","addProductsToCompareList","getAddProductsToCompareList","addProductToCompare","result","removeComparedProduct","removeProductsFromCompareList","getRemoveProductsFromCompareList","fetchCustomersList","getCreateEmptyCompareList","assignCompareList","assignCompareListToCustomer","compare_list","newUid","getAssignCompareList","getDeleteCompareList","resetComparedProducts","Object","defineProperty","_ProductCompareDispatcher","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport ProductCompareQuery from 'Query/ProductCompare.query';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport {\n    clearComparedProducts,\n    setCompareList,\n    toggleLoader\n} from 'Store/ProductCompare/ProductCompare.action';\nimport { getUid, removeUid, setUid } from 'Util/Compare';\nimport { fetchMutation, fetchQuery } from 'Util/Request';\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\n\n/** @namespace Store/ProductCompare/Dispatcher */\nexport class ProductCompareDispatcher {\n    async getCompareList(dispatch) {\n        const uid = getUid();\n        if (!uid) {\n            return false;\n        }\n\n        dispatch(toggleLoader(true));\n\n        try {\n            const { compareList } = await fetchQuery(\n                ProductCompareQuery.getCompareList(uid)\n            );\n\n            dispatch(toggleLoader(false));\n            dispatch(setCompareList(compareList));\n        } catch (error) {\n            dispatch(toggleLoader(false));\n            dispatch(showNotification('error', __('Unable to fetch compare list'), error));\n\n            return false;\n        }\n\n        return true;\n    }\n\n    async createCompareList(productId) {\n        const {\n            createCompareList,\n            createCompareList: {\n                uid\n            }\n        } = await fetchMutation(\n            ProductCompareQuery.getCreateCompareList(\n                [productId]\n            )\n        );\n\n        if (uid) {\n            setUid(uid);\n        }\n\n        return createCompareList;\n    }\n\n    async addToCompareList(uid, productId) {\n        const {\n            addProductsToCompareList\n        } = await fetchMutation(\n            ProductCompareQuery.getAddProductsToCompareList(\n                uid,\n                [productId]\n            )\n        );\n\n        return addProductsToCompareList;\n    }\n\n    async addProductToCompare(productId, dispatch) {\n        const uid = getUid();\n\n        try {\n            const result = (uid)\n                ? await this.addToCompareList(uid, productId)\n                : await this.createCompareList(productId);\n\n            dispatch(setCompareList(result));\n            dispatch(showNotification('success', __('Product is added to the compare list')));\n\n            return result;\n        } catch (error) {\n            dispatch(showNotification('error', __('Unable to add product to the compare list'), error));\n\n            return false;\n        }\n    }\n\n    async removeComparedProduct(productId, dispatch) {\n        const uid = getUid();\n        if (!uid) {\n            return false;\n        }\n\n        try {\n            const {\n                removeProductsFromCompareList\n            } = await fetchMutation(\n                ProductCompareQuery.getRemoveProductsFromCompareList(\n                    uid,\n                    [productId]\n                )\n            );\n\n            dispatch(setCompareList(removeProductsFromCompareList));\n            dispatch(showNotification('success', __('Product is removed from the compare list')));\n\n            return removeProductsFromCompareList;\n        } catch (error) {\n            dispatch(showNotification('error', __('Unable to remove product from the compare list'), error));\n\n            return false;\n        }\n    }\n\n    async fetchCustomersList(dispatch) {\n        const {\n            createCompareList,\n            createCompareList: {\n                uid\n            }\n        } = await fetchMutation(\n            ProductCompareQuery.getCreateEmptyCompareList()\n        );\n\n        if (uid) {\n            setUid(uid);\n        }\n\n        dispatch(setCompareList(createCompareList));\n    }\n\n    async assignCompareList(dispatch) {\n        const uid = getUid();\n        if (!uid) {\n            await this.fetchCustomersList(dispatch);\n\n            return false;\n        }\n\n        removeUid();\n\n        try {\n            const {\n                assignCompareListToCustomer: {\n                    result,\n                    compare_list,\n                    compare_list: {\n                        uid: newUid\n                    }\n                }\n            } = await fetchMutation(\n                ProductCompareQuery.getAssignCompareList(uid)\n            );\n\n            if (result) {\n                setUid(newUid);\n                dispatch(setCompareList(compare_list));\n            }\n\n            return result;\n        } catch (error) {\n            dispatch(toggleLoader(false));\n\n            return false;\n        }\n    }\n\n    async clearComparedProducts(dispatch) {\n        const uid = getUid();\n        if (!uid) {\n            return false;\n        }\n\n        dispatch(toggleLoader(true));\n\n        try {\n            const result = await fetchMutation(\n                ProductCompareQuery.getDeleteCompareList(uid)\n            );\n\n            removeUid();\n            dispatch(clearComparedProducts());\n            dispatch(showNotification('success', __('Compare list is cleared')));\n            dispatch(toggleLoader(false));\n\n            return result;\n        } catch (error) {\n            dispatch(toggleLoader(false));\n            dispatch(showNotification('error', __('Unable to clear product compare list'), error));\n            return false;\n        }\n    }\n\n    resetComparedProducts(dispatch) {\n        dispatch(clearComparedProducts());\n    }\n}\n\nexport default new ProductCompareDispatcher();\n"]},"metadata":{},"sourceType":"module"}