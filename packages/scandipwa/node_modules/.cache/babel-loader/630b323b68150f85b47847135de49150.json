{"ast":null,"code":"import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{showNotification as _showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import{ProductType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/ProductList\";import{isSignedIn}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";import{BUNDLE,CONFIGURABLE,DOWNLOADABLE,getExtensionAttributes,GROUPED}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";import ProductWishlistButton from\"./ProductWishlistButton.component\";import{ERROR_CONFIGURABLE_NOT_PROVIDED}from\"./ProductWishlistButton.config\";export var WishlistDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Wishlist/Wishlist.dispatcher\");/** @namespace Component/ProductWishlistButton/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{productsInWishlist:state.WishlistReducer.productsInWishlist,isAddingWishlistItem:state.WishlistReducer.isLoading};},\"Component/ProductWishlistButton/Container/mapStateToProps\");/** @namespace Component/ProductWishlistButton/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{addProductToWishlist:function addProductToWishlist(wishlistItem){return WishlistDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.addItemToWishlist(dispatch,wishlistItem);});},removeProductFromWishlist:function removeProductFromWishlist(options){return WishlistDispatcher.then(function(_ref2){var dispatcher=_ref2.default;return dispatcher.removeItemFromWishlist(dispatch,options);});},showNotification:function showNotification(type,message){return dispatch(_showNotification(type,message));}};},\"Component/ProductWishlistButton/Container/mapDispatchToProps\");/** @namespace Component/ProductWishlistButton/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _ProductWishlistButtonContainer=/*#__PURE__*/function(_Extensible){_inherits(_ProductWishlistButtonContainer,_Extensible);var _super=_createSuper(_ProductWishlistButtonContainer);function _ProductWishlistButtonContainer(){var _this;_classCallCheck(this,_ProductWishlistButtonContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isWishlistButtonLoading:false};_this.containerProps=function(){return{isDisabled:_this.isDisabled(),isInWishlist:_this.isInWishlist(),isReady:_this._getIsProductReady(),isSignedIn:isSignedIn()};};_this.containerFunctions=function(){return{addToWishlist:_this.toggleProductInWishlist.bind(_assertThisInitialized(_this),true),removeFromWishlist:_this.toggleProductInWishlist.bind(_assertThisInitialized(_this),false)};};_this.toggleProductInWishlist=function(){var add=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var _this$props=_this.props,_this$props$product=_this$props.product,sku=_this$props$product.sku,type_id=_this$props$product.type_id,quantity=_this$props.quantity,isAddingWishlistItem=_this$props.isAddingWishlistItem,showNotification=_this$props.showNotification,productsInWishlist=_this$props.productsInWishlist,addProductToWishlist=_this$props.addProductToWishlist,onProductValidationError=_this$props.onProductValidationError,removeProductFromWishlist=_this$props.removeProductFromWishlist;if(!isSignedIn()){return showNotification('info',__('You must login or register to add items to your wishlist.'));}if(isAddingWishlistItem){return null;}var product=_this._getProductVariant();if(product===ERROR_CONFIGURABLE_NOT_PROVIDED){onProductValidationError(type_id);return showNotification('info',__('Please, select desirable option first!'));}_this.setWishlistButtonLoading(true);var variantSku=product.sku,product_option=product.product_option;if(add){return addProductToWishlist({sku:sku,product_option:product_option,quantity:quantity});}var _Object$values$find=Object.values(productsInWishlist).find(function(_ref3){var sku=_ref3.wishlist.sku;return sku===variantSku;}),item_id=_Object$values$find.wishlist.id;return removeProductFromWishlist({item_id:item_id,sku:variantSku});};_this.isDisabled=function(){var isAddingWishlistItem=_this.props.isAddingWishlistItem;var product=_this._getProductVariant();if(product===ERROR_CONFIGURABLE_NOT_PROVIDED){return true;}return isAddingWishlistItem||!isSignedIn();};_this.isInWishlist=function(){var productsInWishlist=_this.props.productsInWishlist;var product=_this._getProductVariant();if(product===ERROR_CONFIGURABLE_NOT_PROVIDED){return false;}var productSku=product.sku;return Object.values(productsInWishlist).findIndex(function(_ref4){var sku=_ref4.wishlist.sku;return sku===productSku;})>=0;};return _this;}_createClass(_ProductWishlistButtonContainer,[{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var isPrevAddingWishlistItem=prevProps.isAddingWishlistItem;var isAddingWishlistItem=this.props.isAddingWishlistItem;if(isPrevAddingWishlistItem&&!isAddingWishlistItem){this.setWishlistButtonLoading(false);}}},{key:\"setWishlistButtonLoading\",value:function setWishlistButtonLoading(isLoading){return this.setState({isWishlistButtonLoading:isLoading});}},{key:\"_getIsProductReady\",value:function _getIsProductReady(){var _this$props2=this.props,type_id=_this$props2.product.type_id,configurableVariantIndex=_this$props2.configurableVariantIndex;if(type_id===CONFIGURABLE&&configurableVariantIndex<0){return false;}return true;}},{key:\"_getProductVariant\",value:function _getProductVariant(){var _this$props3=this.props,product=_this$props3.product,type_id=_this$props3.product.type_id,configurableVariantIndex=_this$props3.configurableVariantIndex;if(type_id===CONFIGURABLE){if(configurableVariantIndex<0){return ERROR_CONFIGURABLE_NOT_PROVIDED;}var extension_attributes=getExtensionAttributes(_objectSpread(_objectSpread({},product),{},{configurableVariantIndex:configurableVariantIndex}));var variant=product.variants[configurableVariantIndex];return _objectSpread(_objectSpread({},variant),{},{product_option:{extension_attributes:extension_attributes}});}if(type_id===GROUPED){var _this$props$groupedPr=this.props.groupedProductQuantity,groupedProductQuantity=_this$props$groupedPr===void 0?{}:_this$props$groupedPr;var grouped_product_options=Object.entries(groupedProductQuantity).map(function(option){return{option_id:option[0],option_value:option[1]};});return _objectSpread(_objectSpread({},product),{},{product_option:{extension_attributes:{grouped_product_options:grouped_product_options}}});}if(type_id===BUNDLE){var productOptions=this.props.productOptionsData.productOptions;var _extension_attributes=getExtensionAttributes(_objectSpread(_objectSpread({},product),{},{productOptions:productOptions}));return _objectSpread(_objectSpread({},product),{},{product_option:{extension_attributes:_extension_attributes}});}if(type_id===DOWNLOADABLE){var downloadableLinks=this.props.productOptionsData.downloadableLinks;var _extension_attributes2=getExtensionAttributes(_objectSpread(_objectSpread({},product),{},{downloadableLinks:downloadableLinks}));return _objectSpread(_objectSpread({},product),{},{product_option:{extension_attributes:_extension_attributes2}});}return product;}},{key:\"render\",value:function render(){var isWishlistButtonLoading=this.state.isWishlistButtonLoading;return/*#__PURE__*/_checkBEM(React,ProductWishlistButton,Object.assign({isLoading:isWishlistButtonLoading},this.props,this.containerProps(),this.containerFunctions()));}}]);return _ProductWishlistButtonContainer;}(Extensible(PureComponent));_ProductWishlistButtonContainer.defaultProps={quantity:1,onProductValidationError:function onProductValidationError(){},configurableVariantIndex:-2,productOptionsData:{}};Object.defineProperty(_ProductWishlistButtonContainer,'name',{value:'ProductWishlistButtonContainer'});export var ProductWishlistButtonContainer=middleware(_ProductWishlistButtonContainer,\"Component/ProductWishlistButton/Container\");export default connect(mapStateToProps,mapDispatchToProps)(ProductWishlistButtonContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductWishlistButton/ProductWishlistButton.container.js"],"names":["PureComponent","connect","showNotification","ProductType","isSignedIn","BUNDLE","CONFIGURABLE","DOWNLOADABLE","getExtensionAttributes","GROUPED","ProductWishlistButton","ERROR_CONFIGURABLE_NOT_PROVIDED","WishlistDispatcher","mapStateToProps","state","productsInWishlist","WishlistReducer","isAddingWishlistItem","isLoading","mapDispatchToProps","dispatch","addProductToWishlist","wishlistItem","then","dispatcher","default","addItemToWishlist","removeProductFromWishlist","options","removeItemFromWishlist","type","message","ProductWishlistButtonContainer","isWishlistButtonLoading","containerProps","isDisabled","isInWishlist","isReady","_getIsProductReady","containerFunctions","addToWishlist","toggleProductInWishlist","bind","removeFromWishlist","add","props","product","sku","type_id","quantity","onProductValidationError","__","_getProductVariant","setWishlistButtonLoading","variantSku","product_option","Object","values","find","wishlist","item_id","id","productSku","findIndex","prevProps","isPrevAddingWishlistItem","setState","configurableVariantIndex","extension_attributes","variant","variants","groupedProductQuantity","grouped_product_options","entries","map","option","option_id","option_value","productOptions","productOptionsData","downloadableLinks","defaultProps","defineProperty","_ProductWishlistButtonContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { ProductType } from 'Type/ProductList';\nimport { isSignedIn } from 'Util/Auth';\nimport {\n    BUNDLE,\n    CONFIGURABLE,\n    DOWNLOADABLE,\n    getExtensionAttributes,\n    GROUPED\n} from 'Util/Product';\n\nimport ProductWishlistButton from './ProductWishlistButton.component';\nimport { ERROR_CONFIGURABLE_NOT_PROVIDED } from './ProductWishlistButton.config';\n\nexport const WishlistDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Wishlist/Wishlist.dispatcher'\n);\n\n/** @namespace Component/ProductWishlistButton/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    productsInWishlist: state.WishlistReducer.productsInWishlist,\n    isAddingWishlistItem: state.WishlistReducer.isLoading\n});\n\n/** @namespace Component/ProductWishlistButton/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    addProductToWishlist: (wishlistItem) => WishlistDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.addItemToWishlist(dispatch, wishlistItem)\n    ),\n    removeProductFromWishlist: (options) => WishlistDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.removeItemFromWishlist(dispatch, options)\n    ),\n    showNotification: (type, message) => dispatch(showNotification(type, message))\n});\n\n/** @namespace Component/ProductWishlistButton/Container */\nexport class ProductWishlistButtonContainer extends PureComponent {\n    static propTypes = {\n        quantity: PropTypes.number,\n        product: ProductType.isRequired,\n        isAddingWishlistItem: PropTypes.bool.isRequired,\n        configurableVariantIndex: PropTypes.number,\n        showNotification: PropTypes.func.isRequired,\n        productsInWishlist: PropTypes.objectOf(ProductType).isRequired,\n        addProductToWishlist: PropTypes.func.isRequired,\n        onProductValidationError: PropTypes.func,\n        removeProductFromWishlist: PropTypes.func.isRequired,\n        productOptionsData: PropTypes.object,\n        groupedProductQuantity: PropTypes.objectOf(PropTypes.number).isRequired\n    };\n\n    static defaultProps = {\n        quantity: 1,\n        onProductValidationError: () => {},\n        configurableVariantIndex: -2,\n        productOptionsData: {}\n    };\n\n    state = {\n        isWishlistButtonLoading: false\n    };\n\n    componentDidUpdate(prevProps) {\n        const { isAddingWishlistItem: isPrevAddingWishlistItem } = prevProps;\n        const { isAddingWishlistItem } = this.props;\n\n        if (isPrevAddingWishlistItem && !isAddingWishlistItem) {\n            this.setWishlistButtonLoading(false);\n        }\n    }\n\n    containerProps = () => ({\n        isDisabled: this.isDisabled(),\n        isInWishlist: this.isInWishlist(),\n        isReady: this._getIsProductReady(),\n        isSignedIn: isSignedIn()\n    });\n\n    containerFunctions = () => ({\n        addToWishlist: this.toggleProductInWishlist.bind(this, true),\n        removeFromWishlist: this.toggleProductInWishlist.bind(this, false)\n    });\n\n    setWishlistButtonLoading(isLoading) {\n        return this.setState({ isWishlistButtonLoading: isLoading });\n    }\n\n    toggleProductInWishlist = (add = true) => {\n        const {\n            product: { sku, type_id },\n            quantity,\n            isAddingWishlistItem,\n            showNotification,\n            productsInWishlist,\n            addProductToWishlist,\n            onProductValidationError,\n            removeProductFromWishlist\n        } = this.props;\n\n        if (!isSignedIn()) {\n            return showNotification('info', __('You must login or register to add items to your wishlist.'));\n        }\n\n        if (isAddingWishlistItem) {\n            return null;\n        }\n\n        const product = this._getProductVariant();\n        if (product === ERROR_CONFIGURABLE_NOT_PROVIDED) {\n            onProductValidationError(type_id);\n            return showNotification('info', __('Please, select desirable option first!'));\n        }\n\n        this.setWishlistButtonLoading(true);\n\n        const { sku: variantSku, product_option } = product;\n        if (add) {\n            return addProductToWishlist({ sku, product_option, quantity });\n        }\n\n        const { wishlist: { id: item_id } } = Object.values(productsInWishlist).find(\n            ({ wishlist: { sku } }) => sku === variantSku\n        );\n\n        return removeProductFromWishlist({ item_id, sku: variantSku });\n    };\n\n    isDisabled = () => {\n        const { isAddingWishlistItem } = this.props;\n        const product = this._getProductVariant();\n\n        if (product === ERROR_CONFIGURABLE_NOT_PROVIDED) {\n            return true;\n        }\n\n        return isAddingWishlistItem || !isSignedIn();\n    };\n\n    isInWishlist = () => {\n        const { productsInWishlist } = this.props;\n        const product = this._getProductVariant();\n\n        if (product === ERROR_CONFIGURABLE_NOT_PROVIDED) {\n            return false;\n        }\n\n        const { sku: productSku } = product;\n        return Object.values(productsInWishlist).findIndex(({ wishlist: { sku } }) => sku === productSku) >= 0;\n    };\n\n    _getIsProductReady() {\n        const { product: { type_id }, configurableVariantIndex } = this.props;\n\n        if (type_id === CONFIGURABLE && configurableVariantIndex < 0) {\n            return false;\n        }\n\n        return true;\n    }\n\n    _getProductVariant() {\n        const {\n            product,\n            product: { type_id },\n            configurableVariantIndex\n        } = this.props;\n\n        if (type_id === CONFIGURABLE) {\n            if (configurableVariantIndex < 0) {\n                return ERROR_CONFIGURABLE_NOT_PROVIDED;\n            }\n\n            const extension_attributes = getExtensionAttributes({ ...product, configurableVariantIndex });\n            const variant = product.variants[configurableVariantIndex];\n\n            return { ...variant, product_option: { extension_attributes } };\n        }\n\n        if (type_id === GROUPED) {\n            const {\n                groupedProductQuantity = {}\n            } = this.props;\n\n            const grouped_product_options = Object.entries(groupedProductQuantity).map((option) => ({\n                option_id: option[0],\n                option_value: option[1]\n            }));\n\n            return { ...product, product_option: { extension_attributes: { grouped_product_options } } };\n        }\n\n        if (type_id === BUNDLE) {\n            const {\n                productOptionsData: {\n                    productOptions\n                }\n            } = this.props;\n\n            const extension_attributes = getExtensionAttributes({ ...product, productOptions });\n            return { ...product, product_option: { extension_attributes } };\n        }\n\n        if (type_id === DOWNLOADABLE) {\n            const {\n                productOptionsData: {\n                    downloadableLinks\n                }\n            } = this.props;\n\n            const extension_attributes = getExtensionAttributes({ ...product, downloadableLinks });\n            return { ...product, product_option: { extension_attributes } };\n        }\n\n        return product;\n    }\n\n    render() {\n        const { isWishlistButtonLoading } = this.state;\n\n        return (\n            <ProductWishlistButton\n              isLoading={ isWishlistButtonLoading }\n              { ...this.props }\n              { ...this.containerProps() }\n              { ...this.containerFunctions() }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ProductWishlistButtonContainer);\n"]},"metadata":{},"sourceType":"module"}