{"ast":null,"code":"var _jsxFileName = \"/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductWishlistButton/ProductWishlistButton.container.js\";\n\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { showNotification } from \"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";\nimport { ProductType } from \"/home/marketihor/scandipwa/packages/scandipwa/src/type/ProductList\";\nimport { isSignedIn } from \"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";\nimport { BUNDLE, CONFIGURABLE, DOWNLOADABLE, getExtensionAttributes, GROUPED } from \"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";\nimport ProductWishlistButton from \"./ProductWishlistButton.component\";\nimport { ERROR_CONFIGURABLE_NOT_PROVIDED } from \"./ProductWishlistButton.config\";\nexport const WishlistDispatcher = import(\n/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Wishlist/Wishlist.dispatcher\");\n/** @namespace Component/ProductWishlistButton/Container/mapStateToProps */\n\nexport const mapStateToProps = middleware(function (state) {\n  return {\n    productsInWishlist: state.WishlistReducer.productsInWishlist,\n    isAddingWishlistItem: state.WishlistReducer.isLoading\n  };\n}, \"Component/ProductWishlistButton/Container/mapStateToProps\");\n/** @namespace Component/ProductWishlistButton/Container/mapDispatchToProps */\n\nexport const mapDispatchToProps = middleware(function (dispatch) {\n  return {\n    addProductToWishlist: function (wishlistItem) {\n      return WishlistDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.addItemToWishlist(dispatch, wishlistItem);\n      });\n    },\n    removeProductFromWishlist: function (options) {\n      return WishlistDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.removeItemFromWishlist(dispatch, options);\n      });\n    },\n    showNotification: function (type, message) {\n      return dispatch(showNotification(type, message));\n    }\n  };\n}, \"Component/ProductWishlistButton/Container/mapDispatchToProps\");\n/** @namespace Component/ProductWishlistButton/Container */\n\nvar _checkBEM = require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;\n\nexport class _ProductWishlistButtonContainer extends Extensible(PureComponent) {\n  constructor(...args) {\n    var _this;\n\n    super(...args);\n    _this = this;\n    this.state = {\n      isWishlistButtonLoading: false\n    };\n\n    this.containerProps = function () {\n      return {\n        isDisabled: _this.isDisabled(),\n        isInWishlist: _this.isInWishlist(),\n        isReady: _this._getIsProductReady(),\n        isSignedIn: isSignedIn()\n      };\n    };\n\n    this.containerFunctions = function () {\n      return {\n        addToWishlist: _this.toggleProductInWishlist.bind(_this, true),\n        removeFromWishlist: _this.toggleProductInWishlist.bind(_this, false)\n      };\n    };\n\n    this.toggleProductInWishlist = function (add = true) {\n      const {\n        product: {\n          sku,\n          type_id\n        },\n        quantity,\n        isAddingWishlistItem,\n        showNotification,\n        productsInWishlist,\n        addProductToWishlist,\n        onProductValidationError,\n        removeProductFromWishlist\n      } = _this.props;\n\n      if (!isSignedIn()) {\n        return showNotification('info', __('You must login or register to add items to your wishlist.'));\n      }\n\n      if (isAddingWishlistItem) {\n        return null;\n      }\n\n      const product = _this._getProductVariant();\n\n      if (product === ERROR_CONFIGURABLE_NOT_PROVIDED) {\n        onProductValidationError(type_id);\n        return showNotification('info', __('Please, select desirable option first!'));\n      }\n\n      _this.setWishlistButtonLoading(true);\n\n      const {\n        sku: variantSku,\n        product_option\n      } = product;\n\n      if (add) {\n        return addProductToWishlist({\n          sku,\n          product_option,\n          quantity\n        });\n      }\n\n      const {\n        wishlist: {\n          id: item_id\n        }\n      } = Object.values(productsInWishlist).find(function ({\n        wishlist: {\n          sku\n        }\n      }) {\n        return sku === variantSku;\n      });\n      return removeProductFromWishlist({\n        item_id,\n        sku: variantSku\n      });\n    };\n\n    this.isDisabled = function () {\n      const {\n        isAddingWishlistItem\n      } = _this.props;\n\n      const product = _this._getProductVariant();\n\n      if (product === ERROR_CONFIGURABLE_NOT_PROVIDED) {\n        return true;\n      }\n\n      return isAddingWishlistItem || !isSignedIn();\n    };\n\n    this.isInWishlist = function () {\n      const {\n        productsInWishlist\n      } = _this.props;\n\n      const product = _this._getProductVariant();\n\n      if (product === ERROR_CONFIGURABLE_NOT_PROVIDED) {\n        return false;\n      }\n\n      const {\n        sku: productSku\n      } = product;\n      return Object.values(productsInWishlist).findIndex(function ({\n        wishlist: {\n          sku\n        }\n      }) {\n        return sku === productSku;\n      }) >= 0;\n    };\n  }\n\n  componentDidUpdate(prevProps) {\n    const {\n      isAddingWishlistItem: isPrevAddingWishlistItem\n    } = prevProps;\n    const {\n      isAddingWishlistItem\n    } = this.props;\n\n    if (isPrevAddingWishlistItem && !isAddingWishlistItem) {\n      this.setWishlistButtonLoading(false);\n    }\n  }\n\n  setWishlistButtonLoading(isLoading) {\n    return this.setState({\n      isWishlistButtonLoading: isLoading\n    });\n  }\n\n  _getIsProductReady() {\n    const {\n      product: {\n        type_id\n      },\n      configurableVariantIndex\n    } = this.props;\n\n    if (type_id === CONFIGURABLE && configurableVariantIndex < 0) {\n      return false;\n    }\n\n    return true;\n  }\n\n  _getProductVariant() {\n    const {\n      product,\n      product: {\n        type_id\n      },\n      configurableVariantIndex\n    } = this.props;\n\n    if (type_id === CONFIGURABLE) {\n      if (configurableVariantIndex < 0) {\n        return ERROR_CONFIGURABLE_NOT_PROVIDED;\n      }\n\n      const extension_attributes = getExtensionAttributes({ ...product,\n        configurableVariantIndex\n      });\n      const variant = product.variants[configurableVariantIndex];\n      return { ...variant,\n        product_option: {\n          extension_attributes\n        }\n      };\n    }\n\n    if (type_id === GROUPED) {\n      const {\n        groupedProductQuantity = {}\n      } = this.props;\n      const grouped_product_options = Object.entries(groupedProductQuantity).map(function (option) {\n        return {\n          option_id: option[0],\n          option_value: option[1]\n        };\n      });\n      return { ...product,\n        product_option: {\n          extension_attributes: {\n            grouped_product_options\n          }\n        }\n      };\n    }\n\n    if (type_id === BUNDLE) {\n      const {\n        productOptionsData: {\n          productOptions\n        }\n      } = this.props;\n      const extension_attributes = getExtensionAttributes({ ...product,\n        productOptions\n      });\n      return { ...product,\n        product_option: {\n          extension_attributes\n        }\n      };\n    }\n\n    if (type_id === DOWNLOADABLE) {\n      const {\n        productOptionsData: {\n          downloadableLinks\n        }\n      } = this.props;\n      const extension_attributes = getExtensionAttributes({ ...product,\n        downloadableLinks\n      });\n      return { ...product,\n        product_option: {\n          extension_attributes\n        }\n      };\n    }\n\n    return product;\n  }\n\n  render() {\n    const {\n      isWishlistButtonLoading\n    } = this.state;\n    return /*#__PURE__*/_checkBEM(React, ProductWishlistButton, Object.assign({\n      isLoading: isWishlistButtonLoading\n    }, this.props, this.containerProps(), this.containerFunctions(), {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 13\n      }\n    }));\n  }\n\n}\n_ProductWishlistButtonContainer.propTypes = {\n  quantity: PropTypes.number,\n  product: ProductType.isRequired,\n  isAddingWishlistItem: PropTypes.bool.isRequired,\n  configurableVariantIndex: PropTypes.number,\n  showNotification: PropTypes.func.isRequired,\n  productsInWishlist: PropTypes.objectOf(ProductType).isRequired,\n  addProductToWishlist: PropTypes.func.isRequired,\n  onProductValidationError: PropTypes.func,\n  removeProductFromWishlist: PropTypes.func.isRequired,\n  productOptionsData: PropTypes.object,\n  groupedProductQuantity: PropTypes.objectOf(PropTypes.number).isRequired\n};\n_ProductWishlistButtonContainer.defaultProps = {\n  quantity: 1,\n  onProductValidationError: function () {},\n  configurableVariantIndex: -2,\n  productOptionsData: {}\n};\nObject.defineProperty(_ProductWishlistButtonContainer, 'name', {\n  value: 'ProductWishlistButtonContainer'\n});\n\nexport const ProductWishlistButtonContainer = middleware(_ProductWishlistButtonContainer, \"Component/ProductWishlistButton/Container\");\nexport default connect(mapStateToProps, mapDispatchToProps)(ProductWishlistButtonContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductWishlistButton/ProductWishlistButton.container.js"],"names":["PropTypes","PureComponent","connect","showNotification","ProductType","isSignedIn","BUNDLE","CONFIGURABLE","DOWNLOADABLE","getExtensionAttributes","GROUPED","ProductWishlistButton","ERROR_CONFIGURABLE_NOT_PROVIDED","WishlistDispatcher","mapStateToProps","state","productsInWishlist","WishlistReducer","isAddingWishlistItem","isLoading","mapDispatchToProps","dispatch","addProductToWishlist","wishlistItem","then","default","dispatcher","addItemToWishlist","removeProductFromWishlist","options","removeItemFromWishlist","type","message","ProductWishlistButtonContainer","isWishlistButtonLoading","containerProps","isDisabled","isInWishlist","isReady","_getIsProductReady","containerFunctions","addToWishlist","toggleProductInWishlist","bind","removeFromWishlist","add","product","sku","type_id","quantity","onProductValidationError","props","__","_getProductVariant","setWishlistButtonLoading","variantSku","product_option","wishlist","id","item_id","Object","values","find","productSku","findIndex","componentDidUpdate","prevProps","isPrevAddingWishlistItem","setState","configurableVariantIndex","extension_attributes","variant","variants","groupedProductQuantity","grouped_product_options","entries","map","option","option_id","option_value","productOptionsData","productOptions","downloadableLinks","render","propTypes","number","isRequired","bool","func","objectOf","object","defaultProps","defineProperty","_ProductWishlistButtonContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { ProductType } from 'Type/ProductList';\nimport { isSignedIn } from 'Util/Auth';\nimport {\n    BUNDLE,\n    CONFIGURABLE,\n    DOWNLOADABLE,\n    getExtensionAttributes,\n    GROUPED\n} from 'Util/Product';\n\nimport ProductWishlistButton from './ProductWishlistButton.component';\nimport { ERROR_CONFIGURABLE_NOT_PROVIDED } from './ProductWishlistButton.config';\n\nexport const WishlistDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Wishlist/Wishlist.dispatcher'\n);\n\n/** @namespace Component/ProductWishlistButton/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    productsInWishlist: state.WishlistReducer.productsInWishlist,\n    isAddingWishlistItem: state.WishlistReducer.isLoading\n});\n\n/** @namespace Component/ProductWishlistButton/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    addProductToWishlist: (wishlistItem) => WishlistDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.addItemToWishlist(dispatch, wishlistItem)\n    ),\n    removeProductFromWishlist: (options) => WishlistDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.removeItemFromWishlist(dispatch, options)\n    ),\n    showNotification: (type, message) => dispatch(showNotification(type, message))\n});\n\n/** @namespace Component/ProductWishlistButton/Container */\nexport class ProductWishlistButtonContainer extends PureComponent {\n    static propTypes = {\n        quantity: PropTypes.number,\n        product: ProductType.isRequired,\n        isAddingWishlistItem: PropTypes.bool.isRequired,\n        configurableVariantIndex: PropTypes.number,\n        showNotification: PropTypes.func.isRequired,\n        productsInWishlist: PropTypes.objectOf(ProductType).isRequired,\n        addProductToWishlist: PropTypes.func.isRequired,\n        onProductValidationError: PropTypes.func,\n        removeProductFromWishlist: PropTypes.func.isRequired,\n        productOptionsData: PropTypes.object,\n        groupedProductQuantity: PropTypes.objectOf(PropTypes.number).isRequired\n    };\n\n    static defaultProps = {\n        quantity: 1,\n        onProductValidationError: () => {},\n        configurableVariantIndex: -2,\n        productOptionsData: {}\n    };\n\n    state = {\n        isWishlistButtonLoading: false\n    };\n\n    componentDidUpdate(prevProps) {\n        const { isAddingWishlistItem: isPrevAddingWishlistItem } = prevProps;\n        const { isAddingWishlistItem } = this.props;\n\n        if (isPrevAddingWishlistItem && !isAddingWishlistItem) {\n            this.setWishlistButtonLoading(false);\n        }\n    }\n\n    containerProps = () => ({\n        isDisabled: this.isDisabled(),\n        isInWishlist: this.isInWishlist(),\n        isReady: this._getIsProductReady(),\n        isSignedIn: isSignedIn()\n    });\n\n    containerFunctions = () => ({\n        addToWishlist: this.toggleProductInWishlist.bind(this, true),\n        removeFromWishlist: this.toggleProductInWishlist.bind(this, false)\n    });\n\n    setWishlistButtonLoading(isLoading) {\n        return this.setState({ isWishlistButtonLoading: isLoading });\n    }\n\n    toggleProductInWishlist = (add = true) => {\n        const {\n            product: { sku, type_id },\n            quantity,\n            isAddingWishlistItem,\n            showNotification,\n            productsInWishlist,\n            addProductToWishlist,\n            onProductValidationError,\n            removeProductFromWishlist\n        } = this.props;\n\n        if (!isSignedIn()) {\n            return showNotification('info', __('You must login or register to add items to your wishlist.'));\n        }\n\n        if (isAddingWishlistItem) {\n            return null;\n        }\n\n        const product = this._getProductVariant();\n        if (product === ERROR_CONFIGURABLE_NOT_PROVIDED) {\n            onProductValidationError(type_id);\n            return showNotification('info', __('Please, select desirable option first!'));\n        }\n\n        this.setWishlistButtonLoading(true);\n\n        const { sku: variantSku, product_option } = product;\n        if (add) {\n            return addProductToWishlist({ sku, product_option, quantity });\n        }\n\n        const { wishlist: { id: item_id } } = Object.values(productsInWishlist).find(\n            ({ wishlist: { sku } }) => sku === variantSku\n        );\n\n        return removeProductFromWishlist({ item_id, sku: variantSku });\n    };\n\n    isDisabled = () => {\n        const { isAddingWishlistItem } = this.props;\n        const product = this._getProductVariant();\n\n        if (product === ERROR_CONFIGURABLE_NOT_PROVIDED) {\n            return true;\n        }\n\n        return isAddingWishlistItem || !isSignedIn();\n    };\n\n    isInWishlist = () => {\n        const { productsInWishlist } = this.props;\n        const product = this._getProductVariant();\n\n        if (product === ERROR_CONFIGURABLE_NOT_PROVIDED) {\n            return false;\n        }\n\n        const { sku: productSku } = product;\n        return Object.values(productsInWishlist).findIndex(({ wishlist: { sku } }) => sku === productSku) >= 0;\n    };\n\n    _getIsProductReady() {\n        const { product: { type_id }, configurableVariantIndex } = this.props;\n\n        if (type_id === CONFIGURABLE && configurableVariantIndex < 0) {\n            return false;\n        }\n\n        return true;\n    }\n\n    _getProductVariant() {\n        const {\n            product,\n            product: { type_id },\n            configurableVariantIndex\n        } = this.props;\n\n        if (type_id === CONFIGURABLE) {\n            if (configurableVariantIndex < 0) {\n                return ERROR_CONFIGURABLE_NOT_PROVIDED;\n            }\n\n            const extension_attributes = getExtensionAttributes({ ...product, configurableVariantIndex });\n            const variant = product.variants[configurableVariantIndex];\n\n            return { ...variant, product_option: { extension_attributes } };\n        }\n\n        if (type_id === GROUPED) {\n            const {\n                groupedProductQuantity = {}\n            } = this.props;\n\n            const grouped_product_options = Object.entries(groupedProductQuantity).map((option) => ({\n                option_id: option[0],\n                option_value: option[1]\n            }));\n\n            return { ...product, product_option: { extension_attributes: { grouped_product_options } } };\n        }\n\n        if (type_id === BUNDLE) {\n            const {\n                productOptionsData: {\n                    productOptions\n                }\n            } = this.props;\n\n            const extension_attributes = getExtensionAttributes({ ...product, productOptions });\n            return { ...product, product_option: { extension_attributes } };\n        }\n\n        if (type_id === DOWNLOADABLE) {\n            const {\n                productOptionsData: {\n                    downloadableLinks\n                }\n            } = this.props;\n\n            const extension_attributes = getExtensionAttributes({ ...product, downloadableLinks });\n            return { ...product, product_option: { extension_attributes } };\n        }\n\n        return product;\n    }\n\n    render() {\n        const { isWishlistButtonLoading } = this.state;\n\n        return (\n            <ProductWishlistButton\n              isLoading={ isWishlistButtonLoading }\n              { ...this.props }\n              { ...this.containerProps() }\n              { ...this.containerFunctions() }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ProductWishlistButtonContainer);\n"]},"metadata":{},"sourceType":"module"}