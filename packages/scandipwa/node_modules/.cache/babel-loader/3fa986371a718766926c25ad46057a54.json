{"ast":null,"code":"import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{customerType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Account\";import{isSignedIn}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";import CheckoutAddressBook from\"./CheckoutAddressBook.component\";export var MyAccountDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/MyAccount/MyAccount.dispatcher\");/** @namespace Component/CheckoutAddressBook/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{customer:state.MyAccountReducer.customer};},\"Component/CheckoutAddressBook/Container/mapStateToProps\");/** @namespace Component/CheckoutAddressBook/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{requestCustomerData:function requestCustomerData(){return MyAccountDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.requestCustomerData(dispatch);});}};},\"Component/CheckoutAddressBook/Container/mapDispatchToProps\");/** @namespace Component/CheckoutAddressBook/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _CheckoutAddressBookContainer=/*#__PURE__*/function(_Extensible){_inherits(_CheckoutAddressBookContainer,_Extensible);var _super=_createSuper(_CheckoutAddressBookContainer);function _CheckoutAddressBookContainer(){var _this;_classCallCheck(this,_CheckoutAddressBookContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={onAddressSelect:_this.onAddressSelect.bind(_assertThisInitialized(_this))};return _this;}_createClass(_CheckoutAddressBookContainer,[{key:\"__construct\",value:function __construct(props){_get(_getPrototypeOf(_CheckoutAddressBookContainer.prototype),\"__construct\",this).call(this,props);var requestCustomerData=props.requestCustomerData,customer=props.customer,onAddressSelect=props.onAddressSelect;if(isSignedIn()&&!Object.keys(customer).length){requestCustomerData();}var defaultAddressId=CheckoutAddressBookContainer._getDefaultAddressId(props);if(defaultAddressId){onAddressSelect(defaultAddressId);this.estimateShipping(defaultAddressId);}this.state={prevDefaultAddressId:defaultAddressId,selectedAddressId:defaultAddressId};}},{key:\"componentDidUpdate\",value:function componentDidUpdate(_,prevState){var _this$props=this.props,onAddressSelect=_this$props.onAddressSelect,requestCustomerData=_this$props.requestCustomerData,customer=_this$props.customer;var prevSelectedAddressId=prevState.selectedAddressId;var selectedAddressId=this.state.selectedAddressId;if(isSignedIn()&&!Object.keys(customer).length){requestCustomerData();}if(selectedAddressId!==prevSelectedAddressId){onAddressSelect(selectedAddressId);this.estimateShipping(selectedAddressId);}}},{key:\"onAddressSelect\",value:function onAddressSelect(address){var _address$id=address.id,id=_address$id===void 0?0:_address$id;this.setState({selectedAddressId:id});}},{key:\"estimateShipping\",value:function estimateShipping(addressId){var _this$props2=this.props,onShippingEstimationFieldsChange=_this$props2.onShippingEstimationFieldsChange,_this$props2$customer=_this$props2.customer.addresses,addresses=_this$props2$customer===void 0?[]:_this$props2$customer;var address=addresses.find(function(_ref2){var id=_ref2.id;return id===addressId;});if(!address){return;}var city=address.city,country_id=address.country_id,postcode=address.postcode,_address$region=address.region;_address$region=_address$region===void 0?{}:_address$region;var region_id=_address$region.region_id,region=_address$region.region;if(!country_id){return;}onShippingEstimationFieldsChange({city:city,country_id:country_id,region_id:region_id,region:region,postcode:postcode});}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,CheckoutAddressBook,Object.assign({},this.props,this.state,this.containerFunctions));}}],[{key:\"_getDefaultAddressId\",value:function _getDefaultAddressId(props){var customer=props.customer,isBilling=props.isBilling;var defaultKey=isBilling?'default_billing':'default_shipping';var defaultAddressId=customer[defaultKey],addresses=customer.addresses;if(defaultAddressId){return+defaultAddressId;}if(addresses&&addresses.length){return addresses[0].id;}return 0;}},{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){var prevDefaultAddressId=state.prevDefaultAddressId;var defaultAddressId=CheckoutAddressBookContainer._getDefaultAddressId(props);if(defaultAddressId!==prevDefaultAddressId){return{selectedAddressId:defaultAddressId,prevDefaultAddressId:defaultAddressId};}return null;}}]);return _CheckoutAddressBookContainer;}(Extensible(PureComponent));_CheckoutAddressBookContainer.defaultProps={isBilling:false,onAddressSelect:function onAddressSelect(){},onShippingEstimationFieldsChange:function onShippingEstimationFieldsChange(){}};Object.defineProperty(_CheckoutAddressBookContainer,'name',{value:'CheckoutAddressBookContainer'});export var CheckoutAddressBookContainer=middleware(_CheckoutAddressBookContainer,\"Component/CheckoutAddressBook/Container\");export default connect(mapStateToProps,mapDispatchToProps)(CheckoutAddressBookContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/CheckoutAddressBook/CheckoutAddressBook.container.js"],"names":["PureComponent","connect","customerType","isSignedIn","CheckoutAddressBook","MyAccountDispatcher","mapStateToProps","state","customer","MyAccountReducer","mapDispatchToProps","dispatch","requestCustomerData","then","dispatcher","default","CheckoutAddressBookContainer","containerFunctions","onAddressSelect","bind","props","Object","keys","length","defaultAddressId","_getDefaultAddressId","estimateShipping","prevDefaultAddressId","selectedAddressId","_","prevState","prevSelectedAddressId","address","id","setState","addressId","onShippingEstimationFieldsChange","addresses","find","city","country_id","postcode","region","region_id","isBilling","defaultKey","defaultProps","defineProperty","_CheckoutAddressBookContainer","value"],"mappings":"q+BAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAGA,OAASA,aAAT,KAA8B,OAA9B,CACA,OAASC,OAAT,KAAwB,aAAxB,CAEA,OAASC,YAAT,sEACA,OAASC,UAAT,mEAEA,MAAOC,CAAAA,mBAAP,uCAEA,MAAO,IAAMC,CAAAA,mBAAmB,CAAG,OAC/B,0DAD+B,yFAA5B,CAKP,yEACA,MAAO,IAAMC,CAAAA,eAAe,YAAG,SAACC,KAAD,QAAY,CACvCC,QAAQ,CAAED,KAAK,CAACE,gBAAN,CAAuBD,QADM,CAAZ,EAAH,2DAArB,CAIP,4EACA,MAAO,IAAME,CAAAA,kBAAkB,YAAG,SAACC,QAAD,QAAe,CAC7CC,mBAAmB,CAAE,qCAAMP,CAAAA,mBAAmB,CAACQ,IAApB,CACvB,kBAAYC,CAAAA,UAAZ,MAAGC,OAAH,OAA6BD,CAAAA,UAAU,CAACF,mBAAX,CAA+BD,QAA/B,CAA7B,EADuB,CAAN,EADwB,CAAf,EAAH,8DAAxB,CAMP,yD,wEACA,UAAaK,CAAAA,6BAAb,yZA8BIC,kBA9BJ,CA8B0B,CAClBC,eAAe,CAAE,MAAKA,eAAL,CAAqBC,IAArB,+BADC,CA9B1B,oFAkCI,qBAAYC,KAAZ,CAAmB,CACf,4FAAkBA,KAAlB,EADe,GAIXR,CAAAA,mBAJW,CAOXQ,KAPW,CAIXR,mBAJW,CAKXJ,QALW,CAOXY,KAPW,CAKXZ,QALW,CAMXU,eANW,CAOXE,KAPW,CAMXF,eANW,CASf,GAAIf,UAAU,IAAM,CAACkB,MAAM,CAACC,IAAP,CAAYd,QAAZ,EAAsBe,MAA3C,CAAmD,CAC/CX,mBAAmB,GACtB,CAED,GAAMY,CAAAA,gBAAgB,CAAGR,4BAA4B,CAACS,oBAA7B,CAAkDL,KAAlD,CAAzB,CAEA,GAAII,gBAAJ,CAAsB,CAClBN,eAAe,CAACM,gBAAD,CAAf,CACA,KAAKE,gBAAL,CAAsBF,gBAAtB,EACH,CAED,KAAKjB,KAAL,CAAa,CACToB,oBAAoB,CAAEH,gBADb,CAETI,iBAAiB,CAAEJ,gBAFV,CAAb,CAIH,CA1DL,kCA0EI,4BAAmBK,CAAnB,CAAsBC,SAAtB,CAAiC,iBAKzB,KAAKV,KALoB,CAEzBF,eAFyB,aAEzBA,eAFyB,CAGzBN,mBAHyB,aAGzBA,mBAHyB,CAIzBJ,QAJyB,aAIzBA,QAJyB,IAMFuB,CAAAA,qBANE,CAMwBD,SANxB,CAMrBF,iBANqB,IAOrBA,CAAAA,iBAPqB,CAOC,KAAKrB,KAPN,CAOrBqB,iBAPqB,CAS7B,GAAIzB,UAAU,IAAM,CAACkB,MAAM,CAACC,IAAP,CAAYd,QAAZ,EAAsBe,MAA3C,CAAmD,CAC/CX,mBAAmB,GACtB,CAED,GAAIgB,iBAAiB,GAAKG,qBAA1B,CAAiD,CAC7Cb,eAAe,CAACU,iBAAD,CAAf,CACA,KAAKF,gBAAL,CAAsBE,iBAAtB,EACH,CACJ,CA3FL,+BA6FI,yBAAgBI,OAAhB,CAAyB,iBACFA,OADE,CACbC,EADa,CACbA,EADa,sBACR,CADQ,aAErB,KAAKC,QAAL,CAAc,CAAEN,iBAAiB,CAAEK,EAArB,CAAd,EACH,CAhGL,gCAkGI,0BAAiBE,SAAjB,CAA4B,kBAIpB,KAAKf,KAJe,CAEpBgB,gCAFoB,cAEpBA,gCAFoB,oCAGpB5B,QAHoB,CAGR6B,SAHQ,CAGRA,SAHQ,gCAGI,EAHJ,uBAMxB,GAAML,CAAAA,OAAO,CAAGK,SAAS,CAACC,IAAV,CAAe,mBAAGL,CAAAA,EAAH,OAAGA,EAAH,OAAYA,CAAAA,EAAE,GAAKE,SAAnB,EAAf,CAAhB,CAEA,GAAI,CAACH,OAAL,CAAc,CACV,OACH,CAVuB,GAapBO,CAAAA,IAboB,CAoBpBP,OApBoB,CAapBO,IAboB,CAcpBC,UAdoB,CAoBpBR,OApBoB,CAcpBQ,UAdoB,CAepBC,QAfoB,CAoBpBT,OApBoB,CAepBS,QAfoB,iBAoBpBT,OApBoB,CAgBpBU,MAhBoB,0CAmBhB,EAnBgB,oBAiBhBC,CAAAA,SAjBgB,iBAiBhBA,SAjBgB,CAkBhBD,MAlBgB,iBAkBhBA,MAlBgB,CAsBxB,GAAI,CAACF,UAAL,CAAiB,CACb,OACH,CAEDJ,gCAAgC,CAAC,CAC7BG,IAAI,CAAJA,IAD6B,CAE7BC,UAAU,CAAVA,UAF6B,CAG7BG,SAAS,CAATA,SAH6B,CAI7BD,MAAM,CAANA,MAJ6B,CAK7BD,QAAQ,CAARA,QAL6B,CAAD,CAAhC,CAOH,CAnIL,sBAqII,iBAAS,CACL,mCACK,mBADL,kBAEW,KAAKrB,KAFhB,CAGW,KAAKb,KAHhB,CAIW,KAAKU,kBAJhB,GAOH,CA7IL,sCAeI,8BAA4BG,KAA5B,CAAmC,IACvBZ,CAAAA,QADuB,CACCY,KADD,CACvBZ,QADuB,CACboC,SADa,CACCxB,KADD,CACbwB,SADa,CAE/B,GAAMC,CAAAA,UAAU,CAAGD,SAAS,CAAG,iBAAH,CAAuB,kBAAnD,CAF+B,GAGTpB,CAAAA,gBAHS,CAGuBhB,QAHvB,CAGtBqC,UAHsB,EAGSR,SAHT,CAGuB7B,QAHvB,CAGS6B,SAHT,CAK/B,GAAIb,gBAAJ,CAAsB,CAClB,MAAO,CAACA,gBAAR,CACH,CACD,GAAIa,SAAS,EAAIA,SAAS,CAACd,MAA3B,CAAmC,CAC/B,MAAOc,CAAAA,SAAS,CAAC,CAAD,CAAT,CAAaJ,EAApB,CACH,CAED,MAAO,EAAP,CACH,CA5BL,wCA4DI,kCAAgCb,KAAhC,CAAuCb,KAAvC,CAA8C,IAClCoB,CAAAA,oBADkC,CACTpB,KADS,CAClCoB,oBADkC,CAE1C,GAAMH,CAAAA,gBAAgB,CAAGR,4BAA4B,CAACS,oBAA7B,CAAkDL,KAAlD,CAAzB,CAEA,GAAII,gBAAgB,GAAKG,oBAAzB,CAA+C,CAC3C,MAAO,CACHC,iBAAiB,CAAEJ,gBADhB,CAEHG,oBAAoB,CAAEH,gBAFnB,CAAP,CAIH,CAED,MAAO,KAAP,CACH,CAxEL,sEAAaR,6B,CASF8B,Y,CAAe,CAClBF,SAAS,CAAE,KADO,CAElB1B,eAAe,CAAE,0BAAM,CAAE,CAFP,CAGlBkB,gCAAgC,CAAE,2CAAM,CAAE,CAHxB,C,CA/C1Bf,MAAM,CAAC0B,cAAP,CAAsBC,6BAAtB,CAAqD,MAArD,CAA6D,CAAEC,KAAK,CAAE,8BAAT,CAA7D,E,4HAsLA,cAAehD,CAAAA,OAAO,CAACK,eAAD,CAAkBI,kBAAlB,CAAP,CAA6CM,4BAA7C,CAAf","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { customerType } from 'Type/Account';\nimport { isSignedIn } from 'Util/Auth';\n\nimport CheckoutAddressBook from './CheckoutAddressBook.component';\n\nexport const MyAccountDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/MyAccount/MyAccount.dispatcher'\n);\n\n/** @namespace Component/CheckoutAddressBook/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    customer: state.MyAccountReducer.customer\n});\n\n/** @namespace Component/CheckoutAddressBook/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    requestCustomerData: () => MyAccountDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.requestCustomerData(dispatch)\n    )\n});\n\n/** @namespace Component/CheckoutAddressBook/Container */\nexport class CheckoutAddressBookContainer extends PureComponent {\n    static propTypes = {\n        requestCustomerData: PropTypes.func.isRequired,\n        onShippingEstimationFieldsChange: PropTypes.func,\n        onAddressSelect: PropTypes.func,\n        customer: customerType.isRequired,\n        isBilling: PropTypes.bool\n    };\n\n    static defaultProps = {\n        isBilling: false,\n        onAddressSelect: () => {},\n        onShippingEstimationFieldsChange: () => {}\n    };\n\n    static _getDefaultAddressId(props) {\n        const { customer, isBilling } = props;\n        const defaultKey = isBilling ? 'default_billing' : 'default_shipping';\n        const { [defaultKey]: defaultAddressId, addresses } = customer;\n\n        if (defaultAddressId) {\n            return +defaultAddressId;\n        }\n        if (addresses && addresses.length) {\n            return addresses[0].id;\n        }\n\n        return 0;\n    }\n\n    containerFunctions = ({\n        onAddressSelect: this.onAddressSelect.bind(this)\n    });\n\n    __construct(props) {\n        super.__construct(props);\n\n        const {\n            requestCustomerData,\n            customer,\n            onAddressSelect\n        } = props;\n\n        if (isSignedIn() && !Object.keys(customer).length) {\n            requestCustomerData();\n        }\n\n        const defaultAddressId = CheckoutAddressBookContainer._getDefaultAddressId(props);\n\n        if (defaultAddressId) {\n            onAddressSelect(defaultAddressId);\n            this.estimateShipping(defaultAddressId);\n        }\n\n        this.state = {\n            prevDefaultAddressId: defaultAddressId,\n            selectedAddressId: defaultAddressId\n        };\n    }\n\n    static getDerivedStateFromProps(props, state) {\n        const { prevDefaultAddressId } = state;\n        const defaultAddressId = CheckoutAddressBookContainer._getDefaultAddressId(props);\n\n        if (defaultAddressId !== prevDefaultAddressId) {\n            return {\n                selectedAddressId: defaultAddressId,\n                prevDefaultAddressId: defaultAddressId\n            };\n        }\n\n        return null;\n    }\n\n    componentDidUpdate(_, prevState) {\n        const {\n            onAddressSelect,\n            requestCustomerData,\n            customer\n        } = this.props;\n        const { selectedAddressId: prevSelectedAddressId } = prevState;\n        const { selectedAddressId } = this.state;\n\n        if (isSignedIn() && !Object.keys(customer).length) {\n            requestCustomerData();\n        }\n\n        if (selectedAddressId !== prevSelectedAddressId) {\n            onAddressSelect(selectedAddressId);\n            this.estimateShipping(selectedAddressId);\n        }\n    }\n\n    onAddressSelect(address) {\n        const { id = 0 } = address;\n        this.setState({ selectedAddressId: id });\n    }\n\n    estimateShipping(addressId) {\n        const {\n            onShippingEstimationFieldsChange,\n            customer: { addresses = [] }\n        } = this.props;\n\n        const address = addresses.find(({ id }) => id === addressId);\n\n        if (!address) {\n            return;\n        }\n\n        const {\n            city,\n            country_id,\n            postcode,\n            region: {\n                region_id,\n                region\n            } = {}\n        } = address;\n\n        if (!country_id) {\n            return;\n        }\n\n        onShippingEstimationFieldsChange({\n            city,\n            country_id,\n            region_id,\n            region,\n            postcode\n        });\n    }\n\n    render() {\n        return (\n            <CheckoutAddressBook\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerFunctions }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CheckoutAddressBookContainer);\n"]},"metadata":{},"sourceType":"module"}