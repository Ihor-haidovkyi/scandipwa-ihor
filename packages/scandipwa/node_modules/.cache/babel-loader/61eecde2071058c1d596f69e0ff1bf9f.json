{"ast":null,"code":"import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import ProductListQuery from\"/home/marketihor/scandipwa/packages/scandipwa/src/query/ProductList.query\";import{updateNoMatch}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/NoMatch/NoMatch.action\";import{updateProductDetails}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Product/Product.action\";import{QueryDispatcher}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request\";export var LinkedProductsDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/LinkedProducts/LinkedProducts.dispatcher\");/**\n * Product List Dispatcher\n * @class ProductDispatcher\n * @extends ProductDispatcher\n * @namespace Store/Product/Dispatcher\n */export var _ProductDispatcher=/*#__PURE__*/function(_Extensible){_inherits(_ProductDispatcher,_Extensible);var _super=_createSuper(_ProductDispatcher);function _ProductDispatcher(){_classCallCheck(this,_ProductDispatcher);return _super.apply(this,arguments);}_createClass(_ProductDispatcher,[{key:\"__construct\",value:function __construct(){_get(_getPrototypeOf(_ProductDispatcher.prototype),\"__construct\",this).call(this,'Product');}},{key:\"onSuccess\",value:function onSuccess(data,dispatch){var items=data.products.items;/**\n         * In case there are no items, or item count is\n         * smaller then 0 => the product was not found.\n         */if(!items||items.length<=0){dispatch(updateNoMatch(true));return;}var _items=_slicedToArray(items,1),product=_items[0];var product_links=items.reduce(function(links,product){var product_links=product.product_links;if(product_links){Object.values(product_links).forEach(function(item){links.push(item);});}return links;},[]);LinkedProductsDispatcher.then(function(_ref){var dispatcher=_ref.default;if(product_links.length>0){dispatcher.handleData(dispatch,product_links);}else{dispatcher.clearLinkedProducts(dispatch);}});dispatch(updateProductDetails(product));}},{key:\"onError\",value:function onError(_,dispatch){dispatch(updateNoMatch(true));}},{key:\"prepareRequest\",value:function prepareRequest(options){return ProductListQuery.getQuery(options);}}]);return _ProductDispatcher;}(Extensible(QueryDispatcher));Object.defineProperty(_ProductDispatcher,'name',{value:'ProductDispatcher'});export var ProductDispatcher=middleware(_ProductDispatcher,\"Store/Product/Dispatcher\");export default new ProductDispatcher();","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/store/Product/Product.dispatcher.js"],"names":["ProductListQuery","updateNoMatch","updateProductDetails","QueryDispatcher","LinkedProductsDispatcher","ProductDispatcher","data","dispatch","items","products","length","product","product_links","reduce","links","Object","values","forEach","item","push","then","dispatcher","default","handleData","clearLinkedProducts","_","options","getQuery","defineProperty","_ProductDispatcher","value"],"mappings":"q9BAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAEA,MAAOA,CAAAA,gBAAP,iFACA,OAASC,aAAT,sFACA,OAASC,oBAAT,sFACA,OAASC,eAAT,sEAEA,MAAO,IAAMC,CAAAA,wBAAwB,CAAG,OACpC,0DADoC,mGAAjC,CAKP;AACA;AACA;AACA;AACA;AACA,GACA,UAAaC,CAAAA,kBAAb,gSACI,sBAAc,CACV,iFAAkB,SAAlB,EACH,CAHL,yBAKI,mBAAUC,IAAV,CAAgBC,QAAhB,CAA0B,IACFC,CAAAA,KADE,CACUF,IADV,CACdG,QADc,CACFD,KADE,CAGtB;AACR;AACA;AACA,WACQ,GAAI,CAACA,KAAD,EAAUA,KAAK,CAACE,MAAN,EAAgB,CAA9B,CAAiC,CAC7BH,QAAQ,CAACN,aAAa,CAAC,IAAD,CAAd,CAAR,CACA,OACH,CAVqB,0BAYJO,KAZI,IAYfG,OAZe,WActB,GAAMC,CAAAA,aAAa,CAAGJ,KAAK,CAACK,MAAN,CAAa,SAACC,KAAD,CAAQH,OAAR,CAAoB,IAC3CC,CAAAA,aAD2C,CACzBD,OADyB,CAC3CC,aAD2C,CAGnD,GAAIA,aAAJ,CAAmB,CACfG,MAAM,CAACC,MAAP,CAAcJ,aAAd,EAA6BK,OAA7B,CAAqC,SAACC,IAAD,CAAU,CAC3CJ,KAAK,CAACK,IAAN,CAAWD,IAAX,EACH,CAFD,EAGH,CAED,MAAOJ,CAAAA,KAAP,CACH,CAVqB,CAUnB,EAVmB,CAAtB,CAYAV,wBAAwB,CAACgB,IAAzB,CACI,cAA6B,IAAjBC,CAAAA,UAAiB,MAA1BC,OAA0B,CACzB,GAAIV,aAAa,CAACF,MAAd,CAAuB,CAA3B,CAA8B,CAC1BW,UAAU,CAACE,UAAX,CAAsBhB,QAAtB,CAAgCK,aAAhC,EACH,CAFD,IAEO,CACHS,UAAU,CAACG,mBAAX,CAA+BjB,QAA/B,EACH,CACJ,CAPL,EAUAA,QAAQ,CAACL,oBAAoB,CAACS,OAAD,CAArB,CAAR,CACH,CA1CL,uBA4CI,iBAAQc,CAAR,CAAWlB,QAAX,CAAqB,CACjBA,QAAQ,CAACN,aAAa,CAAC,IAAD,CAAd,CAAR,CACH,CA9CL,8BAgDI,wBAAeyB,OAAf,CAAwB,CACpB,MAAO1B,CAAAA,gBAAgB,CAAC2B,QAAjB,CAA0BD,OAA1B,CAAP,CACH,CAlDL,6DA3BAX,MAAM,CAACa,cAAP,CAAsBC,kBAAtB,CAA0C,MAA1C,CAAkD,CAAEC,KAAK,CAAE,mBAAT,CAAlD,E,uFAgFA,cAAe,IAAIzB,CAAAA,iBAAJ,EAAf","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport ProductListQuery from 'Query/ProductList.query';\nimport { updateNoMatch } from 'Store/NoMatch/NoMatch.action';\nimport { updateProductDetails } from 'Store/Product/Product.action';\nimport { QueryDispatcher } from 'Util/Request';\n\nexport const LinkedProductsDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/LinkedProducts/LinkedProducts.dispatcher'\n);\n\n/**\n * Product List Dispatcher\n * @class ProductDispatcher\n * @extends ProductDispatcher\n * @namespace Store/Product/Dispatcher\n */\nexport class ProductDispatcher extends QueryDispatcher {\n    __construct() {\n        super.__construct('Product');\n    }\n\n    onSuccess(data, dispatch) {\n        const { products: { items } } = data;\n\n        /**\n         * In case there are no items, or item count is\n         * smaller then 0 => the product was not found.\n         */\n        if (!items || items.length <= 0) {\n            dispatch(updateNoMatch(true));\n            return;\n        }\n\n        const [product] = items;\n\n        const product_links = items.reduce((links, product) => {\n            const { product_links } = product;\n\n            if (product_links) {\n                Object.values(product_links).forEach((item) => {\n                    links.push(item);\n                });\n            }\n\n            return links;\n        }, []);\n\n        LinkedProductsDispatcher.then(\n            ({ default: dispatcher }) => {\n                if (product_links.length > 0) {\n                    dispatcher.handleData(dispatch, product_links);\n                } else {\n                    dispatcher.clearLinkedProducts(dispatch);\n                }\n            }\n        );\n\n        dispatch(updateProductDetails(product));\n    }\n\n    onError(_, dispatch) {\n        dispatch(updateNoMatch(true));\n    }\n\n    prepareRequest(options) {\n        return ProductListQuery.getQuery(options);\n    }\n}\n\nexport default new ProductDispatcher();\n"]},"metadata":{},"sourceType":"module"}