{"ast":null,"code":"import _toConsumableArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{withRouter}from'react-router-dom';import ProductListInfoDispatcher from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/ProductListInfo/ProductListInfo.dispatcher\";import{HistoryType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Common\";import{DeviceType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Device\";import{FilterInputType,PagesType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/ProductList\";import{LocationType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Router\";import{getQueryParam,setQueryParams}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Url\";import ProductList from\"./ProductList.component\";/** @namespace Component/ProductList/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{device:state.ConfigReducer.device};},\"Component/ProductList/Container/mapStateToProps\");/** @namespace Component/ProductList/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{requestProductListInfo:function requestProductListInfo(options){return ProductListInfoDispatcher.handleData(dispatch,options);}};},\"Component/ProductList/Container/mapDispatchToProps\");/** @namespace Component/ProductList/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _ProductListContainer=/*#__PURE__*/function(_Extensible){_inherits(_ProductListContainer,_Extensible);var _super=_createSuper(_ProductListContainer);function _ProductListContainer(){var _this;_classCallCheck(this,_ProductListContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={loadPrevPage:_this.loadPage.bind(_assertThisInitialized(_this),false),loadPage:_this.loadPage.bind(_assertThisInitialized(_this)),updatePage:_this.updatePage.bind(_assertThisInitialized(_this))};_this.state={pagesCount:1};_this.requestPage=function(){var currentPage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var isNext=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var _this$props=_this.props,sort=_this$props.sort,search=_this$props.search,filter=_this$props.filter,pageSize=_this$props.pageSize,requestProductList=_this$props.requestProductList,requestProductListInfo=_this$props.requestProductListInfo,noAttributes=_this$props.noAttributes,noVariants=_this$props.noVariants,isWidget=_this$props.isWidget;/**\n         * In case the wrong category was passed down to the product list,\n         * prevent it from being requested.\n         */if(filter.categoryIds===-1){return;}/**\n         * Do not request page if there are no filters\n         */if(!search&&!_this.isEmptyFilter()){return;}// TODO: product list requests filters alongside the page\n// TODO: sometimes product list is requested more then once\n// TODO: the product list should not request itself, when coming from PDP\nvar options={isNext:isNext,noAttributes:noAttributes,noVariants:noVariants,args:{sort:sort,filter:filter,search:search,pageSize:pageSize,currentPage:currentPage}};var infoOptions={args:{filter:filter,search:search}};requestProductList(options);if(!isWidget){requestProductListInfo(infoOptions);}};_this.containerProps=function(){return{currentPage:_this._getPageFromUrl(),isShowLoading:_this._isShowLoading(),isVisible:_this._isVisible(),requestPage:_this.requestPage,// disable this property to enable infinite scroll on desktop\nisInfiniteLoaderEnabled:_this._getIsInfiniteLoaderEnabled()};};return _this;}_createClass(_ProductListContainer,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$props2=this.props,pages=_this$props2.pages,isPreventRequest=_this$props2.isPreventRequest;var pagesCount=this.state.pagesCount;var pagesLength=Object.keys(pages).length;if(pagesCount!==pagesLength){this.setState({pagesCount:pagesLength});}// Is true when category is changed. This check prevents making new requests when navigating back to PLP from PDP\nif(!isPreventRequest){this.requestPage(this._getPageFromUrl());}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var _this$props3=this.props,sort=_this$props3.sort,search=_this$props3.search,filter=_this$props3.filter;var prevSort=prevProps.sort,prevSearch=prevProps.search,prevFilter=prevProps.filter;var pages=this.props.pages;var pagesCount=this.state.pagesCount;var pagesLength=Object.keys(pages).length;if(pagesCount!==pagesLength){// eslint-disable-next-line react/no-did-update-set-state\nthis.setState({pagesCount:pagesLength});}if(search!==prevSearch||JSON.stringify(sort)!==JSON.stringify(prevSort)||JSON.stringify(filter)!==JSON.stringify(prevFilter)){this.requestPage(this._getPageFromUrl());}}},{key:\"isEmptyFilter\",value:function isEmptyFilter(){var filter=this.props.filter;var validFilters=Object.entries(filter).filter(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];switch(key){case'priceRange':return value.min>0||value.max>0;case'customFilters':return Object.keys(value).length>0;case'categoryIds':default:return true;}});/**\n         * If there is more then one valid filter, filters are not empty.\n         */return validFilters.length>0;}},{key:\"_getIsInfiniteLoaderEnabled\",value:function _getIsInfiniteLoaderEnabled(){// disable infinite scroll on mobile\nvar _this$props4=this.props,isInfiniteLoaderEnabled=_this$props4.isInfiniteLoaderEnabled,device=_this$props4.device;// allow scroll and mobile\nif(device.isMobile){return isInfiniteLoaderEnabled;}return false;}},{key:\"_getPageFromUrl\",value:function _getPageFromUrl(){var location=this.props.location;return+(getQueryParam('page',location)||1);}},{key:\"_getPagesBounds\",value:function _getPagesBounds(){var _this$props5=this.props,pages=_this$props5.pages,totalItems=_this$props5.totalItems,pageSize=_this$props5.pageSize;var keys=Object.keys(pages);return{maxPage:Math.max.apply(Math,_toConsumableArray(keys)),minPage:Math.min.apply(Math,_toConsumableArray(keys)),totalPages:Math.ceil(totalItems/pageSize),loadedPagesCount:keys.length};}},{key:\"_isShowLoading\",value:function _isShowLoading(){var isLoading=this.props.isLoading;var _this$_getPagesBounds=this._getPagesBounds(),minPage=_this$_getPagesBounds.minPage;return minPage>1&&!isLoading;}},{key:\"_isVisible\",value:function _isVisible(){var _this$_getPagesBounds2=this._getPagesBounds(),maxPage=_this$_getPagesBounds2.maxPage,totalPages=_this$_getPagesBounds2.totalPages;return maxPage<totalPages;}},{key:\"loadPage\",value:function loadPage(){var next=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var pagesCount=this.state.pagesCount;var isPageLoading=this.props.isPageLoading;var _this$_getPagesBounds3=this._getPagesBounds(),minPage=_this$_getPagesBounds3.minPage,maxPage=_this$_getPagesBounds3.maxPage,totalPages=_this$_getPagesBounds3.totalPages,loadedPagesCount=_this$_getPagesBounds3.loadedPagesCount;var isUpdatable=totalPages>0&&pagesCount===loadedPagesCount;var shouldUpdateList=next?maxPage<totalPages:minPage>1;if(isUpdatable&&shouldUpdateList&&!isPageLoading){this.setState({pagesCount:pagesCount+1});this.requestPage(next?maxPage+1:minPage-1,true);}}},{key:\"updatePage\",value:function updatePage(pageNumber){var _this$props6=this.props,location=_this$props6.location,history=_this$props6.history;setQueryParams({page:pageNumber===1?'':pageNumber},location,history);}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,ProductList,Object.assign({},this.props,this.containerFunctions,this.containerProps()));}}]);return _ProductListContainer;}(Extensible(PureComponent));_ProductListContainer.defaultProps={pageSize:24,filter:{},search:'',selectedFilters:{},sort:undefined,isPreventRequest:false,isPaginationEnabled:true,isInfiniteLoaderEnabled:true,isPageLoading:false,noAttributes:false,noVariants:false,isWidget:false};Object.defineProperty(_ProductListContainer,'name',{value:'ProductListContainer'});export var ProductListContainer=middleware(_ProductListContainer,\"Component/ProductList/Container\");export default withRouter(connect(mapStateToProps,mapDispatchToProps)(ProductListContainer));","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductList/ProductList.container.js"],"names":["PureComponent","connect","withRouter","ProductListInfoDispatcher","HistoryType","DeviceType","FilterInputType","PagesType","LocationType","getQueryParam","setQueryParams","ProductList","mapStateToProps","state","device","ConfigReducer","mapDispatchToProps","dispatch","requestProductListInfo","options","handleData","ProductListContainer","containerFunctions","loadPrevPage","loadPage","bind","updatePage","pagesCount","requestPage","currentPage","isNext","props","sort","search","filter","pageSize","requestProductList","noAttributes","noVariants","isWidget","categoryIds","isEmptyFilter","args","infoOptions","containerProps","_getPageFromUrl","isShowLoading","_isShowLoading","isVisible","_isVisible","isInfiniteLoaderEnabled","_getIsInfiniteLoaderEnabled","pages","isPreventRequest","pagesLength","Object","keys","length","setState","prevProps","prevSort","prevSearch","prevFilter","JSON","stringify","validFilters","entries","key","value","min","max","isMobile","location","totalItems","maxPage","Math","minPage","totalPages","ceil","loadedPagesCount","isLoading","_getPagesBounds","next","isPageLoading","isUpdatable","shouldUpdateList","pageNumber","history","page","defaultProps","selectedFilters","undefined","isPaginationEnabled","defineProperty","_ProductListContainer"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\n\nimport ProductListInfoDispatcher from 'Store/ProductListInfo/ProductListInfo.dispatcher';\nimport { HistoryType } from 'Type/Common';\nimport { DeviceType } from 'Type/Device';\nimport { FilterInputType, PagesType } from 'Type/ProductList';\nimport { LocationType } from 'Type/Router';\nimport { getQueryParam, setQueryParams } from 'Util/Url';\n\nimport ProductList from './ProductList.component';\n\n/** @namespace Component/ProductList/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    device: state.ConfigReducer.device\n});\n\n/** @namespace Component/ProductList/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    requestProductListInfo: (options) => ProductListInfoDispatcher.handleData(dispatch, options)\n});\n\n/** @namespace Component/ProductList/Container */\nexport class ProductListContainer extends PureComponent {\n    containerFunctions = {\n        loadPrevPage: this.loadPage.bind(this, false),\n        loadPage: this.loadPage.bind(this),\n        updatePage: this.updatePage.bind(this)\n    };\n\n    static propTypes = {\n        history: HistoryType.isRequired,\n        location: LocationType.isRequired,\n        pages: PagesType.isRequired,\n        pageSize: PropTypes.number,\n        isLoading: PropTypes.bool.isRequired,\n        isPageLoading: PropTypes.bool,\n        totalItems: PropTypes.number.isRequired,\n        requestProductList: PropTypes.func.isRequired,\n        requestProductListInfo: PropTypes.func.isRequired,\n        selectedFilters: PropTypes.objectOf(PropTypes.shape),\n        isPreventRequest: PropTypes.bool,\n        isInfiniteLoaderEnabled: PropTypes.bool,\n        isPaginationEnabled: PropTypes.bool,\n        filter: FilterInputType,\n        search: PropTypes.string,\n        sort: PropTypes.objectOf(PropTypes.string),\n        noAttributes: PropTypes.bool,\n        noVariants: PropTypes.bool,\n        isWidget: PropTypes.bool,\n        device: DeviceType.isRequired\n    };\n\n    static defaultProps = {\n        pageSize: 24,\n        filter: {},\n        search: '',\n        selectedFilters: {},\n        sort: undefined,\n        isPreventRequest: false,\n        isPaginationEnabled: true,\n        isInfiniteLoaderEnabled: true,\n        isPageLoading: false,\n        noAttributes: false,\n        noVariants: false,\n        isWidget: false\n    };\n\n    state = {\n        pagesCount: 1\n    };\n\n    componentDidMount() {\n        const { pages, isPreventRequest } = this.props;\n        const { pagesCount } = this.state;\n        const pagesLength = Object.keys(pages).length;\n\n        if (pagesCount !== pagesLength) {\n            this.setState({ pagesCount: pagesLength });\n        }\n\n        // Is true when category is changed. This check prevents making new requests when navigating back to PLP from PDP\n        if (!isPreventRequest) {\n            this.requestPage(this._getPageFromUrl());\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n        const { sort, search, filter } = this.props;\n        const { sort: prevSort, search: prevSearch, filter: prevFilter } = prevProps;\n\n        const { pages } = this.props;\n        const { pagesCount } = this.state;\n        const pagesLength = Object.keys(pages).length;\n\n        if (pagesCount !== pagesLength) {\n            // eslint-disable-next-line react/no-did-update-set-state\n            this.setState({ pagesCount: pagesLength });\n        }\n\n        if (search !== prevSearch\n            || JSON.stringify(sort) !== JSON.stringify(prevSort)\n            || JSON.stringify(filter) !== JSON.stringify(prevFilter)\n        ) {\n            this.requestPage(this._getPageFromUrl());\n        }\n    }\n\n    isEmptyFilter() {\n        const { filter } = this.props;\n\n        const validFilters = Object.entries(filter).filter(([key, value]) => {\n            switch (key) {\n            case 'priceRange':\n                return value.min > 0 || value.max > 0;\n            case 'customFilters':\n                return Object.keys(value).length > 0;\n            case 'categoryIds':\n            default:\n                return true;\n            }\n        });\n\n        /**\n         * If there is more then one valid filter, filters are not empty.\n         */\n        return validFilters.length > 0;\n    }\n\n    requestPage = (currentPage = 1, isNext = false) => {\n        const {\n            sort,\n            search,\n            filter,\n            pageSize,\n            requestProductList,\n            requestProductListInfo,\n            noAttributes,\n            noVariants,\n            isWidget\n        } = this.props;\n\n        /**\n         * In case the wrong category was passed down to the product list,\n         * prevent it from being requested.\n         */\n        if (filter.categoryIds === -1) {\n            return;\n        }\n\n        /**\n         * Do not request page if there are no filters\n         */\n        if (!search && !this.isEmptyFilter()) {\n            return;\n        }\n\n        // TODO: product list requests filters alongside the page\n        // TODO: sometimes product list is requested more then once\n        // TODO: the product list should not request itself, when coming from PDP\n\n        const options = {\n            isNext,\n            noAttributes,\n            noVariants,\n            args: {\n                sort,\n                filter,\n                search,\n                pageSize,\n                currentPage\n            }\n        };\n\n        const infoOptions = {\n            args: {\n                filter,\n                search\n            }\n        };\n\n        requestProductList(options);\n\n        if (!isWidget) {\n            requestProductListInfo(infoOptions);\n        }\n    };\n\n    containerProps = () => ({\n        currentPage: this._getPageFromUrl(),\n        isShowLoading: this._isShowLoading(),\n        isVisible: this._isVisible(),\n        requestPage: this.requestPage,\n        // disable this property to enable infinite scroll on desktop\n        isInfiniteLoaderEnabled: this._getIsInfiniteLoaderEnabled()\n    });\n\n    _getIsInfiniteLoaderEnabled() { // disable infinite scroll on mobile\n        const { isInfiniteLoaderEnabled, device } = this.props;\n\n        // allow scroll and mobile\n        if (device.isMobile) {\n            return isInfiniteLoaderEnabled;\n        }\n\n        return false;\n    }\n\n    _getPageFromUrl() {\n        const { location } = this.props;\n        return +(getQueryParam('page', location) || 1);\n    }\n\n    _getPagesBounds() {\n        const { pages, totalItems, pageSize } = this.props;\n        const keys = Object.keys(pages);\n\n        return {\n            maxPage: Math.max(...keys),\n            minPage: Math.min(...keys),\n            totalPages: Math.ceil(totalItems / pageSize),\n            loadedPagesCount: keys.length\n        };\n    }\n\n    _isShowLoading() {\n        const { isLoading } = this.props;\n        const { minPage } = this._getPagesBounds();\n        return minPage > 1 && !isLoading;\n    }\n\n    _isVisible() {\n        const { maxPage, totalPages } = this._getPagesBounds();\n        return maxPage < totalPages;\n    }\n\n    loadPage(next = true) {\n        const { pagesCount } = this.state;\n        const { isPageLoading } = this.props;\n\n        const {\n            minPage,\n            maxPage,\n            totalPages,\n            loadedPagesCount\n        } = this._getPagesBounds();\n\n        const isUpdatable = totalPages > 0 && pagesCount === loadedPagesCount;\n        const shouldUpdateList = next ? maxPage < totalPages : minPage > 1;\n\n        if (isUpdatable && shouldUpdateList && !isPageLoading) {\n            this.setState({ pagesCount: pagesCount + 1 });\n            this.requestPage(next ? maxPage + 1 : minPage - 1, true);\n        }\n    }\n\n    updatePage(pageNumber) {\n        const { location, history } = this.props;\n\n        setQueryParams({\n            page: pageNumber === 1 ? '' : pageNumber\n        }, location, history);\n    }\n\n    render() {\n        return (\n            <ProductList\n              { ...this.props }\n              { ...this.containerFunctions }\n              { ...this.containerProps() }\n            />\n        );\n    }\n}\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(ProductListContainer));\n"]},"metadata":{},"sourceType":"module"}