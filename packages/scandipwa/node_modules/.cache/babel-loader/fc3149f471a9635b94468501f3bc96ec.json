{"ast":null,"code":"import _objectWithoutProperties from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _toConsumableArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import CategoryPagination from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/CategoryPagination\";import ProductListPage from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductListPage\";import{MixType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Common\";import{DeviceType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Device\";import{FilterType,PagesType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/ProductList\";import{observerThreshold}from\"./ProductList.config\";import\"./ProductList.style\";/**\n * List of category products\n * @class ProductList\n * @namespace Component/ProductList/Component\n */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _ProductList=/*#__PURE__*/function(_Extensible){_inherits(_ProductList,_Extensible);var _super=_createSuper(_ProductList);function _ProductList(){var _this;_classCallCheck(this,_ProductList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.nodes={};_this.observedNodes=[];_this.pagesIntersecting=[];_this.renderProductPage=function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],_ref2$=_ref2[1],items=_ref2$===void 0?[]:_ref2$;var selectedFilters=_this.props.selectedFilters;var pageNumber=+key;return _this.renderPage({selectedFilters:selectedFilters,pageNumber:pageNumber,items:items,key:key,wrapperRef:function wrapperRef(node){_this.nodes[pageNumber]=node;}});};return _this;}_createClass(_ProductList,[{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var _this$props=this.props,isWidget=_this$props.isWidget,currentPage=_this$props.currentPage,device=_this$props.device;var prevCurrentPage=prevProps.currentPage;// Scroll up on page change, ignore widgets\nif(prevCurrentPage!==currentPage&&!isWidget&&!device.isMobile){window.scrollTo({top:0,behavior:'smooth'});}var isInfiniteLoaderEnabled=this.props.isInfiniteLoaderEnabled;if(isInfiniteLoaderEnabled){this.observePageChange();}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.observer&&this.observer.disconnect){this.observer.disconnect();}this.observer=null;}},{key:\"observePageChange\",value:function observePageChange(){var _this2=this;var _this$props2=this.props,updatePage=_this$props2.updatePage,isLoading=_this$props2.isLoading;if(isLoading){this.pagesIntersecting=[];}if(!this.observer&&'IntersectionObserver'in window){var threshold=this._getThreshold();this.observer=new IntersectionObserver(function(entries){var currentPage=_this2.props.currentPage;entries.forEach(function(_ref3){var target=_ref3.target,isIntersecting=_ref3.isIntersecting;var page=+Object.keys(_this2.nodes).find(function(node){return _this2.nodes[node]===target;});var index=_this2.pagesIntersecting.indexOf(page);if(isIntersecting&&index===-1){_this2.pagesIntersecting.push(page);}if(!isIntersecting&&index>-1){_this2.pagesIntersecting.splice(index,1);}});var minPage=Math.min.apply(Math,_toConsumableArray(_this2.pagesIntersecting));if(minPage<Infinity&&minPage!==currentPage){updatePage(minPage);}},{rootMargin:'0px',threshold:threshold});}this.updateObserver();}},{key:\"updateObserver\",value:function updateObserver(){var _this3=this;var currentNodes=Object.values(this.nodes);if(!this.observer||currentNodes.length<=0){return;}currentNodes.forEach(function(node){if(node&&!_this3.observedNodes.includes(node)){_this3.observer.observe(node);_this3.observedNodes.push(node);}});this.observedNodes=this.observedNodes.reduce(function(acc,node){if(!currentNodes.includes(node)){_this3.observer.unobserve(node);}else{acc.push(node);}return acc;},[]);}},{key:\"_getThreshold\",value:function _getThreshold(){var hundredPercent=100;return Array.from({length:hundredPercent/observerThreshold+1},function(_,i){return i*(observerThreshold/hundredPercent);});}},{key:\"renderLoadButton\",value:function renderLoadButton(){var _this$props3=this.props,isShowLoading=_this$props3.isShowLoading,isInfiniteLoaderEnabled=_this$props3.isInfiniteLoaderEnabled,loadPrevPage=_this$props3.loadPrevPage;if(!isShowLoading||!isInfiniteLoaderEnabled){return null;}return/*#__PURE__*/_checkBEM(React,\"div\",{block:\"ProductList\",elem:\"LoadButton\",role:\"button\",tabIndex:\"0\",onKeyUp:loadPrevPage,onClick:loadPrevPage},__('Load previous'));}},{key:\"renderNoProducts\",value:function renderNoProducts(){return/*#__PURE__*/_checkBEM(React,\"div\",{block:\"ProductList\"},/*#__PURE__*/_checkBEM(React,\"div\",{block:\"ProductList\",elem:\"ProductsMissing\"},/*#__PURE__*/_checkBEM(React,\"h2\",null,__('We are sorry!')),/*#__PURE__*/_checkBEM(React,\"h3\",null,__('There were no products found matching your request.')),/*#__PURE__*/_checkBEM(React,\"p\",null,__('Please, try removing selected filters and try again!'))));}},{key:\"renderPages\",value:function renderPages(){var _this$props4=this.props,pages=_this$props4.pages,isVisible=_this$props4.isVisible,isLoading=_this$props4.isLoading,isInfiniteLoaderEnabled=_this$props4.isInfiniteLoaderEnabled;if(isLoading){return this.renderPage();}var pageRenders=Object.entries(pages).map(this.renderProductPage);if(isVisible&&isInfiniteLoaderEnabled){// add placeholders to the end of pages if needed\nvar key=Math.max(Object.keys(pages))+1;// the key should match next page key\npageRenders.push(this.renderPage({key:key}));}return pageRenders;}},{key:\"_processProps\",value:function _processProps(props){var isInfiniteLoaderEnabled=this.props.isInfiniteLoaderEnabled;if(isInfiniteLoaderEnabled){return props;}// there must be no more then one page per screen\n// if the \"isInfiniteLoaderEnabled\" is false\nvar key=props.key,restProps=_objectWithoutProperties(props,[\"key\"]);restProps.key=0;return restProps;}},{key:\"renderPage\",value:function renderPage(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _this$props5=this.props,isInfiniteLoaderEnabled=_this$props5.isInfiniteLoaderEnabled,loadPage=_this$props5.loadPage,isLoading=_this$props5.isLoading,isVisible=_this$props5.isVisible,currentPage=_this$props5.currentPage,mix=_this$props5.mix;var newProps=this._processProps(props);return/*#__PURE__*/_checkBEM(React,ProductListPage,Object.assign({key:currentPage,isInfiniteLoaderEnabled:isInfiniteLoaderEnabled,updatePages:loadPage,isLoading:isLoading,isVisible:isVisible,mix:mix},newProps));}},{key:\"renderPagination\",value:function renderPagination(){var _this$props6=this.props,isLoading=_this$props6.isLoading,totalPages=_this$props6.totalPages,requestPage=_this$props6.requestPage,isPaginationEnabled=_this$props6.isPaginationEnabled;if(!isPaginationEnabled){return null;}return/*#__PURE__*/_checkBEM(React,CategoryPagination,{isLoading:isLoading,totalPages:totalPages,onPageSelect:requestPage});}},{key:\"renderTitle\",value:function renderTitle(){var title=this.props.title;if(!title){return null;}return/*#__PURE__*/_checkBEM(React,\"h2\",null,title);}},{key:\"render\",value:function render(){var _this$props7=this.props,totalPages=_this$props7.totalPages,isLoading=_this$props7.isLoading,mix=_this$props7.mix;if(!isLoading&&totalPages===0){return this.renderNoProducts();}return/*#__PURE__*/_checkBEM(React,\"div\",{block:\"ProductList\",mods:{isLoading:isLoading},mix:mix},this.renderPagination(),this.renderTitle(),this.renderLoadButton(),this.renderPages(),this.renderPagination());}}]);return _ProductList;}(Extensible(PureComponent));_ProductList.defaultProps={mix:{},title:'',isInfiniteLoaderEnabled:false,isPaginationEnabled:false,selectedFilters:{},isLoading:false,updatePage:function updatePage(){},totalPages:1,loadPage:function loadPage(){},requestPage:function requestPage(){},loadPrevPage:function loadPrevPage(){},currentPage:1,isShowLoading:false,isVisible:true,isWidget:false};Object.defineProperty(_ProductList,'name',{value:'ProductList'});export var ProductList=middleware(_ProductList,\"Component/ProductList/Component\");export default ProductList;","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductList/ProductList.component.js"],"names":["PureComponent","CategoryPagination","ProductListPage","MixType","DeviceType","FilterType","PagesType","observerThreshold","ProductList","nodes","observedNodes","pagesIntersecting","renderProductPage","key","items","selectedFilters","props","pageNumber","renderPage","wrapperRef","node","prevProps","isWidget","currentPage","device","prevCurrentPage","isMobile","window","scrollTo","top","behavior","isInfiniteLoaderEnabled","observePageChange","observer","disconnect","updatePage","isLoading","threshold","_getThreshold","IntersectionObserver","entries","forEach","target","isIntersecting","page","Object","keys","find","index","indexOf","push","splice","minPage","Math","min","Infinity","rootMargin","updateObserver","currentNodes","values","length","includes","observe","reduce","acc","unobserve","hundredPercent","Array","from","_","i","isShowLoading","loadPrevPage","__","pages","isVisible","pageRenders","map","max","restProps","loadPage","mix","newProps","_processProps","totalPages","requestPage","isPaginationEnabled","title","renderNoProducts","renderPagination","renderTitle","renderLoadButton","renderPages","defaultProps","defineProperty","_ProductList","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\n\nimport CategoryPagination from 'Component/CategoryPagination';\nimport ProductListPage from 'Component/ProductListPage';\nimport { MixType } from 'Type/Common';\nimport { DeviceType } from 'Type/Device';\nimport { FilterType, PagesType } from 'Type/ProductList';\n\nimport { observerThreshold } from './ProductList.config';\n\nimport './ProductList.style';\n\n/**\n * List of category products\n * @class ProductList\n * @namespace Component/ProductList/Component\n */\nexport class ProductList extends PureComponent {\n    static propTypes = {\n        device: DeviceType.isRequired,\n        title: PropTypes.string,\n        pages: PagesType.isRequired,\n        selectedFilters: FilterType,\n        isLoading: PropTypes.bool,\n        updatePage: PropTypes.func,\n        totalPages: PropTypes.number,\n        loadPage: PropTypes.func,\n        requestPage: PropTypes.func,\n        loadPrevPage: PropTypes.func,\n        currentPage: PropTypes.number,\n        isShowLoading: PropTypes.bool,\n        isVisible: PropTypes.bool,\n        isInfiniteLoaderEnabled: PropTypes.bool,\n        isPaginationEnabled: PropTypes.bool,\n        isWidget: PropTypes.bool,\n        mix: MixType\n    };\n\n    static defaultProps = {\n        mix: {},\n        title: '',\n        isInfiniteLoaderEnabled: false,\n        isPaginationEnabled: false,\n        selectedFilters: {},\n        isLoading: false,\n        updatePage: () => {},\n        totalPages: 1,\n        loadPage: () => {},\n        requestPage: () => {},\n        loadPrevPage: () => {},\n        currentPage: 1,\n        isShowLoading: false,\n        isVisible: true,\n        isWidget: false\n    };\n\n    nodes = {};\n\n    observedNodes = [];\n\n    pagesIntersecting = [];\n\n    componentDidUpdate(prevProps) {\n        const { isWidget, currentPage, device } = this.props;\n        const { currentPage: prevCurrentPage } = prevProps;\n\n        // Scroll up on page change, ignore widgets\n        if (prevCurrentPage !== currentPage && !isWidget && !device.isMobile) {\n            window.scrollTo({ top: 0, behavior: 'smooth' });\n        }\n\n        const { isInfiniteLoaderEnabled } = this.props;\n\n        if (isInfiniteLoaderEnabled) {\n            this.observePageChange();\n        }\n    }\n\n    componentWillUnmount() {\n        if (this.observer && this.observer.disconnect) {\n            this.observer.disconnect();\n        }\n\n        this.observer = null;\n    }\n\n    observePageChange() {\n        const { updatePage, isLoading } = this.props;\n\n        if (isLoading) {\n            this.pagesIntersecting = [];\n        }\n\n        if (!this.observer && 'IntersectionObserver' in window) {\n            const threshold = this._getThreshold();\n\n            this.observer = new IntersectionObserver((entries) => {\n                const { currentPage } = this.props;\n\n                entries.forEach(({ target, isIntersecting }) => {\n                    const page = +Object.keys(this.nodes).find((node) => this.nodes[node] === target);\n                    const index = this.pagesIntersecting.indexOf(page);\n\n                    if (isIntersecting && index === -1) {\n                        this.pagesIntersecting.push(page);\n                    }\n\n                    if (!isIntersecting && index > -1) {\n                        this.pagesIntersecting.splice(index, 1);\n                    }\n                });\n\n                const minPage = Math.min(...this.pagesIntersecting);\n\n                if (minPage < Infinity && minPage !== currentPage) {\n                    updatePage(minPage);\n                }\n            }, {\n                rootMargin: '0px',\n                threshold\n            });\n        }\n\n        this.updateObserver();\n    }\n\n    updateObserver() {\n        const currentNodes = Object.values(this.nodes);\n\n        if (!this.observer || currentNodes.length <= 0) {\n            return;\n        }\n\n        currentNodes.forEach((node) => {\n            if (node && !this.observedNodes.includes(node)) {\n                this.observer.observe(node);\n                this.observedNodes.push(node);\n            }\n        });\n\n        this.observedNodes = this.observedNodes.reduce((acc, node) => {\n            if (!currentNodes.includes(node)) {\n                this.observer.unobserve(node);\n            } else {\n                acc.push(node);\n            }\n\n            return acc;\n        }, []);\n    }\n\n    _getThreshold() {\n        const hundredPercent = 100;\n\n        return Array.from(\n            { length: (hundredPercent / observerThreshold) + 1 },\n            (_, i) => i * (observerThreshold / hundredPercent)\n        );\n    }\n\n    renderLoadButton() {\n        const {\n            isShowLoading,\n            isInfiniteLoaderEnabled,\n            loadPrevPage\n        } = this.props;\n\n        if (!isShowLoading || !isInfiniteLoaderEnabled) {\n            return null;\n        }\n\n        return (\n            <div\n              block=\"ProductList\"\n              elem=\"LoadButton\"\n              role=\"button\"\n              tabIndex=\"0\"\n              onKeyUp={ loadPrevPage }\n              onClick={ loadPrevPage }\n            >\n                { __('Load previous') }\n            </div>\n        );\n    }\n\n    renderNoProducts() {\n        return (\n            <div block=\"ProductList\">\n                <div\n                  block=\"ProductList\"\n                  elem=\"ProductsMissing\"\n                >\n                    <h2>{ __('We are sorry!') }</h2>\n                    <h3>{ __('There were no products found matching your request.') }</h3>\n                    <p>{ __('Please, try removing selected filters and try again!') }</p>\n                </div>\n            </div>\n        );\n    }\n\n    renderPages() {\n        const {\n            pages,\n            isVisible,\n            isLoading,\n            isInfiniteLoaderEnabled\n        } = this.props;\n\n        if (isLoading) {\n            return this.renderPage();\n        }\n\n        const pageRenders = Object.entries(pages).map(this.renderProductPage);\n\n        if (isVisible && isInfiniteLoaderEnabled) { // add placeholders to the end of pages if needed\n            const key = Math.max(Object.keys(pages)) + 1; // the key should match next page key\n            pageRenders.push(this.renderPage({ key }));\n        }\n\n        return pageRenders;\n    }\n\n    _processProps(props) {\n        const { isInfiniteLoaderEnabled } = this.props;\n\n        if (isInfiniteLoaderEnabled) {\n            return props;\n        }\n\n        // there must be no more then one page per screen\n        // if the \"isInfiniteLoaderEnabled\" is false\n        const { key, ...restProps } = props;\n        restProps.key = 0;\n        return restProps;\n    }\n\n    renderPage(props = {}) {\n        const {\n            isInfiniteLoaderEnabled,\n            loadPage,\n            isLoading,\n            isVisible,\n            currentPage,\n            mix\n        } = this.props;\n\n        const newProps = this._processProps(props);\n\n        return (\n            <ProductListPage\n              key={ currentPage }\n              isInfiniteLoaderEnabled={ isInfiniteLoaderEnabled }\n              updatePages={ loadPage }\n              isLoading={ isLoading }\n              isVisible={ isVisible }\n              mix={ mix }\n              { ...newProps }\n            />\n        );\n    }\n\n    renderProductPage = ([key, items = []]) => {\n        const { selectedFilters } = this.props;\n\n        const pageNumber = +key;\n\n        return this.renderPage({\n            selectedFilters,\n            pageNumber,\n            items,\n            key,\n            wrapperRef: (node) => {\n                this.nodes[pageNumber] = node;\n            }\n        });\n    };\n\n    renderPagination() {\n        const {\n            isLoading,\n            totalPages,\n            requestPage,\n            isPaginationEnabled\n        } = this.props;\n\n        if (!isPaginationEnabled) {\n            return null;\n        }\n\n        return (\n            <CategoryPagination\n              isLoading={ isLoading }\n              totalPages={ totalPages }\n              onPageSelect={ requestPage }\n            />\n        );\n    }\n\n    renderTitle() {\n        const { title } = this.props;\n\n        if (!title) {\n            return null;\n        }\n\n        return (\n            <h2>{ title }</h2>\n        );\n    }\n\n    render() {\n        const {\n            totalPages,\n            isLoading,\n            mix\n        } = this.props;\n\n        if (!isLoading && totalPages === 0) {\n            return this.renderNoProducts();\n        }\n\n        return (\n            <div\n              block=\"ProductList\"\n              mods={ { isLoading } }\n              mix={ mix }\n            >\n                { this.renderPagination() }\n                { this.renderTitle() }\n                { this.renderLoadButton() }\n                { this.renderPages() }\n                { this.renderPagination() }\n            </div>\n        );\n    }\n}\n\nexport default ProductList;\n"]},"metadata":{},"sourceType":"module"}