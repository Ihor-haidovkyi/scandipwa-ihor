{"ast":null,"code":"import _defineProperty from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{Subscribe}from'unstated';import SharedTransitionContainer from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/SharedTransition/SharedTransition.unstated\";import{DeviceType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Device\";import{FilterType,ProductType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/ProductList\";import history from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/History\";import{CONFIGURABLE,getVariantsIndexes}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";import{appendWithStoreCode,objectToUri}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Url\";import ProductCard from\"./ProductCard.component\";import{IN_STOCK}from\"./ProductCard.config\";export var CartDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Cart/Cart.dispatcher\");/** @namespace Component/ProductCard/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{device:state.ConfigReducer.device,base_link_url:state.ConfigReducer.base_link_url||'',product_use_categories:state.ConfigReducer.product_use_categories||false,category_url_suffix:state.ConfigReducer.category_url_suffix,isWishlistEnabled:state.ConfigReducer.wishlist_general_active};},\"Component/ProductCard/Container/mapStateToProps\");/** @namespace Component/ProductCard/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{addProduct:function addProduct(options){return CartDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.addProductToCart(dispatch,options);});}};},\"Component/ProductCard/Container/mapDispatchToProps\");/** @namespace Component/ProductCard/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _ProductCardContainer=/*#__PURE__*/function(_Extensible){_inherits(_ProductCardContainer,_Extensible);var _super=_createSuper(_ProductCardContainer);function _ProductCardContainer(){var _this;_classCallCheck(this,_ProductCardContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={getAttribute:_this.getAttribute.bind(_assertThisInitialized(_this)),isConfigurableProductOutOfStock:_this.isConfigurableProductOutOfStock.bind(_assertThisInitialized(_this)),isBundleProductOutOfStock:_this.isConfigurableProductOutOfStock.bind(_assertThisInitialized(_this))};_this.containerProps=function(){return{availableVisualOptions:_this._getAvailableVisualOptions(),currentVariantIndex:_this._getCurrentVariantIndex(),productOrVariant:_this._getProductOrVariant(),thumbnail:_this._getThumbnail(),linkTo:_this._getLinkTo()};};return _this;}_createClass(_ProductCardContainer,[{key:\"getAttribute\",value:function getAttribute(code){var selectedFilters=this.props.selectedFilters;if(!Object.keys(selectedFilters).length){var _this$props$product$a=this.props.product.attributes,_attributes=_this$props$product$a===void 0?{}:_this$props$product$a;return _attributes[code];}var currentVariantIndex=this._getCurrentVariantIndex();var _this$props=this.props,product=_this$props.product,_this$props$product$v=_this$props.product.variants,variants=_this$props$product$v===void 0?[]:_this$props$product$v;var _product$attributes=product.attributes,parentAttributes=_product$attributes===void 0?{}:_product$attributes;var _ref2=variants[currentVariantIndex]||product,_ref2$attributes=_ref2.attributes,attributes=_ref2$attributes===void 0?parentAttributes:_ref2$attributes;var _ref3=parentAttributes[code]||{},_ref3$attribute_optio=_ref3.attribute_options,attribute_options=_ref3$attribute_optio===void 0?{}:_ref3$attribute_optio;return _objectSpread(_objectSpread({},attributes[code]),{},{attribute_options:attribute_options});}},{key:\"_getLinkTo\",value:function _getLinkTo(){var _this$props2=this.props,base_link_url=_this$props2.base_link_url,product_use_categories=_this$props2.product_use_categories,category_url_suffix=_this$props2.category_url_suffix,_this$props2$product=_this$props2.product,url=_this$props2$product.url,url_rewrites=_this$props2$product.url_rewrites,product=_this$props2.product;var _URL=new URL(base_link_url||window.location.origin),storePrefix=_URL.pathname;var pathname=history.location.pathname;if(!url){return undefined;}var _this$_getConfigurabl=this._getConfigurableParameters(),parameters=_this$_getConfigurabl.parameters;var _history$location$sta=history.location.state;_history$location$sta=_history$location$sta===void 0?{}:_history$location$sta;var _history$location$sta2=_history$location$sta.category,category=_history$location$sta2===void 0?null:_history$location$sta2;var categoryUrlPart=pathname.replace(storePrefix,'').replace(category_url_suffix,'');var productUrl=\"\".concat(categoryUrlPart,\"/\").concat(url.replace(storePrefix,''));// if 'Product Use Categories' is enabled then use the current window location to see if the product\n// has any url_rewrite for that path. (if not then just use the default url)\nvar rewriteUrl=url_rewrites.find(function(_ref4){var url=_ref4.url;return url.includes(productUrl);})||{};var rewriteUrlPath=product_use_categories?rewriteUrl.url&&appendWithStoreCode(rewriteUrl.url)||url:url;return{pathname:rewriteUrlPath,state:{product:product,prevCategoryId:category},search:objectToUri(parameters)};}},{key:\"_getCurrentVariantIndex\",value:function _getCurrentVariantIndex(){var _this$_getConfigurabl2=this._getConfigurableParameters(),index=_this$_getConfigurabl2.index;return index;}},{key:\"_getConfigurableParameters\",value:function _getConfigurableParameters(){var _this$props3=this.props,_this$props3$product$=_this$props3.product.variants,variants=_this$props3$product$===void 0?[]:_this$props3$product$,_this$props3$selected=_this$props3.selectedFilters,selectedFilters=_this$props3$selected===void 0?{}:_this$props3$selected;var filterKeys=Object.keys(selectedFilters);if(filterKeys.length===0){return{indexes:[],parameters:{}};}var indexes=getVariantsIndexes(variants,selectedFilters);var _indexes=_slicedToArray(indexes,1),index=_indexes[0];if(!variants[index]){return{indexes:[],parameters:{}};}var attributes=variants[index].attributes;var parameters=Object.entries(attributes).reduce(function(parameters,_ref5){var _ref6=_slicedToArray(_ref5,2),key=_ref6[0],attribute_value=_ref6[1].attribute_value;if(filterKeys.includes(key)){return _objectSpread(_objectSpread({},parameters),{},_defineProperty({},key,attribute_value));}return parameters;},{});return{indexes:indexes,index:index,parameters:parameters};}},{key:\"_isThumbnailAvailable\",value:function _isThumbnailAvailable(path){return path&&path!=='no_selection';}},{key:\"_getThumbnail\",value:function _getThumbnail(){var product=this._getProductOrVariant();var _product$small_image=product.small_image;_product$small_image=_product$small_image===void 0?{}:_product$small_image;var url=_product$small_image.url;if(this._isThumbnailAvailable(url)){return url;}// If thumbnail is, missing we try to get image from parent\nvar _this$props$product$s=this.props.product.small_image;_this$props$product$s=_this$props$product$s===void 0?{}:_this$props$product$s;var parentUrl=_this$props$product$s.url;if(this._isThumbnailAvailable(parentUrl)){return parentUrl;}return'';}},{key:\"_getProductOrVariant\",value:function _getProductOrVariant(){var _this$props4=this.props,_this$props4$product=_this$props4.product,type_id=_this$props4$product.type_id,variants=_this$props4$product.variants,product=_this$props4.product;if(type_id===CONFIGURABLE&&(variants===null||variants===void 0?void 0:variants.length)){return variants[this._getCurrentVariantIndex()]||product||{};}return product||{};}},{key:\"_getAvailableVisualOptions\",value:function _getAvailableVisualOptions(){var _this$props$product$c=this.props.product.configurable_options,configurable_options=_this$props$product$c===void 0?{}:_this$props$product$c;if(Object.keys(configurable_options).length===0){return[];}// Find first option that has swatch_data in attribute_options property\nvar optionWithSwatchData=Object.values(configurable_options).find(function(option){var _option$attribute_opt=option.attribute_options,attribute_options=_option$attribute_opt===void 0?{}:_option$attribute_opt;return Object.values(attribute_options).some(function(_ref7){var swatch_data=_ref7.swatch_data;return swatch_data;});});var _ref8=optionWithSwatchData||{},_ref8$attribute_optio=_ref8.attribute_options,attribute_options=_ref8$attribute_optio===void 0?{}:_ref8$attribute_optio;return Object.values(attribute_options).reduce(function(acc,option){var swatch_data=option.swatch_data,label=option.label;var _ref9=swatch_data||{},type=_ref9.type,value=_ref9.value;if(type&&value){acc.push({value:value,label:label,type:type});}return acc;},[]);}},{key:\"isConfigurableProductOutOfStock\",value:function isConfigurableProductOutOfStock(){var _this$props5=this.props,variants=_this$props5.product.variants,isPreview=_this$props5.isPreview;if(isPreview){return true;}var variantsInStock=variants.filter(function(productVariant){return productVariant.stock_status===IN_STOCK;});return variantsInStock.length===0;}},{key:\"isBundleProductOutOfStock\",value:function isBundleProductOutOfStock(){var items=this.props.product.items;if(items.length===0){return true;}var options=items[0].options;var optionsInStock=options.filter(function(option){return option.product.stock_status===IN_STOCK;});return optionsInStock.length===0;}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_checkBEM(React,Subscribe,{to:[SharedTransitionContainer]},function(_ref10){var registerSharedElement=_ref10.registerSharedElement;return/*#__PURE__*/_checkBEM(React,ProductCard,Object.assign({},_objectSpread(_objectSpread({},_this2.props),{},{registerSharedElement:registerSharedElement}),_this2.containerFunctions,_this2.containerProps()));});}}]);return _ProductCardContainer;}(Extensible(PureComponent));_ProductCardContainer.defaultProps={product:{},selectedFilters:{},isPreview:false};Object.defineProperty(_ProductCardContainer,'name',{value:'ProductCardContainer'});export var ProductCardContainer=middleware(_ProductCardContainer,\"Component/ProductCard/Container\");export default connect(mapStateToProps,mapDispatchToProps)(ProductCardContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductCard/ProductCard.container.js"],"names":["PureComponent","connect","Subscribe","SharedTransitionContainer","DeviceType","FilterType","ProductType","history","CONFIGURABLE","getVariantsIndexes","appendWithStoreCode","objectToUri","ProductCard","IN_STOCK","CartDispatcher","mapStateToProps","state","device","ConfigReducer","base_link_url","product_use_categories","category_url_suffix","isWishlistEnabled","wishlist_general_active","mapDispatchToProps","dispatch","addProduct","options","then","dispatcher","default","addProductToCart","ProductCardContainer","containerFunctions","getAttribute","bind","isConfigurableProductOutOfStock","isBundleProductOutOfStock","containerProps","availableVisualOptions","_getAvailableVisualOptions","currentVariantIndex","_getCurrentVariantIndex","productOrVariant","_getProductOrVariant","thumbnail","_getThumbnail","linkTo","_getLinkTo","code","selectedFilters","props","Object","keys","length","product","attributes","variants","parentAttributes","attribute_options","url","url_rewrites","URL","window","location","origin","storePrefix","pathname","undefined","_getConfigurableParameters","parameters","category","categoryUrlPart","replace","productUrl","rewriteUrl","find","includes","rewriteUrlPath","prevCategoryId","search","index","filterKeys","indexes","entries","reduce","key","attribute_value","path","small_image","_isThumbnailAvailable","parentUrl","type_id","configurable_options","optionWithSwatchData","values","option","some","swatch_data","acc","label","type","value","push","isPreview","variantsInStock","filter","productVariant","stock_status","items","optionsInStock","registerSharedElement","defaultProps","defineProperty","_ProductCardContainer"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { Subscribe } from 'unstated';\n\nimport SharedTransitionContainer from 'Component/SharedTransition/SharedTransition.unstated';\nimport { DeviceType } from 'Type/Device';\nimport { FilterType, ProductType } from 'Type/ProductList';\nimport history from 'Util/History';\nimport { CONFIGURABLE, getVariantsIndexes } from 'Util/Product';\nimport { appendWithStoreCode, objectToUri } from 'Util/Url';\n\nimport ProductCard from './ProductCard.component';\nimport { IN_STOCK } from './ProductCard.config';\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\n\n/** @namespace Component/ProductCard/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    device: state.ConfigReducer.device,\n    base_link_url: state.ConfigReducer.base_link_url || '',\n    product_use_categories: state.ConfigReducer.product_use_categories || false,\n    category_url_suffix: state.ConfigReducer.category_url_suffix,\n    isWishlistEnabled: state.ConfigReducer.wishlist_general_active\n});\n\n/** @namespace Component/ProductCard/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    addProduct: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.addProductToCart(dispatch, options)\n    )\n});\n\n/** @namespace Component/ProductCard/Container */\nexport class ProductCardContainer extends PureComponent {\n    static propTypes = {\n        product: ProductType,\n        selectedFilters: FilterType,\n        device: DeviceType.isRequired,\n        product_use_categories: PropTypes.bool.isRequired,\n        category_url_suffix: PropTypes.string.isRequired,\n        base_link_url: PropTypes.string.isRequired,\n        isWishlistEnabled: PropTypes.bool.isRequired,\n        isPreview: PropTypes.bool\n    };\n\n    static defaultProps = {\n        product: {},\n        selectedFilters: {},\n        isPreview: false\n    };\n\n    containerFunctions = {\n        getAttribute: this.getAttribute.bind(this),\n        isConfigurableProductOutOfStock: this.isConfigurableProductOutOfStock.bind(this),\n        isBundleProductOutOfStock: this.isConfigurableProductOutOfStock.bind(this)\n    };\n\n    getAttribute(code) {\n        const { selectedFilters } = this.props;\n\n        if (!Object.keys(selectedFilters).length) {\n            const { product: { attributes = {} } } = this.props;\n            return attributes[code];\n        }\n\n        const currentVariantIndex = this._getCurrentVariantIndex();\n        const { product, product: { variants = [] } } = this.props;\n        const { attributes: parentAttributes = {} } = product;\n        const { attributes = parentAttributes } = variants[currentVariantIndex] || product;\n        const { attribute_options = {} } = parentAttributes[code] || {};\n\n        return {\n            ...attributes[code],\n            attribute_options\n        };\n    }\n\n    containerProps = () => ({\n        availableVisualOptions: this._getAvailableVisualOptions(),\n        currentVariantIndex: this._getCurrentVariantIndex(),\n        productOrVariant: this._getProductOrVariant(),\n        thumbnail: this._getThumbnail(),\n        linkTo: this._getLinkTo()\n    });\n\n    _getLinkTo() {\n        const {\n            base_link_url,\n            product_use_categories,\n            category_url_suffix,\n            product: { url, url_rewrites },\n            product\n        } = this.props;\n        const { pathname: storePrefix } = new URL(base_link_url || window.location.origin);\n        const { location: { pathname } } = history;\n\n        if (!url) {\n            return undefined;\n        }\n\n        const { parameters } = this._getConfigurableParameters();\n        const { state: { category = null } = {} } = history.location;\n        const categoryUrlPart = pathname.replace(storePrefix, '').replace(category_url_suffix, '');\n        const productUrl = `${categoryUrlPart}/${url.replace(storePrefix, '')}`;\n\n        // if 'Product Use Categories' is enabled then use the current window location to see if the product\n        // has any url_rewrite for that path. (if not then just use the default url)\n        const rewriteUrl = url_rewrites.find(({ url }) => url.includes(productUrl)) || {};\n        const rewriteUrlPath = product_use_categories\n            ? (rewriteUrl.url && appendWithStoreCode(rewriteUrl.url)) || url\n            : url;\n\n        return {\n            pathname: rewriteUrlPath,\n            state: { product, prevCategoryId: category },\n            search: objectToUri(parameters)\n        };\n    }\n\n    _getCurrentVariantIndex() {\n        const { index } = this._getConfigurableParameters();\n        return index;\n    }\n\n    _getConfigurableParameters() {\n        const { product: { variants = [] }, selectedFilters = {} } = this.props;\n        const filterKeys = Object.keys(selectedFilters);\n\n        if (filterKeys.length === 0) {\n            return { indexes: [], parameters: {} };\n        }\n\n        const indexes = getVariantsIndexes(variants, selectedFilters);\n        const [index] = indexes;\n\n        if (!variants[index]) {\n            return { indexes: [], parameters: {} };\n        }\n        const { attributes } = variants[index];\n\n        const parameters = Object.entries(attributes)\n            .reduce((parameters, [key, { attribute_value }]) => {\n                if (filterKeys.includes(key)) {\n                    return { ...parameters, [key]: attribute_value };\n                }\n\n                return parameters;\n            }, {});\n\n        return { indexes, index, parameters };\n    }\n\n    _isThumbnailAvailable(path) {\n        return path && path !== 'no_selection';\n    }\n\n    _getThumbnail() {\n        const product = this._getProductOrVariant();\n        const { small_image: { url } = {} } = product;\n        if (this._isThumbnailAvailable(url)) {\n            return url;\n        }\n\n        // If thumbnail is, missing we try to get image from parent\n        const { product: { small_image: { url: parentUrl } = {} } } = this.props;\n        if (this._isThumbnailAvailable(parentUrl)) {\n            return parentUrl;\n        }\n\n        return '';\n    }\n\n    _getProductOrVariant() {\n        const { product: { type_id, variants }, product } = this.props;\n\n        if (type_id === CONFIGURABLE && variants?.length) {\n            return variants[this._getCurrentVariantIndex()] || product || {};\n        }\n\n        return product || {};\n    }\n\n    _getAvailableVisualOptions() {\n        const { product: { configurable_options = {} } } = this.props;\n\n        if (Object.keys(configurable_options).length === 0) {\n            return [];\n        }\n\n        // Find first option that has swatch_data in attribute_options property\n        const optionWithSwatchData = Object.values(configurable_options).find((option) => {\n            const { attribute_options = {} } = option;\n\n            return Object.values(attribute_options).some(({ swatch_data }) => swatch_data);\n        });\n\n        const { attribute_options = {} } = optionWithSwatchData || {};\n\n        return Object.values(attribute_options).reduce(\n            (acc, option) => {\n                const {\n                    swatch_data,\n                    label\n                } = option;\n\n                const { type, value } = swatch_data || {};\n\n                if (type && value) {\n                    acc.push({ value, label, type });\n                }\n\n                return acc;\n            },\n            []\n        );\n    }\n\n    isConfigurableProductOutOfStock() {\n        const { product: { variants }, isPreview } = this.props;\n\n        if (isPreview) {\n            return true;\n        }\n\n        const variantsInStock = variants.filter((productVariant) => productVariant.stock_status === IN_STOCK);\n\n        return variantsInStock.length === 0;\n    }\n\n    isBundleProductOutOfStock() {\n        const { product: { items } } = this.props;\n\n        if (items.length === 0) {\n            return true;\n        }\n\n        const { options } = items[0];\n\n        const optionsInStock = options.filter((option) => option.product.stock_status === IN_STOCK);\n\n        return optionsInStock.length === 0;\n    }\n\n    render() {\n        return (\n            <Subscribe to={ [SharedTransitionContainer] }>\n                { ({ registerSharedElement }) => (\n                    <ProductCard\n                      { ...{ ...this.props, registerSharedElement } }\n                      { ...this.containerFunctions }\n                      { ...this.containerProps() }\n                    />\n                ) }\n            </Subscribe>\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ProductCardContainer);\n"]},"metadata":{},"sourceType":"module"}