{"ast":null,"code":"import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{STORE_IN_PICK_UP_METHOD_CODE,STORE_IN_PICK_UP_POPUP_ID}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/StoreInPickUp/StoreInPickUp.config\";import{SHIPPING_STEP}from\"/home/marketihor/scandipwa/packages/scandipwa/src/route/Checkout/Checkout.config\";import{showPopup as _showPopup}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Popup/Popup.action\";import{shippingMethodsType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Checkout\";import CheckoutDeliveryOptions from\"./CheckoutDeliveryOptions.component\";/** @namespace Component/CheckoutDeliveryOptions/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{shippingMethod:state.CartReducer.cartTotals.shipping_method};},\"Component/CheckoutDeliveryOptions/Container/mapStateToProps\");/** @namespace Component/CheckoutDeliveryOptions/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{showPopup:function showPopup(popupId){return dispatch(_showPopup(popupId));}};},\"Component/CheckoutDeliveryOptions/Container/mapDispatchToProps\");/** @namespace Component/CheckoutDeliveryOptions/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _CheckoutDeliveryOptionsContainer=/*#__PURE__*/function(_Extensible){_inherits(_CheckoutDeliveryOptionsContainer,_Extensible);var _super=_createSuper(_CheckoutDeliveryOptionsContainer);function _CheckoutDeliveryOptionsContainer(){var _this;_classCallCheck(this,_CheckoutDeliveryOptionsContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={selectShippingMethod:_this.selectShippingMethod.bind(_assertThisInitialized(_this)),setSelectedShippingMethodCode:_this.setSelectedShippingMethodCode.bind(_assertThisInitialized(_this))};_this.dataMap={};_this.collectAdditionalData=function(){var selectedShippingMethodCode=_this.state.selectedShippingMethodCode;var additionalDataGetter=_this.dataMap[selectedShippingMethodCode];if(!additionalDataGetter){return{};}return additionalDataGetter();};return _this;}_createClass(_CheckoutDeliveryOptionsContainer,[{key:\"__construct\",value:function __construct(props){_get(_getPrototypeOf(_CheckoutDeliveryOptionsContainer.prototype),\"__construct\",this).call(this,props);var shippingMethods=props.shippingMethods;this.state={prevShippingMethods:shippingMethods};var selectedShippingMethodCode=CheckoutDeliveryOptionsContainer._getDefaultMethod(props);if(selectedShippingMethodCode){this.state=_objectSpread(_objectSpread({},this.state),{},{selectedShippingMethodCode:selectedShippingMethodCode});}}},{key:\"componentDidMount\",value:function componentDidMount(){if(window.formPortalCollector){window.formPortalCollector.subscribe(SHIPPING_STEP,this.collectAdditionalData,'CheckoutDeliveryOptions');}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(_,prevState){var _this$props=this.props,onShippingMethodSelect=_this$props.onShippingMethodSelect,shippingMethods=_this$props.shippingMethods;var selectedShippingMethodCode=this.state.selectedShippingMethodCode;var prevSelectedShippingMethodCode=prevState.selectedShippingMethodCode;if(selectedShippingMethodCode!==prevSelectedShippingMethodCode){var shippingMethod=shippingMethods.find(function(_ref){var method_code=_ref.method_code;return method_code===selectedShippingMethodCode;});onShippingMethodSelect(shippingMethod);}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(window.formPortalCollector){window.formPortalCollector.unsubscribe(SHIPPING_STEP,'CheckoutDeliveryOptions');}}},{key:\"setSelectedShippingMethodCode\",value:function setSelectedShippingMethodCode(code){this.setState({selectedShippingMethodCode:code});}},{key:\"selectShippingMethod\",value:function selectShippingMethod(shippingMethod){var _this$props2=this.props,onShippingMethodSelect=_this$props2.onShippingMethodSelect,showPopup=_this$props2.showPopup,onStoreSelect=_this$props2.onStoreSelect;var method_code=shippingMethod.method_code;if(method_code===STORE_IN_PICK_UP_METHOD_CODE){showPopup(STORE_IN_PICK_UP_POPUP_ID);}this.setSelectedShippingMethodCode(method_code);onShippingMethodSelect(shippingMethod);onStoreSelect();}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,CheckoutDeliveryOptions,Object.assign({},this.props,this.containerFunctions,this.state));}}],[{key:\"_getDefaultMethod\",value:function _getDefaultMethod(props){var _props$shippingMethod=props.shippingMethods,shippingMethods=_props$shippingMethod===void 0?[]:_props$shippingMethod,shippingMethod=props.shippingMethod;var items=shippingMethods.filter(function(_ref2){var available=_ref2.available;return available;});/**\n         * Code bellow checking the first selected shipping method.\n         *\n         * In the case of PICK UP IN STORE, code will not select it, as we need customer to select it manually,\n         * to open popup and select actual store where order will be shipped.\n         */var result=items.find(function(_ref3){var method_code=_ref3.method_code,carrier_code=_ref3.carrier_code;return\"\".concat(carrier_code,\"_\").concat(method_code)===shippingMethod&&method_code!==STORE_IN_PICK_UP_METHOD_CODE;})||(items[0]&&items[0].method_code!==STORE_IN_PICK_UP_METHOD_CODE?items[0]:{});return result.method_code;}},{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){var shippingMethods=props.shippingMethods;var prevShippingMethods=state.prevShippingMethods;if(shippingMethods.length!==prevShippingMethods.length){var selectedShippingMethodCode=CheckoutDeliveryOptionsContainer._getDefaultMethod(props);return{selectedShippingMethodCode:selectedShippingMethodCode,prevShippingMethods:shippingMethods};}return null;}}]);return _CheckoutDeliveryOptionsContainer;}(Extensible(PureComponent));Object.defineProperty(_CheckoutDeliveryOptionsContainer,'name',{value:'CheckoutDeliveryOptionsContainer'});export var CheckoutDeliveryOptionsContainer=middleware(_CheckoutDeliveryOptionsContainer,\"Component/CheckoutDeliveryOptions/Container\");export default connect(mapStateToProps,mapDispatchToProps)(CheckoutDeliveryOptionsContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/CheckoutDeliveryOptions/CheckoutDeliveryOptions.container.js"],"names":["PureComponent","connect","STORE_IN_PICK_UP_METHOD_CODE","STORE_IN_PICK_UP_POPUP_ID","SHIPPING_STEP","showPopup","shippingMethodsType","CheckoutDeliveryOptions","mapStateToProps","state","shippingMethod","CartReducer","cartTotals","shipping_method","mapDispatchToProps","dispatch","popupId","CheckoutDeliveryOptionsContainer","containerFunctions","selectShippingMethod","bind","setSelectedShippingMethodCode","dataMap","collectAdditionalData","selectedShippingMethodCode","additionalDataGetter","props","shippingMethods","prevShippingMethods","_getDefaultMethod","window","formPortalCollector","subscribe","_","prevState","onShippingMethodSelect","prevSelectedShippingMethodCode","find","method_code","unsubscribe","code","setState","onStoreSelect","items","filter","available","result","carrier_code","length","Object","defineProperty","_CheckoutDeliveryOptionsContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { STORE_IN_PICK_UP_METHOD_CODE, STORE_IN_PICK_UP_POPUP_ID } from 'Component/StoreInPickUp/StoreInPickUp.config';\nimport { SHIPPING_STEP } from 'Route/Checkout/Checkout.config';\nimport { showPopup } from 'Store/Popup/Popup.action';\nimport { shippingMethodsType } from 'Type/Checkout';\n\nimport CheckoutDeliveryOptions from './CheckoutDeliveryOptions.component';\n\n/** @namespace Component/CheckoutDeliveryOptions/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    shippingMethod: state.CartReducer.cartTotals.shipping_method\n});\n\n/** @namespace Component/CheckoutDeliveryOptions/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    showPopup: (popupId) => dispatch(showPopup(popupId))\n});\n\n/** @namespace Component/CheckoutDeliveryOptions/Container */\nexport class CheckoutDeliveryOptionsContainer extends PureComponent {\n    static propTypes = {\n        onShippingMethodSelect: PropTypes.func.isRequired,\n        showPopup: PropTypes.func.isRequired,\n        onStoreSelect: PropTypes.func.isRequired,\n        shippingMethods: shippingMethodsType.isRequired\n    };\n\n    static _getDefaultMethod(props) {\n        const {\n            shippingMethods = [],\n            shippingMethod\n        } = props;\n\n        const items = shippingMethods.filter(({ available }) => available);\n\n        /**\n         * Code bellow checking the first selected shipping method.\n         *\n         * In the case of PICK UP IN STORE, code will not select it, as we need customer to select it manually,\n         * to open popup and select actual store where order will be shipped.\n         */\n        const result = items.find(\n            ({ method_code, carrier_code }) => (`${carrier_code}_${method_code}` === shippingMethod\n            ) && method_code !== STORE_IN_PICK_UP_METHOD_CODE\n        ) || (\n            items[0] && items[0].method_code !== STORE_IN_PICK_UP_METHOD_CODE\n                ? items[0]\n                : {}\n        );\n\n        return result.method_code;\n    }\n\n    containerFunctions = {\n        selectShippingMethod: this.selectShippingMethod.bind(this),\n        setSelectedShippingMethodCode: this.setSelectedShippingMethodCode.bind(this)\n    };\n\n    dataMap = {};\n\n    __construct(props) {\n        super.__construct(props);\n\n        const { shippingMethods } = props;\n        this.state = { prevShippingMethods: shippingMethods };\n\n        const selectedShippingMethodCode = CheckoutDeliveryOptionsContainer._getDefaultMethod(props);\n\n        if (selectedShippingMethodCode) {\n            this.state = {\n                ...this.state,\n                selectedShippingMethodCode\n            };\n        }\n    }\n\n    static getDerivedStateFromProps(props, state) {\n        const { shippingMethods } = props;\n        const { prevShippingMethods } = state;\n\n        if (shippingMethods.length !== prevShippingMethods.length) {\n            const selectedShippingMethodCode = CheckoutDeliveryOptionsContainer._getDefaultMethod(props);\n\n            return {\n                selectedShippingMethodCode,\n                prevShippingMethods: shippingMethods\n            };\n        }\n\n        return null;\n    }\n\n    componentDidMount() {\n        if (window.formPortalCollector) {\n            window.formPortalCollector.subscribe(SHIPPING_STEP, this.collectAdditionalData, 'CheckoutDeliveryOptions');\n        }\n    }\n\n    componentDidUpdate(_, prevState) {\n        const { onShippingMethodSelect, shippingMethods } = this.props;\n        const { selectedShippingMethodCode } = this.state;\n        const { selectedShippingMethodCode: prevSelectedShippingMethodCode } = prevState;\n\n        if (selectedShippingMethodCode !== prevSelectedShippingMethodCode) {\n            const shippingMethod = shippingMethods.find(\n                ({ method_code }) => method_code === selectedShippingMethodCode\n            );\n\n            onShippingMethodSelect(shippingMethod);\n        }\n    }\n\n    componentWillUnmount() {\n        if (window.formPortalCollector) {\n            window.formPortalCollector.unsubscribe(SHIPPING_STEP, 'CheckoutDeliveryOptions');\n        }\n    }\n\n    collectAdditionalData = () => {\n        const { selectedShippingMethodCode } = this.state;\n        const additionalDataGetter = this.dataMap[selectedShippingMethodCode];\n        if (!additionalDataGetter) {\n            return {};\n        }\n\n        return additionalDataGetter();\n    };\n\n    setSelectedShippingMethodCode(code) {\n        this.setState({ selectedShippingMethodCode: code });\n    }\n\n    selectShippingMethod(shippingMethod) {\n        const { onShippingMethodSelect, showPopup, onStoreSelect } = this.props;\n        const { method_code } = shippingMethod;\n\n        if (method_code === STORE_IN_PICK_UP_METHOD_CODE) {\n            showPopup(STORE_IN_PICK_UP_POPUP_ID);\n        }\n\n        this.setSelectedShippingMethodCode(method_code);\n        onShippingMethodSelect(shippingMethod);\n        onStoreSelect();\n    }\n\n    render() {\n        return (\n            <CheckoutDeliveryOptions\n              { ...this.props }\n              { ...this.containerFunctions }\n              { ...this.state }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CheckoutDeliveryOptionsContainer);\n"]},"metadata":{},"sourceType":"module"}