{"ast":null,"code":"import _asyncToGenerator from \"D:/task/magento2/ScandiPWA/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\component\\\\CartItem\\\\CartItem.container.js\";\n\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { DEFAULT_MAX_PRODUCTS } from \"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\component/ProductActions/ProductActions.config\";\nimport SwipeToDelete from \"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\component/SwipeToDelete\";\nimport { showNotification } from \"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\store/Notification/Notification.action\";\nimport { CartItemType } from \"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\type/MiniCart\";\nimport { itemIsOutOfStock } from \"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\util/Cart\";\nimport { CONFIGURABLE } from \"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\util/Product\";\nimport { makeCancelable } from \"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\util/Promise\";\nimport { objectToUri } from \"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\util/Url\";\nimport CartItem from \"./CartItem.component\";\nexport const CartDispatcher = import(\n/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n\"D:\\\\task\\\\magento2\\\\ScandiPWA\\\\packages\\\\scandipwa\\\\src\\\\store/Cart/Cart.dispatcher\");\n/** @namespace Component/CartItem/Container/mapStateToProps */\n// eslint-disable-next-line no-unused-vars\n\nexport const mapStateToProps = middleware(function (state) {\n  return {\n    device: state.ConfigReducer.device\n  };\n}, \"Component/CartItem/Container/mapStateToProps\");\n/** @namespace Component/CartItem/Container/mapDispatchToProps */\n\nexport const mapDispatchToProps = middleware(function (dispatch) {\n  return {\n    addProduct: function (options) {\n      return CartDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.addProductToCart(dispatch, options);\n      });\n    },\n    changeItemQty: function (options) {\n      return CartDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.changeItemQty(dispatch, options);\n      });\n    },\n    removeProduct: function (options) {\n      return CartDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.removeProductFromCart(dispatch, options);\n      });\n    },\n    updateCrossSellProducts: function (items) {\n      return CartDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.updateCrossSellProducts(items, dispatch);\n      });\n    },\n    showNotification: function (type, title, error) {\n      return dispatch(showNotification(type, title, error));\n    }\n  };\n}, \"Component/CartItem/Container/mapDispatchToProps\");\n/** @namespace Component/CartItem/Container */\n\nvar _checkBEM = require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;\n\nexport class _CartItemContainer extends Extensible(PureComponent) {\n  constructor(...args) {\n    var _this;\n\n    super(...args);\n    _this = this;\n    this.state = {\n      isLoading: false\n    };\n    this.handlers = [];\n    this.setStateNotLoading = this.setStateNotLoading.bind(this);\n    this.containerFunctions = {\n      handleChangeQuantity: this.handleChangeQuantity.bind(this),\n      handleRemoveItem: this.handleRemoveItem.bind(this),\n      getCurrentProduct: this.getCurrentProduct.bind(this),\n      getProductVariant: this.getProductVariant.bind(this)\n    };\n\n    this.containerProps = function () {\n      return {\n        linkTo: _this._getProductLinkTo(),\n        thumbnail: _this._getProductThumbnail(),\n        minSaleQuantity: _this.getMinQuantity(),\n        maxSaleQuantity: _this.getMaxQuantity(),\n        isProductInStock: _this.productIsInStock()\n      };\n    };\n\n    this.renderRightSideContent = function () {\n      const {\n        handleRemoveItem\n      } = _this.containerFunctions;\n      return /*#__PURE__*/_checkBEM(React, \"button\", {\n        block: \"CartItem\",\n        elem: \"SwipeToDeleteRightSide\",\n        onClick: handleRemoveItem,\n        \"aria-label\": __('Remove'),\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 13\n        }\n      }, __('Delete'));\n    };\n  }\n\n  componentWillUnmount() {\n    if (this.handlers.length) {\n      [].forEach.call(this.handlers, function (cancelablePromise) {\n        return cancelablePromise.cancel();\n      });\n    }\n  }\n\n  productIsInStock() {\n    const {\n      item\n    } = this.props;\n    return !itemIsOutOfStock(item);\n  }\n  /**\n   * @returns {Product}\n   */\n\n\n  getCurrentProduct() {\n    const {\n      item: {\n        product\n      }\n    } = this.props;\n\n    const variantIndex = this._getVariantIndex();\n\n    return variantIndex < 0 ? product : product.variants[variantIndex];\n  }\n\n  getMinQuantity() {\n    const {\n      stock_item: {\n        min_sale_qty\n      } = {}\n    } = this.getCurrentProduct() || {};\n    return min_sale_qty || 1;\n  }\n\n  getMaxQuantity() {\n    const {\n      stock_item: {\n        max_sale_qty\n      } = {}\n    } = this.getCurrentProduct() || {};\n    return max_sale_qty || DEFAULT_MAX_PRODUCTS;\n  }\n\n  setStateNotLoading() {\n    this.setState({\n      isLoading: false\n    });\n  }\n\n  /**\n   * Handle item quantity change. Check that value is <1\n   * @param {Number} value new quantity\n   * @return {void}\n   */\n  handleChangeQuantity(quantity) {\n    var _this2 = this;\n\n    this.setState({\n      isLoading: true\n    }, function () {\n      const {\n        changeItemQty,\n        item: {\n          item_id,\n          sku\n        }\n      } = _this2.props;\n\n      _this2.hideLoaderAfterPromise(changeItemQty({\n        item_id,\n        quantity,\n        sku\n      }));\n    });\n  }\n  /**\n   * @return {void}\n   */\n\n\n  handleRemoveItem() {\n    var _this3 = this;\n\n    this.setState({\n      isLoading: true\n    }, function () {\n      _this3.hideLoaderAfterPromise(_this3.removeProductAndUpdateCrossSell());\n    });\n  }\n\n  removeProductAndUpdateCrossSell() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        removeProduct,\n        updateCrossSellProducts,\n        updateCrossSellsOnRemove,\n        item: {\n          item_id\n        }\n      } = _this4.props;\n      const result = yield removeProduct(item_id);\n\n      if (result && updateCrossSellsOnRemove) {\n        yield updateCrossSellProducts(result.items);\n      }\n\n      return result;\n    })();\n  }\n  /**\n   * @param {Promise}\n   * @returns {cancelablePromise}\n   */\n\n\n  registerCancelablePromise(promise) {\n    const cancelablePromise = makeCancelable(promise);\n    this.handlers.push(cancelablePromise);\n    return cancelablePromise;\n  }\n  /**\n   * @param {Promise} promise\n   * @returns {void}\n   */\n\n\n  hideLoaderAfterPromise(promise) {\n    this.registerCancelablePromise(promise).promise.then(this.setStateNotLoading, this.setStateNotLoading);\n  }\n\n  getProductVariant() {\n    const {\n      item: {\n        product: {\n          variants = []\n        }\n      }\n    } = this.props;\n    return variants[this._getVariantIndex()];\n  }\n  /**\n   * @returns {Int}\n   */\n\n\n  _getVariantIndex() {\n    const {\n      item: {\n        sku: itemSku,\n        product: {\n          variants = []\n        } = {}\n      }\n    } = this.props;\n    return variants.findIndex(function ({\n      sku\n    }) {\n      return sku === itemSku || itemSku.includes(sku);\n    });\n  }\n  /**\n   * Get link to product page\n   * @param url_key Url to product\n   * @return {{pathname: String, state Object}} Pathname and product state\n   */\n\n\n  _getProductLinkTo() {\n    const {\n      item: {\n        product,\n        product: {\n          type_id,\n          configurable_options,\n          parent,\n          url\n        } = {}\n      } = {}\n    } = this.props;\n\n    if (type_id !== CONFIGURABLE) {\n      return {\n        pathname: url,\n        state: {\n          product\n        }\n      };\n    }\n\n    const variant = this.getProductVariant();\n\n    if (!variant) {\n      return {};\n    }\n\n    const {\n      attributes\n    } = variant;\n    const parameters = Object.entries(attributes).reduce(function (parameters, [code, {\n      attribute_value\n    }]) {\n      if (Object.keys(configurable_options).includes(code)) {\n        return { ...parameters,\n          [code]: attribute_value\n        };\n      }\n\n      return parameters;\n    }, {});\n    const stateProduct = parent || product;\n    return {\n      pathname: url,\n      state: {\n        product: stateProduct\n      },\n      search: objectToUri(parameters)\n    };\n  }\n\n  _getProductThumbnail() {\n    const product = this.getCurrentProduct();\n    const {\n      thumbnail: {\n        url: thumbnail\n      } = {}\n    } = product;\n    return thumbnail || '';\n  }\n\n  render() {\n    const {\n      isLoading\n    } = this.state;\n    return /*#__PURE__*/_checkBEM(React, SwipeToDelete, {\n      renderRightSideContent: this.renderRightSideContent,\n      onAheadOfDragItemRemoveThreshold: this.containerFunctions.handleRemoveItem,\n      isLoading: isLoading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/_checkBEM(React, CartItem, Object.assign({}, this.props, this.state, this.containerFunctions, this.containerProps(), {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 17\n      }\n    })));\n  }\n\n}\n_CartItemContainer.propTypes = {\n  item: CartItemType.isRequired,\n  currency_code: PropTypes.string.isRequired,\n  changeItemQty: PropTypes.func.isRequired,\n  removeProduct: PropTypes.func.isRequired,\n  updateCrossSellProducts: PropTypes.func.isRequired,\n  updateCrossSellsOnRemove: PropTypes.bool\n};\n_CartItemContainer.defaultProps = {\n  updateCrossSellsOnRemove: false\n};\nObject.defineProperty(_CartItemContainer, 'name', {\n  value: 'CartItemContainer'\n});\n\nexport const CartItemContainer = middleware(_CartItemContainer, \"Component/CartItem/Container\");\nexport default connect(mapStateToProps, mapDispatchToProps)(CartItemContainer);","map":{"version":3,"sources":["D:/task/magento2/ScandiPWA/packages/scandipwa/src/component/CartItem/CartItem.container.js"],"names":["PropTypes","PureComponent","connect","DEFAULT_MAX_PRODUCTS","SwipeToDelete","showNotification","CartItemType","itemIsOutOfStock","CONFIGURABLE","makeCancelable","objectToUri","CartItem","CartDispatcher","mapStateToProps","state","device","ConfigReducer","mapDispatchToProps","dispatch","addProduct","options","then","default","dispatcher","addProductToCart","changeItemQty","removeProduct","removeProductFromCart","updateCrossSellProducts","items","type","title","error","CartItemContainer","isLoading","handlers","setStateNotLoading","bind","containerFunctions","handleChangeQuantity","handleRemoveItem","getCurrentProduct","getProductVariant","containerProps","linkTo","_getProductLinkTo","thumbnail","_getProductThumbnail","minSaleQuantity","getMinQuantity","maxSaleQuantity","getMaxQuantity","isProductInStock","productIsInStock","renderRightSideContent","__","componentWillUnmount","length","forEach","call","cancelablePromise","cancel","item","props","product","variantIndex","_getVariantIndex","variants","stock_item","min_sale_qty","max_sale_qty","setState","quantity","item_id","sku","hideLoaderAfterPromise","removeProductAndUpdateCrossSell","updateCrossSellsOnRemove","result","registerCancelablePromise","promise","push","itemSku","findIndex","includes","type_id","configurable_options","parent","url","pathname","variant","attributes","parameters","Object","entries","reduce","code","attribute_value","keys","stateProduct","search","render","propTypes","isRequired","currency_code","string","func","bool","defaultProps","defineProperty","_CartItemContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { DEFAULT_MAX_PRODUCTS } from 'Component/ProductActions/ProductActions.config';\nimport SwipeToDelete from 'Component/SwipeToDelete';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { CartItemType } from 'Type/MiniCart';\nimport { itemIsOutOfStock } from 'Util/Cart';\nimport { CONFIGURABLE } from 'Util/Product';\nimport { makeCancelable } from 'Util/Promise';\nimport { objectToUri } from 'Util/Url';\n\nimport CartItem from './CartItem.component';\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\n\n/** @namespace Component/CartItem/Container/mapStateToProps */\n// eslint-disable-next-line no-unused-vars\nexport const mapStateToProps = (state) => ({\n    device: state.ConfigReducer.device\n});\n\n/** @namespace Component/CartItem/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    addProduct: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.addProductToCart(dispatch, options)\n    ),\n    changeItemQty: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.changeItemQty(dispatch, options)\n    ),\n    removeProduct: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.removeProductFromCart(dispatch, options)\n    ),\n    updateCrossSellProducts: (items) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.updateCrossSellProducts(items, dispatch)\n    ),\n    showNotification: (type, title, error) => dispatch(showNotification(type, title, error))\n});\n\n/** @namespace Component/CartItem/Container */\nexport class CartItemContainer extends PureComponent {\n    static propTypes = {\n        item: CartItemType.isRequired,\n        currency_code: PropTypes.string.isRequired,\n        changeItemQty: PropTypes.func.isRequired,\n        removeProduct: PropTypes.func.isRequired,\n        updateCrossSellProducts: PropTypes.func.isRequired,\n        updateCrossSellsOnRemove: PropTypes.bool\n    };\n\n    static defaultProps = {\n        updateCrossSellsOnRemove: false\n    };\n\n    state = { isLoading: false };\n\n    handlers = [];\n\n    setStateNotLoading = this.setStateNotLoading.bind(this);\n\n    containerFunctions = {\n        handleChangeQuantity: this.handleChangeQuantity.bind(this),\n        handleRemoveItem: this.handleRemoveItem.bind(this),\n        getCurrentProduct: this.getCurrentProduct.bind(this),\n        getProductVariant: this.getProductVariant.bind(this)\n    };\n\n    componentWillUnmount() {\n        if (this.handlers.length) {\n            [].forEach.call(this.handlers, (cancelablePromise) => cancelablePromise.cancel());\n        }\n    }\n\n    productIsInStock() {\n        const { item } = this.props;\n        return !itemIsOutOfStock(item);\n    }\n\n    /**\n     * @returns {Product}\n     */\n    getCurrentProduct() {\n        const { item: { product } } = this.props;\n        const variantIndex = this._getVariantIndex();\n\n        return variantIndex < 0\n            ? product\n            : product.variants[variantIndex];\n    }\n\n    getMinQuantity() {\n        const { stock_item: { min_sale_qty } = {} } = this.getCurrentProduct() || {};\n        return min_sale_qty || 1;\n    }\n\n    getMaxQuantity() {\n        const { stock_item: { max_sale_qty } = {} } = this.getCurrentProduct() || {};\n        return max_sale_qty || DEFAULT_MAX_PRODUCTS;\n    }\n\n    setStateNotLoading() {\n        this.setState({ isLoading: false });\n    }\n\n    containerProps = () => ({\n        linkTo: this._getProductLinkTo(),\n        thumbnail: this._getProductThumbnail(),\n        minSaleQuantity: this.getMinQuantity(),\n        maxSaleQuantity: this.getMaxQuantity(),\n        isProductInStock: this.productIsInStock()\n    });\n\n    /**\n     * Handle item quantity change. Check that value is <1\n     * @param {Number} value new quantity\n     * @return {void}\n     */\n    handleChangeQuantity(quantity) {\n        this.setState({ isLoading: true }, () => {\n            const { changeItemQty, item: { item_id, sku } } = this.props;\n            this.hideLoaderAfterPromise(changeItemQty({ item_id, quantity, sku }));\n        });\n    }\n\n    /**\n     * @return {void}\n     */\n    handleRemoveItem() {\n        this.setState({ isLoading: true }, () => {\n            this.hideLoaderAfterPromise(this.removeProductAndUpdateCrossSell());\n        });\n    }\n\n    async removeProductAndUpdateCrossSell() {\n        const {\n            removeProduct,\n            updateCrossSellProducts,\n            updateCrossSellsOnRemove,\n            item: { item_id }\n        } = this.props;\n\n        const result = await removeProduct(item_id);\n\n        if (result && updateCrossSellsOnRemove) {\n            await updateCrossSellProducts(result.items);\n        }\n\n        return result;\n    }\n\n    /**\n     * @param {Promise}\n     * @returns {cancelablePromise}\n     */\n    registerCancelablePromise(promise) {\n        const cancelablePromise = makeCancelable(promise);\n        this.handlers.push(cancelablePromise);\n        return cancelablePromise;\n    }\n\n    /**\n     * @param {Promise} promise\n     * @returns {void}\n     */\n    hideLoaderAfterPromise(promise) {\n        this.registerCancelablePromise(promise)\n            .promise.then(this.setStateNotLoading, this.setStateNotLoading);\n    }\n\n    getProductVariant() {\n        const {\n            item: {\n                product: {\n                    variants = []\n                }\n            }\n        } = this.props;\n\n        return variants[this._getVariantIndex()];\n    }\n\n    /**\n     * @returns {Int}\n     */\n    _getVariantIndex() {\n        const {\n            item: {\n                sku: itemSku,\n                product: { variants = [] } = {}\n            }\n        } = this.props;\n\n        return variants.findIndex(({ sku }) => sku === itemSku || itemSku.includes(sku));\n    }\n\n    /**\n     * Get link to product page\n     * @param url_key Url to product\n     * @return {{pathname: String, state Object}} Pathname and product state\n     */\n    _getProductLinkTo() {\n        const {\n            item: {\n                product,\n                product: {\n                    type_id,\n                    configurable_options,\n                    parent,\n                    url\n                } = {}\n            } = {}\n        } = this.props;\n\n        if (type_id !== CONFIGURABLE) {\n            return {\n                pathname: url,\n                state: { product }\n            };\n        }\n\n        const variant = this.getProductVariant();\n        if (!variant) {\n            return {};\n        }\n        const { attributes } = variant;\n\n        const parameters = Object.entries(attributes).reduce(\n            (parameters, [code, { attribute_value }]) => {\n                if (Object.keys(configurable_options).includes(code)) {\n                    return { ...parameters, [code]: attribute_value };\n                }\n\n                return parameters;\n            }, {}\n        );\n\n        const stateProduct = parent || product;\n\n        return {\n            pathname: url,\n            state: { product: stateProduct },\n            search: objectToUri(parameters)\n        };\n    }\n\n    _getProductThumbnail() {\n        const product = this.getCurrentProduct();\n        const { thumbnail: { url: thumbnail } = {} } = product;\n        return thumbnail || '';\n    }\n\n    renderRightSideContent = () => {\n        const { handleRemoveItem } = this.containerFunctions;\n        return (\n            <button\n              block=\"CartItem\"\n              elem=\"SwipeToDeleteRightSide\"\n              onClick={ handleRemoveItem }\n              aria-label={ __('Remove') }\n            >\n                { __('Delete') }\n            </button>\n        );\n    };\n\n    render() {\n        const { isLoading } = this.state;\n\n        return (\n            <SwipeToDelete\n              renderRightSideContent={ this.renderRightSideContent }\n              onAheadOfDragItemRemoveThreshold={ this.containerFunctions.handleRemoveItem }\n              isLoading={ isLoading }\n            >\n                <CartItem\n                  { ...this.props }\n                  { ...this.state }\n                  { ...this.containerFunctions }\n                  { ...this.containerProps() }\n                />\n            </SwipeToDelete>\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CartItemContainer);\n"]},"metadata":{},"sourceType":"module"}