{"ast":null,"code":"import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _get from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import'intersection-observer';import{PureComponent}from'react';import{InView}from'react-intersection-observer';import{ChildrenType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Common\";import{isCrawler,isSSR}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Browser\";import\"./RenderWhenVisible.style\";/** @namespace Component/RenderWhenVisible/Component */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _RenderWhenVisible=/*#__PURE__*/function(_Extensible){_inherits(_RenderWhenVisible,_Extensible);var _super=_createSuper(_RenderWhenVisible);function _RenderWhenVisible(){var _this;_classCallCheck(this,_RenderWhenVisible);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={wasVisible:false};_this.checkIsVisible=function(){if(!_this.node){return;}var rect=_this.node.getBoundingClientRect();var viewHeight=Math.max(document.documentElement.clientHeight,window.innerHeight);if(!(rect.bottom<0||rect.top-viewHeight>=0)){_this.setState({wasVisible:true});}};_this.handleVisibilityToggle=function(isVisible){var wasVisible=_this.state.wasVisible;if(!wasVisible&&isVisible){_this.setState({wasVisible:true});}};return _this;}_createClass(_RenderWhenVisible,[{key:\"__construct\",value:function __construct(props){_get(_getPrototypeOf(_RenderWhenVisible.prototype),\"__construct\",this).call(this,props);// a hack to determine if the element is on screen or not imidiatelly\nsetTimeout(this.checkIsVisible,0);}},{key:\"shouldRender\",value:function shouldRender(){var wasVisible=this.state.wasVisible;return!wasVisible&&!isSSR()&&!isCrawler();}},{key:\"renderFallback\",value:function renderFallback(){var fallback=this.props.fallback;var fallbackRender=fallback();if(fallbackRender){return fallbackRender;}return/*#__PURE__*/_checkBEM(React,\"div\",{block:\"RenderWhenVisible\",elem:\"Detector\"});}},{key:\"renderVisibilitySensor\",value:function renderVisibilitySensor(){return/*#__PURE__*/_checkBEM(React,InView,{onChange:this.handleVisibilityToggle},this.renderFallback());}},{key:\"renderChildren\",value:function renderChildren(){var children=this.props.children;return children;}},{key:\"renderContent\",value:function renderContent(){if(this.shouldRender()){return this.renderVisibilitySensor();}return this.renderChildren();}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_checkBEM(React,\"div\",{block:\"RenderWhenVisible\",ref:function ref(node){_this2.node=node;}},this.renderContent());}}]);return _RenderWhenVisible;}(Extensible(PureComponent));_RenderWhenVisible.defaultProps={fallback:function fallback(){}};Object.defineProperty(_RenderWhenVisible,'name',{value:'RenderWhenVisible'});export var RenderWhenVisible=middleware(_RenderWhenVisible,\"Component/RenderWhenVisible/Component\");export default RenderWhenVisible;","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/RenderWhenVisible/RenderWhenVisible.component.js"],"names":["PureComponent","InView","ChildrenType","isCrawler","isSSR","RenderWhenVisible","state","wasVisible","checkIsVisible","node","rect","getBoundingClientRect","viewHeight","Math","max","document","documentElement","clientHeight","window","innerHeight","bottom","top","setState","handleVisibilityToggle","isVisible","props","setTimeout","fallback","fallbackRender","renderFallback","children","shouldRender","renderVisibilitySensor","renderChildren","renderContent","defaultProps","Object","defineProperty","_RenderWhenVisible","value"],"mappings":"o0BAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,uBAAP,CAGA,OAASA,aAAT,KAA8B,OAA9B,CACA,OAASC,MAAT,KAAuB,6BAAvB,CAEA,OAASC,YAAT,qEACA,OAASC,SAAT,CAAoBC,KAApB,sEAEA,kCAEA,uD,wEACA,UAAaC,CAAAA,kBAAb,6WAUIC,KAVJ,CAUY,CACJC,UAAU,CAAE,KADR,CAVZ,OAqBIC,cArBJ,CAqBqB,UAAM,CACnB,GAAI,CAAC,MAAKC,IAAV,CAAgB,CACZ,OACH,CAED,GAAMC,CAAAA,IAAI,CAAG,MAAKD,IAAL,CAAUE,qBAAV,EAAb,CACA,GAAMC,CAAAA,UAAU,CAAGC,IAAI,CAACC,GAAL,CAASC,QAAQ,CAACC,eAAT,CAAyBC,YAAlC,CAAgDC,MAAM,CAACC,WAAvD,CAAnB,CAEA,GAAI,EAAET,IAAI,CAACU,MAAL,CAAc,CAAd,EAAmBV,IAAI,CAACW,GAAL,CAAWT,UAAX,EAAyB,CAA9C,CAAJ,CAAsD,CAClD,MAAKU,QAAL,CAAc,CAAEf,UAAU,CAAE,IAAd,CAAd,EACH,CACJ,CAhCL,OAuCIgB,sBAvCJ,CAuC6B,SAACC,SAAD,CAAe,IAC5BjB,CAAAA,UAD4B,CACb,MAAKD,KADQ,CAC5BC,UAD4B,CAGpC,GAAI,CAACA,UAAD,EAAeiB,SAAnB,CAA8B,CAC1B,MAAKF,QAAL,CAAc,CAAEf,UAAU,CAAE,IAAd,CAAd,EACH,CACJ,CA7CL,yEAcI,qBAAYkB,KAAZ,CAAmB,CACf,iFAAkBA,KAAlB,EAEA;AACAC,UAAU,CAAC,KAAKlB,cAAN,CAAsB,CAAtB,CAAV,CACH,CAnBL,4BAkCI,uBAAe,IACHD,CAAAA,UADG,CACY,KAAKD,KADjB,CACHC,UADG,CAEX,MAAO,CAACA,UAAD,EAAe,CAACH,KAAK,EAArB,EAA2B,CAACD,SAAS,EAA5C,CACH,CArCL,8BA+CI,yBAAiB,IACLwB,CAAAA,QADK,CACQ,KAAKF,KADb,CACLE,QADK,CAEb,GAAMC,CAAAA,cAAc,CAAGD,QAAQ,EAA/B,CAEA,GAAIC,cAAJ,CAAoB,CAChB,MAAOA,CAAAA,cAAP,CACH,CAED,0CACS,KAAK,CAAC,mBADf,CACmC,IAAI,CAAC,UADxC,GAGH,CA1DL,sCA4DI,iCAAyB,CACrB,mCACK,MADL,EACY,QAAQ,CAAG,KAAKL,sBAD5B,EAEU,KAAKM,cAAL,EAFV,EAKH,CAlEL,8BAoEI,yBAAiB,IACLC,CAAAA,QADK,CACQ,KAAKL,KADb,CACLK,QADK,CAGb,MAAOA,CAAAA,QAAP,CACH,CAxEL,6BA0EI,wBAAgB,CACZ,GAAI,KAAKC,YAAL,EAAJ,CAAyB,CACrB,MAAO,MAAKC,sBAAL,EAAP,CACH,CAED,MAAO,MAAKC,cAAL,EAAP,CACH,CAhFL,sBAkFI,iBAAS,iBACL,0CAEM,KAAK,CAAC,mBAFZ,CAGM,GAAG,CAAG,aAACxB,IAAD,CAAU,CACZ,MAAI,CAACA,IAAL,CAAYA,IAAZ,CACH,CALP,EAOU,KAAKyB,aAAL,EAPV,EAUH,CA7FL,2DAAa7B,kB,CAMF8B,Y,CAAe,CAClBR,QAAQ,CAAE,mBAAM,CAAE,CADA,C,CA5B1BS,MAAM,CAACC,cAAP,CAAsBC,kBAAtB,CAA0C,MAA1C,CAAkD,CAAEC,KAAK,CAAE,mBAAT,CAAlD,E,oGAsHA,cAAelC,CAAAA,iBAAf","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport 'intersection-observer';\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { InView } from 'react-intersection-observer';\n\nimport { ChildrenType } from 'Type/Common';\nimport { isCrawler, isSSR } from 'Util/Browser';\n\nimport './RenderWhenVisible.style';\n\n/** @namespace Component/RenderWhenVisible/Component */\nexport class RenderWhenVisible extends PureComponent {\n    static propTypes = {\n        children: ChildrenType.isRequired,\n        fallback: PropTypes.func\n    };\n\n    static defaultProps = {\n        fallback: () => {}\n    };\n\n    state = {\n        wasVisible: false\n    };\n\n    __construct(props) {\n        super.__construct(props);\n\n        // a hack to determine if the element is on screen or not imidiatelly\n        setTimeout(this.checkIsVisible, 0);\n    }\n\n    checkIsVisible = () => {\n        if (!this.node) {\n            return;\n        }\n\n        const rect = this.node.getBoundingClientRect();\n        const viewHeight = Math.max(document.documentElement.clientHeight, window.innerHeight);\n\n        if (!(rect.bottom < 0 || rect.top - viewHeight >= 0)) {\n            this.setState({ wasVisible: true });\n        }\n    };\n\n    shouldRender() {\n        const { wasVisible } = this.state;\n        return !wasVisible && !isSSR() && !isCrawler();\n    }\n\n    handleVisibilityToggle = (isVisible) => {\n        const { wasVisible } = this.state;\n\n        if (!wasVisible && isVisible) {\n            this.setState({ wasVisible: true });\n        }\n    };\n\n    renderFallback() {\n        const { fallback } = this.props;\n        const fallbackRender = fallback();\n\n        if (fallbackRender) {\n            return fallbackRender;\n        }\n\n        return (\n            <div block=\"RenderWhenVisible\" elem=\"Detector\" />\n        );\n    }\n\n    renderVisibilitySensor() {\n        return (\n            <InView onChange={ this.handleVisibilityToggle }>\n                { this.renderFallback() }\n            </InView>\n        );\n    }\n\n    renderChildren() {\n        const { children } = this.props;\n\n        return children;\n    }\n\n    renderContent() {\n        if (this.shouldRender()) {\n            return this.renderVisibilitySensor();\n        }\n\n        return this.renderChildren();\n    }\n\n    render() {\n        return (\n            <div\n              block=\"RenderWhenVisible\"\n              ref={ (node) => {\n                  this.node = node;\n              } }\n            >\n                { this.renderContent() }\n            </div>\n        );\n    }\n}\n\nexport default RenderWhenVisible;\n"]},"metadata":{},"sourceType":"module"}