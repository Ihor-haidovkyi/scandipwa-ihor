{"ast":null,"code":"import _toConsumableArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{MAX_NUMBER_OF_RECENT_PRODUCTS,RECENTLY_VIEWED_PRODUCTS}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/RecentlyViewedWidget/RecentlyViewedWidget.config\";import{ADD_RECENTLY_VIEWED_PRODUCT,UPDATE_RECENTLY_VIEWED_PRODUCTS}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/RecentlyViewedProducts/RecentlyViewedProducts.action\";import BrowserDatabase from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/BrowserDatabase\";import{getIndexedProducts}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";/** @namespace Store/RecentlyViewedProducts/Reducer/getInitialState */export var getInitialState=middleware(function(){return{recentlyViewedProducts:BrowserDatabase.getItem(RECENTLY_VIEWED_PRODUCTS)||{},shouldBeUpdated:true};},\"Store/RecentlyViewedProducts/Reducer/getInitialState\");/** @namespace Store/RecentlyViewedProducts/Reducer/recentlyViewedProductsReducer */export var RecentlyViewedProductsReducer=middleware(function(){var _recentlyViewedProduc;var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:getInitialState();var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case ADD_RECENTLY_VIEWED_PRODUCT:var product=action.product,newSku=action.product.sku;var _state$recentlyViewed=state.recentlyViewedProducts,recentlyViewedProducts=_state$recentlyViewed===void 0?{}:_state$recentlyViewed;var store=action.store;var storeProducts=(_recentlyViewedProduc=recentlyViewedProducts[store])!==null&&_recentlyViewedProduc!==void 0?_recentlyViewedProduc:[];if(storeProducts.length===MAX_NUMBER_OF_RECENT_PRODUCTS){storeProducts.pop();}// Remove product from existing recentProducts to add it later in the beginning\nvar newStoreRecentProducts=storeProducts.filter(function(_ref){var sku=_ref.sku;return newSku!==sku;});newStoreRecentProducts.unshift(product);var newRecentProducts=_objectSpread(_objectSpread({},recentlyViewedProducts),{},_defineProperty({},store,newStoreRecentProducts));BrowserDatabase.setItem(newRecentProducts,RECENTLY_VIEWED_PRODUCTS);return _objectSpread(_objectSpread({},state),{},{recentlyViewedProducts:newRecentProducts,shouldBeUpdated:true});case UPDATE_RECENTLY_VIEWED_PRODUCTS:var products=action.products,storeCode=action.storeCode;var _state$recentlyViewed2=state.recentlyViewedProducts,recent=_state$recentlyViewed2===void 0?{}:_state$recentlyViewed2;var indexedProducts=getIndexedProducts(products);var recentProductsFromStorage=BrowserDatabase.getItem(RECENTLY_VIEWED_PRODUCTS)||[];// Sort products same as it is localstorage recentlyViewedProducts\nvar sortedRecentProducts=recentProductsFromStorage[storeCode].reduce(function(acc,_ref2){var sku=_ref2.sku;var sortedProduct=indexedProducts.find(function(item){return item.sku===sku;});return[].concat(_toConsumableArray(acc),[sortedProduct]);},[]);var updatedRecentViewedProducts=_objectSpread(_objectSpread({},recent),{},_defineProperty({},storeCode,sortedRecentProducts));return _objectSpread(_objectSpread({},state),{},{recentlyViewedProducts:updatedRecentViewedProducts,shouldBeUpdated:false});default:return state;}},\"Store/RecentlyViewedProducts/Reducer/recentlyViewedProductsReducer\");export default RecentlyViewedProductsReducer;","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/store/RecentlyViewedProducts/RecentlyViewedProducts.reducer.js"],"names":["MAX_NUMBER_OF_RECENT_PRODUCTS","RECENTLY_VIEWED_PRODUCTS","ADD_RECENTLY_VIEWED_PRODUCT","UPDATE_RECENTLY_VIEWED_PRODUCTS","BrowserDatabase","getIndexedProducts","getInitialState","recentlyViewedProducts","getItem","shouldBeUpdated","RecentlyViewedProductsReducer","state","action","type","product","newSku","sku","store","storeProducts","length","pop","newStoreRecentProducts","filter","unshift","newRecentProducts","setItem","products","storeCode","recent","indexedProducts","recentProductsFromStorage","sortedRecentProducts","reduce","acc","sortedProduct","find","item","updatedRecentViewedProducts"],"mappings":"4bAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAEA,OACIA,6BADJ,CAEIC,wBAFJ,oHAIA,OACIC,2BADJ,CAEIC,+BAFJ,oHAIA,MAAOC,CAAAA,eAAP,8EACA,OAASC,kBAAT,sEAEA,sEACA,MAAO,IAAMC,CAAAA,eAAe,YAAG,iBAAO,CAClCC,sBAAsB,CAAEH,eAAe,CAACI,OAAhB,CAAwBP,wBAAxB,GAAqD,EAD3C,CAElCQ,eAAe,CAAE,IAFiB,CAAP,EAAH,wDAArB,CAKP,oFACA,MAAO,IAAMC,CAAAA,6BAA6B,YAAG,UAGxC,8BAFDC,CAAAA,KAEC,2DAFOL,eAAe,EAEtB,IADDM,CAAAA,MACC,2CACD,OAAQA,MAAM,CAACC,IAAf,EACA,IAAKX,CAAAA,2BAAL,IAEQY,CAAAA,OAFR,CAIQF,MAJR,CAEQE,OAFR,CAGwBC,MAHxB,CAIQH,MAJR,CAGQE,OAHR,CAGmBE,GAHnB,2BAM4CL,KAN5C,CAMYJ,sBANZ,CAMYA,sBANZ,gCAMqC,EANrC,0BAOYU,CAAAA,KAPZ,CAOsBL,MAPtB,CAOYK,KAPZ,CAQI,GAAMC,CAAAA,aAAa,wBAAGX,sBAAsB,CAACU,KAAD,CAAzB,+DAAoC,EAAvD,CAEA,GAAIC,aAAa,CAACC,MAAd,GAAyBnB,6BAA7B,CAA4D,CACxDkB,aAAa,CAACE,GAAd,GACH,CAED;AACA,GAAMC,CAAAA,sBAAsB,CAAGH,aAAa,CAACI,MAAd,CAAqB,kBAAGN,CAAAA,GAAH,MAAGA,GAAH,OAAcD,CAAAA,MAAM,GAAKC,GAAzB,EAArB,CAA/B,CACAK,sBAAsB,CAACE,OAAvB,CAA+BT,OAA/B,EAEA,GAAMU,CAAAA,iBAAiB,gCAChBjB,sBADgB,wBAElBU,KAFkB,CAEVI,sBAFU,EAAvB,CAKAjB,eAAe,CAACqB,OAAhB,CAAwBD,iBAAxB,CAA2CvB,wBAA3C,EAEA,sCACOU,KADP,MAEIJ,sBAAsB,CAAEiB,iBAF5B,CAGIf,eAAe,CAAE,IAHrB,GAMJ,IAAKN,CAAAA,+BAAL,IAEQuB,CAAAA,QAFR,CAIQd,MAJR,CAEQc,QAFR,CAGQC,SAHR,CAIQf,MAJR,CAGQe,SAHR,4BAKoDhB,KALpD,CAKYJ,sBALZ,CAKoCqB,MALpC,iCAK6C,EAL7C,wBAOI,GAAMC,CAAAA,eAAe,CAAGxB,kBAAkB,CAACqB,QAAD,CAA1C,CACA,GAAMI,CAAAA,yBAAyB,CAAG1B,eAAe,CAACI,OAAhB,CAAwBP,wBAAxB,GAAqD,EAAvF,CAEA;AACA,GAAM8B,CAAAA,oBAAoB,CAAGD,yBAAyB,CAACH,SAAD,CAAzB,CAAqCK,MAArC,CAA4C,SAACC,GAAD,OAAkB,IAAVjB,CAAAA,GAAU,OAAVA,GAAU,CACvF,GAAMkB,CAAAA,aAAa,CAAGL,eAAe,CAACM,IAAhB,CAAqB,SAACC,IAAD,QAAUA,CAAAA,IAAI,CAACpB,GAAL,GAAaA,GAAvB,EAArB,CAAtB,CACA,mCAAWiB,GAAX,GAAgBC,aAAhB,GACH,CAH4B,CAG1B,EAH0B,CAA7B,CAKA,GAAMG,CAAAA,2BAA2B,gCAC1BT,MAD0B,wBAE5BD,SAF4B,CAEhBI,oBAFgB,EAAjC,CAKA,sCACOpB,KADP,MAEIJ,sBAAsB,CAAE8B,2BAF5B,CAGI5B,eAAe,CAAE,KAHrB,GAKJ,QACI,MAAOE,CAAAA,KAAP,CA3DJ,CA6DH,CAjEyC,sEAAnC,CAmEP,cAAeD,CAAAA,6BAAf","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport {\n    MAX_NUMBER_OF_RECENT_PRODUCTS,\n    RECENTLY_VIEWED_PRODUCTS\n} from 'Component/RecentlyViewedWidget/RecentlyViewedWidget.config';\nimport {\n    ADD_RECENTLY_VIEWED_PRODUCT,\n    UPDATE_RECENTLY_VIEWED_PRODUCTS\n} from 'Store/RecentlyViewedProducts/RecentlyViewedProducts.action';\nimport BrowserDatabase from 'Util/BrowserDatabase';\nimport { getIndexedProducts } from 'Util/Product';\n\n/** @namespace Store/RecentlyViewedProducts/Reducer/getInitialState */\nexport const getInitialState = () => ({\n    recentlyViewedProducts: BrowserDatabase.getItem(RECENTLY_VIEWED_PRODUCTS) || {},\n    shouldBeUpdated: true\n});\n\n/** @namespace Store/RecentlyViewedProducts/Reducer/recentlyViewedProductsReducer */\nexport const RecentlyViewedProductsReducer = (\n    state = getInitialState(),\n    action\n) => {\n    switch (action.type) {\n    case ADD_RECENTLY_VIEWED_PRODUCT:\n        const {\n            product,\n            product: { sku: newSku }\n        } = action;\n\n        const { recentlyViewedProducts = {} } = state;\n        const { store } = action;\n        const storeProducts = recentlyViewedProducts[store] ?? [];\n\n        if (storeProducts.length === MAX_NUMBER_OF_RECENT_PRODUCTS) {\n            storeProducts.pop();\n        }\n\n        // Remove product from existing recentProducts to add it later in the beginning\n        const newStoreRecentProducts = storeProducts.filter(({ sku }) => (newSku !== sku));\n        newStoreRecentProducts.unshift(product);\n\n        const newRecentProducts = {\n            ...recentlyViewedProducts,\n            [store]: newStoreRecentProducts\n        };\n\n        BrowserDatabase.setItem(newRecentProducts, RECENTLY_VIEWED_PRODUCTS);\n\n        return {\n            ...state,\n            recentlyViewedProducts: newRecentProducts,\n            shouldBeUpdated: true\n        };\n\n    case UPDATE_RECENTLY_VIEWED_PRODUCTS:\n        const {\n            products,\n            storeCode\n        } = action;\n        const { recentlyViewedProducts: recent = {} } = state;\n\n        const indexedProducts = getIndexedProducts(products);\n        const recentProductsFromStorage = BrowserDatabase.getItem(RECENTLY_VIEWED_PRODUCTS) || [];\n\n        // Sort products same as it is localstorage recentlyViewedProducts\n        const sortedRecentProducts = recentProductsFromStorage[storeCode].reduce((acc, { sku }) => {\n            const sortedProduct = indexedProducts.find((item) => item.sku === sku);\n            return [...acc, sortedProduct];\n        }, []);\n\n        const updatedRecentViewedProducts = {\n            ...recent,\n            [storeCode]: sortedRecentProducts\n        };\n\n        return {\n            ...state,\n            recentlyViewedProducts: updatedRecentViewedProducts,\n            shouldBeUpdated: false\n        };\n    default:\n        return state;\n    }\n};\n\nexport default RecentlyViewedProductsReducer;\n"]},"metadata":{},"sourceType":"module"}