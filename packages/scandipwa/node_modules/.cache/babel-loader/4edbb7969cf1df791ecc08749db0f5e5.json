{"ast":null,"code":"import _defineProperty from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{DEFAULT_MAX_PRODUCTS}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/ProductActions/ProductActions.config\";import SwipeToDelete from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/SwipeToDelete\";import{showNotification as _showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import{CartItemType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/MiniCart\";import{itemIsOutOfStock}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Cart\";import{CONFIGURABLE}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";import{makeCancelable}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Promise\";import{objectToUri}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Url\";import CartItem from\"./CartItem.component\";export var CartDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Cart/Cart.dispatcher\");/** @namespace Component/CartItem/Container/mapStateToProps */ // eslint-disable-next-line no-unused-vars\nexport var mapStateToProps=middleware(function(state){return{device:state.ConfigReducer.device};},\"Component/CartItem/Container/mapStateToProps\");/** @namespace Component/CartItem/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{addProduct:function addProduct(options){return CartDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.addProductToCart(dispatch,options);});},changeItemQty:function changeItemQty(options){return CartDispatcher.then(function(_ref2){var dispatcher=_ref2.default;return dispatcher.changeItemQty(dispatch,options);});},removeProduct:function removeProduct(options){return CartDispatcher.then(function(_ref3){var dispatcher=_ref3.default;return dispatcher.removeProductFromCart(dispatch,options);});},updateCrossSellProducts:function updateCrossSellProducts(items){return CartDispatcher.then(function(_ref4){var dispatcher=_ref4.default;return dispatcher.updateCrossSellProducts(items,dispatch);});},showNotification:function showNotification(type,title,error){return dispatch(_showNotification(type,title,error));}};},\"Component/CartItem/Container/mapDispatchToProps\");/** @namespace Component/CartItem/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _CartItemContainer=/*#__PURE__*/function(_Extensible){_inherits(_CartItemContainer,_Extensible);var _super=_createSuper(_CartItemContainer);function _CartItemContainer(){var _this;_classCallCheck(this,_CartItemContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isLoading:false};_this.handlers=[];_this.setStateNotLoading=_this.setStateNotLoading.bind(_assertThisInitialized(_this));_this.containerFunctions={handleChangeQuantity:_this.handleChangeQuantity.bind(_assertThisInitialized(_this)),handleRemoveItem:_this.handleRemoveItem.bind(_assertThisInitialized(_this)),getCurrentProduct:_this.getCurrentProduct.bind(_assertThisInitialized(_this)),getProductVariant:_this.getProductVariant.bind(_assertThisInitialized(_this))};_this.containerProps=function(){return{linkTo:_this._getProductLinkTo(),thumbnail:_this._getProductThumbnail(),minSaleQuantity:_this.getMinQuantity(),maxSaleQuantity:_this.getMaxQuantity(),isProductInStock:_this.productIsInStock()};};_this.renderRightSideContent=function(){var handleRemoveItem=_this.containerFunctions.handleRemoveItem;return/*#__PURE__*/_checkBEM(React,\"button\",{block:\"CartItem\",elem:\"SwipeToDeleteRightSide\",onClick:handleRemoveItem,\"aria-label\":__('Remove')},__('Delete'));};return _this;}_createClass(_CartItemContainer,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.handlers.length){[].forEach.call(this.handlers,function(cancelablePromise){return cancelablePromise.cancel();});}}},{key:\"productIsInStock\",value:function productIsInStock(){var item=this.props.item;return!itemIsOutOfStock(item);}/**\n     * @returns {Product}\n     */},{key:\"getCurrentProduct\",value:function getCurrentProduct(){var product=this.props.item.product;var variantIndex=this._getVariantIndex();return variantIndex<0?product:product.variants[variantIndex];}},{key:\"getMinQuantity\",value:function getMinQuantity(){var _ref5=this.getCurrentProduct()||{},_ref5$stock_item=_ref5.stock_item;_ref5$stock_item=_ref5$stock_item===void 0?{}:_ref5$stock_item;var min_sale_qty=_ref5$stock_item.min_sale_qty;return min_sale_qty||1;}},{key:\"getMaxQuantity\",value:function getMaxQuantity(){var _ref6=this.getCurrentProduct()||{},_ref6$stock_item=_ref6.stock_item;_ref6$stock_item=_ref6$stock_item===void 0?{}:_ref6$stock_item;var max_sale_qty=_ref6$stock_item.max_sale_qty;return max_sale_qty||DEFAULT_MAX_PRODUCTS;}},{key:\"setStateNotLoading\",value:function setStateNotLoading(){this.setState({isLoading:false});}},{key:\"handleChangeQuantity\",value:/**\n     * Handle item quantity change. Check that value is <1\n     * @param {Number} value new quantity\n     * @return {void}\n     */function handleChangeQuantity(quantity){var _this2=this;this.setState({isLoading:true},function(){var _this2$props=_this2.props,changeItemQty=_this2$props.changeItemQty,_this2$props$item=_this2$props.item,item_id=_this2$props$item.item_id,sku=_this2$props$item.sku;_this2.hideLoaderAfterPromise(changeItemQty({item_id:item_id,quantity:quantity,sku:sku}));});}/**\n     * @return {void}\n     */},{key:\"handleRemoveItem\",value:function handleRemoveItem(){var _this3=this;this.setState({isLoading:true},function(){_this3.hideLoaderAfterPromise(_this3.removeProductAndUpdateCrossSell());});}},{key:\"removeProductAndUpdateCrossSell\",value:function(){var _removeProductAndUpdateCrossSell=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$props,removeProduct,updateCrossSellProducts,updateCrossSellsOnRemove,item_id,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props=this.props,removeProduct=_this$props.removeProduct,updateCrossSellProducts=_this$props.updateCrossSellProducts,updateCrossSellsOnRemove=_this$props.updateCrossSellsOnRemove,item_id=_this$props.item.item_id;_context.next=3;return removeProduct(item_id);case 3:result=_context.sent;if(!(result&&updateCrossSellsOnRemove)){_context.next=7;break;}_context.next=7;return updateCrossSellProducts(result.items);case 7:return _context.abrupt(\"return\",result);case 8:case\"end\":return _context.stop();}}},_callee,this);}));function removeProductAndUpdateCrossSell(){return _removeProductAndUpdateCrossSell.apply(this,arguments);}return removeProductAndUpdateCrossSell;}()/**\n     * @param {Promise}\n     * @returns {cancelablePromise}\n     */},{key:\"registerCancelablePromise\",value:function registerCancelablePromise(promise){var cancelablePromise=makeCancelable(promise);this.handlers.push(cancelablePromise);return cancelablePromise;}/**\n     * @param {Promise} promise\n     * @returns {void}\n     */},{key:\"hideLoaderAfterPromise\",value:function hideLoaderAfterPromise(promise){this.registerCancelablePromise(promise).promise.then(this.setStateNotLoading,this.setStateNotLoading);}},{key:\"getProductVariant\",value:function getProductVariant(){var _this$props$item$prod=this.props.item.product.variants,variants=_this$props$item$prod===void 0?[]:_this$props$item$prod;return variants[this._getVariantIndex()];}/**\n     * @returns {Int}\n     */},{key:\"_getVariantIndex\",value:function _getVariantIndex(){var _this$props$item=this.props.item,itemSku=_this$props$item.sku,_this$props$item$prod2=_this$props$item.product;_this$props$item$prod2=_this$props$item$prod2===void 0?{}:_this$props$item$prod2;var _this$props$item$prod3=_this$props$item$prod2.variants,variants=_this$props$item$prod3===void 0?[]:_this$props$item$prod3;return variants.findIndex(function(_ref7){var sku=_ref7.sku;return sku===itemSku||itemSku.includes(sku);});}/**\n     * Get link to product page\n     * @param url_key Url to product\n     * @return {{pathname: String, state Object}} Pathname and product state\n     */},{key:\"_getProductLinkTo\",value:function _getProductLinkTo(){var _this$props$item2=this.props.item;_this$props$item2=_this$props$item2===void 0?{}:_this$props$item2;var product=_this$props$item2.product,_this$props$item2$pro=_this$props$item2.product;_this$props$item2$pro=_this$props$item2$pro===void 0?{}:_this$props$item2$pro;var type_id=_this$props$item2$pro.type_id,configurable_options=_this$props$item2$pro.configurable_options,parent=_this$props$item2$pro.parent,url=_this$props$item2$pro.url;if(type_id!==CONFIGURABLE){return{pathname:url,state:{product:product}};}var variant=this.getProductVariant();if(!variant){return{};}var attributes=variant.attributes;var parameters=Object.entries(attributes).reduce(function(parameters,_ref8){var _ref9=_slicedToArray(_ref8,2),code=_ref9[0],attribute_value=_ref9[1].attribute_value;if(Object.keys(configurable_options).includes(code)){return _objectSpread(_objectSpread({},parameters),{},_defineProperty({},code,attribute_value));}return parameters;},{});var stateProduct=parent||product;return{pathname:url,state:{product:stateProduct},search:objectToUri(parameters)};}},{key:\"_getProductThumbnail\",value:function _getProductThumbnail(){var product=this.getCurrentProduct();var _product$thumbnail=product.thumbnail;_product$thumbnail=_product$thumbnail===void 0?{}:_product$thumbnail;var thumbnail=_product$thumbnail.url;return thumbnail||'';}},{key:\"render\",value:function render(){var isLoading=this.state.isLoading;return/*#__PURE__*/_checkBEM(React,SwipeToDelete,{renderRightSideContent:this.renderRightSideContent,onAheadOfDragItemRemoveThreshold:this.containerFunctions.handleRemoveItem,isLoading:isLoading},/*#__PURE__*/_checkBEM(React,CartItem,Object.assign({},this.props,this.state,this.containerFunctions,this.containerProps())));}}]);return _CartItemContainer;}(Extensible(PureComponent));_CartItemContainer.defaultProps={updateCrossSellsOnRemove:false};Object.defineProperty(_CartItemContainer,'name',{value:'CartItemContainer'});export var CartItemContainer=middleware(_CartItemContainer,\"Component/CartItem/Container\");export default connect(mapStateToProps,mapDispatchToProps)(CartItemContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/CartItem/CartItem.container.js"],"names":["PureComponent","connect","DEFAULT_MAX_PRODUCTS","SwipeToDelete","showNotification","CartItemType","itemIsOutOfStock","CONFIGURABLE","makeCancelable","objectToUri","CartItem","CartDispatcher","mapStateToProps","state","device","ConfigReducer","mapDispatchToProps","dispatch","addProduct","options","then","dispatcher","default","addProductToCart","changeItemQty","removeProduct","removeProductFromCart","updateCrossSellProducts","items","type","title","error","CartItemContainer","isLoading","handlers","setStateNotLoading","bind","containerFunctions","handleChangeQuantity","handleRemoveItem","getCurrentProduct","getProductVariant","containerProps","linkTo","_getProductLinkTo","thumbnail","_getProductThumbnail","minSaleQuantity","getMinQuantity","maxSaleQuantity","getMaxQuantity","isProductInStock","productIsInStock","renderRightSideContent","__","length","forEach","call","cancelablePromise","cancel","item","props","product","variantIndex","_getVariantIndex","variants","stock_item","min_sale_qty","max_sale_qty","setState","quantity","item_id","sku","hideLoaderAfterPromise","removeProductAndUpdateCrossSell","updateCrossSellsOnRemove","result","promise","push","registerCancelablePromise","itemSku","findIndex","includes","type_id","configurable_options","parent","url","pathname","variant","attributes","parameters","Object","entries","reduce","code","attribute_value","keys","stateProduct","search","defaultProps","defineProperty","_CartItemContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { DEFAULT_MAX_PRODUCTS } from 'Component/ProductActions/ProductActions.config';\nimport SwipeToDelete from 'Component/SwipeToDelete';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { CartItemType } from 'Type/MiniCart';\nimport { itemIsOutOfStock } from 'Util/Cart';\nimport { CONFIGURABLE } from 'Util/Product';\nimport { makeCancelable } from 'Util/Promise';\nimport { objectToUri } from 'Util/Url';\n\nimport CartItem from './CartItem.component';\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\n\n/** @namespace Component/CartItem/Container/mapStateToProps */\n// eslint-disable-next-line no-unused-vars\nexport const mapStateToProps = (state) => ({\n    device: state.ConfigReducer.device\n});\n\n/** @namespace Component/CartItem/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    addProduct: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.addProductToCart(dispatch, options)\n    ),\n    changeItemQty: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.changeItemQty(dispatch, options)\n    ),\n    removeProduct: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.removeProductFromCart(dispatch, options)\n    ),\n    updateCrossSellProducts: (items) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.updateCrossSellProducts(items, dispatch)\n    ),\n    showNotification: (type, title, error) => dispatch(showNotification(type, title, error))\n});\n\n/** @namespace Component/CartItem/Container */\nexport class CartItemContainer extends PureComponent {\n    static propTypes = {\n        item: CartItemType.isRequired,\n        currency_code: PropTypes.string.isRequired,\n        changeItemQty: PropTypes.func.isRequired,\n        removeProduct: PropTypes.func.isRequired,\n        updateCrossSellProducts: PropTypes.func.isRequired,\n        updateCrossSellsOnRemove: PropTypes.bool\n    };\n\n    static defaultProps = {\n        updateCrossSellsOnRemove: false\n    };\n\n    state = { isLoading: false };\n\n    handlers = [];\n\n    setStateNotLoading = this.setStateNotLoading.bind(this);\n\n    containerFunctions = {\n        handleChangeQuantity: this.handleChangeQuantity.bind(this),\n        handleRemoveItem: this.handleRemoveItem.bind(this),\n        getCurrentProduct: this.getCurrentProduct.bind(this),\n        getProductVariant: this.getProductVariant.bind(this)\n    };\n\n    componentWillUnmount() {\n        if (this.handlers.length) {\n            [].forEach.call(this.handlers, (cancelablePromise) => cancelablePromise.cancel());\n        }\n    }\n\n    productIsInStock() {\n        const { item } = this.props;\n        return !itemIsOutOfStock(item);\n    }\n\n    /**\n     * @returns {Product}\n     */\n    getCurrentProduct() {\n        const { item: { product } } = this.props;\n        const variantIndex = this._getVariantIndex();\n\n        return variantIndex < 0\n            ? product\n            : product.variants[variantIndex];\n    }\n\n    getMinQuantity() {\n        const { stock_item: { min_sale_qty } = {} } = this.getCurrentProduct() || {};\n        return min_sale_qty || 1;\n    }\n\n    getMaxQuantity() {\n        const { stock_item: { max_sale_qty } = {} } = this.getCurrentProduct() || {};\n        return max_sale_qty || DEFAULT_MAX_PRODUCTS;\n    }\n\n    setStateNotLoading() {\n        this.setState({ isLoading: false });\n    }\n\n    containerProps = () => ({\n        linkTo: this._getProductLinkTo(),\n        thumbnail: this._getProductThumbnail(),\n        minSaleQuantity: this.getMinQuantity(),\n        maxSaleQuantity: this.getMaxQuantity(),\n        isProductInStock: this.productIsInStock()\n    });\n\n    /**\n     * Handle item quantity change. Check that value is <1\n     * @param {Number} value new quantity\n     * @return {void}\n     */\n    handleChangeQuantity(quantity) {\n        this.setState({ isLoading: true }, () => {\n            const { changeItemQty, item: { item_id, sku } } = this.props;\n            this.hideLoaderAfterPromise(changeItemQty({ item_id, quantity, sku }));\n        });\n    }\n\n    /**\n     * @return {void}\n     */\n    handleRemoveItem() {\n        this.setState({ isLoading: true }, () => {\n            this.hideLoaderAfterPromise(this.removeProductAndUpdateCrossSell());\n        });\n    }\n\n    async removeProductAndUpdateCrossSell() {\n        const {\n            removeProduct,\n            updateCrossSellProducts,\n            updateCrossSellsOnRemove,\n            item: { item_id }\n        } = this.props;\n\n        const result = await removeProduct(item_id);\n\n        if (result && updateCrossSellsOnRemove) {\n            await updateCrossSellProducts(result.items);\n        }\n\n        return result;\n    }\n\n    /**\n     * @param {Promise}\n     * @returns {cancelablePromise}\n     */\n    registerCancelablePromise(promise) {\n        const cancelablePromise = makeCancelable(promise);\n        this.handlers.push(cancelablePromise);\n        return cancelablePromise;\n    }\n\n    /**\n     * @param {Promise} promise\n     * @returns {void}\n     */\n    hideLoaderAfterPromise(promise) {\n        this.registerCancelablePromise(promise)\n            .promise.then(this.setStateNotLoading, this.setStateNotLoading);\n    }\n\n    getProductVariant() {\n        const {\n            item: {\n                product: {\n                    variants = []\n                }\n            }\n        } = this.props;\n\n        return variants[this._getVariantIndex()];\n    }\n\n    /**\n     * @returns {Int}\n     */\n    _getVariantIndex() {\n        const {\n            item: {\n                sku: itemSku,\n                product: { variants = [] } = {}\n            }\n        } = this.props;\n\n        return variants.findIndex(({ sku }) => sku === itemSku || itemSku.includes(sku));\n    }\n\n    /**\n     * Get link to product page\n     * @param url_key Url to product\n     * @return {{pathname: String, state Object}} Pathname and product state\n     */\n    _getProductLinkTo() {\n        const {\n            item: {\n                product,\n                product: {\n                    type_id,\n                    configurable_options,\n                    parent,\n                    url\n                } = {}\n            } = {}\n        } = this.props;\n\n        if (type_id !== CONFIGURABLE) {\n            return {\n                pathname: url,\n                state: { product }\n            };\n        }\n\n        const variant = this.getProductVariant();\n        if (!variant) {\n            return {};\n        }\n        const { attributes } = variant;\n\n        const parameters = Object.entries(attributes).reduce(\n            (parameters, [code, { attribute_value }]) => {\n                if (Object.keys(configurable_options).includes(code)) {\n                    return { ...parameters, [code]: attribute_value };\n                }\n\n                return parameters;\n            }, {}\n        );\n\n        const stateProduct = parent || product;\n\n        return {\n            pathname: url,\n            state: { product: stateProduct },\n            search: objectToUri(parameters)\n        };\n    }\n\n    _getProductThumbnail() {\n        const product = this.getCurrentProduct();\n        const { thumbnail: { url: thumbnail } = {} } = product;\n        return thumbnail || '';\n    }\n\n    renderRightSideContent = () => {\n        const { handleRemoveItem } = this.containerFunctions;\n        return (\n            <button\n              block=\"CartItem\"\n              elem=\"SwipeToDeleteRightSide\"\n              onClick={ handleRemoveItem }\n              aria-label={ __('Remove') }\n            >\n                { __('Delete') }\n            </button>\n        );\n    };\n\n    render() {\n        const { isLoading } = this.state;\n\n        return (\n            <SwipeToDelete\n              renderRightSideContent={ this.renderRightSideContent }\n              onAheadOfDragItemRemoveThreshold={ this.containerFunctions.handleRemoveItem }\n              isLoading={ isLoading }\n            >\n                <CartItem\n                  { ...this.props }\n                  { ...this.state }\n                  { ...this.containerFunctions }\n                  { ...this.containerProps() }\n                />\n            </SwipeToDelete>\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CartItemContainer);\n"]},"metadata":{},"sourceType":"module"}