{"ast":null,"code":"var _jsxFileName = \"/home/marketihor/scandipwa/packages/scandipwa/src/component/AddToCart/AddToCart.container.js\";\n\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { showNotification } from \"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";\nimport { ProductType } from \"/home/marketihor/scandipwa/packages/scandipwa/src/type/ProductList\";\nimport { isSignedIn } from \"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";\nimport { BUNDLE, CONFIGURABLE, GROUPED } from \"/home/marketihor/scandipwa/packages/scandipwa/src/util/Product\";\nimport AddToCart from \"./AddToCart.component\";\nexport const CartDispatcher = import(\n/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Cart/Cart.dispatcher\");\nexport const WishlistDispatcher = import(\n/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Wishlist/Wishlist.dispatcher\");\n/** @namespace Component/AddToCart/Container/mapStateToProps */\n\nexport const mapStateToProps = middleware(function (state) {\n  return {\n    wishlistItems: state.WishlistReducer.productsInWishlist\n  };\n}, \"Component/AddToCart/Container/mapStateToProps\");\n/** @namespace Component/AddToCart/Container/mapDispatchToProps */\n\nexport const mapDispatchToProps = middleware(function (dispatch) {\n  return {\n    addProduct: function (options) {\n      return CartDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.addProductToCart(dispatch, options);\n      });\n    },\n    removeFromWishlist: function (options) {\n      return WishlistDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.removeItemFromWishlist(dispatch, options);\n      });\n    },\n    showNotification: function (type, message) {\n      return dispatch(showNotification(type, message));\n    }\n  };\n}, \"Component/AddToCart/Container/mapDispatchToProps\");\n/* @namespace Component/AddToCart/Container */\n\nvar _checkBEM = require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;\n\nexport class _AddToCartContainer extends Extensible(PureComponent) {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isLoading: false\n    };\n    this.containerFunctions = {\n      buttonClick: this.buttonClick.bind(this)\n    };\n    this.validationMap = {\n      [CONFIGURABLE]: this.validateConfigurableProduct.bind(this),\n      [GROUPED]: this.validateGroupedProduct.bind(this),\n      [BUNDLE]: this.validateBundleProduct.bind(this)\n    };\n    this.addToCartHandlerMap = {\n      [CONFIGURABLE]: this.addConfigurableProductToCart.bind(this),\n      [GROUPED]: this.addGroupedProductToCart.bind(this)\n    };\n  }\n\n  validateConfigurableProduct() {\n    const {\n      configurableVariantIndex,\n      showNotification,\n      product: {\n        variants = []\n      }\n    } = this.props;\n\n    if (configurableVariantIndex < 0 || !variants[configurableVariantIndex]) {\n      showNotification('info', __('Please select product options!'));\n      return false;\n    }\n\n    const {\n      stock_status: configurableStock\n    } = variants[configurableVariantIndex];\n\n    if (configurableStock !== 'IN_STOCK') {\n      showNotification('info', __('Sorry! The selected product option is out of stock!'));\n      return false;\n    }\n\n    return true;\n  }\n\n  validateGroupedProduct() {\n    const {\n      groupedProductQuantity,\n      showNotification,\n      product: {\n        items\n      }\n    } = this.props;\n    const isAllItemsAvailable = items.some(function ({\n      product: {\n        id\n      }\n    }) {\n      return groupedProductQuantity[id];\n    });\n\n    if (!isAllItemsAvailable) {\n      showNotification('info', __('Please specify the quantity of product(s)!'));\n      return false;\n    }\n\n    return true;\n  }\n\n  validateBundleProduct() {\n    const {\n      productOptionsData,\n      showNotification\n    } = this.props;\n    const validateBundleOptions = this.validateCustomizableOptions(productOptionsData, true);\n\n    if (!validateBundleOptions) {\n      showNotification('info', __('Please select required option!'));\n      return false;\n    }\n\n    return true;\n  }\n\n  validateSimpleProduct() {\n    const {\n      productOptionsData,\n      showNotification\n    } = this.props;\n    const validateCustomizableOptions = this.validateCustomizableOptions(productOptionsData);\n\n    if (!validateCustomizableOptions) {\n      showNotification('info', __('Please select required option!'));\n      return false;\n    }\n\n    return true;\n  }\n\n  validateCustomizableOptions(productOptionsData, isBundle = false) {\n    const {\n      requiredOptions = {}\n    } = productOptionsData || {};\n\n    if (requiredOptions.length) {\n      const {\n        productOptions,\n        productOptionsMulti,\n        requiredOptions\n      } = productOptionsData;\n      return this.validateProductOptions([...(productOptions || []), ...(productOptionsMulti || [])], requiredOptions, isBundle);\n    }\n\n    return true;\n  }\n\n  validateProductOptions(items, requiredOptions, isBundle = false) {\n    // Make sure EVERY required option is FOUND in selected items\n    return requiredOptions.every(function (requiredOption) {\n      return items.find(function (item) {\n        const {\n          id,\n          option_id\n        } = item;\n        const matchWith = isBundle ? id : option_id;\n        return requiredOption === matchWith;\n      });\n    });\n  }\n\n  validateAddToCart() {\n    const {\n      product: {\n        type_id\n      }\n    } = this.props;\n    const validationRule = this.validationMap[type_id];\n\n    if (validationRule) {\n      return validationRule();\n    }\n\n    return this.validateSimpleProduct();\n  }\n\n  addGroupedProductToCart() {\n    var _this = this;\n\n    const {\n      product,\n      product: {\n        items\n      },\n      groupedProductQuantity,\n      addProduct\n    } = this.props;\n    Promise.all(items.map(function (item) {\n      const {\n        product: groupedProductItem\n      } = item;\n      const newProduct = { ...groupedProductItem,\n        parent: product\n      };\n      const quantity = groupedProductQuantity[groupedProductItem.id];\n\n      if (!quantity) {\n        return Promise.resolve();\n      }\n\n      return addProduct({\n        product: newProduct,\n        quantity\n      });\n    })).then(\n    /** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllThen */\n    middleware(function () {\n      return _this.afterAddToCart();\n    }, \"Component/AddToCart/Container/addGroupedProductToCartPromiseAllThen\"),\n    /** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllCatch */\n    middleware(function () {\n      return _this.resetLoading();\n    }, \"Component/AddToCart/Container/addGroupedProductToCartPromiseAllCatch\"));\n  }\n\n  addConfigurableProductToCart() {\n    var _this2 = this;\n\n    const {\n      product,\n      quantity,\n      addProduct,\n      configurableVariantIndex,\n      productOptionsData\n    } = this.props;\n    addProduct({\n      product: { ...product,\n        configurableVariantIndex\n      },\n      quantity,\n      productOptionsData\n    }).then(\n    /** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductThen */\n    middleware(function () {\n      return _this2.afterAddToCart();\n    }, \"Component/AddToCart/Container/addConfigurableProductToCartAddProductThen\"),\n    /** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductCatch */\n    middleware(function () {\n      return _this2.resetLoading();\n    }, \"Component/AddToCart/Container/addConfigurableProductToCartAddProductCatch\"));\n  }\n\n  addSimpleProductToCart() {\n    var _this3 = this;\n\n    const {\n      product,\n      quantity,\n      addProduct,\n      productOptionsData\n    } = this.props;\n    addProduct({\n      product,\n      quantity,\n      productOptionsData\n    }).then(\n    /** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductThen */\n    middleware(function () {\n      return _this3.afterAddToCart();\n    }, \"Component/AddToCart/Container/addSimpleProductToCartAddProductThen\"),\n    /** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductCatch */\n    middleware(function () {\n      return _this3.resetLoading();\n    }, \"Component/AddToCart/Container/addSimpleProductToCartAddProductCatch\"));\n  }\n\n  addProductToCart() {\n    const {\n      product: {\n        type_id\n      }\n    } = this.props;\n    const addToCartHandler = this.addToCartHandlerMap[type_id];\n\n    if (addToCartHandler) {\n      addToCartHandler();\n      return;\n    }\n\n    this.addSimpleProductToCart();\n  }\n\n  buttonClick() {\n    var _this4 = this;\n\n    const {\n      product: {\n        type_id\n      } = {},\n      onProductValidationError,\n      disableHandler\n    } = this.props;\n\n    if (disableHandler) {\n      return;\n    }\n\n    if (!this.validateAddToCart()) {\n      onProductValidationError(type_id);\n      return;\n    }\n\n    this.setState({\n      isLoading: true\n    }, function () {\n      return _this4.addProductToCart();\n    });\n  }\n\n  resetLoading() {\n    this.setState({\n      isLoading: false\n    });\n  }\n\n  removeProductFromWishlist() {\n    const {\n      wishlistItems,\n      removeFromWishlist,\n      configurableVariantIndex,\n      product: {\n        type_id,\n        variants = {}\n      } = {}\n    } = this.props;\n\n    if (type_id !== 'configurable') {\n      return;\n    }\n\n    const {\n      sku\n    } = variants[configurableVariantIndex];\n    const wishlistItemKey = Object.keys(wishlistItems).find(function (key) {\n      const {\n        wishlist: {\n          sku: wSku\n        }\n      } = wishlistItems[key];\n      return wSku === sku;\n    });\n\n    if (!isSignedIn() || wishlistItemKey === undefined) {\n      return;\n    }\n\n    const {\n      wishlist: {\n        id: item_id\n      }\n    } = wishlistItems[wishlistItemKey];\n    removeFromWishlist({\n      item_id,\n      sku,\n      noMessage: true\n    });\n  }\n\n  afterAddToCart() {\n    const {\n      showNotification,\n      setQuantityToDefault\n    } = this.props;\n    showNotification('success', __('Product added to cart!'));\n    setQuantityToDefault();\n    this.removeProductFromWishlist();\n    this.setState({\n      isLoading: false\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_checkBEM(React, AddToCart, Object.assign({}, this.props, this.state, this.containerFunctions, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 13\n      }\n    }));\n  }\n\n}\n_AddToCartContainer.propTypes = {\n  isLoading: PropTypes.bool,\n  product: ProductType.isRequired,\n  quantity: PropTypes.number,\n  configurableVariantIndex: PropTypes.number,\n  groupedProductQuantity: PropTypes.objectOf(PropTypes.number).isRequired,\n  showNotification: PropTypes.func.isRequired,\n  setQuantityToDefault: PropTypes.func,\n  addProduct: PropTypes.func.isRequired,\n  removeFromWishlist: PropTypes.func.isRequired,\n  wishlistItems: PropTypes.objectOf(ProductType).isRequired,\n  onProductValidationError: PropTypes.func,\n  productOptionsData: PropTypes.object.isRequired,\n  disableHandler: PropTypes.bool\n};\n_AddToCartContainer.defaultProps = {\n  quantity: 1,\n  configurableVariantIndex: 0,\n  setQuantityToDefault: function () {},\n  onProductValidationError: function () {},\n  isLoading: false,\n  disableHandler: false\n};\nObject.defineProperty(_AddToCartContainer, 'name', {\n  value: 'AddToCartContainer'\n});\n\nexport const AddToCartContainer = middleware(_AddToCartContainer, \"Component/AddToCart/Container\");\nexport default connect(mapStateToProps, mapDispatchToProps)(AddToCartContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/AddToCart/AddToCart.container.js"],"names":["PropTypes","PureComponent","connect","showNotification","ProductType","isSignedIn","BUNDLE","CONFIGURABLE","GROUPED","AddToCart","CartDispatcher","WishlistDispatcher","mapStateToProps","state","wishlistItems","WishlistReducer","productsInWishlist","mapDispatchToProps","dispatch","addProduct","options","then","default","dispatcher","addProductToCart","removeFromWishlist","removeItemFromWishlist","type","message","AddToCartContainer","isLoading","containerFunctions","buttonClick","bind","validationMap","validateConfigurableProduct","validateGroupedProduct","validateBundleProduct","addToCartHandlerMap","addConfigurableProductToCart","addGroupedProductToCart","configurableVariantIndex","product","variants","props","__","stock_status","configurableStock","groupedProductQuantity","items","isAllItemsAvailable","some","id","productOptionsData","validateBundleOptions","validateCustomizableOptions","validateSimpleProduct","isBundle","requiredOptions","length","productOptions","productOptionsMulti","validateProductOptions","every","requiredOption","find","item","option_id","matchWith","validateAddToCart","type_id","validationRule","Promise","all","map","groupedProductItem","newProduct","parent","quantity","resolve","afterAddToCart","resetLoading","addSimpleProductToCart","addToCartHandler","onProductValidationError","disableHandler","setState","removeProductFromWishlist","sku","wishlistItemKey","Object","keys","key","wishlist","wSku","undefined","item_id","noMessage","setQuantityToDefault","render","propTypes","bool","isRequired","number","objectOf","func","object","defaultProps","defineProperty","_AddToCartContainer","value"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { ProductType } from 'Type/ProductList';\nimport { isSignedIn } from 'Util/Auth';\nimport {\n    BUNDLE,\n    CONFIGURABLE,\n    GROUPED\n} from 'Util/Product';\n\nimport AddToCart from './AddToCart.component';\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\n\nexport const WishlistDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Wishlist/Wishlist.dispatcher'\n);\n\n/** @namespace Component/AddToCart/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    wishlistItems: state.WishlistReducer.productsInWishlist\n});\n\n/** @namespace Component/AddToCart/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    addProduct: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.addProductToCart(dispatch, options)\n    ),\n    removeFromWishlist: (options) => WishlistDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.removeItemFromWishlist(dispatch, options)\n    ),\n    showNotification: (type, message) => dispatch(showNotification(type, message))\n});\n\n/* @namespace Component/AddToCart/Container */\nexport class AddToCartContainer extends PureComponent {\n    static propTypes = {\n        isLoading: PropTypes.bool,\n        product: ProductType.isRequired,\n        quantity: PropTypes.number,\n        configurableVariantIndex: PropTypes.number,\n        groupedProductQuantity: PropTypes.objectOf(PropTypes.number).isRequired,\n        showNotification: PropTypes.func.isRequired,\n        setQuantityToDefault: PropTypes.func,\n        addProduct: PropTypes.func.isRequired,\n        removeFromWishlist: PropTypes.func.isRequired,\n        wishlistItems: PropTypes.objectOf(ProductType).isRequired,\n        onProductValidationError: PropTypes.func,\n        productOptionsData: PropTypes.object.isRequired,\n        disableHandler: PropTypes.bool\n    };\n\n    static defaultProps = {\n        quantity: 1,\n        configurableVariantIndex: 0,\n        setQuantityToDefault: () => {},\n        onProductValidationError: () => {},\n        isLoading: false,\n        disableHandler: false\n    };\n\n    state = { isLoading: false };\n\n    containerFunctions = {\n        buttonClick: this.buttonClick.bind(this)\n    };\n\n    validationMap = {\n        [CONFIGURABLE]: this.validateConfigurableProduct.bind(this),\n        [GROUPED]: this.validateGroupedProduct.bind(this),\n        [BUNDLE]: this.validateBundleProduct.bind(this)\n    };\n\n    addToCartHandlerMap = {\n        [CONFIGURABLE]: this.addConfigurableProductToCart.bind(this),\n        [GROUPED]: this.addGroupedProductToCart.bind(this)\n    };\n\n    validateConfigurableProduct() {\n        const {\n            configurableVariantIndex,\n            showNotification,\n            product: {\n                variants = []\n            }\n        } = this.props;\n\n        if (configurableVariantIndex < 0 || !variants[configurableVariantIndex]) {\n            showNotification('info', __('Please select product options!'));\n            return false;\n        }\n\n        const { stock_status: configurableStock } = variants[configurableVariantIndex];\n\n        if (configurableStock !== 'IN_STOCK') {\n            showNotification('info', __('Sorry! The selected product option is out of stock!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateGroupedProduct() {\n        const {\n            groupedProductQuantity,\n            showNotification,\n            product: {\n                items\n            }\n        } = this.props;\n\n        const isAllItemsAvailable = items.some(({ product: { id } }) => groupedProductQuantity[id]);\n\n        if (!isAllItemsAvailable) {\n            showNotification('info', __('Please specify the quantity of product(s)!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateBundleProduct() {\n        const {\n            productOptionsData,\n            showNotification\n        } = this.props;\n\n        const validateBundleOptions = this.validateCustomizableOptions(productOptionsData, true);\n\n        if (!validateBundleOptions) {\n            showNotification('info', __('Please select required option!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateSimpleProduct() {\n        const {\n            productOptionsData,\n            showNotification\n        } = this.props;\n\n        const validateCustomizableOptions = this.validateCustomizableOptions(productOptionsData);\n\n        if (!validateCustomizableOptions) {\n            showNotification('info', __('Please select required option!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateCustomizableOptions(productOptionsData, isBundle = false) {\n        const {\n            requiredOptions = {}\n        } = productOptionsData || {};\n\n        if (requiredOptions.length) {\n            const {\n                productOptions,\n                productOptionsMulti,\n                requiredOptions\n            } = productOptionsData;\n\n            return this.validateProductOptions(\n                [...productOptions || [], ...productOptionsMulti || []],\n                requiredOptions,\n                isBundle\n            );\n        }\n\n        return true;\n    }\n\n    validateProductOptions(items, requiredOptions, isBundle = false) {\n        // Make sure EVERY required option is FOUND in selected items\n        return requiredOptions.every((requiredOption) => (\n            items.find((item) => {\n                const { id, option_id } = item;\n                const matchWith = isBundle ? id : option_id;\n                return requiredOption === matchWith;\n            })\n        ));\n    }\n\n    validateAddToCart() {\n        const {\n            product: { type_id }\n        } = this.props;\n\n        const validationRule = this.validationMap[type_id];\n\n        if (validationRule) {\n            return validationRule();\n        }\n\n        return this.validateSimpleProduct();\n    }\n\n    addGroupedProductToCart() {\n        const {\n            product,\n            product: { items },\n            groupedProductQuantity,\n            addProduct\n        } = this.props;\n\n        Promise.all(items.map((item) => {\n            const { product: groupedProductItem } = item;\n\n            const newProduct = {\n                ...groupedProductItem,\n                parent: product\n            };\n\n            const quantity = groupedProductQuantity[groupedProductItem.id];\n\n            if (!quantity) {\n                return Promise.resolve();\n            }\n\n            return addProduct({\n                product: newProduct,\n                quantity\n            });\n        })).then(\n            /** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllThen */\n            () => this.afterAddToCart(),\n            /** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllCatch */\n            () => this.resetLoading()\n        );\n    }\n\n    addConfigurableProductToCart() {\n        const {\n            product,\n            quantity,\n            addProduct,\n            configurableVariantIndex,\n            productOptionsData\n        } = this.props;\n\n        addProduct({\n            product: {\n                ...product,\n                configurableVariantIndex\n            },\n            quantity,\n            productOptionsData\n        }).then(\n            /** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductThen */\n            () => this.afterAddToCart(),\n            /** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductCatch */\n            () => this.resetLoading()\n        );\n    }\n\n    addSimpleProductToCart() {\n        const {\n            product,\n            quantity,\n            addProduct,\n            productOptionsData\n        } = this.props;\n\n        addProduct({\n            product,\n            quantity,\n            productOptionsData\n        }).then(\n            /** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductThen */\n            () => this.afterAddToCart(),\n            /** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductCatch */\n            () => this.resetLoading()\n        );\n    }\n\n    addProductToCart() {\n        const {\n            product: { type_id }\n        } = this.props;\n\n        const addToCartHandler = this.addToCartHandlerMap[type_id];\n\n        if (addToCartHandler) {\n            addToCartHandler();\n            return;\n        }\n\n        this.addSimpleProductToCart();\n    }\n\n    buttonClick() {\n        const {\n            product: { type_id } = {},\n            onProductValidationError,\n            disableHandler\n        } = this.props;\n\n        if (disableHandler) {\n            return;\n        }\n\n        if (!this.validateAddToCart()) {\n            onProductValidationError(type_id);\n            return;\n        }\n\n        this.setState({ isLoading: true }, () => this.addProductToCart());\n    }\n\n    resetLoading() {\n        this.setState({ isLoading: false });\n    }\n\n    removeProductFromWishlist() {\n        const {\n            wishlistItems,\n            removeFromWishlist,\n            configurableVariantIndex,\n            product: { type_id, variants = {} } = {}\n        } = this.props;\n\n        if (type_id !== 'configurable') {\n            return;\n        }\n\n        const { sku } = variants[configurableVariantIndex];\n\n        const wishlistItemKey = Object.keys(wishlistItems)\n            .find((key) => {\n                const { wishlist: { sku: wSku } } = wishlistItems[key];\n                return wSku === sku;\n            });\n\n        if (!isSignedIn() || wishlistItemKey === undefined) {\n            return;\n        }\n\n        const { wishlist: { id: item_id } } = wishlistItems[wishlistItemKey];\n        removeFromWishlist({ item_id, sku, noMessage: true });\n    }\n\n    afterAddToCart() {\n        const {\n            showNotification,\n            setQuantityToDefault\n        } = this.props;\n\n        showNotification('success', __('Product added to cart!'));\n        setQuantityToDefault();\n\n        this.removeProductFromWishlist();\n        this.setState({ isLoading: false });\n    }\n\n    render() {\n        return (\n            <AddToCart\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerFunctions }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AddToCartContainer);\n"]},"metadata":{},"sourceType":"module"}