{"ast":null,"code":"import _defineProperty from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{withRouter}from'react-router';import{FILTER}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/Header/Header.config\";import{changeNavigationState as _changeNavigationState,goToPreviousNavigationState as _goToPreviousNavigationState}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.action\";import{BOTTOM_NAVIGATION_TYPE,TOP_NAVIGATION_TYPE}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.reducer\";import{hideActiveOverlay as _hideActiveOverlay}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Overlay/Overlay.action\";import{HistoryType,LocationType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Common\";import{getQueryParam,setQueryParams}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Url\";import CategoryFilterOverlay from\"./CategoryFilterOverlay.component\";/** @namespace Component/CategoryFilterOverlay/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{isInfoLoading:state.ProductListInfoReducer.isLoading,isProductsLoading:state.ProductListReducer.isLoading,totalPages:state.ProductListReducer.totalPages};},\"Component/CategoryFilterOverlay/Container/mapStateToProps\");/** @namespace Component/CategoryFilterOverlay/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{hideActiveOverlay:function hideActiveOverlay(){return dispatch(_hideActiveOverlay());},goToPreviousHeaderState:function goToPreviousHeaderState(){return dispatch(_goToPreviousNavigationState(TOP_NAVIGATION_TYPE));},goToPreviousNavigationState:function goToPreviousNavigationState(){return dispatch(_goToPreviousNavigationState(BOTTOM_NAVIGATION_TYPE));},changeHeaderState:function changeHeaderState(state){return dispatch(_changeNavigationState(TOP_NAVIGATION_TYPE,state));},changeNavigationState:function changeNavigationState(state){return dispatch(_changeNavigationState(BOTTOM_NAVIGATION_TYPE,state));}};},\"Component/CategoryFilterOverlay/Container/mapDispatchToProps\");/** @namespace Component/CategoryFilterOverlay/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _CategoryFilterOverlayContainer=/*#__PURE__*/function(_Extensible){_inherits(_CategoryFilterOverlayContainer,_Extensible);var _super=_createSuper(_CategoryFilterOverlayContainer);function _CategoryFilterOverlayContainer(){var _this;_classCallCheck(this,_CategoryFilterOverlayContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.containerFunctions={onSeeResultsClick:_this.onSeeResultsClick.bind(_assertThisInitialized(_this)),toggleCustomFilter:_this.toggleCustomFilter.bind(_assertThisInitialized(_this)),getFilterUrl:_this.getCustomFilterUrl.bind(_assertThisInitialized(_this)),onVisible:_this.onVisible.bind(_assertThisInitialized(_this)),onHide:_this.onHide.bind(_assertThisInitialized(_this))};_this.historyBackHook=function(){var _this$props=_this.props,goToPreviousNavigationState=_this$props.goToPreviousNavigationState,customFiltersValues=_this$props.customFiltersValues,hideActiveOverlay=_this$props.hideActiveOverlay,goToPreviousHeaderState=_this$props.goToPreviousHeaderState;goToPreviousNavigationState();// close filter only if no applied filters left\nif(Object.keys(customFiltersValues).length===0){hideActiveOverlay();goToPreviousHeaderState();}};_this.containerProps=function(){return{areFiltersEmpty:_this.getAreFiltersEmpty(),isContentFiltered:_this.isContentFiltered()};};return _this;}_createClass(_CategoryFilterOverlayContainer,[{key:\"updateFilter\",value:function updateFilter(filterName,filterArray){var _this$props2=this.props,location=_this$props2.location,history=_this$props2.history;setQueryParams({customFilters:this.getFilterUrl(filterName,filterArray,false),page:''},location,history);}},{key:\"toggleCustomFilter\",value:function toggleCustomFilter(requestVar,value){this.updateFilter(requestVar,this._getNewFilterArray(requestVar,value));}},{key:\"getFilterUrl\",value:function getFilterUrl(filterName,filterArray){var isFull=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var pathname=this.props.location.pathname;var selectedFilters=this._getNewSelectedFiltersString(filterName,filterArray);var customFilters=isFull?\"\".concat(pathname,\"?customFilters=\"):'';var formattedFilters=this._formatSelectedFiltersString(selectedFilters);return\"\".concat(customFilters).concat(formattedFilters);}},{key:\"getCustomFilterUrl\",value:function getCustomFilterUrl(filterKey,value){return this.getFilterUrl(filterKey,this._getNewFilterArray(filterKey,value));}},{key:\"_getSelectedFiltersFromUrl\",value:function _getSelectedFiltersFromUrl(){var location=this.props.location;var selectedFiltersString=(getQueryParam('customFilters',location)||'').split(';');return selectedFiltersString.reduce(function(acc,filter){if(!filter){return acc;}var _filter$split=filter.split(':'),_filter$split2=_slicedToArray(_filter$split,2),key=_filter$split2[0],value=_filter$split2[1];return _objectSpread(_objectSpread({},acc),{},_defineProperty({},key,value.split(',')));},{});}},{key:\"_getNewSelectedFiltersString\",value:function _getNewSelectedFiltersString(filterName,filterArray){var prevCustomFilters=this._getSelectedFiltersFromUrl();var customFilers=_objectSpread(_objectSpread({},prevCustomFilters),{},_defineProperty({},filterName,filterArray));return Object.entries(customFilers).reduce(function(accumulator,_ref){var _ref2=_slicedToArray(_ref,2),filterKey=_ref2[0],filterValue=_ref2[1];if(filterValue.length){var filterValues=filterValue.sort().join(',');accumulator.push(\"\".concat(filterKey,\":\").concat(filterValues));}return accumulator;},[]).sort().join(';');}},{key:\"_formatSelectedFiltersString\",value:function _formatSelectedFiltersString(string){var hasTrailingSemicolon=string[string.length-1]===';';var hasLeadingSemicolon=string[0]===';';if(hasLeadingSemicolon){return this._formatSelectedFiltersString(string.slice(0,-1));}if(hasTrailingSemicolon){return string.slice(1);}return string;}},{key:\"onSeeResultsClick\",value:function onSeeResultsClick(){var _this$props3=this.props,hideActiveOverlay=_this$props3.hideActiveOverlay,goToPreviousHeaderState=_this$props3.goToPreviousHeaderState,goToPreviousNavigationState=_this$props3.goToPreviousNavigationState;hideActiveOverlay();goToPreviousHeaderState();goToPreviousNavigationState();}},{key:\"onVisible\",value:function onVisible(){var _this$props4=this.props,hideActiveOverlay=_this$props4.hideActiveOverlay,changeHeaderState=_this$props4.changeHeaderState,changeNavigationState=_this$props4.changeNavigationState,goToPreviousNavigationState=_this$props4.goToPreviousNavigationState,_this$props4$location=_this$props4.location,pathname=_this$props4$location.pathname,search=_this$props4$location.search;changeHeaderState({name:FILTER,title:__('Filters'),onCloseClick:function onCloseClick(){hideActiveOverlay();goToPreviousNavigationState();}});changeNavigationState({name:FILTER,isHidden:true});window.addEventListener('popstate',this.historyBackHook);history.pushState({overlayOpen:true},'',pathname+search);}},{key:\"onHide\",value:function onHide(){window.removeEventListener('popstate',this.historyBackHook);}},{key:\"getAreFiltersEmpty\",value:function getAreFiltersEmpty(){var _this$props5=this.props,isInfoLoading=_this$props5.isInfoLoading,availableFilters=_this$props5.availableFilters;return!isInfoLoading&&(!availableFilters||!Object.keys(availableFilters).length);}},{key:\"isContentFiltered\",value:function isContentFiltered(){var _this$urlStringToObje=this.urlStringToObject(),customFilters=_this$urlStringToObje.customFilters,priceMin=_this$urlStringToObje.priceMin,priceMax=_this$urlStringToObje.priceMax;return!!(customFilters||priceMin||priceMax);}},{key:\"urlStringToObject\",value:function urlStringToObject(){var search=this.props.location.search;return search.substr(1).split('&').reduce(function(acc,part){var _part$split=part.split('='),_part$split2=_slicedToArray(_part$split,2),key=_part$split2[0],value=_part$split2[1];return _objectSpread(_objectSpread({},acc),{},_defineProperty({},key,value));},{});}/**\n     * Returns filter array with new parameters\n     *\n     * @param {String} filterKey key of option\n     * @param {String} value\n     * @returns {Object[]}\n     * @memberof CategoryShoppingOptions\n     */},{key:\"_getNewFilterArray\",value:function _getNewFilterArray(filterKey,value){var customFiltersValues=this.props.customFiltersValues;var newFilterArray=customFiltersValues[filterKey]!==undefined?Array.from(customFiltersValues[filterKey]):[];var filterValueIndex=newFilterArray.indexOf(value);if(filterKey==='price'){// for price filter, choose one\nreturn[value];}if(filterValueIndex===-1){newFilterArray.push(value);}else{newFilterArray.splice(filterValueIndex,1);}return newFilterArray;}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,CategoryFilterOverlay,Object.assign({},this.props,this.containerFunctions,this.containerProps()));}}]);return _CategoryFilterOverlayContainer;}(Extensible(PureComponent));Object.defineProperty(_CategoryFilterOverlayContainer,'name',{value:'CategoryFilterOverlayContainer'});export var CategoryFilterOverlayContainer=middleware(_CategoryFilterOverlayContainer,\"Component/CategoryFilterOverlay/Container\");export default withRouter(connect(mapStateToProps,mapDispatchToProps)(CategoryFilterOverlayContainer));","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/CategoryFilterOverlay/CategoryFilterOverlay.container.js"],"names":["PureComponent","connect","withRouter","FILTER","changeNavigationState","goToPreviousNavigationState","BOTTOM_NAVIGATION_TYPE","TOP_NAVIGATION_TYPE","hideActiveOverlay","HistoryType","LocationType","getQueryParam","setQueryParams","CategoryFilterOverlay","mapStateToProps","state","isInfoLoading","ProductListInfoReducer","isLoading","isProductsLoading","ProductListReducer","totalPages","mapDispatchToProps","dispatch","goToPreviousHeaderState","changeHeaderState","CategoryFilterOverlayContainer","containerFunctions","onSeeResultsClick","bind","toggleCustomFilter","getFilterUrl","getCustomFilterUrl","onVisible","onHide","historyBackHook","props","customFiltersValues","Object","keys","length","containerProps","areFiltersEmpty","getAreFiltersEmpty","isContentFiltered","filterName","filterArray","location","history","customFilters","page","requestVar","value","updateFilter","_getNewFilterArray","isFull","pathname","selectedFilters","_getNewSelectedFiltersString","formattedFilters","_formatSelectedFiltersString","filterKey","selectedFiltersString","split","reduce","acc","filter","key","prevCustomFilters","_getSelectedFiltersFromUrl","customFilers","entries","accumulator","filterValue","filterValues","sort","join","push","string","hasTrailingSemicolon","hasLeadingSemicolon","slice","search","name","title","__","onCloseClick","isHidden","window","addEventListener","pushState","overlayOpen","removeEventListener","availableFilters","urlStringToObject","priceMin","priceMax","substr","part","newFilterArray","undefined","Array","from","filterValueIndex","indexOf","splice","defineProperty","_CategoryFilterOverlayContainer"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { withRouter } from 'react-router';\n\nimport { FILTER } from 'Component/Header/Header.config';\nimport { changeNavigationState, goToPreviousNavigationState } from 'Store/Navigation/Navigation.action';\nimport { BOTTOM_NAVIGATION_TYPE, TOP_NAVIGATION_TYPE } from 'Store/Navigation/Navigation.reducer';\nimport { hideActiveOverlay } from 'Store/Overlay/Overlay.action';\nimport { HistoryType, LocationType } from 'Type/Common';\nimport { getQueryParam, setQueryParams } from 'Util/Url';\n\nimport CategoryFilterOverlay from './CategoryFilterOverlay.component';\n\n/** @namespace Component/CategoryFilterOverlay/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    isInfoLoading: state.ProductListInfoReducer.isLoading,\n    isProductsLoading: state.ProductListReducer.isLoading,\n    totalPages: state.ProductListReducer.totalPages\n});\n\n/** @namespace Component/CategoryFilterOverlay/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    hideActiveOverlay: () => dispatch(hideActiveOverlay()),\n    goToPreviousHeaderState: () => dispatch(goToPreviousNavigationState(TOP_NAVIGATION_TYPE)),\n    goToPreviousNavigationState: () => dispatch(goToPreviousNavigationState(BOTTOM_NAVIGATION_TYPE)),\n    changeHeaderState: (state) => dispatch(changeNavigationState(TOP_NAVIGATION_TYPE, state)),\n    changeNavigationState: (state) => dispatch(changeNavigationState(BOTTOM_NAVIGATION_TYPE, state))\n});\n\n/** @namespace Component/CategoryFilterOverlay/Container */\nexport class CategoryFilterOverlayContainer extends PureComponent {\n    static propTypes = {\n        history: HistoryType.isRequired,\n        location: LocationType.isRequired,\n        customFiltersValues: PropTypes.objectOf(PropTypes.array).isRequired,\n        hideActiveOverlay: PropTypes.func.isRequired,\n        goToPreviousHeaderState: PropTypes.func.isRequired,\n        goToPreviousNavigationState: PropTypes.func.isRequired,\n        changeHeaderState: PropTypes.func.isRequired,\n        changeNavigationState: PropTypes.func.isRequired,\n        availableFilters: PropTypes.objectOf(PropTypes.shape).isRequired,\n        isInfoLoading: PropTypes.bool.isRequired\n    };\n\n    containerFunctions = {\n        onSeeResultsClick: this.onSeeResultsClick.bind(this),\n        toggleCustomFilter: this.toggleCustomFilter.bind(this),\n        getFilterUrl: this.getCustomFilterUrl.bind(this),\n        onVisible: this.onVisible.bind(this),\n        onHide: this.onHide.bind(this)\n    };\n\n    updateFilter(filterName, filterArray) {\n        const { location, history } = this.props;\n\n        setQueryParams({\n            customFilters: this.getFilterUrl(filterName, filterArray, false),\n            page: ''\n        }, location, history);\n    }\n\n    toggleCustomFilter(requestVar, value) {\n        this.updateFilter(requestVar, this._getNewFilterArray(requestVar, value));\n    }\n\n    getFilterUrl(filterName, filterArray, isFull = true) {\n        const { location: { pathname } } = this.props;\n        const selectedFilters = this._getNewSelectedFiltersString(filterName, filterArray);\n        const customFilters = isFull ? `${pathname}?customFilters=` : '';\n        const formattedFilters = this._formatSelectedFiltersString(selectedFilters);\n\n        return `${ customFilters }${ formattedFilters }`;\n    }\n\n    getCustomFilterUrl(filterKey, value) {\n        return this.getFilterUrl(filterKey, this._getNewFilterArray(filterKey, value));\n    }\n\n    _getSelectedFiltersFromUrl() {\n        const { location } = this.props;\n        const selectedFiltersString = (getQueryParam('customFilters', location) || '').split(';');\n\n        return selectedFiltersString.reduce((acc, filter) => {\n            if (!filter) {\n                return acc;\n            }\n            const [key, value] = filter.split(':');\n            return { ...acc, [key]: value.split(',') };\n        }, {});\n    }\n\n    _getNewSelectedFiltersString(filterName, filterArray) {\n        const prevCustomFilters = this._getSelectedFiltersFromUrl();\n        const customFilers = {\n            ...prevCustomFilters,\n            [filterName]: filterArray\n        };\n\n        return Object.entries(customFilers)\n            .reduce((accumulator, [filterKey, filterValue]) => {\n                if (filterValue.length) {\n                    const filterValues = filterValue.sort().join(',');\n\n                    accumulator.push(`${filterKey}:${filterValues}`);\n                }\n\n                return accumulator;\n            }, [])\n            .sort()\n            .join(';');\n    }\n\n    _formatSelectedFiltersString(string) {\n        const hasTrailingSemicolon = string[string.length - 1] === ';';\n        const hasLeadingSemicolon = string[0] === ';';\n\n        if (hasLeadingSemicolon) {\n            return this._formatSelectedFiltersString(string.slice(0, -1));\n        }\n\n        if (hasTrailingSemicolon) {\n            return string.slice(1);\n        }\n\n        return string;\n    }\n\n    onSeeResultsClick() {\n        const {\n            hideActiveOverlay,\n            goToPreviousHeaderState,\n            goToPreviousNavigationState\n        } = this.props;\n\n        hideActiveOverlay();\n        goToPreviousHeaderState();\n        goToPreviousNavigationState();\n    }\n\n    onVisible() {\n        const {\n            hideActiveOverlay,\n            changeHeaderState,\n            changeNavigationState,\n            goToPreviousNavigationState,\n            location: { pathname, search }\n        } = this.props;\n\n        changeHeaderState({\n            name: FILTER,\n            title: __('Filters'),\n            onCloseClick: () => {\n                hideActiveOverlay();\n                goToPreviousNavigationState();\n            }\n        });\n\n        changeNavigationState({\n            name: FILTER,\n            isHidden: true\n        });\n\n        window.addEventListener('popstate', this.historyBackHook);\n\n        history.pushState(\n            { overlayOpen: true },\n            '',\n            pathname + search\n        );\n    }\n\n    historyBackHook = () => {\n        const {\n            goToPreviousNavigationState,\n            customFiltersValues,\n            hideActiveOverlay,\n            goToPreviousHeaderState\n        } = this.props;\n\n        goToPreviousNavigationState();\n\n        // close filter only if no applied filters left\n        if (Object.keys(customFiltersValues).length === 0) {\n            hideActiveOverlay();\n            goToPreviousHeaderState();\n        }\n    };\n\n    onHide() {\n        window.removeEventListener('popstate', this.historyBackHook);\n    }\n\n    getAreFiltersEmpty() {\n        const { isInfoLoading, availableFilters } = this.props;\n\n        return !isInfoLoading && (\n            !availableFilters\n            || !Object.keys(availableFilters).length\n        );\n    }\n\n    containerProps = () => ({\n        areFiltersEmpty: this.getAreFiltersEmpty(),\n        isContentFiltered: this.isContentFiltered()\n    });\n\n    isContentFiltered() {\n        const { customFilters, priceMin, priceMax } = this.urlStringToObject();\n        return !!(customFilters || priceMin || priceMax);\n    }\n\n    urlStringToObject() {\n        const { location: { search } } = this.props;\n        return search.substr(1).split('&').reduce((acc, part) => {\n            const [key, value] = part.split('=');\n            return { ...acc, [key]: value };\n        }, {});\n    }\n\n    /**\n     * Returns filter array with new parameters\n     *\n     * @param {String} filterKey key of option\n     * @param {String} value\n     * @returns {Object[]}\n     * @memberof CategoryShoppingOptions\n     */\n    _getNewFilterArray(filterKey, value) {\n        const { customFiltersValues } = this.props;\n        const newFilterArray = customFiltersValues[filterKey] !== undefined\n            ? Array.from(customFiltersValues[filterKey])\n            : [];\n\n        const filterValueIndex = newFilterArray.indexOf(value);\n\n        if (filterKey === 'price') { // for price filter, choose one\n            return [value];\n        }\n\n        if (filterValueIndex === -1) {\n            newFilterArray.push(value);\n        } else {\n            newFilterArray.splice(filterValueIndex, 1);\n        }\n\n        return newFilterArray;\n    }\n\n    render() {\n        return (\n            <CategoryFilterOverlay\n              { ...this.props }\n              { ...this.containerFunctions }\n              { ...this.containerProps() }\n            />\n        );\n    }\n}\n\nexport default withRouter(\n    connect(mapStateToProps, mapDispatchToProps)(CategoryFilterOverlayContainer)\n);\n"]},"metadata":{},"sourceType":"module"}