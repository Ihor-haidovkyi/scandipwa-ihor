{"ast":null,"code":"import _objectSpread from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/* eslint-disable react/prop-types */ /**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import{PureComponent}from'react';import{connect}from'react-redux';import{CART,CART_EDITING}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/Header/Header.config\";import{CUSTOMER_ACCOUNT_OVERLAY_KEY}from\"/home/marketihor/scandipwa/packages/scandipwa/src/component/MyAccountOverlay/MyAccountOverlay.config\";import{CHECKOUT_URL}from\"/home/marketihor/scandipwa/packages/scandipwa/src/route/Checkout/Checkout.config\";import{updateMeta as _updateMeta}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Meta/Meta.action\";import{changeNavigationState}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.action\";import{TOP_NAVIGATION_TYPE}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Navigation/Navigation.reducer\";import{showNotification as _showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import{toggleOverlayByKey}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Overlay/Overlay.action\";import{HistoryType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Common\";import{DeviceType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/Device\";import{TotalsType}from\"/home/marketihor/scandipwa/packages/scandipwa/src/type/MiniCart\";import{isSignedIn}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Auth\";import{getCartShippingPrice,getCartShippingSubPrice,getCartSubtotal,getCartSubtotalSubPrice,getCartTotalSubPrice,hasOutOfStockProductsInCartItems}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Cart\";import history from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/History\";import{appendWithStoreCode}from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Url\";import CartPage from\"./CartPage.component\";export var BreadcrumbsDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Breadcrumbs/Breadcrumbs.dispatcher\");export var CartDispatcher=import(/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Cart/Cart.dispatcher\");/** @namespace Route/CartPage/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{totals:state.CartReducer.cartTotals,headerState:state.NavigationReducer[TOP_NAVIGATION_TYPE].navigationState,guest_checkout:state.ConfigReducer.guest_checkout,device:state.ConfigReducer.device,cartDisplayConfig:state.ConfigReducer.cartDisplayConfig,cartSubtotal:getCartSubtotal(state),cartSubtotalSubPrice:getCartSubtotalSubPrice(state),cartTotalSubPrice:getCartTotalSubPrice(state),cartShippingPrice:getCartShippingPrice(state),cartShippingSubPrice:getCartShippingSubPrice(state)};},\"Route/CartPage/Container/mapStateToProps\");/** @namespace Route/CartPage/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{changeHeaderState:function changeHeaderState(state){return dispatch(changeNavigationState(TOP_NAVIGATION_TYPE,state));},updateBreadcrumbs:function updateBreadcrumbs(breadcrumbs){return BreadcrumbsDispatcher.then(function(_ref){var dispatcher=_ref.default;return dispatcher.update(breadcrumbs,dispatch);});},showOverlay:function showOverlay(overlayKey){return dispatch(toggleOverlayByKey(overlayKey));},showNotification:function showNotification(type,message){return dispatch(_showNotification(type,message));},updateMeta:function updateMeta(meta){return dispatch(_updateMeta(meta));},updateCrossSellProducts:function updateCrossSellProducts(items){return CartDispatcher.then(function(_ref2){var dispatcher=_ref2.default;return dispatcher.updateCrossSellProducts(items,dispatch);});}};},\"Route/CartPage/Container/mapDispatchToProps\");/** @namespace Route/CartPage/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _CartPageContainer=/*#__PURE__*/function(_Extensible){_inherits(_CartPageContainer,_Extensible);var _super=_createSuper(_CartPageContainer);function _CartPageContainer(){var _this;_classCallCheck(this,_CartPageContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isEditing:false};_this.containerFunctions={onCheckoutButtonClick:_this.onCheckoutButtonClick.bind(_assertThisInitialized(_this))};_this.containerProps=function(){var totals=_this.props.totals;return{hasOutOfStockProductsInCart:hasOutOfStockProductsInCartItems(totals.items)};};return _this;}_createClass(_CartPageContainer,[{key:\"componentDidMount\",value:function componentDidMount(){var updateMeta=this.props.updateMeta;updateMeta({title:__('Cart')});this._updateBreadcrumbs();this._changeHeaderState();this._updateCrossSellProducts();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var _this$props=this.props,changeHeaderState=_this$props.changeHeaderState,_this$props$totals$it=_this$props.totals.items_qty,items_qty=_this$props$totals$it===void 0?0:_this$props$totals$it,headerState=_this$props.headerState,name=_this$props.headerState.name;var prevItemsQty=prevProps.totals.items_qty,prevName=prevProps.headerState.name;if(name!==prevName){if(name===CART){this._changeHeaderState();}}if(items_qty!==prevItemsQty&&prevItemsQty!==undefined){var title=__('%s Item(s)',items_qty);changeHeaderState(_objectSpread(_objectSpread({},headerState),{},{title:title}));}}},{key:\"onCheckoutButtonClick\",value:function onCheckoutButtonClick(e){var _this$props2=this.props,history=_this$props2.history,guest_checkout=_this$props2.guest_checkout,showOverlay=_this$props2.showOverlay,showNotification=_this$props2.showNotification,device=_this$props2.device,totals=_this$props2.totals;// to prevent outside-click handler trigger\ne.nativeEvent.stopImmediatePropagation();if(hasOutOfStockProductsInCartItems(totals.items)){return;}if(guest_checkout){history.push({pathname:appendWithStoreCode(CHECKOUT_URL)});return;}if(isSignedIn()){history.push({pathname:appendWithStoreCode(CHECKOUT_URL)});return;}// fir notification whatever device that is\nshowNotification('info',__('Please sign-in to complete checkout!'));if(device.isMobile){// for all mobile devices, simply switch route\nhistory.push({pathname:appendWithStoreCode('/my-account')});return;}// for desktop, just open customer overlay\nshowOverlay(CUSTOMER_ACCOUNT_OVERLAY_KEY);}},{key:\"_updateBreadcrumbs\",value:function _updateBreadcrumbs(){var updateBreadcrumbs=this.props.updateBreadcrumbs;var breadcrumbs=[{url:'/cart',name:__('Shopping cart')}];updateBreadcrumbs(breadcrumbs);}},{key:\"_changeHeaderState\",value:function _changeHeaderState(){var _this2=this;var _this$props3=this.props,changeHeaderState=_this$props3.changeHeaderState,items_qty=_this$props3.totals.items_qty;var title=__('%s Item(s)',items_qty||0);changeHeaderState({name:CART,title:title,onEditClick:function onEditClick(){_this2.setState({isEditing:true});changeHeaderState({name:CART_EDITING,title:title,onOkClick:function onOkClick(){return _this2.setState({isEditing:false});},onCancelClick:function onCancelClick(){return _this2.setState({isEditing:false});}});},onCloseClick:function onCloseClick(){_this2.setState({isEditing:false});history.goBack();}});}},{key:\"_updateCrossSellProducts\",value:function _updateCrossSellProducts(){var _this$props4=this.props,updateCrossSellProducts=_this$props4.updateCrossSellProducts,_this$props4$totals=_this$props4.totals;_this$props4$totals=_this$props4$totals===void 0?{}:_this$props4$totals;var _this$props4$totals$i=_this$props4$totals.items,items=_this$props4$totals$i===void 0?[]:_this$props4$totals$i;updateCrossSellProducts(items);}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,CartPage,Object.assign({},this.props,this.state,this.containerFunctions,this.containerProps()));}}]);return _CartPageContainer;}(Extensible(PureComponent));Object.defineProperty(_CartPageContainer,'name',{value:'CartPageContainer'});export var CartPageContainer=middleware(_CartPageContainer,\"Route/CartPage/Container\");export default connect(mapStateToProps,mapDispatchToProps)(CartPageContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/route/CartPage/CartPage.container.js"],"names":["PureComponent","connect","CART","CART_EDITING","CUSTOMER_ACCOUNT_OVERLAY_KEY","CHECKOUT_URL","updateMeta","changeNavigationState","TOP_NAVIGATION_TYPE","showNotification","toggleOverlayByKey","HistoryType","DeviceType","TotalsType","isSignedIn","getCartShippingPrice","getCartShippingSubPrice","getCartSubtotal","getCartSubtotalSubPrice","getCartTotalSubPrice","hasOutOfStockProductsInCartItems","history","appendWithStoreCode","CartPage","BreadcrumbsDispatcher","CartDispatcher","mapStateToProps","state","totals","CartReducer","cartTotals","headerState","NavigationReducer","navigationState","guest_checkout","ConfigReducer","device","cartDisplayConfig","cartSubtotal","cartSubtotalSubPrice","cartTotalSubPrice","cartShippingPrice","cartShippingSubPrice","mapDispatchToProps","dispatch","changeHeaderState","updateBreadcrumbs","breadcrumbs","then","dispatcher","default","update","showOverlay","overlayKey","type","message","meta","updateCrossSellProducts","items","CartPageContainer","isEditing","containerFunctions","onCheckoutButtonClick","bind","containerProps","props","hasOutOfStockProductsInCart","title","__","_updateBreadcrumbs","_changeHeaderState","_updateCrossSellProducts","prevProps","items_qty","name","prevItemsQty","prevName","undefined","e","nativeEvent","stopImmediatePropagation","push","pathname","isMobile","url","onEditClick","setState","onOkClick","onCancelClick","onCloseClick","goBack","Object","defineProperty","_CartPageContainer","value"],"mappings":"q2BAAA,qC,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAGA,OAASA,aAAT,KAA8B,OAA9B,CACA,OAASC,OAAT,KAAwB,aAAxB,CAEA,OAASC,IAAT,CAAeC,YAAf,wFACA,OAASC,4BAAT,4GACA,OAASC,YAAT,wFACA,OAASC,UAAU,GAAVA,CAAAA,WAAT,gFACA,OAASC,qBAAT,4FACA,OAASC,mBAAT,6FACA,OAASC,gBAAgB,GAAhBA,CAAAA,iBAAT,gGACA,OAASC,kBAAT,sFACA,OAASC,WAAT,qEACA,OAASC,UAAT,qEACA,OAASC,UAAT,uEACA,OAASC,UAAT,mEACA,OACIC,oBADJ,CAEIC,uBAFJ,CAGIC,eAHJ,CAIIC,uBAJJ,CAKIC,oBALJ,CAMIC,gCANJ,mEAQA,MAAOC,CAAAA,OAAP,sEACA,OAASC,mBAAT,kEAEA,MAAOC,CAAAA,QAAP,4BAEA,MAAO,IAAMC,CAAAA,qBAAqB,CAAG,OACjC,0DADiC,6FAA9B,CAKP,MAAO,IAAMC,CAAAA,cAAc,CAAG,OAC1B,0DAD0B,+EAAvB,CAKP,0DACA,MAAO,IAAMC,CAAAA,eAAe,YAAG,SAACC,KAAD,QAAY,CACvCC,MAAM,CAAED,KAAK,CAACE,WAAN,CAAkBC,UADa,CAEvCC,WAAW,CAAEJ,KAAK,CAACK,iBAAN,CAAwBxB,mBAAxB,EAA6CyB,eAFnB,CAGvCC,cAAc,CAAEP,KAAK,CAACQ,aAAN,CAAoBD,cAHG,CAIvCE,MAAM,CAAET,KAAK,CAACQ,aAAN,CAAoBC,MAJW,CAKvCC,iBAAiB,CAAEV,KAAK,CAACQ,aAAN,CAAoBE,iBALA,CAMvCC,YAAY,CAAErB,eAAe,CAACU,KAAD,CANU,CAOvCY,oBAAoB,CAAErB,uBAAuB,CAACS,KAAD,CAPN,CAQvCa,iBAAiB,CAAErB,oBAAoB,CAACQ,KAAD,CARA,CASvCc,iBAAiB,CAAE1B,oBAAoB,CAACY,KAAD,CATA,CAUvCe,oBAAoB,CAAE1B,uBAAuB,CAACW,KAAD,CAVN,CAAZ,EAAH,4CAArB,CAaP,6DACA,MAAO,IAAMgB,CAAAA,kBAAkB,YAAG,SAACC,QAAD,QAAe,CAC7CC,iBAAiB,CAAE,2BAAClB,KAAD,QAAWiB,CAAAA,QAAQ,CAACrC,qBAAqB,CAACC,mBAAD,CAAsBmB,KAAtB,CAAtB,CAAnB,EAD0B,CAE7CmB,iBAAiB,CAAE,2BAACC,WAAD,QAAiBvB,CAAAA,qBAAqB,CAACwB,IAAtB,CAChC,kBAAYC,CAAAA,UAAZ,MAAGC,OAAH,OAA6BD,CAAAA,UAAU,CAACE,MAAX,CAAkBJ,WAAlB,CAA+BH,QAA/B,CAA7B,EADgC,CAAjB,EAF0B,CAK7CQ,WAAW,CAAE,qBAACC,UAAD,QAAgBT,CAAAA,QAAQ,CAAClC,kBAAkB,CAAC2C,UAAD,CAAnB,CAAxB,EALgC,CAM7C5C,gBAAgB,CAAE,0BAAC6C,IAAD,CAAOC,OAAP,QAAmBX,CAAAA,QAAQ,CAACnC,iBAAgB,CAAC6C,IAAD,CAAOC,OAAP,CAAjB,CAA3B,EAN2B,CAO7CjD,UAAU,CAAE,oBAACkD,IAAD,QAAUZ,CAAAA,QAAQ,CAACtC,WAAU,CAACkD,IAAD,CAAX,CAAlB,EAPiC,CAQ7CC,uBAAuB,CAAE,iCAACC,KAAD,QAAWjC,CAAAA,cAAc,CAACuB,IAAf,CAChC,mBAAYC,CAAAA,UAAZ,OAAGC,OAAH,OAA6BD,CAAAA,UAAU,CAACQ,uBAAX,CAAmCC,KAAnC,CAA0Cd,QAA1C,CAA7B,EADgC,CAAX,EARoB,CAAf,EAAH,+CAAxB,CAaP,0C,wEACA,UAAae,CAAAA,kBAAb,6WAcIhC,KAdJ,CAcY,CAAEiC,SAAS,CAAE,KAAb,CAdZ,OAgBIC,kBAhBJ,CAgByB,CACjBC,qBAAqB,CAAE,MAAKA,qBAAL,CAA2BC,IAA3B,+BADN,CAhBzB,OA0DIC,cA1DJ,CA0DqB,UAAM,IACXpC,CAAAA,MADW,CACA,MAAKqC,KADL,CACXrC,MADW,CAGnB,MAAO,CACHsC,2BAA2B,CAAE9C,gCAAgC,CAACQ,MAAM,CAAC8B,KAAR,CAD1D,CAAP,CAGH,CAhEL,+EAoBI,4BAAoB,IACRpD,CAAAA,UADQ,CACO,KAAK2D,KADZ,CACR3D,UADQ,CAGhBA,UAAU,CAAC,CAAE6D,KAAK,CAAEC,EAAE,CAAC,MAAD,CAAX,CAAD,CAAV,CAEA,KAAKC,kBAAL,GACA,KAAKC,kBAAL,GACA,KAAKC,wBAAL,GACH,CA5BL,kCA8BI,4BAAmBC,SAAnB,CAA8B,iBAMtB,KAAKP,KANiB,CAEtBpB,iBAFsB,aAEtBA,iBAFsB,mCAGtBjB,MAHsB,CAGZ6C,SAHY,CAGZA,SAHY,gCAGA,CAHA,uBAItB1C,WAJsB,aAItBA,WAJsB,CAKP2C,IALO,aAKtB3C,WALsB,CAKP2C,IALO,IASDC,CAAAA,YATC,CAWtBH,SAXsB,CAStB5C,MATsB,CASZ6C,SATY,CAUDG,QAVC,CAWtBJ,SAXsB,CAUtBzC,WAVsB,CAUP2C,IAVO,CAa1B,GAAIA,IAAI,GAAKE,QAAb,CAAuB,CACnB,GAAIF,IAAI,GAAKxE,IAAb,CAAmB,CACf,KAAKoE,kBAAL,GACH,CACJ,CAED,GAAIG,SAAS,GAAKE,YAAd,EAA8BA,YAAY,GAAKE,SAAnD,CAA8D,CAC1D,GAAMV,CAAAA,KAAK,CAAGC,EAAE,CAAC,YAAD,CAAeK,SAAf,CAAhB,CACA5B,iBAAiB,gCACVd,WADU,MAEboC,KAAK,CAALA,KAFa,GAAjB,CAIH,CACJ,CAxDL,qCAkEI,+BAAsBW,CAAtB,CAAyB,kBAQjB,KAAKb,KARY,CAEjB5C,OAFiB,cAEjBA,OAFiB,CAGjBa,cAHiB,cAGjBA,cAHiB,CAIjBkB,WAJiB,cAIjBA,WAJiB,CAKjB3C,gBALiB,cAKjBA,gBALiB,CAMjB2B,MANiB,cAMjBA,MANiB,CAOjBR,MAPiB,cAOjBA,MAPiB,CAUrB;AACAkD,CAAC,CAACC,WAAF,CAAcC,wBAAd,GAEA,GAAI5D,gCAAgC,CAACQ,MAAM,CAAC8B,KAAR,CAApC,CAAoD,CAChD,OACH,CAED,GAAIxB,cAAJ,CAAoB,CAChBb,OAAO,CAAC4D,IAAR,CAAa,CACTC,QAAQ,CAAE5D,mBAAmB,CAACjB,YAAD,CADpB,CAAb,EAIA,OACH,CAED,GAAIS,UAAU,EAAd,CAAkB,CACdO,OAAO,CAAC4D,IAAR,CAAa,CACTC,QAAQ,CAAE5D,mBAAmB,CAACjB,YAAD,CADpB,CAAb,EAIA,OACH,CAED;AACAI,gBAAgB,CAAC,MAAD,CAAS2D,EAAE,CAAC,sCAAD,CAAX,CAAhB,CAEA,GAAIhC,MAAM,CAAC+C,QAAX,CAAqB,CAAE;AACnB9D,OAAO,CAAC4D,IAAR,CAAa,CAAEC,QAAQ,CAAE5D,mBAAmB,CAAC,aAAD,CAA/B,CAAb,EACA,OACH,CAED;AACA8B,WAAW,CAAChD,4BAAD,CAAX,CACH,CA7GL,kCA+GI,6BAAqB,IACT0C,CAAAA,iBADS,CACa,KAAKmB,KADlB,CACTnB,iBADS,CAEjB,GAAMC,CAAAA,WAAW,CAAG,CAChB,CAAEqC,GAAG,CAAE,OAAP,CAAgBV,IAAI,CAAEN,EAAE,CAAC,eAAD,CAAxB,CADgB,CAApB,CAIAtB,iBAAiB,CAACC,WAAD,CAAjB,CACH,CAtHL,kCAwHI,6BAAqB,kCACoC,KAAKkB,KADzC,CACTpB,iBADS,cACTA,iBADS,CACoB4B,SADpB,cACU7C,MADV,CACoB6C,SADpB,CAEjB,GAAMN,CAAAA,KAAK,CAAGC,EAAE,CAAC,YAAD,CAAeK,SAAS,EAAI,CAA5B,CAAhB,CAEA5B,iBAAiB,CAAC,CACd6B,IAAI,CAAExE,IADQ,CAEdiE,KAAK,CAALA,KAFc,CAGdkB,WAAW,CAAE,sBAAM,CACf,MAAI,CAACC,QAAL,CAAc,CAAE1B,SAAS,CAAE,IAAb,CAAd,EACAf,iBAAiB,CAAC,CACd6B,IAAI,CAAEvE,YADQ,CAEdgE,KAAK,CAALA,KAFc,CAGdoB,SAAS,CAAE,2BAAM,CAAA,MAAI,CAACD,QAAL,CAAc,CAAE1B,SAAS,CAAE,KAAb,CAAd,CAAN,EAHG,CAId4B,aAAa,CAAE,+BAAM,CAAA,MAAI,CAACF,QAAL,CAAc,CAAE1B,SAAS,CAAE,KAAb,CAAd,CAAN,EAJD,CAAD,CAAjB,CAMH,CAXa,CAYd6B,YAAY,CAAE,uBAAM,CAChB,MAAI,CAACH,QAAL,CAAc,CAAE1B,SAAS,CAAE,KAAb,CAAd,EACAvC,OAAO,CAACqE,MAAR,GACH,CAfa,CAAD,CAAjB,CAiBH,CA7IL,wCA+II,mCAA2B,kBAMnB,KAAKzB,KANc,CAEnBR,uBAFmB,cAEnBA,uBAFmB,kCAGnB7B,MAHmB,kDAKf,EALe,mEAIf8B,KAJe,CAIfA,KAJe,gCAIP,EAJO,uBAQvBD,uBAAuB,CAACC,KAAD,CAAvB,CACH,CAxJL,sBA0JI,iBAAS,CACL,mCACK,QADL,kBAEW,KAAKO,KAFhB,CAGW,KAAKtC,KAHhB,CAIW,KAAKkC,kBAJhB,CAKW,KAAKG,cAAL,EALX,GAQH,CAnKL,2DAhFA2B,MAAM,CAACC,cAAP,CAAsBC,kBAAtB,CAA0C,MAA1C,CAAkD,CAAEC,KAAK,CAAE,mBAAT,CAAlD,E,uFAsPA,cAAe7F,CAAAA,OAAO,CAACyB,eAAD,CAAkBiB,kBAAlB,CAAP,CAA6CgB,iBAA7C,CAAf","sourcesContent":["/* eslint-disable react/prop-types */\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright Â© Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { CART, CART_EDITING } from 'Component/Header/Header.config';\nimport { CUSTOMER_ACCOUNT_OVERLAY_KEY } from 'Component/MyAccountOverlay/MyAccountOverlay.config';\nimport { CHECKOUT_URL } from 'Route/Checkout/Checkout.config';\nimport { updateMeta } from 'Store/Meta/Meta.action';\nimport { changeNavigationState } from 'Store/Navigation/Navigation.action';\nimport { TOP_NAVIGATION_TYPE } from 'Store/Navigation/Navigation.reducer';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { toggleOverlayByKey } from 'Store/Overlay/Overlay.action';\nimport { HistoryType } from 'Type/Common';\nimport { DeviceType } from 'Type/Device';\nimport { TotalsType } from 'Type/MiniCart';\nimport { isSignedIn } from 'Util/Auth';\nimport {\n    getCartShippingPrice,\n    getCartShippingSubPrice,\n    getCartSubtotal,\n    getCartSubtotalSubPrice,\n    getCartTotalSubPrice,\n    hasOutOfStockProductsInCartItems\n} from 'Util/Cart';\nimport history from 'Util/History';\nimport { appendWithStoreCode } from 'Util/Url';\n\nimport CartPage from './CartPage.component';\n\nexport const BreadcrumbsDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Breadcrumbs/Breadcrumbs.dispatcher'\n);\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\n\n/** @namespace Route/CartPage/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    totals: state.CartReducer.cartTotals,\n    headerState: state.NavigationReducer[TOP_NAVIGATION_TYPE].navigationState,\n    guest_checkout: state.ConfigReducer.guest_checkout,\n    device: state.ConfigReducer.device,\n    cartDisplayConfig: state.ConfigReducer.cartDisplayConfig,\n    cartSubtotal: getCartSubtotal(state),\n    cartSubtotalSubPrice: getCartSubtotalSubPrice(state),\n    cartTotalSubPrice: getCartTotalSubPrice(state),\n    cartShippingPrice: getCartShippingPrice(state),\n    cartShippingSubPrice: getCartShippingSubPrice(state)\n});\n\n/** @namespace Route/CartPage/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    changeHeaderState: (state) => dispatch(changeNavigationState(TOP_NAVIGATION_TYPE, state)),\n    updateBreadcrumbs: (breadcrumbs) => BreadcrumbsDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.update(breadcrumbs, dispatch)\n    ),\n    showOverlay: (overlayKey) => dispatch(toggleOverlayByKey(overlayKey)),\n    showNotification: (type, message) => dispatch(showNotification(type, message)),\n    updateMeta: (meta) => dispatch(updateMeta(meta)),\n    updateCrossSellProducts: (items) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.updateCrossSellProducts(items, dispatch)\n    )\n});\n\n/** @namespace Route/CartPage/Container */\nexport class CartPageContainer extends PureComponent {\n    static propTypes = {\n        updateBreadcrumbs: PropTypes.func.isRequired,\n        changeHeaderState: PropTypes.func.isRequired,\n        updateCrossSellProducts: PropTypes.func.isRequired,\n        showOverlay: PropTypes.func.isRequired,\n        showNotification: PropTypes.func.isRequired,\n        updateMeta: PropTypes.func.isRequired,\n        guest_checkout: PropTypes.bool.isRequired,\n        history: HistoryType.isRequired,\n        totals: TotalsType.isRequired,\n        device: DeviceType.isRequired\n    };\n\n    state = { isEditing: false };\n\n    containerFunctions = {\n        onCheckoutButtonClick: this.onCheckoutButtonClick.bind(this)\n    };\n\n    componentDidMount() {\n        const { updateMeta } = this.props;\n\n        updateMeta({ title: __('Cart') });\n\n        this._updateBreadcrumbs();\n        this._changeHeaderState();\n        this._updateCrossSellProducts();\n    }\n\n    componentDidUpdate(prevProps) {\n        const {\n            changeHeaderState,\n            totals: { items_qty = 0 },\n            headerState,\n            headerState: { name }\n        } = this.props;\n\n        const {\n            totals: { items_qty: prevItemsQty },\n            headerState: { name: prevName }\n        } = prevProps;\n\n        if (name !== prevName) {\n            if (name === CART) {\n                this._changeHeaderState();\n            }\n        }\n\n        if (items_qty !== prevItemsQty && prevItemsQty !== undefined) {\n            const title = __('%s Item(s)', items_qty);\n            changeHeaderState({\n                ...headerState,\n                title\n            });\n        }\n    }\n\n    containerProps = () => {\n        const { totals } = this.props;\n\n        return {\n            hasOutOfStockProductsInCart: hasOutOfStockProductsInCartItems(totals.items)\n        };\n    };\n\n    onCheckoutButtonClick(e) {\n        const {\n            history,\n            guest_checkout,\n            showOverlay,\n            showNotification,\n            device,\n            totals\n        } = this.props;\n\n        // to prevent outside-click handler trigger\n        e.nativeEvent.stopImmediatePropagation();\n\n        if (hasOutOfStockProductsInCartItems(totals.items)) {\n            return;\n        }\n\n        if (guest_checkout) {\n            history.push({\n                pathname: appendWithStoreCode(CHECKOUT_URL)\n            });\n\n            return;\n        }\n\n        if (isSignedIn()) {\n            history.push({\n                pathname: appendWithStoreCode(CHECKOUT_URL)\n            });\n\n            return;\n        }\n\n        // fir notification whatever device that is\n        showNotification('info', __('Please sign-in to complete checkout!'));\n\n        if (device.isMobile) { // for all mobile devices, simply switch route\n            history.push({ pathname: appendWithStoreCode('/my-account') });\n            return;\n        }\n\n        // for desktop, just open customer overlay\n        showOverlay(CUSTOMER_ACCOUNT_OVERLAY_KEY);\n    }\n\n    _updateBreadcrumbs() {\n        const { updateBreadcrumbs } = this.props;\n        const breadcrumbs = [\n            { url: '/cart', name: __('Shopping cart') }\n        ];\n\n        updateBreadcrumbs(breadcrumbs);\n    }\n\n    _changeHeaderState() {\n        const { changeHeaderState, totals: { items_qty } } = this.props;\n        const title = __('%s Item(s)', items_qty || 0);\n\n        changeHeaderState({\n            name: CART,\n            title,\n            onEditClick: () => {\n                this.setState({ isEditing: true });\n                changeHeaderState({\n                    name: CART_EDITING,\n                    title,\n                    onOkClick: () => this.setState({ isEditing: false }),\n                    onCancelClick: () => this.setState({ isEditing: false })\n                });\n            },\n            onCloseClick: () => {\n                this.setState({ isEditing: false });\n                history.goBack();\n            }\n        });\n    }\n\n    _updateCrossSellProducts() {\n        const {\n            updateCrossSellProducts,\n            totals: {\n                items = []\n            } = {}\n        } = this.props;\n\n        updateCrossSellProducts(items);\n    }\n\n    render() {\n        return (\n            <CartPage\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerFunctions }\n              { ...this.containerProps() }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CartPageContainer);\n"]},"metadata":{},"sourceType":"module"}