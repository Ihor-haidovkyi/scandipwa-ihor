{"ast":null,"code":"import _toConsumableArray from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/marketihor/scandipwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */import PropTypes from'prop-types';import{connect}from'react-redux';import ConfigQuery from\"/home/marketihor/scandipwa/packages/scandipwa/src/query/Config.query\";import{showNotification}from\"/home/marketihor/scandipwa/packages/scandipwa/src/store/Notification/Notification.action\";import BrowserDatabase from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/BrowserDatabase/BrowserDatabase\";import DataContainer from\"/home/marketihor/scandipwa/packages/scandipwa/src/util/Request/DataContainer\";import StoreSwitcher from\"./StoreSwitcher.component\";import{STORE_CONFIG_KEY}from\"./StoreSwitcher.config\";/** @namespace Component/StoreSwitcher/Container/mapStateToProps */export var mapStateToProps=middleware(function(state){return{device:state.ConfigReducer.device,currentStoreCode:state.ConfigReducer.code};},\"Component/StoreSwitcher/Container/mapStateToProps\");/** @namespace Component/StoreSwitcher/Container/mapDispatchToProps */export var mapDispatchToProps=middleware(function(dispatch){return{showErrorNotification:function showErrorNotification(message){return dispatch(showNotification('error',message));}};},\"Component/StoreSwitcher/Container/mapDispatchToProps\");/** @namespace Component/StoreSwitcher/Container */var _checkBEM=require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;export var _StoreSwitcherContainer=/*#__PURE__*/function(_Extensible){_inherits(_StoreSwitcherContainer,_Extensible);var _super=_createSuper(_StoreSwitcherContainer);function _StoreSwitcherContainer(){var _this;_classCallCheck(this,_StoreSwitcherContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={storeList:[],isOpened:false,storeLabel:''};_this.containerFunctions={handleStoreSelect:_this._handleStoreSelect.bind(_assertThisInitialized(_this)),onStoreSwitcherClick:_this.onStoreSwitcherClick.bind(_assertThisInitialized(_this)),onStoreSwitcherOutsideClick:_this.onStoreSwitcherOutsideClick.bind(_assertThisInitialized(_this))};_this.containerProps=function(){var _this$props=_this.props,currentStoreCode=_this$props.currentStoreCode,device=_this$props.device;return{currentStoreCode:currentStoreCode,device:device};};return _this;}_createClass(_StoreSwitcherContainer,[{key:\"componentDidMount\",value:function componentDidMount(){this._getStoreList();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var currentStoreCode=this.props.currentStoreCode;var prevStoreCode=prevProps.prevStoreCode;var _this$state=this.state,storeLabel=_this$state.storeLabel,storeList=_this$state.storeList;if(!storeList.length){this._getStoreList();}if(currentStoreCode&&(!storeLabel||prevStoreCode!==currentStoreCode)){this.getCurrentLabel(currentStoreCode);}}},{key:\"onStoreSwitcherClick\",value:function onStoreSwitcherClick(){var isOpened=this.state.isOpened;this.setState({isOpened:!isOpened});}},{key:\"onStoreSwitcherOutsideClick\",value:function onStoreSwitcherOutsideClick(){this.setState({isOpened:false});}},{key:\"_getStoreList\",value:function _getStoreList(){var _this2=this;this.fetchData([ConfigQuery.getStoreListField()],function(_ref){var storeList=_ref.storeList;return _this2.setState({storeList:_this2._formatStoreList(storeList)});});}},{key:\"_formatStoreList\",value:function _formatStoreList(storeList){return storeList.reduce(function(acc,_ref2){var name=_ref2.name,code=_ref2.code,is_active=_ref2.is_active,base_url=_ref2.base_url,base_link_url=_ref2.base_link_url;if(!is_active){return acc;}return[].concat(_toConsumableArray(acc),[{id:\"store_\".concat(code),value:code,storeUrl:base_url,storeLinkUrl:base_link_url,label:name}]);},[]);}},{key:\"getCurrentLabel\",value:function getCurrentLabel(storeCode){var storeList=this.state.storeList;var store=storeList.find(function(_ref3){var value=_ref3.value;return value===storeCode;});if(!store){return;}var label=store.label;this.setState({storeLabel:label});}},{key:\"_handleStoreSelect\",value:function _handleStoreSelect(storeCode){var showErrorNotification=this.props.showErrorNotification;var storeList=this.state.storeList;var store=storeList.find(function(_ref4){var value=_ref4.value;return value===storeCode;});if(!store){showErrorNotification(__('This store can not be opened!'));return;}BrowserDatabase.deleteItem(STORE_CONFIG_KEY);window.location=store.storeLinkUrl;}},{key:\"render\",value:function render(){return/*#__PURE__*/_checkBEM(React,StoreSwitcher,Object.assign({},this.containerFunctions,this.containerProps(),this.state));}}]);return _StoreSwitcherContainer;}(Extensible(DataContainer));_StoreSwitcherContainer.propTypes={showErrorNotification:PropTypes.func.isRequired,currentStoreCode:PropTypes.string};_StoreSwitcherContainer.defaultProps={currentStoreCode:'default'};Object.defineProperty(_StoreSwitcherContainer,'name',{value:'StoreSwitcherContainer'});export var StoreSwitcherContainer=middleware(_StoreSwitcherContainer,\"Component/StoreSwitcher/Container\");export default connect(mapStateToProps,mapDispatchToProps)(StoreSwitcherContainer);","map":{"version":3,"sources":["/home/marketihor/scandipwa/packages/scandipwa/src/component/StoreSwitcher/StoreSwitcher.container.js"],"names":["PropTypes","connect","ConfigQuery","showNotification","BrowserDatabase","DataContainer","StoreSwitcher","STORE_CONFIG_KEY","mapStateToProps","state","device","ConfigReducer","currentStoreCode","code","mapDispatchToProps","dispatch","showErrorNotification","message","StoreSwitcherContainer","storeList","isOpened","storeLabel","containerFunctions","handleStoreSelect","_handleStoreSelect","bind","onStoreSwitcherClick","onStoreSwitcherOutsideClick","containerProps","props","_getStoreList","prevProps","prevStoreCode","length","getCurrentLabel","setState","fetchData","getStoreListField","_formatStoreList","reduce","acc","name","is_active","base_url","base_link_url","id","value","storeUrl","storeLinkUrl","label","storeCode","store","find","__","deleteItem","window","location","propTypes","func","isRequired","string","defaultProps","Object","defineProperty","_StoreSwitcherContainer"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport ConfigQuery from 'Query/Config.query';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport BrowserDatabase from 'Util/BrowserDatabase/BrowserDatabase';\nimport DataContainer from 'Util/Request/DataContainer';\n\nimport StoreSwitcher from './StoreSwitcher.component';\nimport { STORE_CONFIG_KEY } from './StoreSwitcher.config';\n\n/** @namespace Component/StoreSwitcher/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    device: state.ConfigReducer.device,\n    currentStoreCode: state.ConfigReducer.code\n});\n\n/** @namespace Component/StoreSwitcher/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    showErrorNotification: (message) => dispatch(showNotification('error', message))\n});\n\n/** @namespace Component/StoreSwitcher/Container */\nexport class StoreSwitcherContainer extends DataContainer {\n    static propTypes = {\n        showErrorNotification: PropTypes.func.isRequired,\n        currentStoreCode: PropTypes.string\n    };\n\n    static defaultProps = {\n        currentStoreCode: 'default'\n    };\n\n    state = {\n        storeList: [],\n        isOpened: false,\n        storeLabel: ''\n    };\n\n    containerFunctions = {\n        handleStoreSelect: this._handleStoreSelect.bind(this),\n        onStoreSwitcherClick: this.onStoreSwitcherClick.bind(this),\n        onStoreSwitcherOutsideClick: this.onStoreSwitcherOutsideClick.bind(this)\n    };\n\n    componentDidMount() {\n        this._getStoreList();\n    }\n\n    componentDidUpdate(prevProps) {\n        const { currentStoreCode } = this.props;\n        const { prevStoreCode } = prevProps;\n        const { storeLabel, storeList } = this.state;\n\n        if (!storeList.length) {\n            this._getStoreList();\n        }\n\n        if (currentStoreCode && (!storeLabel || (prevStoreCode !== currentStoreCode))) {\n            this.getCurrentLabel(currentStoreCode);\n        }\n    }\n\n    containerProps = () => {\n        const { currentStoreCode, device } = this.props;\n        return { currentStoreCode, device };\n    };\n\n    onStoreSwitcherClick() {\n        const { isOpened } = this.state;\n\n        this.setState({ isOpened: !isOpened });\n    }\n\n    onStoreSwitcherOutsideClick() {\n        this.setState({ isOpened: false });\n    }\n\n    _getStoreList() {\n        this.fetchData(\n            [ConfigQuery.getStoreListField()],\n            ({ storeList }) => this.setState({\n                storeList: this._formatStoreList(storeList)\n            })\n        );\n    }\n\n    _formatStoreList(storeList) {\n        return storeList.reduce((acc, {\n            name, code, is_active, base_url, base_link_url\n        }) => {\n            if (!is_active) {\n                return acc;\n            }\n\n            return [\n                ...acc,\n                {\n                    id: `store_${ code }`,\n                    value: code,\n                    storeUrl: base_url,\n                    storeLinkUrl: base_link_url,\n                    label: name\n                }\n            ];\n        }, []);\n    }\n\n    getCurrentLabel(storeCode) {\n        const { storeList } = this.state;\n\n        const store = storeList.find(\n            ({ value }) => value === storeCode\n        );\n\n        if (!store) {\n            return;\n        }\n\n        const { label } = store;\n\n        this.setState({ storeLabel: label });\n    }\n\n    _handleStoreSelect(storeCode) {\n        const { showErrorNotification } = this.props;\n        const { storeList } = this.state;\n\n        const store = storeList.find(\n            ({ value }) => value === storeCode\n        );\n\n        if (!store) {\n            showErrorNotification(__('This store can not be opened!'));\n            return;\n        }\n\n        BrowserDatabase.deleteItem(STORE_CONFIG_KEY);\n        window.location = store.storeLinkUrl;\n    }\n\n    render() {\n        return (\n            <StoreSwitcher\n              { ...this.containerFunctions }\n              { ...this.containerProps() }\n              { ...this.state }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(StoreSwitcherContainer);\n"]},"metadata":{},"sourceType":"module"}